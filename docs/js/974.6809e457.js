"use strict";(self["webpackChunkosi"]=self["webpackChunkosi"]||[]).push([[974],{7292:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4114),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),_stores_apps_store__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5619),_lang__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7800),pinia__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2261);__webpack_exports__.A={name:"OSICalculator",props:{windowId:{type:String,required:!0}},data(){return{expression:"",result:"0",history:[],lastResult:null,LangData:{},isInitialized:!1}},computed:{...(0,pinia__WEBPACK_IMPORTED_MODULE_3__.n2)(_stores_apps_store__WEBPACK_IMPORTED_MODULE_1__.useAppsStore),reversedHistory(){return[...this.history].reverse().slice(0,5)}},watch:{expression(){this.isInitialized&&(this.calculate(),this.saveState())},history:{handler(){this.isInitialized&&this.saveState()},deep:!0},result(){this.isInitialized&&this.saveState()}},methods:{initFromStore(){if(!this.windowId||!this.appsStore)return void console.error("OSICalculator: windowId or appsStore is missing");const e=this.appsStore.getWindowState(this.windowId);console.log("OSICalculator loaded state:",e),e&&"calculator"===e.appType&&(this.expression=e.expression||"",this.result=e.result||"0",this.history=e.history||[],this.lastResult=e.lastResult||null),this.isInitialized=!0,console.log("OSICalculator initialized")},saveState(){if(!this.windowId||!this.appsStore||!this.isInitialized)return;const e={appType:"calculator",expression:this.expression,result:this.result,lastResult:this.lastResult,history:[...this.history],timestamp:Date.now()};console.log("OSICalculator saving state:",e),this.appsStore.saveWindowState(this.windowId,e)},appendNumber(e){null===this.lastResult||this.expression.includes("+")||this.expression.includes("-")||this.expression.includes("×")||this.expression.includes("÷")||(this.expression="",this.lastResult=null),this.expression+=e},appendOperation(e){if(this.expression){const s=this.expression.slice(-1);["+","-","×","÷"].includes(s)?this.expression=this.expression.slice(0,-1)+e:this.expression+=e}else{if(null===this.lastResult)return;this.expression=this.lastResult+e}this.lastResult=null},appendDecimal(){!this.expression||["+","-","×","÷"].includes(this.expression.slice(-1))?this.expression+="0.":this.expression.split(/[+\-×÷]/).pop().includes(".")||(this.expression+=".")},calculate(){if(this.expression)try{let expr=this.expression.replace(/×/g,"*").replace(/÷/g,"/"),calcResult=eval(expr);calcResult%1!==0&&(calcResult=parseFloat(calcResult.toFixed(10))),this.result=calcResult}catch(error){this.result="Ошибка"}else this.result="0"},calculateAndAddHistory(){if(!this.expression)return;const e=this.expression;this.calculate(),"Ошибка"!==this.result&&(this.addToHistory(e,this.result),this.lastResult=this.result,this.expression="")},addToHistory(e,s){this.history.push({expression:e,result:s,timestamp:(new Date).toLocaleTimeString()}),this.isInitialized&&this.saveState()},clearAll(){this.expression="",this.result="0",this.lastResult=null},clearEntry(){this.expression="",this.calculate()},backspace(){this.expression&&(this.expression=this.expression.slice(0,-1),this.calculate())},clearHistory(){this.history=[],this.isInitialized&&this.saveState()},useHistoryItem(e){this.expression=e.expression,this.result=e.result,this.lastResult=e.result},handleKeyPress(e){const s=e.key;/[0-9]/.test(s)?(this.appendNumber(s),e.preventDefault()):"+"===s?(this.appendOperation("+"),e.preventDefault()):"-"===s?(this.appendOperation("-"),e.preventDefault()):"*"===s?(this.appendOperation("×"),e.preventDefault()):"/"===s?(this.appendOperation("÷"),e.preventDefault()):"."===s||","===s?(this.appendDecimal(),e.preventDefault()):"Enter"===s||"="===s?(this.calculateAndAddHistory(),e.preventDefault()):"Escape"===s?(this.clearAll(),e.preventDefault()):"Backspace"===s&&(this.backspace(),e.preventDefault())}},mounted(){console.log("OSICalculator mounted with windowId:",this.windowId),window.addEventListener("keydown",this.handleKeyPress),this.$nextTick(()=>{this.initFromStore()});const e=navigator.language||navigator.userLanguage,s=e.split("-")[0];this.UserLang=s;const t=_lang__WEBPACK_IMPORTED_MODULE_2__._;this.LangData=s&&t&&t[s]?t[s]:t.en,setTimeout(()=>{this.isInitialized||this.initFromStore(),this.saveState()},100)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeyPress)}}},7800:function(e,s,t){t.d(s,{_:function(){return i}});const i={en:{history:"History",clearhistory:"Clear history"},ru:{history:"История",clearhistory:"Очистить историю"}}},9974:function(e,s,t){t.r(s),t.d(s,{default:function(){return y}});var i=t(6768),a=t(4232);const n={class:"calculator-app"},l={class:"calculator-display"},r={class:"expression"},o={class:"result"},c={class:"calculator-buttons"},u=["disabled"],p={class:"calculator-history"},_=["onClick"];function h(e,s){return(0,i.uX)(),(0,i.CE)("div",n,[(0,i.Lk)("div",l,[(0,i.Lk)("div",r,(0,a.v_)(e.expression||"0"),1),(0,i.Lk)("div",o,(0,a.v_)(e.result),1)]),(0,i.Lk)("div",c,[(0,i.Lk)("button",{class:"calc-btn clear",onClick:s[0]||(s[0]=(...s)=>e.clearAll&&e.clearAll(...s))},"C"),(0,i.Lk)("button",{class:"calc-btn clear",onClick:s[1]||(s[1]=(...s)=>e.clearEntry&&e.clearEntry(...s))},"CE"),(0,i.Lk)("button",{class:"calc-btn operation",onClick:s[2]||(s[2]=(...s)=>e.backspace&&e.backspace(...s))},"⌫"),(0,i.Lk)("button",{class:"calc-btn operation",onClick:s[3]||(s[3]=s=>e.appendOperation("÷"))},"÷"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[4]||(s[4]=s=>e.appendNumber("7"))},"7"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[5]||(s[5]=s=>e.appendNumber("8"))},"8"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[6]||(s[6]=s=>e.appendNumber("9"))},"9"),(0,i.Lk)("button",{class:"calc-btn operation",onClick:s[7]||(s[7]=s=>e.appendOperation("×"))},"×"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[8]||(s[8]=s=>e.appendNumber("4"))},"4"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[9]||(s[9]=s=>e.appendNumber("5"))},"5"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[10]||(s[10]=s=>e.appendNumber("6"))},"6"),(0,i.Lk)("button",{class:"calc-btn operation",onClick:s[11]||(s[11]=s=>e.appendOperation("-"))},"-"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[12]||(s[12]=s=>e.appendNumber("1"))},"1"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[13]||(s[13]=s=>e.appendNumber("2"))},"2"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[14]||(s[14]=s=>e.appendNumber("3"))},"3"),(0,i.Lk)("button",{class:"calc-btn operation",onClick:s[15]||(s[15]=s=>e.appendOperation("+"))},"+"),(0,i.Lk)("button",{class:"calc-btn number zero",onClick:s[16]||(s[16]=s=>e.appendNumber("0"))},"0"),(0,i.Lk)("button",{class:"calc-btn number",onClick:s[17]||(s[17]=s=>e.appendDecimal())},"."),(0,i.Lk)("button",{class:"calc-btn equals",onClick:s[18]||(s[18]=(...s)=>e.calculateAndAddHistory&&e.calculateAndAddHistory(...s)),disabled:!e.expression},"=",8,u)]),(0,i.Lk)("div",p,[(0,i.Lk)("h3",null,(0,a.v_)(e.LangData.history),1),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.reversedHistory,(s,t)=>((0,i.uX)(),(0,i.CE)("li",{key:t,onClick:t=>e.useHistoryItem(s)},(0,a.v_)(s.expression)+" = "+(0,a.v_)(s.result),9,_))),128))]),e.history.length>0?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"clear-history",onClick:s[19]||(s[19]=(...s)=>e.clearHistory&&e.clearHistory(...s))},(0,a.v_)(e.LangData.clearhistory),1)):(0,i.Q3)("",!0)])])}var d=t(7292),b=t(1241);const k=(0,b.A)(d.A,[["render",h]]);var y=k}}]);
//# sourceMappingURL=974.6809e457.js.map