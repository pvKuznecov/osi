"use strict";(self["webpackChunkosi"]=self["webpackChunkosi"]||[]).push([[156],{3677:function(t,e,a){a.d(e,{Sl:function(){return o},Z:function(){return n},xu:function(){return i}});a(6573),a(8100),a(7936),a(9577),a(4979);var s=a(7636),r=a(2272);class i{static fromBase64(t){return i.fromBuffer(Uint8Array.from(atob(t),t=>t.charCodeAt(0)))}static fromBuffer(t){const e=new i(t.length);return e.get(t,0)}constructor(t){this.len=t}get(t,e){const a=r.n5[s.UINT32_BE.get(t,e)];e+=4;const i=s.UINT32_BE.get(t,e);e+=4;const n=new s.StringType(i,"utf-8").get(t,e);e+=i;const o=s.UINT32_BE.get(t,e);e+=4;const h=new s.StringType(o,"utf-8").get(t,e);e+=o;const c=s.UINT32_BE.get(t,e);e+=4;const d=s.UINT32_BE.get(t,e);e+=4;const m=s.UINT32_BE.get(t,e);e+=4;const l=s.UINT32_BE.get(t,e);e+=4;const p=s.UINT32_BE.get(t,e);e+=4;const g=t.slice(e,e+p);return{type:a,format:n,description:h,width:c,height:d,colour_depth:m,indexed_color:l,data:g}}}const n={len:7,get:(t,e)=>({packetType:s.UINT8.get(t,e),vorbis:new s.StringType(6,"ascii").get(t,e+1)})},o={len:23,get:(t,e)=>({version:s.UINT32_LE.get(t,e+0),channelMode:s.UINT8.get(t,e+4),sampleRate:s.UINT32_LE.get(t,e+5),bitrateMax:s.UINT32_LE.get(t,e+9),bitrateNominal:s.UINT32_LE.get(t,e+13),bitrateMin:s.UINT32_LE.get(t,e+17)})}},4973:function(t,e,a){a.d(e,{_:function(){return d}});a(4114),a(6573),a(8100),a(7936),a(8111),a(7588),a(8237),a(9577),a(1549),a(9797),a(9631),a(5623);var s=a(7636),r=a(4940),i=a(9629),n=a(3677),o=a(5775);const h=r("music-metadata:parser:ogg:vorbis1");class c extends((0,o.fO)("Vorbis")){}class d{constructor(t,e){this.pageSegments=[],this.durationOnLastPage=!0,this.metadata=t,this.options=e}async parsePage(t,e){if(this.lastPageHeader=t,t.headerType.firstPage)this.parseFirstPage(t,e);else{if(t.headerType.continued){if(0===this.pageSegments.length)throw new c("Cannot continue on previous page");this.pageSegments.push(e)}if(t.headerType.lastPage||!t.headerType.continued){if(this.pageSegments.length>0){const t=d.mergeUint8Arrays(this.pageSegments);await this.parseFullPage(t)}this.pageSegments=t.headerType.lastPage?[]:[e]}}}static mergeUint8Arrays(t){const e=t.reduce((t,e)=>t+e.length,0),a=new Uint8Array(e);return t.forEach((t,e,s)=>{const r=s.slice(0,e).reduce((t,e)=>t+e.length,0);a.set(t,r)}),a}async flush(){await this.parseFullPage(d.mergeUint8Arrays(this.pageSegments))}async parseUserComment(t,e){const a=new i.Y(t,e),s=a.parseUserComment();return await this.addTag(s.key,s.value),s.len}async addTag(t,e){if("METADATA_BLOCK_PICTURE"===t&&"string"===typeof e){if(this.options.skipCovers)return void h("Ignore picture");e=n.xu.fromBase64(e),h(`Push picture: id=${t}, format=${e.format}`)}else h(`Push tag: id=${t}, value=${e}`);await this.metadata.addTag("vorbis",t,e)}calculateDuration(t){this.lastPageHeader&&this.metadata.format.sampleRate&&this.lastPageHeader.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",this.lastPageHeader.absoluteGranulePosition),this.metadata.setFormat("duration",this.lastPageHeader.absoluteGranulePosition/this.metadata.format.sampleRate))}parseFirstPage(t,e){this.metadata.setFormat("codec","Vorbis I"),this.metadata.setFormat("hasAudio",!0),h("Parse first page");const a=n.Z.get(e,0);if("vorbis"!==a.vorbis)throw new c("Metadata does not look like Vorbis");if(1!==a.packetType)throw new c("First Ogg page should be type 1: the identification header");{const t=n.Sl.get(e,n.Z.len);this.metadata.setFormat("sampleRate",t.sampleRate),this.metadata.setFormat("bitrate",t.bitrateNominal),this.metadata.setFormat("numberOfChannels",t.channelMode),h("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",t.sampleRate,t.bitrateNominal,t.channelMode)}}async parseFullPage(t){const e=n.Z.get(t,0);switch(h("Parse full page: type=%s, byteLength=%s",e.packetType,t.byteLength),e.packetType){case 3:return this.parseUserCommentList(t,n.Z.len);case 1:case 5:break}}async parseUserCommentList(t,e){const a=s.UINT32_LE.get(t,e);e+=4,e+=a;let r=s.UINT32_LE.get(t,e);e+=4;while(r-- >0)e+=await this.parseUserComment(t,e)}}},6156:function(t,e,a){a.r(e),a.d(e,{FlacParser:function(){return g}});a(8111),a(1701);var s=a(4940),r=a(7636),i=a(3677),n=a(7112),o=a(8442),h=a(4973),c=a(9629),d=a(5775),m=a(6254);const l=s("music-metadata:parser:FLAC");class p extends((0,d.fO)("FLAC")){}class g extends n.k{constructor(){super(...arguments),this.vorbisParser=new h._(this.metadata,this.options),this.padding=0}async postId3v2Parse(){const t=await this.tokenizer.readToken(o.e);if("fLaC"!==t.toString())throw new p("Invalid FLAC preamble");let e;do{e=await this.tokenizer.readToken(m.Tw),await this.parseDataBlock(e)}while(!e.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const t=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*t/this.metadata.format.duration)}}async parseDataBlock(t){switch(l(`blockHeader type=${t.type}, length=${t.length}`),t.type){case m._B.STREAMINFO:return this.readBlockStreamInfo(t.length);case m._B.PADDING:this.padding+=t.length;break;case m._B.APPLICATION:break;case m._B.SEEKTABLE:break;case m._B.VORBIS_COMMENT:return this.readComment(t.length);case m._B.CUESHEET:break;case m._B.PICTURE:return void await this.parsePicture(t.length);default:this.metadata.addWarning(`Unknown block type: ${t.type}`)}return this.tokenizer.ignore(t.length).then()}async readBlockStreamInfo(t){if(t!==m.om.len)throw new p("Unexpected block-stream-info length");const e=await this.tokenizer.readToken(m.om);this.metadata.setFormat("container","FLAC"),this.processsStreamInfo(e)}processsStreamInfo(t){this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("hasAudio",!0),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",t.channels),this.metadata.setFormat("bitsPerSample",t.bitsPerSample),this.metadata.setFormat("sampleRate",t.sampleRate),t.totalSamples>0&&this.metadata.setFormat("duration",t.totalSamples/t.sampleRate)}async readComment(t){const e=await this.tokenizer.readToken(new r.Uint8ArrayType(t));return this.parseComment(e)}async parseComment(t){const e=new c.Y(t,0),a=e.readStringUtf8();a.length>0&&this.metadata.setFormat("tool",a);const s=e.readInt32(),r=new Array(s);for(let i=0;i<s;i++)r[i]=e.parseUserComment();await Promise.all(r.map(t=>("ENCODER"===t.key&&this.metadata.setFormat("tool",t.value),this.addTag(t.key,t.value))))}async parsePicture(t){return this.options.skipCovers?this.tokenizer.ignore(t):this.addPictureTag(await this.tokenizer.readToken(new i.xu(t)))}addPictureTag(t){return this.addTag("METADATA_BLOCK_PICTURE",t)}addTag(t,e){return this.vorbisParser.addTag(t,e)}}},6254:function(t,e,a){a.d(e,{Tw:function(){return n},_B:function(){return i},om:function(){return o}});var s=a(1488),r=a(7636);const i={STREAMINFO:0,PADDING:1,APPLICATION:2,SEEKTABLE:3,VORBIS_COMMENT:4,CUESHEET:5,PICTURE:6},n={len:4,get:(t,e)=>({lastBlock:s.mh(t,e,7),type:s.f5(t,e,1,7),length:r.UINT24_BE.get(t,e+1)})},o={len:34,get:(t,e)=>({minimumBlockSize:r.UINT16_BE.get(t,e),maximumBlockSize:r.UINT16_BE.get(t,e+2)/1e3,minimumFrameSize:r.UINT24_BE.get(t,e+4),maximumFrameSize:r.UINT24_BE.get(t,e+7),sampleRate:r.UINT24_BE.get(t,e+10)>>4,channels:s.f5(t,e+12,4,3)+1,bitsPerSample:s.f5(t,e+12,7,5)+1,totalSamples:s.f5(t,e+13,4,36),fileMD5:new r.Uint8ArrayType(16).get(t,e+18)})}},7112:function(t,e,a){a.d(e,{k:function(){return d}});var s=a(8968),r=a(4940),i=a(2272),n=a(9219),o=a(2898),h=a(6351);const c=r("music-metadata:parser:ID3");class d extends h.s{constructor(){super(...arguments),this.id3parser=new n.S}static async startsWithID3v2Header(t){return"ID3"===(await t.peekToken(i.yW)).fileIdentifier}async parse(){try{await this.parseID3v2()}catch(t){if(!(t instanceof s.d1))throw t;c("End-of-stream")}}finalize(){}async parseID3v2(){if(await this.tryReadId3v2Headers(),c("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny())this.finalize();else{const t=new o.Bn(this.metadata,this.tokenizer,this.options);await t.parse(),this.finalize()}}async tryReadId3v2Headers(){const t=await this.tokenizer.peekToken(i.yW);if("ID3"===t.fileIdentifier)return c("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}}},9629:function(t,e,a){a.d(e,{Y:function(){return i}});var s=a(7636),r=a(4656);class i{constructor(t,e){this.data=t,this.offset=e}readInt32(){const t=s.UINT32_LE.get(this.data,this.offset);return this.offset+=4,t}readStringUtf8(){const t=this.readInt32(),e=(0,r.c)(this.data.subarray(this.offset,this.offset+t),"utf-8");return this.offset+=t,e}parseUserComment(){const t=this.offset,e=this.readStringUtf8(),a=e.indexOf("=");return{key:e.substring(0,a).toUpperCase(),value:e.substring(a+1),len:this.offset-t}}}}}]);
//# sourceMappingURL=156.260b9bf6.js.map