"use strict";(self["webpackChunkosi"]=self["webpackChunkosi"]||[]).push([[127],{5619:function(t,r,e){e.d(r,{T:function(){return n}});var o=e(2261),i=e(144);const n=(0,o.nY)("apps",()=>{const t=(0,i.KR)({}),r=(r,e)=>{r&&(t.value[r]={...t.value[r],...e,lastUpdated:Date.now()},console.log("State saved for window:",r,t.value[r]))},e=r=>r&&t.value[r]||null,o=r=>{r&&delete t.value[r]},n=()=>{t.value={}},s=(r,e)=>{if(!e)return null;const o=t.value[e];return o&&o.appType===r?o:null};return{windowStates:t,saveWindowState:r,getWindowState:e,deleteWindowState:o,clearAllStates:n,getAppState:s}})},7127:function(t,r,e){e.r(r),e.d(r,{default:function(){return I}});var o=e(6768),i=e(5130);const n={class:"browser-app"},s={key:0,class:"browser-controls"},a={class:"url-bar"},l=["disabled"],c=["disabled"],d={class:"iframe-wrapper"},h=["src"],u={key:1,class:"loading-indicator"},p={key:2,class:"error-message"};function w(t,r,e,w,f,m){return(0,o.uX)(),(0,o.CE)("div",n,[e.showControls?((0,o.uX)(),(0,o.CE)("div",s,[(0,o.Lk)("div",a,[(0,o.Lk)("button",{onClick:r[0]||(r[0]=(...t)=>m.goBack&&m.goBack(...t)),disabled:!m.canGoBack,title:"Назад"},"←",8,l),(0,o.Lk)("button",{onClick:r[1]||(r[1]=(...t)=>m.goForward&&m.goForward(...t)),disabled:!m.canGoForward,title:"Вперёд"},"→",8,c),(0,o.Lk)("button",{onClick:r[2]||(r[2]=(...t)=>m.reload&&m.reload(...t)),title:"Обновить"},"↻"),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":r[3]||(r[3]=t=>f.currentUrl=t),onKeyup:r[4]||(r[4]=(0,i.jR)((...t)=>m.navigate&&m.navigate(...t),["enter"])),class:"url-input",placeholder:"Введите URL..."},null,544),[[i.Jo,f.currentUrl]]),(0,o.Lk)("button",{onClick:r[5]||(r[5]=(...t)=>m.navigate&&m.navigate(...t)),class:"go-btn"},"Перейти")])])):(0,o.Q3)("",!0),(0,o.Lk)("div",d,[(0,o.Lk)("iframe",{ref:"iframeRef",src:f.iframeSrc,onLoad:r[6]||(r[6]=(...t)=>m.onIframeLoad&&m.onIframeLoad(...t)),onError:r[7]||(r[7]=(...t)=>m.onIframeError&&m.onIframeError(...t)),sandbox:"allow-scripts allow-same-origin allow-forms allow-popups",referrerpolicy:"no-referrer"},null,40,h)]),f.loading?((0,o.uX)(),(0,o.CE)("div",u,[...r[9]||(r[9]=[(0,o.Lk)("div",{class:"spinner"},null,-1),(0,o.Lk)("span",null,"Загрузка...",-1)])])):(0,o.Q3)("",!0),f.error?((0,o.uX)(),(0,o.CE)("div",p,[r[10]||(r[10]=(0,o.Lk)("p",null,"⚠️ Не удалось загрузить страницу",-1)),(0,o.Lk)("button",{onClick:r[8]||(r[8]=(...t)=>m.reload&&m.reload(...t))},"Повторить")])):(0,o.Q3)("",!0)])}e(4114),e(4603),e(7566),e(8721);var f=e(5619),m=e(2261),g={name:"AppWiki",props:{windowId:{type:String,required:!0},showControls:{type:Boolean,default:!0}},data(){const t="https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0";return{currentUrl:t,iframeSrc:t,loading:!0,error:!1,history:[t],currentHistoryIndex:0}},computed:{...(0,m.n2)(f.T),canGoBack(){return this.currentHistoryIndex>0},canGoForward(){return this.currentHistoryIndex<this.history.length-1}},watch:{currentUrl(t){console.log("URL changed to:",t),this.saveState()},currentHistoryIndex(){this.saveState()},history:{handler(){this.saveState()},deep:!0}},methods:{initFromStore(){if(!this.windowId)return;const t=this.appsStore.getWindowState(this.windowId);console.log("Loaded state from store:",t),t&&(this.currentUrl=t.currentUrl||this.currentUrl,this.iframeSrc=t.currentUrl||this.iframeSrc,this.history=t.history||this.history,this.currentHistoryIndex=t.currentHistoryIndex||this.currentHistoryIndex)},saveState(){if(!this.windowId||!this.appsStore)return;const t={appType:"wiki",currentUrl:this.currentUrl,history:[...this.history],currentHistoryIndex:this.currentHistoryIndex,timestamp:Date.now()};this.appsStore.saveWindowState(this.windowId,t)},navigate(){let t=this.currentUrl.trim();t.startsWith("http://")||t.startsWith("https://")||(t="https://"+t);try{new URL(t),this.iframeSrc=t,this.loading=!0,this.error=!1,t!==this.history[this.currentHistoryIndex]&&(this.history=this.history.slice(0,this.currentHistoryIndex+1),this.history.push(t),this.currentHistoryIndex=this.history.length-1)}catch(r){console.error("Invalid URL:",t),this.error=!0,this.loading=!1}},goBack(){this.canGoBack&&(this.currentHistoryIndex--,this.currentUrl=this.history[this.currentHistoryIndex],this.iframeSrc=this.currentUrl,this.loading=!0)},goForward(){this.canGoForward&&(this.currentHistoryIndex++,this.currentUrl=this.history[this.currentHistoryIndex],this.iframeSrc=this.currentUrl,this.loading=!0)},reload(){this.loading=!0,this.error=!1;const t=this.iframeSrc;this.iframeSrc="",setTimeout(()=>{this.iframeSrc=t},50)},onIframeLoad(){console.log("Wiki iframe loaded successfully"),this.loading=!1,this.error=!1,this.safeGetTitle()},onIframeError(){console.error("Wiki iframe failed to load"),this.loading=!1,this.error=!0},safeGetTitle(){try{const t=this.$refs.iframeRef;if(t&&t.contentDocument){const r=t.contentDocument.title;r&&(console.log("Wiki page title:",r),this.$emit("title-change",r))}}catch(t){console.log("Cannot access iframe content due to CORS")}},openInNewTab(){window.open(this.currentUrl,"_blank","noopener,noreferrer")}},mounted(){console.log("AppWiki mounted with windowId:",this.windowId),this.initFromStore(),this.saveState()},beforeUnmount(){console.log("AppWiki unmounting, windowId:",this.windowId)}},y=e(1241);const k=(0,y.A)(g,[["render",w],["__scopeId","data-v-c1a6590c"]]);var I=k}}]);
//# sourceMappingURL=127.25b363e9.js.map