{"version":3,"file":"js/225.4ddbfd21.js","mappings":"gOAAO,MAAMA,EAAW,CACpBC,OAAQ,EACRC,KAAM,EACNC,IAAK,EACLC,KAAM,EACNC,OAAQ,EACRC,MAAO,GCCEC,EAAc,CACvBC,KAAM,MACNC,UAAW,CACP,UAAY,CACRD,KAAM,OACNC,UAAW,CACP,MAAQ,CAAED,KAAM,cAAeE,MAAOV,EAASE,MAC/C,MAAQ,CAAEM,KAAM,kBAAmBE,MAAOV,EAASE,MACnD,MAAQ,CAAEM,KAAM,iBAAkBE,MAAOV,EAASE,MAClD,MAAQ,CAAEM,KAAM,mBAAoBE,MAAOV,EAASE,MACpD,MAAQ,CAAEM,KAAM,UAAWE,MAAOV,EAASC,QAC3C,MAAQ,CAAEO,KAAM,iBAAkBE,MAAOV,EAASE,MAClD,MAAQ,CAAEM,KAAM,qBAAsBE,MAAOV,EAASE,QAI9D,UAAY,CACRM,KAAM,UACNC,UAAW,CAEP,UAAY,CACRD,KAAM,WACNC,UAAW,CACP,MAAQ,CACJD,KAAM,OACNG,UAAU,EACVF,UAAW,CACP,MAAQ,CAAED,KAAM,KAAME,MAAOV,EAASK,QACtC,MAAQ,CAAEG,KAAM,WAAYE,MAAOV,EAASE,UAM5D,UAAY,CACRM,KAAM,OACNC,UAAW,CACP,MAAQ,CAAED,KAAM,MAAOE,MAAOV,EAASG,KACvC,MAAQ,CAAEK,KAAM,WAAYE,MAAOV,EAASC,QAC5C,QAAU,CAAEO,KAAM,UAAWE,MAAOV,EAASG,KAC7C,QAAU,CAAEK,KAAM,eAAgBE,MAAOV,EAASC,QAClD,QAAU,CAAEO,KAAM,UAAWE,MAAOV,EAASG,KAC7C,QAAU,CAAEK,KAAM,eAAgBE,MAAOV,EAASC,QAClD,QAAU,CAAEO,KAAM,gBAAiBE,MAAOV,EAASE,MACnD,MAAQ,CAAEM,KAAM,WAAYE,MAAOV,EAASM,OAC5C,MAAQ,CAAEE,KAAM,UAAWE,MAAOV,EAASE,MAC3C,MAAQ,CAAEM,KAAM,QAASE,MAAOV,EAASC,QACzC,MAAQ,CAAEO,KAAM,YAAaE,MAAOV,EAASC,QAC7C,MAAQ,CAAEO,KAAM,aAAcE,MAAOV,EAASC,UAItD,UAAY,CACRO,KAAM,UACNG,UAAU,EACVF,UAAW,CACP,IAAM,CAAED,KAAM,WAAYE,MAAOV,EAASG,KAC1C,MAAQ,CAAEK,KAAM,gBAAiBG,UAAU,GAC3C,IAAM,CAAEH,KAAM,WAAYE,MAAOV,EAASG,KAC1C,IAAM,CAAEK,KAAM,WAAYE,MAAOV,EAASG,KAC1C,IAAM,CAAEK,KAAM,cACd,IAAM,CAAEA,KAAM,iBAItB,UAAY,CACRA,KAAM,SACNC,UAAW,CACP,IAAM,CACFD,KAAM,UACNG,UAAU,EACVF,UAAW,CACP,IAAM,CAAED,KAAM,cAAeE,MAAOV,EAASE,MAC7C,MAAQ,CAAEM,KAAM,MAAOE,MAAOV,EAASG,KACvC,IAAM,CAAEK,KAAM,YAAaE,MAAOV,EAASE,MAC3C,IAAM,CAAEM,KAAM,cAAeE,MAAOV,EAASI,MAC7C,IAAM,CAAEI,KAAM,cAAeE,MAAOV,EAASI,MAC7C,MAAQ,CAAEI,KAAM,aAAcE,MAAOV,EAASI,MAC9C,IAAM,CAAEI,KAAM,aAAcE,MAAOV,EAASI,MAC5C,MAAQ,CAAEI,KAAM,WAAYE,MAAOV,EAASE,MAC5C,MAAQ,CAAEM,KAAM,WAAYE,MAAOV,EAASE,MAC5C,QAAU,CAAEM,KAAM,kBAAmBE,MAAOV,EAASE,MACrD,QAAU,CAAEM,KAAM,gBAAiBE,MAAOV,EAASM,OACnD,MAAQ,CAAEE,KAAM,OAAQE,MAAOV,EAASC,QACxC,QAAU,CAAEO,KAAM,WAAYE,MAAOV,EAASC,QAC9C,IAAM,CAAEO,KAAM,UAAWE,MAAOV,EAASC,QACzC,MAAQ,CAAEO,KAAM,eAAgBE,MAAOV,EAASK,QAChD,QAAU,CAAEG,KAAM,YAAaE,MAAOV,EAASC,QAC/C,QAAU,CAAEO,KAAM,gBAAiBE,MAAOV,EAASC,QACnD,QAAU,CAAEO,KAAM,eAAgBE,MAAOV,EAASC,QAClD,OAAU,CAAEO,KAAM,mBAAoBE,MAAOV,EAASC,QACtD,IAAM,CAAEO,KAAM,iBAAkBE,MAAOV,EAASI,MAChD,MAAQ,CAAEI,KAAM,eAAgBE,MAAOV,EAASE,MAEhD,IAAM,CACFM,KAAM,QACNC,UAAW,CACP,IAAM,CAAED,KAAM,iBAAkBE,MAAOV,EAASI,MAChD,MAAQ,CAAEI,KAAM,aAAcE,MAAOV,EAASE,MAC9C,IAAM,CAAEM,KAAM,aAAcE,MAAOV,EAASE,MAC5C,IAAM,CAAEM,KAAM,cAAeE,MAAOV,EAASE,MAC7C,MAAQ,CAAEM,KAAM,eAAgBE,MAAOV,EAASE,MAChD,MAAQ,CAAEM,KAAM,gBAAiBE,MAAOV,EAASE,MACjD,MAAQ,CAAEM,KAAM,kBAAmBE,MAAOV,EAASE,MACnD,QAAU,CAAEM,KAAM,cAAeE,MAAOV,EAASE,MACjD,QAAU,CAAEM,KAAM,aAAcE,MAAOV,EAASM,SAIxD,IAAM,CACFE,KAAM,QACNC,UAAW,CACP,IAAM,CAAED,KAAM,oBAAqBE,MAAOV,EAASM,OACnD,MAAQ,CAAEE,KAAM,0BAA2BE,MAAOV,EAASM,OAC3D,IAAM,CAAEE,KAAM,WAAYE,MAAOV,EAASE,MAC1C,IAAM,CAAEM,KAAM,WAAYE,MAAOV,EAASE,MAC1C,MAAQ,CAAEM,KAAM,mBAAoBE,MAAOV,EAASK,QACpD,MAAQ,CAAEG,KAAM,WAAYE,MAAOV,EAASE,QAIpD,MAAQ,CACJM,KAAM,mBACNC,UAAW,CACP,MAAQ,CACJD,KAAM,kBACNC,UAAW,CACP,MAAQ,CAAED,KAAM,QAASE,MAAOV,EAASE,MACzC,MAAQ,CAAEM,KAAM,QAASE,MAAOV,EAASI,MACzC,MAAQ,CAAEI,KAAM,OAAQE,MAAOV,EAASE,MACxC,MAAQ,CACJM,KAAM,kBACNC,UAAW,CACP,MAAQ,CAAED,KAAM,kBAAmBE,MAAOV,EAASE,MACnD,MAAQ,CAAEM,KAAM,sBAAuBE,MAAOV,EAASK,UAG/D,MAAQ,CACJG,KAAM,kBACNC,UAAW,CACP,MAAQ,CAAED,KAAM,iBAAkBE,MAAOV,EAASE,MAClD,MAAQ,CAAEM,KAAM,kBAAmBE,MAAOV,EAASK,QACnD,MAAQ,CAAEG,KAAM,oBAAqBE,MAAOV,EAASK,QACrD,MAAQ,CAAEG,KAAM,oBAAqBE,MAAOV,EAASK,QACrD,MAAQ,CAAEG,KAAM,kBAAmBE,MAAOV,EAASE,MACnD,MAAQ,CAAEM,KAAM,sBAAuBE,MAAOV,EAASE,QAG/D,MAAQ,CAAEM,KAAM,WAAYE,MAAOV,EAASE,cAU5E,UAAY,CACRM,KAAM,OACNC,UAAW,CACP,IAAM,CACFD,KAAM,WACNC,UAAW,CACP,IAAM,CAAED,KAAM,UAAWE,MAAOV,EAASG,KACzC,IAAM,CACFK,KAAM,YACNC,UAAW,CACP,IAAM,CAAED,KAAM,QAASE,MAAOV,EAASE,MACvC,IAAM,CAAEM,KAAM,kBAAmBE,MAAOV,EAASE,MACjD,MAAQ,CAAEM,KAAM,cAAeE,MAAOV,EAASE,MAC/C,IAAM,CAAEM,KAAM,aAAcE,MAAOV,EAASE,MAC5C,IAAM,CACFM,KAAM,YAAaC,UAAW,CAC1B,IAAM,CAAED,KAAM,OAAQE,MAAOV,EAASE,MACtC,IAAM,CAAEM,KAAM,UAAWE,MAAOV,EAASE,MACzC,MAAQ,CAAEM,KAAM,SAAUE,MAAOV,EAASE,MAC1C,IAAM,CAAEM,KAAM,aAAcE,MAAOV,EAASE,QAGpD,IAAM,CAAEM,KAAM,mBAAoBE,MAAOV,EAASE,YAQ1E,UAAY,CACRM,KAAM,cACNC,UAAW,CACP,MAAQ,CACJD,KAAM,gBACNG,UAAU,EACVF,UAAW,CACP,MAAQ,CAAED,KAAM,cAAeE,MAAOV,EAASC,QAC/C,MAAQ,CAAEO,KAAM,OAAQE,MAAOV,EAASC,QACxC,MAAQ,CAAEO,KAAM,WAAYE,MAAOV,EAASC,QAC5C,MAAQ,CAAEO,KAAM,OAAQE,MAAOV,EAASK,QACxC,MAAQ,CAAEG,KAAM,MAAOE,MAAOV,EAASG,SAMvD,UAAY,CACRK,KAAM,WACNC,UAAW,CACP,MAAQ,CACJD,KAAM,eACNC,UAAW,CACP,IAAM,CACFD,KAAM,cACNC,UAAW,CACP,MAAQ,CAAED,KAAM,MAAOE,MAAOV,EAASG,KACvC,IAAM,CAAEK,KAAM,YAAaE,MAAOV,EAASE,MAC3C,IAAM,CAAEM,KAAM,UAAWE,MAAOV,EAASG,KACzC,IAAM,CAAEK,KAAM,SAAUE,MAAOV,EAASI,MACxC,MAAQ,CAAEI,KAAM,UAAWE,MAAOV,EAASG,KAC3C,IAAM,CACFK,KAAM,QAASC,UAAW,CACtB,IAAM,CAAED,KAAM,cAAeE,MAAOV,EAASG,KAC7C,IAAM,CACFK,KAAM,UAAWC,UAAW,CACxB,IAAM,CAAED,KAAM,SAAUE,MAAOV,EAASC,QACxC,MAAQ,CAAEO,KAAM,YAAaE,MAAOV,EAASC,QAC7C,MAAQ,CAAEO,KAAM,WAAYE,MAAOV,EAASC,kBAYpF,UAAY,CACRO,KAAM,OACNC,UAAW,CACP,MAAQ,CACJD,KAAM,MACNG,UAAU,EACVF,UAAW,CACP,MAAQ,CACJD,KAAM,SACNC,UAAW,CACP,MAAQ,CAAED,KAAM,cAAeE,MAAOV,EAASG,KAC/C,MAAQ,CAAEK,KAAM,gBAAiBE,MAAOV,EAASE,MACjD,MAAQ,CAAEM,KAAM,mBAAoBE,MAAOV,EAASG,KACpD,MAAQ,CAAEK,KAAM,aAAcE,MAAOV,EAASC,QAC9C,MAAQ,CAAEO,KAAM,kBAAmBE,MAAOV,EAASE,MACnD,MAAQ,CAAEM,KAAM,gBAAiBE,MAAOV,EAASG,OAGzD,MAAQ,CACJK,KAAM,aACNG,UAAU,EACVF,UAAW,CACP,MAAQ,CAAED,KAAM,OAAQE,MAAOV,EAASC,QACxC,MAAQ,CAAEO,KAAM,SAAUE,MAAOV,EAASC,QAC1C,MAAQ,CAAEO,KAAM,SAAUE,MAAOV,EAASK,QAC1C,MAAQ,CAAEG,KAAM,WAAYE,MAAOV,EAASC,QAC5C,MAAQ,CAAEO,KAAM,eAAgBE,MAAOV,EAASC,QAChD,MAAQ,CAAEO,KAAM,UAAWE,MAAOV,EAASI,gB,sHC1QnF,MAAMQ,EAAQC,EAAU,8BACjB,MAAMC,WAAyBC,EAAAA,EAAAA,IAA+B,UAE9D,MAAMC,EAAc,CACvBC,SAAU,EACVC,cAAe,EACfC,aAAc,EACdC,iBAAkB,EAClBC,YAAa,GASV,MAAMC,EAKTC,WAAAA,CAAYC,GACRC,KAAKC,QAAU,EACfD,KAAKE,UAAY,IAAIC,IACrBH,KAAKI,gBAAkB,EACvBJ,KAAKK,kBAAoB,EACzBL,KAAKD,UAAYA,EACjBC,KAAKE,UAAUI,IAAI/B,EAASE,KAAM8B,GAAKP,KAAKQ,SAASD,IACrDP,KAAKE,UAAUI,IAAI/B,EAASC,OAAQ+B,GAAKP,KAAKS,WAAWF,IACzDP,KAAKE,UAAUI,IAAI/B,EAASK,OAAQ2B,GAAKP,KAAKU,WAAWH,IACzDP,KAAKE,UAAUI,IAAI/B,EAASG,IAAKiC,SAAaX,KAAKU,WAAWH,IAC9DP,KAAKE,UAAUI,IAAI/B,EAASI,KAAM4B,GAAKP,KAAKY,SAASL,IACrDP,KAAKE,UAAUI,IAAI/B,EAASM,MAAO0B,GAAKP,KAAKa,UAAUN,GAC3D,CACA,aAAMO,CAAQC,EAAYC,EAASC,GAC/B,OAAOjB,KAAKkB,eAAeC,EAAYJ,GAAaC,EAASC,EACjE,CACA,oBAAMC,CAAeH,EAAYC,EAASC,GACtC,MAAMG,EAAO,CAAC,EACd,MAAOpB,KAAKD,UAAUsB,SAAWL,EAAS,CACtC,IAAIM,EACJ,MAAMC,EAAkBvB,KAAKD,UAAUsB,SACvC,IACIC,QAAgBtB,KAAKwB,aACzB,CACA,MAAOC,GACH,GAAIA,aAAiBC,EAAAA,GACjB,MAEJ,MAAMD,CACV,CACA,MAAME,EAAQZ,EAAW/B,UAAUsC,EAAQM,IAC3C,GAAID,EAAO,CACP,MAAME,EAASZ,EAASa,UAAUH,GAClC,OAAQE,GACJ,KAAKtC,EAAYC,SAQT,GANI8B,EAAQM,GAKZzC,EAAM,sBAAsB4C,EAAeJ,WAAeL,EAAQM,GAAGI,SAAS,oBAAoBL,EAAM3C,0BAA0BuC,KAC9HI,EAAM3C,UAAW,CACjB,MAAMiD,QAAYjC,KAAKkB,eAAeS,EAAOL,EAAQY,KAAO,EAAIlC,KAAKD,UAAUsB,SAAWC,EAAQY,KAAO,EAAGjB,GACxGU,EAAMzC,UACDkC,EAAKO,EAAM5C,QACZqC,EAAKO,EAAM5C,MAAQ,IAEvBqC,EAAKO,EAAM5C,MAAMoD,KAAKF,IAGtBb,EAAKO,EAAM5C,MAAQkD,QAEjBhB,EAASmB,aAAaT,EAAOM,EAAKV,EAC5C,KACK,CACD,MAAMc,EAASrC,KAAKE,UAAUoC,IAAIX,EAAM1C,OACxC,GAAsB,oBAAXoD,EAAuB,CAC9B,MAAMpD,QAAcoD,EAAOf,GAC3BF,EAAKO,EAAM5C,MAAQE,QACbgC,EAASmB,aAAaT,EAAO1C,EAAOsC,EAC9C,CACJ,CAEJ,MACJ,KAAKhC,EAAYK,YACbT,EAAM,4BAA4B4C,EAAeJ,oBAAwBL,EAAQM,mBAAmBD,EAAM3C,yBAAyBuC,KACnI,MACJ,KAAKhC,EAAYE,cACbN,EAAM,wBAAwB4C,EAAeJ,oBAAwBL,EAAQM,mBAAmBD,EAAM3C,yBAAyBuC,WACzHvB,KAAKD,UAAUwC,OAAOjB,EAAQY,KACpC,MACJ,KAAK3C,EAAYG,aACbP,EAAM,wCAAwC4C,EAAeJ,oBAAwBL,EAAQM,mBAAmBD,EAAM3C,yBAAyBuC,WACzIvB,KAAKD,UAAUwC,OAAOvB,EAAUhB,KAAKD,UAAUsB,UACrD,MACJ,KAAK9B,EAAYI,iBAEb,OADAR,EAAM,sCAAsC4C,EAAeJ,oBAAwBL,EAAQM,mBAAmBD,EAAM3C,yBAAyBuC,KACtIH,EAEnB,MAEI,OAAQE,EAAQM,IACZ,KAAK,IACD5B,KAAKC,SAAWqB,EAAQY,UAClBlC,KAAKD,UAAUwC,OAAOjB,EAAQY,KACpC,MACJ,QACI/C,EAAM,qBAAqB4C,EAAehB,yBAAkCO,EAAQM,GAAGI,SAAS,mBAAmBT,KACnHvB,KAAKC,SAAWqB,EAAQY,UAClBlC,KAAKD,UAAUwC,OAAOjB,EAAQY,KAGpD,CACA,OAAOd,CACX,CACA,kBAAMoB,CAAaC,GACf,MAAMC,QAAY1C,KAAKD,UAAU4C,WAAWC,EAAAA,OAC5C,IAAIC,EAAO,IACPC,EAAK,EAET,MAAwB,KAAhBJ,EAAMG,GAAa,CACvB,GAAIC,EAAKL,EACL,MAAM,IAAIpD,EAAiB,uCAE7ByD,EACFD,IAAS,CACb,CACA,MAAMjB,EAAK,IAAImB,WAAWD,GAE1B,aADM9C,KAAKD,UAAUW,WAAWkB,GACzBA,CACX,CACA,iBAAMJ,GACF,MAAMI,QAAW5B,KAAKwC,aAAaxC,KAAKI,iBAClC4C,QAAiBhD,KAAKwC,aAAaxC,KAAKK,mBAE9C,OADA2C,EAAS,IAAM,KAASA,EAASC,OAAS,EACnC,CACHrB,GAAIsB,EAAWtB,EAAIA,EAAGqB,QACtBf,IAAKgB,EAAWF,EAAUA,EAASC,QAE3C,CACA,eAAMpC,CAAUN,GACZ,OAAQA,EAAE2B,KACN,KAAK,EACD,OAAO,EACX,KAAK,EACD,OAAOlC,KAAKD,UAAUoD,WAAWC,EAAAA,YACrC,KAAK,EACD,OAAOpD,KAAKD,UAAUoD,WAAWE,EAAAA,YACrC,KAAK,GACD,OAAOrD,KAAKD,UAAUoD,WAAWE,EAAAA,YACrC,QACI,MAAM,IAAIhE,EAAiB,kCAAkCkB,EAAE2B,OAE3E,CACA,cAAMtB,CAASL,GACX,OAAoC,UAAtBP,KAAKQ,SAASD,EAChC,CACA,cAAMC,CAASD,GACX,MAAM+C,QAAYtD,KAAKU,WAAWH,GAClC,OAAO2C,EAAWI,EAAK/C,EAAE2B,IAC7B,CACA,gBAAMzB,CAAWF,GACb,MAAMgD,QAAkBvD,KAAKD,UAAUyD,UAAU,IAAIC,EAAAA,WAAWlD,EAAE2B,IAAK,UACvE,OAAOqB,EAAUG,QAAQ,WAAY,GACzC,CACA,gBAAMhD,CAAWH,GACb,MAAM+C,EAAM,IAAIP,WAAWxC,EAAE2B,KAE7B,aADMlC,KAAKD,UAAUW,WAAW4C,GACzBA,CACX,EAEJ,SAASJ,EAAWI,EAAKpB,GACrB,OAAOyB,OAAOC,EAAmBN,EAAKpB,GAC1C,CAOA,SAAS0B,EAAmBN,EAAKpB,GAC7B,MAAM2B,EAAmB,IAAId,WAAW,GAClCe,EAAcR,EAAIS,SAAS,EAAG7B,GACpC,IAEI,OADA2B,EAAiBvD,IAAIwD,EAAa,EAAI5B,GAC/B8B,EAAAA,UAAgB1B,IAAIuB,EAAkB,EACjD,CACA,MAAOI,GACH,OAAOC,QAAQ,EACnB,CACJ,CACA,SAAS/C,EAAYG,GAYjB,OAXIA,EAAQtC,WACRmF,OAAOC,KAAK9C,EAAQtC,WACfqF,IAAIzC,IACL,MAAMD,EAAQL,EAAQtC,UAAU4C,GAEhC,OADAD,EAAMC,GAAK+B,OAAOW,SAAS1C,GACpBD,IACR4C,QAAQ5C,IACPA,EAAM6C,OAASlD,EACfH,EAAYQ,KAGbL,CACX,CACO,SAASS,EAAeT,GAC3B,IAAImD,EAAO,GAIX,OAHInD,EAAQkD,QAAkC,QAAxBlD,EAAQkD,OAAOzF,OACjC0F,GAAQ,GAAG1C,EAAeT,EAAQkD,YAE/BC,EAAOnD,EAAQvC,IAC1B,CCvNA,MAAMI,EAAQC,EAAU,kCAQjB,MAAMsF,UAAuBC,EAAAA,EAChC7E,WAAAA,GACI8E,SAASC,WACT7E,KAAK8E,eAAiB,EAKtB9E,KAAK+E,2BAA6B/E,KAAKgF,QAAQC,cAAe,CAClE,CACA,WAAMC,GACF,MAAMC,EAAgBnF,KAAKD,UAAUqF,SAASC,MAAQ1B,OAAO2B,iBACvDC,EAAmB,IAAI1F,EAAaG,KAAKD,WAC/CZ,EAAM,+CACAoG,EAAiBzE,QAAQhC,EAAaqG,EAAe,CACvDrD,UAAYR,IACR,OAAQA,EAAQM,IAEZ,KAAK,UAED,OADAzC,EAAM,sBAAsBmC,EAAQvC,cAAcuC,EAAQM,GAAGI,SAAS,OAC/DzC,EAAYE,cACvB,KAAK,UACD,GAAIO,KAAK+E,4BAA8B/E,KAAKwF,SAAU,CAClD,MAAMC,EAAQzF,KAAKwF,SAASE,KAAKC,KAAKF,GAASA,EAAMpE,SAAWrB,KAAK8E,eAAiB9E,KAAKD,UAAUsB,UACrG,GAAIoE,EAAO,CAEP,MAAMG,EAAaH,EAAMpE,SAAWrB,KAAK8E,eAAiB9E,KAAKD,UAAUsB,SAGzE,OAFAlC,EAAM,8CAA8CyG,WACpD5F,KAAKD,UAAUwC,OAAOqD,GACfrG,EAAYK,WACvB,CACJ,CACA,OAAOL,EAAYE,cACvB,QACI,OAAOF,EAAYC,WAG/B4C,aAAczB,MAAOW,EAASrC,EAAO4G,KAEjC,OADA1G,EAAM,kBAAkBmC,EAAQvC,eAAeE,KACvCqC,EAAQM,IACZ,KAAK,MACD5B,KAAK8F,SAASC,UAAU,YAAa,QAAQ9G,KAC7C,MACJ,KAAK,UACDe,KAAKwF,SAAWvG,EAChBe,KAAK8E,eAAiBe,EACtB,MACJ,KAAK,UACD,CACI,MAAMG,EAAO/G,EACPgH,EAAgBD,EAAKC,cAAgBD,EAAKC,cAAgB,IAChE,GAA6B,kBAAlBD,EAAKE,SAAuB,CACnC,MAAMA,EAAWF,EAAKE,SAAWD,EAAgB,UAC3CjG,KAAKmG,OAAO,gBAAiBH,EAAKI,OACxCpG,KAAK8F,SAASC,UAAU,WAAYpC,OAAOuC,GAC/C,CACJ,CACA,MACJ,KAAK,UACD,CACI,MAAMG,EAAcpH,EACpB,GAAIoH,GAAaC,QAAS,CACtBD,EAAYC,QAAQ/B,QAAQgC,IACxB,MAAMC,EAAS,CACXC,UAAWF,EAAMG,QAAQhD,QAAQ,KAAM,IAAIA,QAAQ,KAAM,IACzDiD,cAAeJ,EAAMI,cACrBC,YAAaL,EAAMK,YACnBC,WAAYN,EAAMM,WAClBC,YAAaP,EAAMO,YACnBC,SAAUR,EAAMQ,SAChBhI,KAAMwH,EAAMxH,KACZiI,KAAMT,EAAMU,UACZC,MAAOX,EAAMW,MACbC,MAAOZ,EAAMY,OAEjBnH,KAAK8F,SAASsB,cAAcZ,KAEhC,MAAMa,EAAahB,EAAYC,QAC1BgB,OAAOf,GAASA,EAAMU,YAAcM,EAAAA,EAAUL,OAC9CM,OAAO,CAACC,EAAKC,IACTD,EAEDC,EAAId,cAAgBa,EAAIb,aAExBc,EAAIC,YAAcF,EAAIE,YADfD,EAGJD,EALIC,EAMZ,MACCL,IACArH,KAAK8F,SAASC,UAAU,QAASsB,EAAWX,QAAQhD,QAAQ,KAAM,KAClE1D,KAAK8F,SAASC,UAAU,aAAcsB,EAAWH,MAAMU,mBACvD5H,KAAK8F,SAASC,UAAU,mBAAoBsB,EAAWH,MAAMW,UAErE,CACJ,CACA,MACJ,KAAK,UACD,CACI,MAAMC,EAAO7I,QACP8I,QAAQC,IAAIF,EAAKG,IAAI5D,IAAI1D,UAC3B,MAAMuH,EAASD,EAAIC,OACbC,EAAaD,GAAQE,gBAAkBC,EAAAA,GAAWH,EAAOE,iBAAoBF,GAAQC,WAAaD,EAAOC,WAAa,cACtHJ,QAAQC,IAAIC,EAAIK,WAAWjE,IAAI1D,UACjC,MAAM1B,EAAQsJ,EAAU/J,OAAS+J,EAAU/J,OAAS+J,EAAU3J,aACxDoB,KAAKmG,OAAO,GAAGgC,KAAcI,EAAUxJ,OAAQE,QAGjE,CACA,MACJ,KAAK,UACD,CACI,MAAMuJ,EAAcvJ,QACd8I,QAAQC,IAAIQ,EAAYC,cACzBnB,OAAOoB,GAAQA,EAAKC,SAASC,WAAW,WACxCvE,IAAIqE,GAAQ1I,KAAKmG,OAAO,UAAW,CACpC0C,KAAMH,EAAKG,KACXC,OAAQJ,EAAKC,SACbI,YAAaL,EAAKK,YAClBhK,KAAM2J,EAAK3J,QAEnB,CACA,SAIpB,CACA,YAAMoH,CAAO6C,EAAO/J,SACVe,KAAK8F,SAASK,OAAO,WAAY6C,EAAO/J,EAClD,E","sources":["webpack://osi/./node_modules/music-metadata/lib/ebml/types.js","webpack://osi/./node_modules/music-metadata/lib/matroska/MatroskaDtd.js","webpack://osi/./node_modules/music-metadata/lib/ebml/EbmlIterator.js","webpack://osi/./node_modules/music-metadata/lib/matroska/MatroskaParser.js"],"sourcesContent":["export const DataType = {\r\n    string: 0,\r\n    uint: 1,\r\n    uid: 2,\r\n    bool: 3,\r\n    binary: 4,\r\n    float: 5,\r\n};\r\n","import { DataType } from '../ebml/types.js';\r\n/**\r\n * Elements of document type description\r\n * Derived from https://github.com/tungol/EBML/blob/master/doctypes/matroska.dtd\r\n * Extended with:\r\n * - https://www.matroska.org/technical/specs/index.html\r\n */\r\nexport const matroskaDtd = {\r\n    name: 'dtd',\r\n    container: {\r\n        0x1a45dfa3: {\r\n            name: 'ebml',\r\n            container: {\r\n                0x4286: { name: 'ebmlVersion', value: DataType.uint }, // 5.1.1\r\n                0x42f7: { name: 'ebmlReadVersion', value: DataType.uint }, // 5.1.2\r\n                0x42f2: { name: 'ebmlMaxIDWidth', value: DataType.uint }, // 5.1.3\r\n                0x42f3: { name: 'ebmlMaxSizeWidth', value: DataType.uint }, // 5.1.4\r\n                0x4282: { name: 'docType', value: DataType.string }, // 5.1.5\r\n                0x4287: { name: 'docTypeVersion', value: DataType.uint }, // 5.1.6\r\n                0x4285: { name: 'docTypeReadVersion', value: DataType.uint } // 5.1.7\r\n            }\r\n        },\r\n        // Matroska segments\r\n        0x18538067: {\r\n            name: 'segment',\r\n            container: {\r\n                // Meta Seek Information (also known as MetaSeek)\r\n                0x114d9b74: {\r\n                    name: 'seekHead',\r\n                    container: {\r\n                        0x4dbb: {\r\n                            name: 'seek',\r\n                            multiple: true,\r\n                            container: {\r\n                                0x53ab: { name: 'id', value: DataType.binary },\r\n                                0x53ac: { name: 'position', value: DataType.uint }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                // Segment Information\r\n                0x1549a966: {\r\n                    name: 'info',\r\n                    container: {\r\n                        0x73a4: { name: 'uid', value: DataType.uid },\r\n                        0x7384: { name: 'filename', value: DataType.string },\r\n                        0x3cb923: { name: 'prevUID', value: DataType.uid },\r\n                        0x3c83ab: { name: 'prevFilename', value: DataType.string },\r\n                        0x3eb923: { name: 'nextUID', value: DataType.uid },\r\n                        0x3e83bb: { name: 'nextFilename', value: DataType.string },\r\n                        0x2ad7b1: { name: 'timecodeScale', value: DataType.uint },\r\n                        0x4489: { name: 'duration', value: DataType.float },\r\n                        0x4461: { name: 'dateUTC', value: DataType.uint },\r\n                        0x7ba9: { name: 'title', value: DataType.string },\r\n                        0x4d80: { name: 'muxingApp', value: DataType.string },\r\n                        0x5741: { name: 'writingApp', value: DataType.string }\r\n                    }\r\n                },\r\n                // Cluster\r\n                0x1f43b675: {\r\n                    name: 'cluster',\r\n                    multiple: true,\r\n                    container: {\r\n                        0xe7: { name: 'timecode', value: DataType.uid },\r\n                        0x58d7: { name: 'silentTracks ', multiple: true },\r\n                        0xa7: { name: 'position', value: DataType.uid },\r\n                        0xab: { name: 'prevSize', value: DataType.uid },\r\n                        0xa0: { name: 'blockGroup' },\r\n                        0xa3: { name: 'simpleBlock' }\r\n                    }\r\n                },\r\n                // Track\r\n                0x1654ae6b: {\r\n                    name: 'tracks',\r\n                    container: {\r\n                        0xae: {\r\n                            name: 'entries',\r\n                            multiple: true,\r\n                            container: {\r\n                                0xd7: { name: 'trackNumber', value: DataType.uint },\r\n                                0x73c5: { name: 'uid', value: DataType.uid },\r\n                                0x83: { name: 'trackType', value: DataType.uint },\r\n                                0xb9: { name: 'flagEnabled', value: DataType.bool },\r\n                                0x88: { name: 'flagDefault', value: DataType.bool },\r\n                                0x55aa: { name: 'flagForced', value: DataType.bool }, // extended\r\n                                0x9c: { name: 'flagLacing', value: DataType.bool },\r\n                                0x6de7: { name: 'minCache', value: DataType.uint },\r\n                                0x6de8: { name: 'maxCache', value: DataType.uint },\r\n                                0x23e383: { name: 'defaultDuration', value: DataType.uint },\r\n                                0x23314f: { name: 'timecodeScale', value: DataType.float },\r\n                                0x536e: { name: 'name', value: DataType.string },\r\n                                0x22b59c: { name: 'language', value: DataType.string },\r\n                                0x86: { name: 'codecID', value: DataType.string },\r\n                                0x63a2: { name: 'codecPrivate', value: DataType.binary },\r\n                                0x258688: { name: 'codecName', value: DataType.string },\r\n                                0x3a9697: { name: 'codecSettings', value: DataType.string },\r\n                                0x3b4040: { name: 'codecInfoUrl', value: DataType.string },\r\n                                0x26b240: { name: 'codecDownloadUrl', value: DataType.string },\r\n                                0xaa: { name: 'codecDecodeAll', value: DataType.bool },\r\n                                0x6fab: { name: 'trackOverlay', value: DataType.uint },\r\n                                // Video\r\n                                0xe0: {\r\n                                    name: 'video',\r\n                                    container: {\r\n                                        0x9a: { name: 'flagInterlaced', value: DataType.bool },\r\n                                        0x53b8: { name: 'stereoMode', value: DataType.uint },\r\n                                        0xb0: { name: 'pixelWidth', value: DataType.uint },\r\n                                        0xba: { name: 'pixelHeight', value: DataType.uint },\r\n                                        0x54b0: { name: 'displayWidth', value: DataType.uint },\r\n                                        0x54ba: { name: 'displayHeight', value: DataType.uint },\r\n                                        0x54b3: { name: 'aspectRatioType', value: DataType.uint },\r\n                                        0x2eb524: { name: 'colourSpace', value: DataType.uint },\r\n                                        0x2fb523: { name: 'gammaValue', value: DataType.float }\r\n                                    }\r\n                                },\r\n                                // Audio\r\n                                0xe1: {\r\n                                    name: 'audio',\r\n                                    container: {\r\n                                        0xb5: { name: 'samplingFrequency', value: DataType.float },\r\n                                        0x78b5: { name: 'outputSamplingFrequency', value: DataType.float },\r\n                                        0x9f: { name: 'channels', value: DataType.uint }, // https://www.matroska.org/technical/specs/index.html\r\n                                        0x94: { name: 'channels', value: DataType.uint },\r\n                                        0x7d7b: { name: 'channelPositions', value: DataType.binary },\r\n                                        0x6264: { name: 'bitDepth', value: DataType.uint }\r\n                                    }\r\n                                },\r\n                                // Content Encoding\r\n                                0x6d80: {\r\n                                    name: 'contentEncodings',\r\n                                    container: {\r\n                                        0x6240: {\r\n                                            name: 'contentEncoding',\r\n                                            container: {\r\n                                                0x5031: { name: 'order', value: DataType.uint },\r\n                                                0x5032: { name: 'scope', value: DataType.bool },\r\n                                                0x5033: { name: 'type', value: DataType.uint },\r\n                                                0x5034: {\r\n                                                    name: 'contentEncoding',\r\n                                                    container: {\r\n                                                        0x4254: { name: 'contentCompAlgo', value: DataType.uint },\r\n                                                        0x4255: { name: 'contentCompSettings', value: DataType.binary }\r\n                                                    }\r\n                                                },\r\n                                                0x5035: {\r\n                                                    name: 'contentEncoding',\r\n                                                    container: {\r\n                                                        0x47e1: { name: 'contentEncAlgo', value: DataType.uint },\r\n                                                        0x47e2: { name: 'contentEncKeyID', value: DataType.binary },\r\n                                                        0x47e3: { name: 'contentSignature ', value: DataType.binary },\r\n                                                        0x47e4: { name: 'ContentSigKeyID  ', value: DataType.binary },\r\n                                                        0x47e5: { name: 'contentSigAlgo ', value: DataType.uint },\r\n                                                        0x47e6: { name: 'contentSigHashAlgo ', value: DataType.uint }\r\n                                                    }\r\n                                                },\r\n                                                0x6264: { name: 'bitDepth', value: DataType.uint }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                // Cueing Data\r\n                0x1c53bb6b: {\r\n                    name: 'cues',\r\n                    container: {\r\n                        0xbb: {\r\n                            name: 'cuePoint',\r\n                            container: {\r\n                                0xb3: { name: 'cueTime', value: DataType.uid },\r\n                                0xb7: {\r\n                                    name: 'positions',\r\n                                    container: {\r\n                                        0xf7: { name: 'track', value: DataType.uint },\r\n                                        0xf1: { name: 'clusterPosition', value: DataType.uint },\r\n                                        0x5378: { name: 'blockNumber', value: DataType.uint },\r\n                                        0xea: { name: 'codecState', value: DataType.uint },\r\n                                        0xdb: {\r\n                                            name: 'reference', container: {\r\n                                                0x96: { name: 'time', value: DataType.uint },\r\n                                                0x97: { name: 'cluster', value: DataType.uint },\r\n                                                0x535f: { name: 'number', value: DataType.uint },\r\n                                                0xeb: { name: 'codecState', value: DataType.uint }\r\n                                            }\r\n                                        },\r\n                                        0xf0: { name: 'relativePosition', value: DataType.uint } // extended\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                // Attachment\r\n                0x1941a469: {\r\n                    name: 'attachments',\r\n                    container: {\r\n                        0x61a7: {\r\n                            name: 'attachedFiles',\r\n                            multiple: true,\r\n                            container: {\r\n                                0x467e: { name: 'description', value: DataType.string },\r\n                                0x466e: { name: 'name', value: DataType.string },\r\n                                0x4660: { name: 'mimeType', value: DataType.string },\r\n                                0x465c: { name: 'data', value: DataType.binary },\r\n                                0x46ae: { name: 'uid', value: DataType.uid }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                // Chapters\r\n                0x1043a770: {\r\n                    name: 'chapters',\r\n                    container: {\r\n                        0x45b9: {\r\n                            name: 'editionEntry',\r\n                            container: {\r\n                                0xb6: {\r\n                                    name: 'chapterAtom',\r\n                                    container: {\r\n                                        0x73c4: { name: 'uid', value: DataType.uid },\r\n                                        0x91: { name: 'timeStart', value: DataType.uint },\r\n                                        0x92: { name: 'timeEnd', value: DataType.uid },\r\n                                        0x98: { name: 'hidden', value: DataType.bool },\r\n                                        0x4598: { name: 'enabled', value: DataType.uid },\r\n                                        0x8f: {\r\n                                            name: 'track', container: {\r\n                                                0x89: { name: 'trackNumber', value: DataType.uid },\r\n                                                0x80: {\r\n                                                    name: 'display', container: {\r\n                                                        0x85: { name: 'string', value: DataType.string },\r\n                                                        0x437c: { name: 'language ', value: DataType.string },\r\n                                                        0x437e: { name: 'country ', value: DataType.string }\r\n                                                    }\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                // Tagging\r\n                0x1254c367: {\r\n                    name: 'tags',\r\n                    container: {\r\n                        0x7373: {\r\n                            name: 'tag',\r\n                            multiple: true,\r\n                            container: {\r\n                                0x63c0: {\r\n                                    name: 'target',\r\n                                    container: {\r\n                                        0x63c5: { name: 'tagTrackUID', value: DataType.uid },\r\n                                        0x63c4: { name: 'tagChapterUID', value: DataType.uint },\r\n                                        0x63c6: { name: 'tagAttachmentUID', value: DataType.uid },\r\n                                        0x63ca: { name: 'targetType', value: DataType.string }, // extended\r\n                                        0x68ca: { name: 'targetTypeValue', value: DataType.uint }, // extended\r\n                                        0x63c9: { name: 'tagEditionUID', value: DataType.uid } // extended\r\n                                    }\r\n                                },\r\n                                0x67c8: {\r\n                                    name: 'simpleTags',\r\n                                    multiple: true,\r\n                                    container: {\r\n                                        0x45a3: { name: 'name', value: DataType.string },\r\n                                        0x4487: { name: 'string', value: DataType.string },\r\n                                        0x4485: { name: 'binary', value: DataType.binary },\r\n                                        0x447a: { name: 'language', value: DataType.string }, // extended\r\n                                        0x447b: { name: 'languageIETF', value: DataType.string }, // extended\r\n                                        0x4484: { name: 'default', value: DataType.bool } // extended\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n","import { Float32_BE, Float64_BE, StringType, UINT8 } from 'token-types';\r\nimport initDebug from 'debug';\r\nimport { EndOfStreamError } from 'strtok3';\r\nimport { DataType } from './types.js';\r\nimport * as Token from 'token-types';\r\nimport { makeUnexpectedFileContentError } from '../ParseError.js';\r\nconst debug = initDebug('music-metadata:parser:ebml');\r\nexport class EbmlContentError extends makeUnexpectedFileContentError('EBML') {\r\n}\r\nexport const ParseAction = {\r\n    ReadNext: 0, // Continue reading the next elements\r\n    IgnoreElement: 2, // Ignore (do not read) this element\r\n    SkipSiblings: 3, // Skip all remaining elements at the same level\r\n    TerminateParsing: 4, // Terminate the parsing process\r\n    SkipElement: 5 // Consider the element has read, assume position is at the next element\r\n};\r\n/**\r\n * Extensible Binary Meta Language (EBML) iterator\r\n * https://en.wikipedia.org/wiki/Extensible_Binary_Meta_Language\r\n * http://matroska.sourceforge.net/technical/specs/rfc/index.html\r\n *\r\n * WEBM VP8 AUDIO FILE\r\n */\r\nexport class EbmlIterator {\r\n    /**\r\n     * @param {ITokenizer} tokenizer Input\r\n     * @param tokenizer\r\n     */\r\n    constructor(tokenizer) {\r\n        this.padding = 0;\r\n        this.parserMap = new Map();\r\n        this.ebmlMaxIDLength = 4;\r\n        this.ebmlMaxSizeLength = 8;\r\n        this.tokenizer = tokenizer;\r\n        this.parserMap.set(DataType.uint, e => this.readUint(e));\r\n        this.parserMap.set(DataType.string, e => this.readString(e));\r\n        this.parserMap.set(DataType.binary, e => this.readBuffer(e));\r\n        this.parserMap.set(DataType.uid, async (e) => this.readBuffer(e));\r\n        this.parserMap.set(DataType.bool, e => this.readFlag(e));\r\n        this.parserMap.set(DataType.float, e => this.readFloat(e));\r\n    }\r\n    async iterate(dtdElement, posDone, listener) {\r\n        return this.parseContainer(linkParents(dtdElement), posDone, listener);\r\n    }\r\n    async parseContainer(dtdElement, posDone, listener) {\r\n        const tree = {};\r\n        while (this.tokenizer.position < posDone) {\r\n            let element;\r\n            const elementPosition = this.tokenizer.position;\r\n            try {\r\n                element = await this.readElement();\r\n            }\r\n            catch (error) {\r\n                if (error instanceof EndOfStreamError) {\r\n                    break;\r\n                }\r\n                throw error;\r\n            }\r\n            const child = dtdElement.container[element.id];\r\n            if (child) {\r\n                const action = listener.startNext(child);\r\n                switch (action) {\r\n                    case ParseAction.ReadNext:\r\n                        {\r\n                            if (element.id === 0x1F43B675) {\r\n                                // Hack to ignore remaining segment, when cluster element received\r\n                                // await this.tokenizer.ignore(posDone - this.tokenizer.position);\r\n                                // break;\r\n                            }\r\n                            debug(`Read element: name=${getElementPath(child)}{id=0x${element.id.toString(16)}, container=${!!child.container}} at position=${elementPosition}`);\r\n                            if (child.container) {\r\n                                const res = await this.parseContainer(child, element.len >= 0 ? this.tokenizer.position + element.len : -1, listener);\r\n                                if (child.multiple) {\r\n                                    if (!tree[child.name]) {\r\n                                        tree[child.name] = [];\r\n                                    }\r\n                                    tree[child.name].push(res);\r\n                                }\r\n                                else {\r\n                                    tree[child.name] = res;\r\n                                }\r\n                                await listener.elementValue(child, res, elementPosition);\r\n                            }\r\n                            else {\r\n                                const parser = this.parserMap.get(child.value);\r\n                                if (typeof parser === 'function') {\r\n                                    const value = await parser(element);\r\n                                    tree[child.name] = value;\r\n                                    await listener.elementValue(child, value, elementPosition);\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    case ParseAction.SkipElement:\r\n                        debug(`Go to next element: name=${getElementPath(child)}, element.id=0x${element.id}, container=${!!child.container} at position=${elementPosition}`);\r\n                        break;\r\n                    case ParseAction.IgnoreElement:\r\n                        debug(`Ignore element: name=${getElementPath(child)}, element.id=0x${element.id}, container=${!!child.container} at position=${elementPosition}`);\r\n                        await this.tokenizer.ignore(element.len);\r\n                        break;\r\n                    case ParseAction.SkipSiblings:\r\n                        debug(`Ignore remaining container, at: name=${getElementPath(child)}, element.id=0x${element.id}, container=${!!child.container} at position=${elementPosition}`);\r\n                        await this.tokenizer.ignore(posDone - this.tokenizer.position);\r\n                        break;\r\n                    case ParseAction.TerminateParsing:\r\n                        debug(`Terminate parsing at element: name=${getElementPath(child)}, element.id=0x${element.id}, container=${!!child.container} at position=${elementPosition}`);\r\n                        return tree;\r\n                }\r\n            }\r\n            else {\r\n                switch (element.id) {\r\n                    case 0xec: // void\r\n                        this.padding += element.len;\r\n                        await this.tokenizer.ignore(element.len);\r\n                        break;\r\n                    default:\r\n                        debug(`parseEbml: parent=${getElementPath(dtdElement)}, unknown child: id=${element.id.toString(16)} at position=${elementPosition}`);\r\n                        this.padding += element.len;\r\n                        await this.tokenizer.ignore(element.len);\r\n                }\r\n            }\r\n        }\r\n        return tree;\r\n    }\r\n    async readVintData(maxLength) {\r\n        const msb = await this.tokenizer.peekNumber(UINT8);\r\n        let mask = 0x80;\r\n        let oc = 1;\r\n        // Calculate VINT_WIDTH\r\n        while ((msb & mask) === 0) {\r\n            if (oc > maxLength) {\r\n                throw new EbmlContentError('VINT value exceeding maximum size');\r\n            }\r\n            ++oc;\r\n            mask >>= 1;\r\n        }\r\n        const id = new Uint8Array(oc);\r\n        await this.tokenizer.readBuffer(id);\r\n        return id;\r\n    }\r\n    async readElement() {\r\n        const id = await this.readVintData(this.ebmlMaxIDLength);\r\n        const lenField = await this.readVintData(this.ebmlMaxSizeLength);\r\n        lenField[0] ^= 0x80 >> (lenField.length - 1);\r\n        return {\r\n            id: readUIntBE(id, id.length),\r\n            len: readUIntBE(lenField, lenField.length)\r\n        };\r\n    }\r\n    async readFloat(e) {\r\n        switch (e.len) {\r\n            case 0:\r\n                return 0.0;\r\n            case 4:\r\n                return this.tokenizer.readNumber(Float32_BE);\r\n            case 8:\r\n                return this.tokenizer.readNumber(Float64_BE);\r\n            case 10:\r\n                return this.tokenizer.readNumber(Float64_BE);\r\n            default:\r\n                throw new EbmlContentError(`Invalid IEEE-754 float length: ${e.len}`);\r\n        }\r\n    }\r\n    async readFlag(e) {\r\n        return (await this.readUint(e)) === 1;\r\n    }\r\n    async readUint(e) {\r\n        const buf = await this.readBuffer(e);\r\n        return readUIntBE(buf, e.len);\r\n    }\r\n    async readString(e) {\r\n        const rawString = await this.tokenizer.readToken(new StringType(e.len, 'utf-8'));\r\n        return rawString.replace(/\\x00.*$/g, '');\r\n    }\r\n    async readBuffer(e) {\r\n        const buf = new Uint8Array(e.len);\r\n        await this.tokenizer.readBuffer(buf);\r\n        return buf;\r\n    }\r\n}\r\nfunction readUIntBE(buf, len) {\r\n    return Number(readUIntBeAsBigInt(buf, len));\r\n}\r\n/**\r\n * Reeds an unsigned integer from a big endian buffer of length `len`\r\n * @param buf Buffer to decode from\r\n * @param len Number of bytes\r\n * @private\r\n */\r\nfunction readUIntBeAsBigInt(buf, len) {\r\n    const normalizedNumber = new Uint8Array(8);\r\n    const cleanNumber = buf.subarray(0, len);\r\n    try {\r\n        normalizedNumber.set(cleanNumber, 8 - len);\r\n        return Token.UINT64_BE.get(normalizedNumber, 0);\r\n    }\r\n    catch (_error) {\r\n        return BigInt(-1);\r\n    }\r\n}\r\nfunction linkParents(element) {\r\n    if (element.container) {\r\n        Object.keys(element.container)\r\n            .map(id => {\r\n            const child = element.container[id];\r\n            child.id = Number.parseInt(id);\r\n            return child;\r\n        }).forEach(child => {\r\n            child.parent = element;\r\n            linkParents(child);\r\n        });\r\n    }\r\n    return element;\r\n}\r\nexport function getElementPath(element) {\r\n    let path = '';\r\n    if (element.parent && element.parent.name !== 'dtd') {\r\n        path += `${getElementPath(element.parent)}/`;\r\n    }\r\n    return path + element.name;\r\n}\r\n","import initDebug from 'debug';\r\nimport { BasicParser } from '../common/BasicParser.js';\r\nimport { matroskaDtd } from './MatroskaDtd.js';\r\nimport { TargetType, TrackType } from './types.js';\r\nimport { EbmlIterator, ParseAction } from '../ebml/EbmlIterator.js';\r\nconst debug = initDebug('music-metadata:parser:matroska');\r\n/**\r\n * Extensible Binary Meta Language (EBML) parser\r\n * https://en.wikipedia.org/wiki/Extensible_Binary_Meta_Language\r\n * http://matroska.sourceforge.net/technical/specs/rfc/index.html\r\n *\r\n * WEBM VP8 AUDIO FILE\r\n */\r\nexport class MatroskaParser extends BasicParser {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.seekHeadOffset = 0;\r\n        /**\r\n         * Use index to skip multiple segment/cluster elements at once.\r\n         * Significant performance impact\r\n         */\r\n        this.flagUseIndexToSkipClusters = this.options.mkvUseIndex ?? false;\r\n    }\r\n    async parse() {\r\n        const containerSize = this.tokenizer.fileInfo.size ?? Number.MAX_SAFE_INTEGER;\r\n        const matroskaIterator = new EbmlIterator(this.tokenizer);\r\n        debug('Initializing DTD end MatroskaIterator');\r\n        await matroskaIterator.iterate(matroskaDtd, containerSize, {\r\n            startNext: (element) => {\r\n                switch (element.id) {\r\n                    // case 0x1f43b675: // cluster\r\n                    case 0x1c53bb6b: // Cueing Data\r\n                        debug(`Skip element: name=${element.name}, id=0x${element.id.toString(16)}`);\r\n                        return ParseAction.IgnoreElement;\r\n                    case 0x1f43b675: // cluster\r\n                        if (this.flagUseIndexToSkipClusters && this.seekHead) {\r\n                            const index = this.seekHead.seek.find(index => index.position + this.seekHeadOffset > this.tokenizer.position);\r\n                            if (index) {\r\n                                // Go to next index position\r\n                                const ignoreSize = index.position + this.seekHeadOffset - this.tokenizer.position;\r\n                                debug(`Use index to go to next position, ignoring ${ignoreSize} bytes`);\r\n                                this.tokenizer.ignore(ignoreSize);\r\n                                return ParseAction.SkipElement;\r\n                            }\r\n                        }\r\n                        return ParseAction.IgnoreElement;\r\n                    default:\r\n                        return ParseAction.ReadNext;\r\n                }\r\n            },\r\n            elementValue: async (element, value, offset) => {\r\n                debug(`Received: name=${element.name}, value=${value}`);\r\n                switch (element.id) {\r\n                    case 0x4282: // docType\r\n                        this.metadata.setFormat('container', `EBML/${value}`);\r\n                        break;\r\n                    case 0x114d9b74:\r\n                        this.seekHead = value;\r\n                        this.seekHeadOffset = offset;\r\n                        break;\r\n                    case 0x1549a966:\r\n                        { // Info (Segment Information)\r\n                            const info = value;\r\n                            const timecodeScale = info.timecodeScale ? info.timecodeScale : 1000000;\r\n                            if (typeof info.duration === 'number') {\r\n                                const duration = info.duration * timecodeScale / 1000000000;\r\n                                await this.addTag('segment:title', info.title);\r\n                                this.metadata.setFormat('duration', Number(duration));\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 0x1654ae6b:\r\n                        { // tracks\r\n                            const audioTracks = value;\r\n                            if (audioTracks?.entries) {\r\n                                audioTracks.entries.forEach(entry => {\r\n                                    const stream = {\r\n                                        codecName: entry.codecID.replace('A_', '').replace('V_', ''),\r\n                                        codecSettings: entry.codecSettings,\r\n                                        flagDefault: entry.flagDefault,\r\n                                        flagLacing: entry.flagLacing,\r\n                                        flagEnabled: entry.flagEnabled,\r\n                                        language: entry.language,\r\n                                        name: entry.name,\r\n                                        type: entry.trackType,\r\n                                        audio: entry.audio,\r\n                                        video: entry.video\r\n                                    };\r\n                                    this.metadata.addStreamInfo(stream);\r\n                                });\r\n                                const audioTrack = audioTracks.entries\r\n                                    .filter(entry => entry.trackType === TrackType.audio)\r\n                                    .reduce((acc, cur) => {\r\n                                    if (!acc)\r\n                                        return cur;\r\n                                    if (cur.flagDefault && !acc.flagDefault)\r\n                                        return cur;\r\n                                    if (cur.trackNumber < acc.trackNumber)\r\n                                        return cur;\r\n                                    return acc;\r\n                                }, null);\r\n                                if (audioTrack) {\r\n                                    this.metadata.setFormat('codec', audioTrack.codecID.replace('A_', ''));\r\n                                    this.metadata.setFormat('sampleRate', audioTrack.audio.samplingFrequency);\r\n                                    this.metadata.setFormat('numberOfChannels', audioTrack.audio.channels);\r\n                                }\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 0x1254c367:\r\n                        { // tags\r\n                            const tags = value;\r\n                            await Promise.all(tags.tag.map(async (tag) => {\r\n                                const target = tag.target;\r\n                                const targetType = target?.targetTypeValue ? TargetType[target.targetTypeValue] : (target?.targetType ? target.targetType : 'track');\r\n                                await Promise.all(tag.simpleTags.map(async (simpleTag) => {\r\n                                    const value = simpleTag.string ? simpleTag.string : simpleTag.binary;\r\n                                    await this.addTag(`${targetType}:${simpleTag.name}`, value);\r\n                                }));\r\n                            }));\r\n                        }\r\n                        break;\r\n                    case 0x1941a469:\r\n                        { // attachments\r\n                            const attachments = value;\r\n                            await Promise.all(attachments.attachedFiles\r\n                                .filter(file => file.mimeType.startsWith('image/'))\r\n                                .map(file => this.addTag('picture', {\r\n                                data: file.data,\r\n                                format: file.mimeType,\r\n                                description: file.description,\r\n                                name: file.name\r\n                            })));\r\n                        }\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    async addTag(tagId, value) {\r\n        await this.metadata.addTag('matroska', tagId, value);\r\n    }\r\n}\r\n"],"names":["DataType","string","uint","uid","bool","binary","float","matroskaDtd","name","container","value","multiple","debug","initDebug","EbmlContentError","makeUnexpectedFileContentError","ParseAction","ReadNext","IgnoreElement","SkipSiblings","TerminateParsing","SkipElement","EbmlIterator","constructor","tokenizer","this","padding","parserMap","Map","ebmlMaxIDLength","ebmlMaxSizeLength","set","e","readUint","readString","readBuffer","async","readFlag","readFloat","iterate","dtdElement","posDone","listener","parseContainer","linkParents","tree","position","element","elementPosition","readElement","error","EndOfStreamError","child","id","action","startNext","getElementPath","toString","res","len","push","elementValue","parser","get","ignore","readVintData","maxLength","msb","peekNumber","UINT8","mask","oc","Uint8Array","lenField","length","readUIntBE","readNumber","Float32_BE","Float64_BE","buf","rawString","readToken","StringType","replace","Number","readUIntBeAsBigInt","normalizedNumber","cleanNumber","subarray","Token","_error","BigInt","Object","keys","map","parseInt","forEach","parent","path","MatroskaParser","BasicParser","super","arguments","seekHeadOffset","flagUseIndexToSkipClusters","options","mkvUseIndex","parse","containerSize","fileInfo","size","MAX_SAFE_INTEGER","matroskaIterator","seekHead","index","seek","find","ignoreSize","offset","metadata","setFormat","info","timecodeScale","duration","addTag","title","audioTracks","entries","entry","stream","codecName","codecID","codecSettings","flagDefault","flagLacing","flagEnabled","language","type","trackType","audio","video","addStreamInfo","audioTrack","filter","TrackType","reduce","acc","cur","trackNumber","samplingFrequency","channels","tags","Promise","all","tag","target","targetType","targetTypeValue","TargetType","simpleTags","simpleTag","attachments","attachedFiles","file","mimeType","startsWith","data","format","description","tagId"],"ignoreList":[],"sourceRoot":""}