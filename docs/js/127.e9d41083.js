"use strict";(self["webpackChunkosi"]=self["webpackChunkosi"]||[]).push([[127],{7127:function(r,t,e){e.r(t),e.d(t,{default:function(){return I}});var i=e(6768),o=e(5130);const s={class:"browser-app"},n={key:0,class:"browser-controls"},a={class:"url-bar"},c=["disabled"],l=["disabled"],h={class:"iframe-wrapper"},d=["src"],u={key:1,class:"loading-indicator"},p={key:2,class:"error-message"};function f(r,t,e,f,w,m){return(0,i.uX)(),(0,i.CE)("div",s,[e.showControls?((0,i.uX)(),(0,i.CE)("div",n,[(0,i.Lk)("div",a,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...r)=>m.goBack&&m.goBack(...r)),disabled:!m.canGoBack,title:"Назад"},"←",8,c),(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...r)=>m.goForward&&m.goForward(...r)),disabled:!m.canGoForward,title:"Вперёд"},"→",8,l),(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...r)=>m.reload&&m.reload(...r)),title:"Обновить"},"↻"),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>w.currentUrl=r),onKeyup:t[4]||(t[4]=(0,o.jR)((...r)=>m.navigate&&m.navigate(...r),["enter"])),class:"url-input",placeholder:"Введите URL..."},null,544),[[o.Jo,w.currentUrl]]),(0,i.Lk)("button",{onClick:t[5]||(t[5]=(...r)=>m.navigate&&m.navigate(...r)),class:"go-btn"},"Перейти")])])):(0,i.Q3)("",!0),(0,i.Lk)("div",h,[(0,i.Lk)("iframe",{ref:"iframeRef",src:w.iframeSrc,onLoad:t[6]||(t[6]=(...r)=>m.onIframeLoad&&m.onIframeLoad(...r)),onError:t[7]||(t[7]=(...r)=>m.onIframeError&&m.onIframeError(...r)),sandbox:"allow-scripts allow-same-origin allow-forms allow-popups",referrerpolicy:"no-referrer"},null,40,d)]),w.loading?((0,i.uX)(),(0,i.CE)("div",u,[...t[9]||(t[9]=[(0,i.Lk)("div",{class:"spinner"},null,-1),(0,i.Lk)("span",null,"Загрузка...",-1)])])):(0,i.Q3)("",!0),w.error?((0,i.uX)(),(0,i.CE)("div",p,[t[10]||(t[10]=(0,i.Lk)("p",null,"⚠️ Не удалось загрузить страницу",-1)),(0,i.Lk)("button",{onClick:t[8]||(t[8]=(...r)=>m.reload&&m.reload(...r))},"Повторить")])):(0,i.Q3)("",!0)])}e(4114),e(4603),e(7566),e(8721);var w=e(5619),m=e(2261),y={name:"AppWiki",props:{windowId:{type:String,required:!0},showControls:{type:Boolean,default:!0}},data(){const r="https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0";return{currentUrl:r,iframeSrc:r,loading:!0,error:!1,history:[r],currentHistoryIndex:0}},computed:{...(0,m.n2)(w.useAppsStore),canGoBack(){return this.currentHistoryIndex>0},canGoForward(){return this.currentHistoryIndex<this.history.length-1}},watch:{currentUrl(r){console.log("URL changed to:",r),this.saveState()},currentHistoryIndex(){this.saveState()},history:{handler(){this.saveState()},deep:!0}},methods:{initFromStore(){if(!this.windowId)return;const r=this.appsStore.getWindowState(this.windowId);console.log("Loaded state from store:",r),r&&(this.currentUrl=r.currentUrl||this.currentUrl,this.iframeSrc=r.currentUrl||this.iframeSrc,this.history=r.history||this.history,this.currentHistoryIndex=r.currentHistoryIndex||this.currentHistoryIndex)},saveState(){if(!this.windowId||!this.appsStore)return;const r={appType:"wiki",currentUrl:this.currentUrl,history:[...this.history],currentHistoryIndex:this.currentHistoryIndex,timestamp:Date.now()};this.appsStore.saveWindowState(this.windowId,r)},navigate(){let r=this.currentUrl.trim();r.startsWith("http://")||r.startsWith("https://")||(r="https://"+r);try{new URL(r),this.iframeSrc=r,this.loading=!0,this.error=!1,r!==this.history[this.currentHistoryIndex]&&(this.history=this.history.slice(0,this.currentHistoryIndex+1),this.history.push(r),this.currentHistoryIndex=this.history.length-1)}catch(t){console.error("Invalid URL:",r),this.error=!0,this.loading=!1}},goBack(){this.canGoBack&&(this.currentHistoryIndex--,this.currentUrl=this.history[this.currentHistoryIndex],this.iframeSrc=this.currentUrl,this.loading=!0)},goForward(){this.canGoForward&&(this.currentHistoryIndex++,this.currentUrl=this.history[this.currentHistoryIndex],this.iframeSrc=this.currentUrl,this.loading=!0)},reload(){this.loading=!0,this.error=!1;const r=this.iframeSrc;this.iframeSrc="",setTimeout(()=>{this.iframeSrc=r},50)},onIframeLoad(){console.log("Wiki iframe loaded successfully"),this.loading=!1,this.error=!1,this.safeGetTitle()},onIframeError(){console.error("Wiki iframe failed to load"),this.loading=!1,this.error=!0},safeGetTitle(){try{const r=this.$refs.iframeRef;if(r&&r.contentDocument){const t=r.contentDocument.title;t&&(console.log("Wiki page title:",t),this.$emit("title-change",t))}}catch(r){console.log("Cannot access iframe content due to CORS")}},openInNewTab(){window.open(this.currentUrl,"_blank","noopener,noreferrer")}},mounted(){console.log("AppWiki mounted with windowId:",this.windowId),this.initFromStore(),this.saveState()},beforeUnmount(){console.log("AppWiki unmounting, windowId:",this.windowId)}},g=e(1241);const k=(0,g.A)(y,[["render",f],["__scopeId","data-v-c1a6590c"]]);var I=k}}]);
//# sourceMappingURL=127.e9d41083.js.map