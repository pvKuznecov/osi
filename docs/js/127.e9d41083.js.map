{"version":3,"file":"js/127.e9d41083.js","mappings":"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","sources":["webpack://osi/./src/apps/learn/AppWiki/AppWiki.vue","webpack://osi/./src/apps/learn/AppWiki/AppWiki.vue?15ee"],"sourcesContent":["<template>\n    <div class=\"browser-app\">    \n        <!-- Панель управления браузером -->\n        <div class=\"browser-controls\" v-if=\"showControls\">\n            <div class=\"url-bar\">\n                <button @click=\"goBack\" :disabled=\"!canGoBack\" title=\"Назад\">←</button>\n                <button @click=\"goForward\" :disabled=\"!canGoForward\" title=\"Вперёд\">→</button>\n                <button @click=\"reload\" title=\"Обновить\">↻</button>\n                \n                <input \n                    v-model=\"currentUrl\" \n                    @keyup.enter=\"navigate\" \n                    class=\"url-input\" \n                    placeholder=\"Введите URL...\"\n                />\n                \n                <button @click=\"navigate\" class=\"go-btn\">Перейти</button>\n            </div>\n        </div>\n        \n        <div class=\"iframe-wrapper\">\n            <iframe \n                ref=\"iframeRef\" \n                :src=\"iframeSrc\" \n                @load=\"onIframeLoad\" \n                @error=\"onIframeError\" \n                sandbox=\"allow-scripts allow-same-origin allow-forms allow-popups\" \n                referrerpolicy=\"no-referrer\" \n            ></iframe>\n        </div>    \n        \n        <div v-if=\"loading\" class=\"loading-indicator\">\n            <div class=\"spinner\"></div>\n            <span>Загрузка...</span>\n        </div>\n        \n        <div v-if=\"error\" class=\"error-message\">\n            <p>⚠️ Не удалось загрузить страницу</p>\n            <button @click=\"reload\">Повторить</button>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { useAppsStore } from '@/stores/apps.store';\nimport { mapStores } from 'pinia';\n\nexport default {\n    name: 'AppWiki',\n\n    props: {\n        windowId: {\n            type: String,\n            required: true\n        },\n        showControls: {\n            type: Boolean,\n            default: true\n        }\n    },\n    \n    data() {\n        const defLink = 'https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0';\n\n        // В data() мы НЕ можем использовать this.appsStore\n        // Возвращаем только базовые данные\n        return {\n            currentUrl: defLink,\n            iframeSrc: defLink,\n            loading: true,\n            error: false,\n            history: [defLink],\n            currentHistoryIndex: 0\n        };\n    },\n    \n    computed: {\n        // Подключаем store через mapStores\n        ...mapStores(useAppsStore),\n        \n        canGoBack() {\n            return this.currentHistoryIndex > 0;\n        },\n        \n        canGoForward() {\n            return this.currentHistoryIndex < this.history.length - 1;\n        }\n    },\n\n    watch: {\n        currentUrl(newUrl) {\n            console.log(\"URL changed to:\", newUrl);\n            this.saveState();\n        },\n        currentHistoryIndex() {\n            this.saveState();\n        },\n        history: {\n            handler() {\n                this.saveState();\n            },\n            deep: true\n        }\n    },\n\n    methods: {\n        // Инициализация из store (вызывается в mounted)\n        initFromStore() {\n            if (!this.windowId) return;\n            \n            const savedState = this.appsStore.getWindowState(this.windowId);\n            console.log('Loaded state from store:', savedState);\n            \n            if (savedState) {\n                this.currentUrl = savedState.currentUrl || this.currentUrl;\n                this.iframeSrc = savedState.currentUrl || this.iframeSrc;\n                this.history = savedState.history || this.history;\n                this.currentHistoryIndex = savedState.currentHistoryIndex || this.currentHistoryIndex;\n            }\n        },\n\n        // Сохраняем текущее состояние в store\n        saveState() {\n            if (!this.windowId || !this.appsStore) return;\n            \n            const state = {\n                appType: 'wiki',\n                currentUrl: this.currentUrl,\n                history: [...this.history],\n                currentHistoryIndex: this.currentHistoryIndex,\n                timestamp: Date.now()\n            };\n            \n            this.appsStore.saveWindowState(this.windowId, state);\n        },\n\n        // Навигация по URL\n        navigate() {\n            let url = this.currentUrl.trim();\n            \n            // Добавляем протокол если нужно\n            if (!url.startsWith('http://') && !url.startsWith('https://')) {\n                url = 'https://' + url;\n            }\n            \n            try {\n                // Валидация URL\n                new URL(url);\n                this.iframeSrc = url;\n                this.loading = true;\n                this.error = false;\n                \n                // Добавляем в историю\n                if (url !== this.history[this.currentHistoryIndex]) {\n                    // Отрезаем будущее если мы не на конце истории\n                    this.history = this.history.slice(0, this.currentHistoryIndex + 1);\n                    this.history.push(url);\n                    this.currentHistoryIndex = this.history.length - 1;\n                }\n                \n            } catch (e) {\n                console.error('Invalid URL:', url);\n                this.error = true;\n                this.loading = false;\n            }\n        },\n        \n        // Назад по истории\n        goBack() {\n            if (this.canGoBack) {\n                this.currentHistoryIndex--;\n                this.currentUrl = this.history[this.currentHistoryIndex];\n                this.iframeSrc = this.currentUrl;\n                this.loading = true;\n            }\n        },\n        \n        // Вперёд по истории\n        goForward() {\n            if (this.canGoForward) {\n                this.currentHistoryIndex++;\n                this.currentUrl = this.history[this.currentHistoryIndex];\n                this.iframeSrc = this.currentUrl;\n                this.loading = true;\n            }\n        },\n\n        // Обновление страницы\n        reload() {\n            this.loading = true;\n            this.error = false;\n            \n            // Форсируем перезагрузку iframe\n            const tempSrc = this.iframeSrc;\n            this.iframeSrc = '';\n            \n            // Небольшая задержка для гарантии перезагрузки\n            setTimeout(() => {\n                this.iframeSrc = tempSrc;\n            }, 50);\n        },\n\n        // Загрузка завершена\n        onIframeLoad() {\n            console.log('Wiki iframe loaded successfully');\n            this.loading = false;\n            this.error = false;\n            this.safeGetTitle();\n        },\n\n        // Ошибка загрузки\n        onIframeError() {\n            console.error('Wiki iframe failed to load');\n            this.loading = false;\n            this.error = true;\n        },\n\n        // Безопасное получение заголовка\n        safeGetTitle() {\n            try {\n                const iframe = this.$refs.iframeRef;\n                if (iframe && iframe.contentDocument) {\n                    const title = iframe.contentDocument.title;\n                    if (title) {\n                        console.log('Wiki page title:', title);\n                        // Можно обновить заголовок окна, если нужно\n                        this.$emit('title-change', title);\n                    }\n                }\n            } catch (e) {\n                console.log('Cannot access iframe content due to CORS');\n            }\n        },\n        \n        // Открыть в новой вкладке\n        openInNewTab() {\n            window.open(this.currentUrl, '_blank', 'noopener,noreferrer');\n        }\n    },\n\n    mounted() {\n        console.log('AppWiki mounted with windowId:', this.windowId);\n        \n        // Инициализируем данные из store после монтирования\n        this.initFromStore();\n        \n        // Сохраняем начальное состояние\n        this.saveState();\n    },\n\n    beforeUnmount() {\n        console.log('AppWiki unmounting, windowId:', this.windowId);\n        // Решите, нужно ли удалять состояние при закрытии окна\n        // this.appsStore.deleteWindowState(this.windowId);\n    }\n};\n</script>\n\n<style scoped>\n/* Стили остаются без изменений */\n.browser-app {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    background: white;\n    position: relative;\n}\n\n.browser-controls {\n    background: #f8f9fa;\n    border-bottom: 1px solid #dee2e6;\n    padding: 10px;\n    flex-shrink: 0;\n}\n\n.url-bar {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.url-bar button {\n    padding: 6px 12px;\n    border: 1px solid #ced4da;\n    background: white;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    min-width: 36px;\n    transition: all 0.2s;\n}\n\n.url-bar button:hover:not(:disabled) {\n    background: #e9ecef;\n}\n\n.url-bar button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.url-input {\n    flex: 1;\n    padding: 8px 12px;\n    border: 1px solid #ced4da;\n    border-radius: 4px;\n    font-size: 14px;\n}\n\n.go-btn {\n    background: #007bff !important;\n    color: white !important;\n    border-color: #007bff !important;\n}\n\n.go-btn:hover {\n    background: #0056b3;\n}\n\n.iframe-wrapper {\n    flex: 1;\n    position: relative;\n    overflow: hidden;\n}\n\n.iframe-wrapper iframe {\n    width: 100%;\n    height: 100%;\n    border: none;\n    display: block;\n}\n\n.loading-indicator {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 10px;\n    background: rgba(255, 255, 255, 0.9);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    z-index: 10;\n}\n\n.spinner {\n    width: 40px;\n    height: 40px;\n    border: 4px solid #f3f3f3;\n    border-top: 4px solid #007bff;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.error-message {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    text-align: center;\n    background: #f8d7da;\n    border: 1px solid #f5c6cb;\n    padding: 20px;\n    border-radius: 8px;\n    color: #721c24;\n    z-index: 10;\n}\n\n.error-message button {\n    margin-top: 10px;\n    padding: 8px 16px;\n    background: #dc3545;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n</style>","import { render } from \"./AppWiki.vue?vue&type=template&id=c1a6590c&scoped=true\"\nimport script from \"./AppWiki.vue?vue&type=script&lang=js\"\nexport * from \"./AppWiki.vue?vue&type=script&lang=js\"\n\nimport \"./AppWiki.vue?vue&type=style&index=0&id=c1a6590c&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-c1a6590c\"]])\n\nexport default __exports__"],"names":["class","_createElementBlock","_hoisted_1","$props","showControls","_hoisted_2","_createElementVNode","_hoisted_3","onClick","_cache","args","$options","goBack","disabled","canGoBack","title","_hoisted_4","goForward","canGoForward","_hoisted_5","reload","$data","currentUrl","$event","onKeyup","_withKeys","navigate","placeholder","_hoisted_6","ref","src","iframeSrc","onLoad","onIframeLoad","onError","onIframeError","sandbox","referrerpolicy","loading","_hoisted_8","error","_hoisted_9","name","props","windowId","type","String","required","Boolean","default","data","defLink","history","currentHistoryIndex","computed","mapStores","useAppsStore","this","length","watch","newUrl","console","log","saveState","handler","deep","methods","initFromStore","savedState","appsStore","getWindowState","state","appType","timestamp","Date","now","saveWindowState","url","trim","startsWith","URL","slice","push","e","tempSrc","setTimeout","safeGetTitle","iframe","$refs","iframeRef","contentDocument","$emit","openInNewTab","window","open","mounted","beforeUnmount","__exports__","render"],"ignoreList":[],"sourceRoot":""}