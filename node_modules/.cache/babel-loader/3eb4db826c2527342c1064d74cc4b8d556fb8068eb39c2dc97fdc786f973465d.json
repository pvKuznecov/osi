{"ast":null,"code":"import \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nexport const useAppsStore = defineStore('apps', () => {\n  // Храним состояния окон по их ID\n  const windowStates = ref({});\n  const LOCALSTORAGE_KEY = \"osi_app_store\";\n  const loadFromStorage = () => {\n    try {\n      const saved = localStorage.getItem(LOCALSTORAGE_KEY);\n      if (saved) {\n        const parsed = JSON.parse(saved);\n        windowStates.value = parsed || {};\n        console.log('Loaded app states from localStorage:', Object.keys(windowStates.value).length, 'windows');\n      }\n    } catch (error) {\n      console.error('Failed to load app states from localStorage:', error);\n      // В случае ошибки очищаем localStorage\n      localStorage.removeItem(LOCALSTORAGE_KEY);\n    }\n  };\n  const saveToStorage = () => {\n    try {\n      localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(windowStates.value));\n    } catch (error) {\n      console.error('Failed to save app states to localStorage:', error);\n    }\n  };\n  watch(windowStates, newStates => {\n    clearTimeout(windowStates.saveTimeout);\n    windowStates.saveTimeout = setTimeout(() => {\n      saveToStorage();\n    }, 500);\n  }, {\n    deep: true\n  });\n\n  // Сохранить состояние окна\n  const saveWindowState = (windowId, state) => {\n    if (!windowId) return;\n    windowStates.value[windowId] = {\n      ...windowStates.value[windowId],\n      ...state,\n      lastUpdated: Date.now()\n    };\n    console.log('State saved for window:', windowId, windowStates.value[windowId]);\n  };\n\n  // Получить состояние окна\n  const getWindowState = windowId => {\n    if (!windowId) return null;\n    return windowStates.value[windowId] || null;\n  };\n\n  // Удалить состояние окна\n  const deleteWindowState = windowId => {\n    if (!windowId) return;\n    delete windowStates.value[windowId];\n  };\n\n  // Очистить все состояния\n  const clearAllStates = () => {\n    windowStates.value = {};\n  };\n\n  // Получить состояние конкретного приложения по типу\n  const getAppState = (appType, windowId) => {\n    if (!windowId) return null;\n    const state = windowStates.value[windowId];\n    return state && state.appType === appType ? state : null;\n  };\n  return {\n    windowStates,\n    saveWindowState,\n    getWindowState,\n    deleteWindowState,\n    clearAllStates,\n    getAppState\n  };\n});","map":{"version":3,"names":["defineStore","ref","useAppsStore","windowStates","LOCALSTORAGE_KEY","loadFromStorage","saved","localStorage","getItem","parsed","JSON","parse","value","console","log","Object","keys","length","error","removeItem","saveToStorage","setItem","stringify","watch","newStates","clearTimeout","saveTimeout","setTimeout","deep","saveWindowState","windowId","state","lastUpdated","Date","now","getWindowState","deleteWindowState","clearAllStates","getAppState","appType"],"sources":["/home/kup/my_projects/vue/osi/src/stores/apps.store.js"],"sourcesContent":["import { defineStore } from 'pinia';\nimport { ref } from 'vue';\n\nexport const useAppsStore = defineStore('apps', () => {\n    // Храним состояния окон по их ID\n    const windowStates = ref({});\n\n    const LOCALSTORAGE_KEY = \"osi_app_store\";\n    const loadFromStorage = () => {\n        try {\n            const saved = localStorage.getItem(LOCALSTORAGE_KEY);\n            if (saved) {\n                const parsed = JSON.parse(saved);\n                windowStates.value = parsed || {};\n                console.log('Loaded app states from localStorage:', Object.keys(windowStates.value).length, 'windows');\n            }\n        } catch (error) {\n            console.error('Failed to load app states from localStorage:', error);\n            // В случае ошибки очищаем localStorage\n            localStorage.removeItem(LOCALSTORAGE_KEY);\n        }\n    };\n\n    const saveToStorage = () => {\n        try {\n            localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(windowStates.value));\n        } catch (error) {\n            console.error('Failed to save app states to localStorage:', error);\n        }\n    };\n\n    watch (\n        windowStates,\n        (newStates) => {\n             clearTimeout(windowStates.saveTimeout);\n            windowStates.saveTimeout = setTimeout(() => {\n                saveToStorage();\n            }, 500);\n        },\n        { deep: true }\n    );\n    \n    // Сохранить состояние окна\n    const saveWindowState = (windowId, state) => {\n        if (!windowId) return;\n        \n        windowStates.value[windowId] = {\n            ...windowStates.value[windowId],\n            ...state,\n            lastUpdated: Date.now()\n        };\n        \n        console.log('State saved for window:', windowId, windowStates.value[windowId]);\n    };\n    \n    // Получить состояние окна\n    const getWindowState = (windowId) => {\n        if (!windowId) return null;\n        return windowStates.value[windowId] || null;\n    };\n    \n    // Удалить состояние окна\n    const deleteWindowState = (windowId) => {\n        if (!windowId) return;\n        delete windowStates.value[windowId];\n    };\n    \n    // Очистить все состояния\n    const clearAllStates = () => {\n        windowStates.value = {};\n    };\n    \n    // Получить состояние конкретного приложения по типу\n    const getAppState = (appType, windowId) => {\n        if (!windowId) return null;\n        const state = windowStates.value[windowId];\n        return state && state.appType === appType ? state : null;\n    };\n    \n    return {\n        windowStates,\n        saveWindowState,\n        getWindowState,\n        deleteWindowState,\n        clearAllStates,\n        getAppState\n    };\n});"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}