{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"browser-app\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"browser-controls\"\n};\nconst _hoisted_3 = {\n  class: \"url-bar\"\n};\nconst _hoisted_4 = [\"disabled\"];\nconst _hoisted_5 = [\"disabled\"];\nconst _hoisted_6 = {\n  class: \"iframe-wrapper\"\n};\nconst _hoisted_7 = [\"src\"];\nconst _hoisted_8 = {\n  key: 1,\n  class: \"loading-indicator\"\n};\nconst _hoisted_9 = {\n  key: 2,\n  class: \"error-message\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" Панель управления браузером \"), $props.showControls ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.goBack && $options.goBack(...args)),\n    disabled: !$options.canGoBack,\n    title: \"Назад\"\n  }, \"←\", 8 /* PROPS */, _hoisted_4), _createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.goForward && $options.goForward(...args)),\n    disabled: !$options.canGoForward,\n    title: \"Вперёд\"\n  }, \"→\", 8 /* PROPS */, _hoisted_5), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.reload && $options.reload(...args)),\n    title: \"Обновить\"\n  }, \"↻\"), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.currentUrl = $event),\n    onKeyup: _cache[4] || (_cache[4] = _withKeys((...args) => $options.navigate && $options.navigate(...args), [\"enter\"])),\n    class: \"url-input\",\n    placeholder: \"Введите URL...\"\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelText, $data.currentUrl]]), _createElementVNode(\"button\", {\n    onClick: _cache[5] || (_cache[5] = (...args) => $options.navigate && $options.navigate(...args)),\n    class: \"go-btn\"\n  }, \"Перейти\"), _createElementVNode(\"button\", {\n    onClick: _cache[6] || (_cache[6] = (...args) => $options.openInNewTab && $options.openInNewTab(...args)),\n    class: \"external-btn\",\n    title: \"Открыть в новой вкладке\"\n  }, \"↗\")])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"iframe\", {\n    ref: \"iframeRef\",\n    src: $data.iframeSrc,\n    onLoad: _cache[7] || (_cache[7] = (...args) => $options.onIframeLoad && $options.onIframeLoad(...args)),\n    onError: _cache[8] || (_cache[8] = (...args) => $options.onIframeError && $options.onIframeError(...args)),\n    sandbox: \"allow-scripts allow-same-origin allow-forms allow-popups\",\n    referrerpolicy: \"no-referrer\"\n  }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_7)]), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [...(_cache[10] || (_cache[10] = [_createElementVNode(\"div\", {\n    class: \"spinner\"\n  }, null, -1 /* CACHED */), _createElementVNode(\"span\", null, \"Загрузка...\", -1 /* CACHED */)]))])) : _createCommentVNode(\"v-if\", true), $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_cache[11] || (_cache[11] = _createElementVNode(\"p\", null, \"⚠️ Не удалось загрузить страницу\", -1 /* CACHED */)), _createElementVNode(\"button\", {\n    onClick: _cache[9] || (_cache[9] = (...args) => $options.reload && $options.reload(...args))\n  }, \"Повторить\")])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createCommentVNode","$props","showControls","_hoisted_2","_createElementVNode","_hoisted_3","onClick","_cache","args","$options","goBack","disabled","canGoBack","title","_hoisted_4","goForward","canGoForward","_hoisted_5","reload","$data","currentUrl","$event","onKeyup","_withKeys","navigate","placeholder","openInNewTab","_hoisted_6","ref","src","iframeSrc","onLoad","onIframeLoad","onError","onIframeError","sandbox","referrerpolicy","loading","_hoisted_8","error","_hoisted_9"],"sources":["/home/kup/my_projects/vue/osi/src/apps/learn/AppWiki/AppWiki.vue"],"sourcesContent":["<template>\n    <div class=\"browser-app\">    \n        <!-- Панель управления браузером -->\n        <div class=\"browser-controls\" v-if=\"showControls\">\n            <div class=\"url-bar\">\n                <button @click=\"goBack\" :disabled=\"!canGoBack\" title=\"Назад\">←</button>\n                <button @click=\"goForward\" :disabled=\"!canGoForward\" title=\"Вперёд\">→</button>\n                <button @click=\"reload\" title=\"Обновить\">↻</button>\n                \n                <input \n                    v-model=\"currentUrl\" \n                    @keyup.enter=\"navigate\" \n                    class=\"url-input\" \n                    placeholder=\"Введите URL...\"\n                />\n                \n                <button @click=\"navigate\" class=\"go-btn\">Перейти</button>\n                <button @click=\"openInNewTab\" class=\"external-btn\" title=\"Открыть в новой вкладке\">↗</button>\n            </div>\n        </div>\n        \n        <div class=\"iframe-wrapper\">\n            <iframe \n                ref=\"iframeRef\" \n                :src=\"iframeSrc\" \n                @load=\"onIframeLoad\" \n                @error=\"onIframeError\" \n                sandbox=\"allow-scripts allow-same-origin allow-forms allow-popups\" \n                referrerpolicy=\"no-referrer\" \n            ></iframe>\n        </div>    \n        \n        <div v-if=\"loading\" class=\"loading-indicator\">\n            <div class=\"spinner\"></div>\n            <span>Загрузка...</span>\n        </div>\n        \n        <div v-if=\"error\" class=\"error-message\">\n            <p>⚠️ Не удалось загрузить страницу</p>\n            <button @click=\"reload\">Повторить</button>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { useAppsStore } from '@/stores/apps.store';\nimport { mapStores } from 'pinia';\n\nexport default {\n    name: 'AppWiki',\n\n    props: {\n        windowId: {\n            type: String,\n            required: true,\n            default: () => `wiki_${Date.now()}`\n        },\n        showControls: {\n            type: Boolean,\n            default: true\n        }\n    },\n    \n    data() {\n        const defLink = 'https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0';\n        \n        // Получаем сохраненное состояние из store\n        const savedState = this.appsStore.getWindowState(this.windowId);\n        const initialUrl = savedState?.currentUrl || defLink;\n        const initialHistory = savedState?.history || [initialUrl];\n        const initialHistoryIndex = savedState?.currentHistoryIndex || 0;\n\n        return {\n            currentUrl: initialUrl,\n            iframeSrc: initialUrl,\n            loading: true,\n            error: false,\n            history: initialHistory,\n            currentHistoryIndex: initialHistoryIndex\n        };\n    },\n    \n    computed: {\n        // Подключаем store через mapStores\n        ...mapStores(useAppsStore),\n        \n        canGoBack() {\n            return this.currentHistoryIndex > 0;\n        },\n        \n        canGoForward() {\n            return this.currentHistoryIndex < this.history.length - 1;\n        }\n    },\n\n    watch: {\n        currentUrl(newUrl) {\n            this.saveState();\n        },\n        currentHistoryIndex() {\n            this.saveState();\n        },\n        history: {\n            handler() {\n                this.saveState();\n            },\n            deep: true\n        }\n    },\n\n    methods: {\n        // Сохраняем текущее состояние в store\n        saveState() {\n            const state = {\n                appType: 'wiki',\n                currentUrl: this.currentUrl,\n                history: [...this.history],\n                currentHistoryIndex: this.currentHistoryIndex,\n                timestamp: Date.now()\n            };\n            \n            this.appsStore.saveWindowState(this.windowId, state);\n        },\n\n        // Навигация по URL\n        navigate() {\n            let url = this.currentUrl.trim();\n            \n            // Добавляем протокол если нужно\n            if (!url.startsWith('http://') && !url.startsWith('https://')) {\n                url = 'https://' + url;\n            }\n            \n            try {\n                // Валидация URL\n                new URL(url);\n                this.iframeSrc = url;\n                this.loading = true;\n                this.error = false;\n                \n                // Добавляем в историю\n                if (url !== this.history[this.currentHistoryIndex]) {\n                    // Отрезаем будущее если мы не на конце истории\n                    this.history = this.history.slice(0, this.currentHistoryIndex + 1);\n                    this.history.push(url);\n                    this.currentHistoryIndex = this.history.length - 1;\n                }\n                \n            } catch (e) {\n                console.error('Invalid URL:', url);\n                this.error = true;\n                this.loading = false;\n            }\n        },\n        \n        // Назад по истории\n        goBack() {\n            if (this.canGoBack) {\n                this.currentHistoryIndex--;\n                this.currentUrl = this.history[this.currentHistoryIndex];\n                this.iframeSrc = this.currentUrl;\n                this.loading = true;\n            }\n        },\n        \n        // Вперёд по истории\n        goForward() {\n            if (this.canGoForward) {\n                this.currentHistoryIndex++;\n                this.currentUrl = this.history[this.currentHistoryIndex];\n                this.iframeSrc = this.currentUrl;\n                this.loading = true;\n            }\n        },\n\n        // Обновление страницы\n        reload() {\n            this.loading = true;\n            this.error = false;\n            \n            // Форсируем перезагрузку iframe\n            const tempSrc = this.iframeSrc;\n            this.iframeSrc = '';\n            \n            // Небольшая задержка для гарантии перезагрузки\n            setTimeout(() => {\n                this.iframeSrc = tempSrc;\n            }, 50);\n        },\n\n        // Загрузка завершена\n        onIframeLoad() {\n            console.log('Wiki iframe loaded successfully');\n            this.loading = false;\n            this.error = false;\n            this.safeGetTitle();\n        },\n\n        // Ошибка загрузки\n        onIframeError() {\n            console.error('Wiki iframe failed to load');\n            this.loading = false;\n            this.error = true;\n        },\n\n        // Безопасное получение заголовка\n        safeGetTitle() {\n            try {\n                const iframe = this.$refs.iframeRef;\n                if (iframe && iframe.contentDocument) {\n                    const title = iframe.contentDocument.title;\n                    if (title) {\n                        console.log('Wiki page title:', title);\n                        // Можно обновить заголовок окна, если нужно\n                        this.$emit('title-change', title);\n                    }\n                }\n            } catch (e) {\n                console.log('Cannot access iframe content due to CORS');\n            }\n        },\n        \n        // Открыть в новой вкладке\n        openInNewTab() {\n            window.open(this.currentUrl, '_blank', 'noopener,noreferrer');\n        }\n    },\n\n    mounted() {\n        console.log('AppWiki mounted with windowId:', this.windowId);\n        this.saveState(); // Сохраняем начальное состояние\n        \n        // Можно также загрузить favicon или другую мета-информацию\n    },\n\n    beforeUnmount() {\n        console.log('AppWiki unmounting, windowId:', this.windowId);\n        // Решите, нужно ли удалять состояние при закрытии окна\n        // this.appsStore.deleteWindowState(this.windowId);\n    }\n};\n</script>\n\n<style scoped>\n.browser-app {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    background: white;\n    position: relative;\n}\n\n.browser-controls {\n    background: #f8f9fa;\n    border-bottom: 1px solid #dee2e6;\n    padding: 10px;\n    flex-shrink: 0;\n}\n\n.url-bar {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.url-bar button {\n    padding: 6px 12px;\n    border: 1px solid #ced4da;\n    background: white;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    min-width: 36px;\n    transition: all 0.2s;\n}\n\n.url-bar button:hover:not(:disabled) {\n    background: #e9ecef;\n}\n\n.url-bar button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.url-input {\n    flex: 1;\n    padding: 8px 12px;\n    border: 1px solid #ced4da;\n    border-radius: 4px;\n    font-size: 14px;\n}\n\n.go-btn {\n    background: #007bff;\n    color: white;\n    border-color: #007bff;\n}\n\n.go-btn:hover {\n    background: #0056b3;\n}\n\n.external-btn {\n    background: #28a745;\n    color: white;\n    border-color: #28a745;\n}\n\n.external-btn:hover {\n    background: #1e7e34;\n}\n\n.iframe-wrapper {\n    flex: 1;\n    position: relative;\n    overflow: hidden;\n}\n\n.iframe-wrapper iframe {\n    width: 100%;\n    height: 100%;\n    border: none;\n    display: block;\n}\n\n.loading-indicator {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 10px;\n    background: rgba(255, 255, 255, 0.9);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    z-index: 10;\n}\n\n.spinner {\n    width: 40px;\n    height: 40px;\n    border: 4px solid #f3f3f3;\n    border-top: 4px solid #007bff;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.error-message {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    text-align: center;\n    background: #f8d7da;\n    border: 1px solid #f5c6cb;\n    padding: 20px;\n    border-radius: 8px;\n    color: #721c24;\n    z-index: 10;\n}\n\n.error-message button {\n    margin-top: 10px;\n    padding: 8px 16px;\n    background: #dc3545;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}