{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.to-array.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport Dexie from \"dexie\";\nimport { appsConfig } from \"@/config/applications\";\n\n// конфигураторы БД\nconst db_name = 'OSIDB';\nconst db_version = 1;\n\n// инициализация БД\nconst DB = new Dexie(db_name);\n\n// const defaultApps = await appsConfig.getAllApps();\n// Функция для получения упрощенных объектов приложений\nasync function getDefaultApps() {\n  const apps = await appsConfig.getAllApps();\n\n  // Преобразуем каждый объект приложения в упрощенную версию\n  return apps.map(app => ({\n    id: app.id,\n    name: app.name,\n    label: app.label,\n    category: app.category || 'Other',\n    icon: app.icon || '',\n    iconclass: app.iconclass || '',\n    description: app.description || '',\n    defWidth: app.defWidth || false,\n    defHeight: app.defHeight || false,\n    isMaximized: app.isMaximized || false,\n    resizable: app.resizable || false,\n    canMinimize: app.canMinimize || false,\n    showOnDesktop: app.showOnDesktop || false,\n    showInStartMenu: app.showInStartMenu || false,\n    // Сохраняем только базовые данные, удаляем функции и компоненты\n    path: app.path || '',\n    component: app.component && app.component.name ? app.component.name : 'Component',\n    // Добавляем только примитивные типы данных\n    data: app.data && typeof app.data === 'object' ? JSON.parse(JSON.stringify(app.data)) : {}\n  }));\n}\n\n// описание схемы БД\nDB.version(db_version).stores({\n  users: '++id, name, login, password, apps, data, config, systemСonfig, createdAt, updatedAt',\n  settings: '++id, key, value, updatedAt'\n});\nconst Def_userConfig = {\n  avatar: \"cat.jpg\"\n};\nconst Def_userSystemconfig = {\n  desktopWallpaper: \"nwall.jpg\",\n  windows: {}\n};\n\n// -=-=-=-=-=-=-Описание классов моделей-=-=-=-=-=-=-\nexport class User {\n  constructor(data = {}) {\n    this.login = data.login || 'user';\n    this.name = data.name || 'User';\n    this.password = data.password || ''; //ПРОДУМАТЬ РЕАЛЬНУЮ СХЕМУ ЗАЩИТЫ\n    this.apps = data.apps || [];\n    this.data = data.data || {};\n    this.config = data.config || Def_userConfig;\n    this.systemconfig = data.systemconfig || Def_userSystemconfig;\n    this.createdAt = data.createdAt || new Date();\n    this.updatedAt = data.updatedAt || new Date();\n\n    // автоматическое присваение id (вариант для \"совместимости\")\n    if (data.id) {\n      this.id = data.id;\n    }\n  }\n}\nexport class Setting {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.updatedAt = new Date();\n  }\n}\n\n// -=-=-=-=-=-=-Основные операции CRUD-=-=-=-=-=-=-\nexport const usersTable = {\n  // обновление|сохранение учетной записи\n  async save(userData) {\n    try {\n      const NUser = new User(userData);\n      if (NUser.id) {\n        // Преобразуем объект User в простой объект для IndexedDB\n        const userForDB = this.prepareUserForDB(NUser);\n        userForDB.updatedAt = new Date();\n        await DB.users.update(userForDB.id, userForDB);\n        return NUser;\n      } else {\n        // зачищаем id в NUser (автоматически сгенерирует)\n        delete NUser.id;\n        NUser.apps = await getDefaultApps();\n        NUser.createdAt = new Date();\n        NUser.updatedAt = new Date();\n        return await DB.users.add(NUser);\n      }\n    } catch (error) {\n      console.error('Error operation (users; save):', error);\n      throw new Error(`Failed to save user: ${error.message}`);\n    }\n  },\n  // Функция для проверки сериализуемости\n  isSerializable(value) {\n    if (value === null || value === undefined) return true;\n    if (typeof value === 'boolean' || typeof value === 'number' || typeof value === 'string') return true;\n    if (value instanceof Date) return true;\n    try {\n      JSON.stringify(value);\n      return true;\n    } catch {\n      return false;\n    }\n  },\n  // Функция для создания безопасной копии\n  createSafeCopy(value) {\n    if (!this.isSerializable(value)) return undefined;\n    if (Array.isArray(value)) return value.map(this.createSafeCopy).filter(item => item !== undefined);\n    if (value && typeof value === 'object' && !(value instanceof Date)) {\n      const result = {};\n      Object.entries(value).forEach(([key, val]) => {\n        if (typeof val !== 'function' && this.isSerializable(val)) result[key] = this.createSafeCopy(val);\n      });\n      return result;\n    }\n    return value;\n  },\n  prepareUserForDB(user) {\n    // // Функция для проверки сериализуемости\n    // const isSerializable = (value) => {\n    //     if (value === null || value === undefined) return true;\n    //     if (typeof value === 'boolean' || typeof value === 'number' || typeof value === 'string') return true;\n    //     if (value instanceof Date) return true;\n\n    //     try {\n    //         JSON.stringify(value);\n    //         return true;\n    //     } catch {\n    //         return false;\n    //     }\n    // };\n\n    // // Функция для создания безопасной копии\n    // const createSafeCopy = (value) => {\n    //     if (!this.isSerializable(value)) return undefined;\n\n    //     if (Array.isArray(value)) return value.map(createSafeCopy).filter(item => item !== undefined);\n\n    //     if (value && typeof value === 'object' && !(value instanceof Date)) {\n    //         const result = {};\n    //         Object.entries(value).forEach(([key, val]) => {\n    //             if (typeof val !== 'function' && this.isSerializable(val)) result[key] = createSafeCopy(val);\n    //         });\n    //         return result;\n    //     }\n\n    //     return value;\n    // };\n\n    // Создаем безопасный объект для сохранения\n    return {\n      id: user.id,\n      login: user.login || '',\n      name: user.name || '',\n      password: user.password || '',\n      apps: Array.isArray(user.apps) ? user.apps.map(app => this.createSafeCopy(app) || {}).filter(app => Object.keys(app).length > 0) : [],\n      data: this.createSafeCopy(user.data) || {},\n      config: this.createSafeCopy(user.config) || {\n        avatar: \"cat.jpg\"\n      },\n      systemconfig: this.createSafeCopy(user.systemconfig) || {\n        desktopWallpaper: \"nwall.jpg\"\n      },\n      createdAt: user.createdAt instanceof Date ? user.createdAt : user.createdAt ? new Date(user.createdAt) : new Date(),\n      updatedAt: user.updatedAt instanceof Date ? user.updatedAt : user.updatedAt ? new Date(user.updatedAt) : new Date()\n    };\n  },\n  // поиск учетной записи по id\n  async getbyId(id) {\n    try {\n      return await DB.users.get(id);\n    } catch (error) {\n      console.error('Error operation (users; getbyId):', error);\n      throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n    }\n  },\n  // поиск учетной записи по login\n  async getbyLogin(login) {\n    try {\n      return await DB.users.where('login').equals(login).first();\n    } catch (error) {\n      console.error('Error operation (users; getbyLogin):', error);\n      throw new Error(`Failed to get user by login ${login}: ${error.message}`);\n    }\n  },\n  // получить массив всех учетных записей\n  async getAll() {\n    try {\n      return await DB.users.toArray();\n    } catch (error) {\n      console.error('Error operation (users; getAll):', error);\n      throw new Error(`Failed to get all users`);\n    }\n  },\n  // получить массив apps учетной записи\n  async getApps(id) {\n    try {\n      const USER = await DB.users.get(id);\n      if (USER && USER.apps) {\n        return USER.apps;\n      } else {\n        console.error('Error operation (users; getApps).');\n      }\n    } catch (error) {\n      console.error('Error operation (users; getApps):', error);\n      throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n    }\n  },\n  // получить config пользователя по id\n  async getConfig(id) {\n    try {\n      const USER = await DB.users.get(id);\n      if (USER && USER.config) {\n        return USER.config;\n      } else {\n        console.error('Error operation (users; getConfig).');\n      }\n    } catch (error) {\n      console.error('Error operation (users; getConfig):', error);\n      throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n    }\n  },\n  // получить systemconfig пользователя по id\n  async getSConfig(id) {\n    try {\n      const USER = await DB.users.get(id);\n      if (USER && USER.systemconfig) {\n        return USER.systemconfig;\n      } else {\n        console.error('Error operation (users; getSConfig).');\n      }\n    } catch (error) {\n      console.error('Error operation (users; getSConfig):', error);\n      throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n    }\n  },\n  // обновление конфигуратора приложений в учетной записи\n  async updateAppSetting(userId, appId, key, value) {\n    try {\n      // Получаем пользователя\n      const user = await DB.users.get(userId);\n      if (!user) {\n        throw new Error(`Пользователь с ID ${userId} не найден`);\n      }\n\n      // Находим приложение в массиве apps\n      const appIndex = user.apps.findIndex(app => app.id === appId);\n      if (appIndex === -1) {\n        throw new Error(`Приложение с ID ${appId} не найдено у пользователя ${userId}`);\n      }\n\n      // Обновляем значение ключа\n      // Используем $set для реактивного обновления, если это необходимо\n      const updatedApps = [...user.apps];\n      updatedApps[appIndex] = {\n        ...updatedApps[appIndex],\n        [key]: value\n      };\n\n      // Сохраняем обновленный массив приложений\n      await DB.users.update(userId, {\n        apps: updatedApps,\n        updatedAt: new Date()\n      });\n      return {\n        success: true,\n        userId,\n        appId,\n        key,\n        value\n      };\n    } catch (error) {\n      console.error('Error operation (users; updateAppSetting):', error);\n      throw new Error(`Failed to update app setting: ${error.message}`);\n    }\n  },\n  // удалить учетную запись\n  async delete(id) {\n    try {\n      return await DB.users.delete(id);\n    } catch (error) {\n      console.error('Error operation (users; delete):', error);\n      throw new Error(`Failed to delete user ${id}: ${error.message}`);\n    }\n  },\n  // кол-во учетных записей\n  async count() {\n    try {\n      return await DB.users.count();\n    } catch (error) {\n      console.error('Error operation (users; count):', error);\n      throw new Error(`Failed to count users`);\n    }\n  },\n  async search(query) {\n    try {\n      return await DB.users.filter(user => user.login.toLowerCase().includes(query.toLowerCase()) || JSON.stringify(user.data).toLowerCase().includes(query.toLowerCase())).toArray();\n    } catch (error) {\n      console.error('Error operation (users; search');\n      throw new Error(`Search failed: ${error.message}`);\n    }\n  },\n  // =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n\n  prepareWindowForDB(wdata) {},\n  windows: {\n    async create(userId, appData) {\n      // валидация\n      if (!appData.name) throw new Error('App name required!');\n      const windowId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n      appData.id = windowId;\n      const windowData = {\n        ...appData\n      };\n      await DB.users.where('id').equals(userId).modify(user => {\n        user.systemconfig.windows[windowId] = windowData;\n      });\n      return windowData;\n    },\n    async getAll(userId) {\n      const user = await DB.users.get(userId);\n      return Object.values(user?.systemconfig?.windows || {});\n    }\n  },\n  // получить объект \"окна\" в SConfig пользователя (по его id)\n  async getSConfig_windows(userId) {\n    try {\n      const FindUser = await this.getbyId(userId);\n      const FindSConfig = FindUser && FindUser.systemconfig ? FindUser.systemconfig : false;\n      return FindSConfig && FindSConfig.windows ? FindSConfig.windows : false;\n    } catch (error) {\n      console.error('Error operation(users; getSConfig_windows).');\n      throw new Error(`Failed: ${error.message}`);\n    }\n  },\n  // создание нового \"окна\" в SConfig пользователя\n  async addSConfig_newWindow(userId, appData) {\n    const newId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n    try {\n      let FindUser = await this.getbyId(userId);\n      if (FindUser) {\n        let nSystemConfig = FindUser.systemconfig ? FindUser.systemconfig : {\n          windows: {}\n        };\n        let nWindows = nSystemConfig && nSystemConfig.windows ? nSystemConfig.windows : false;\n        nWindows[newId] = {\n          ...appData\n        };\n        if (nSystemConfig && nWindows) {\n          nSystemConfig.windows = nWindows;\n          FindUser.systemconfig = nSystemConfig;\n          const userForDB = this.prepareUserForDB(FindUser);\n          userForDB.updatedAt = new Date();\n          await DB.users.update(userForDB.id, userForDB);\n          return true;\n        } else {\n          console.error('Error operation(users; addSConfig_newWindow; c:1).');\n          return false;\n        }\n      } else {\n        console.error('Error operation(users; addSConfig_newWindow; c:2).');\n        return false;\n      }\n    } catch (error) {\n      console.error('Error operation(users; addSConfig_newWindow).');\n      throw new Error(`Failed: ${error.message}`);\n    }\n  },\n  // поиск \"окна\" в SConfig пользователя по его id\n  async getSConfig_window_byId(userId, windowId) {\n    try {\n      const FindUser = await this.getbyId(userId);\n      const FindSConfig = FindUser && FindUser.systemconfig ? FindUser.systemconfig : false;\n      const FindWindows = FindSConfig && FindSConfig.windows ? FindSConfig.windows : false;\n      return FindWindows && Object.keys(FindWindows).includes(windowId) ? FindWindows[windowId] : false;\n    } catch (error) {\n      console.error('Error operation(users; getSConfig_window_byId).');\n      throw new Error(`Failed: ${error.message}`);\n    }\n  },\n  // поиск \"окна\" в SConfig пользователя по данным приложения\n  async getSConfig_window_byConfig(userId, appData) {\n    try {\n      const FindWindows = await this.getSConfig_windows(userId);\n      if (FindWindows) {\n        let res = false;\n        Object.keys(FindWindows).forEach(function (key) {\n          if (appData.id && FindWindows[key].id === appData.id && appData.name && FindWindows[key].name === appData.name) {\n            res = FindWindows[key];\n          }\n        });\n        return res;\n      } else {\n        return false;\n      }\n    } catch (error) {\n      console.error('Error operation(users; getSConfig_window_byConfig).');\n      throw new Error(`Failed: ${error.message}`);\n    }\n  }\n};\nexport const settingsTable = {\n  // сохранение настройки\n  async save(key, value) {\n    try {\n      const existing = await DB.settings.where('key').equals(key).first();\n      if (existing) {\n        await DB.settings.update(existing.id, {\n          value: value,\n          updatedAt: new Date()\n        });\n        return existing.id;\n      } else {\n        return await DB.settings.add(new Setting(key, value));\n      }\n    } catch (error) {\n      console.error('Error operation (settings; save');\n      throw new Error(`Failed to save setting ${key}: ${error.message}`);\n    }\n  },\n  // получить настройку\n  async get(key, defaultVal = null) {\n    try {\n      const findSetting = DB.settings.where('key').equals(key).first();\n      return findSetting ? findSetting.value : defaultVal;\n    } catch (error) {\n      console.error('Error operation (settings; get');\n      throw new Error(`Failed to get setting ${key}: ${error.message}`);\n    }\n  },\n  // удалить настройку\n  async delete(key) {\n    try {\n      const findSetting = await DB.settings.where('key').equals(key).first();\n      if (findSetting) {\n        return await DB.settings.delete(findSetting.id);\n      } else {\n        return null;\n      }\n    } catch (error) {\n      console.error('Error operation (settings; delete');\n      throw new Error(`Failed to delete setting ${key}: ${error.message}`);\n    }\n  },\n  // получить все настройки\n  async getAll() {\n    try {\n      return await DB.settings.toArray();\n    } catch (error) {\n      console.error('Error operation (settings; getAll');\n      throw new Error(`Failed to get all settings`);\n    }\n  }\n};\n\n// -=-=-=-=-=-=-Служебное-=-=-=-=-=-=-\n\n// инициализация БД с тестовыми данными\nexport async function initDatabase() {\n  try {\n    // проверка, пустая ли база\n    const userCount = await usersTable.count();\n    if (userCount === 0) {\n      // Загружаем apps асинхронно\n      const defaultAppsList = await getDefaultApps();\n\n      // создание базового пользователя\n      const defaultUser = new User({\n        login: 'user',\n        password: '',\n        apps: defaultAppsList,\n        data: {},\n        config: {\n          avatar: 'robot.jpg'\n        },\n        systemconfig: {\n          desktopWallpaper: \"nwall.jpg\"\n        }\n      });\n      await usersTable.save(defaultUser);\n      console.log('Default user created.');\n    }\n\n    // инициализация базовых настроек \n    const defaultSettings = [['theme', 'dark'], ['avatarDefault', 'cat']];\n    for (const [key, value] of defaultSettings) {\n      const existing = await settingsTable.get(key);\n      if (existing === null) {\n        await settingsTable.set(key, value);\n      }\n    }\n    console.log('Database initialized successfully');\n    return true;\n  } catch (error) {\n    console.error('Error initializing DB:', error);\n    throw error;\n  }\n}\n\n/**\n * Очистка базы данных (осторожно!)\n */\nexport async function clearDatabase() {\n  try {\n    await Promise.all([DB.users.clear(), DB.settings.clear()]);\n    console.log('Database cleared');\n  } catch (error) {\n    console.error('Error clearing database:', error);\n    throw error;\n  }\n}\n\n// ==================== МИГРАЦИИ ====================\n\n// Пример добавления миграции при увеличении версии\n// DB.version(2).stores({\n//     users: '++id, login, password, apps, data, config, systemConfig, createdAt, updatedAt, lastLogin',\n//     settings: '++id, key, value, updatedAt',\n//     sessions: '++id, userId, token, expiresAt, createdAt' // Новая таблица\n// }).upgrade(async (tx) => {\n//     // Добавляем поле lastLogin к существующим пользователям\n//     const users = await tx.users.toArray();\n//     await Promise.all(\n//         users.map(user => \n//             tx.users.update(user.id, { \n//                 lastLogin: null,\n//                 updatedAt: new Date() \n//             })\n//         )\n//     );\n\n//     console.log('Migration to version 2 completed');\n// });\n\nexport { DB };\nexport default {\n  DB,\n  User,\n  usersTable,\n  settingsTable,\n  initDatabase,\n  clearDatabase\n};","map":{"version":3,"names":["Dexie","appsConfig","db_name","db_version","DB","getDefaultApps","apps","getAllApps","map","app","id","name","label","category","icon","iconclass","description","defWidth","defHeight","isMaximized","resizable","canMinimize","showOnDesktop","showInStartMenu","path","component","data","JSON","parse","stringify","version","stores","users","settings","Def_userConfig","avatar","Def_userSystemconfig","desktopWallpaper","windows","User","constructor","login","password","config","systemconfig","createdAt","Date","updatedAt","Setting","key","value","usersTable","save","userData","NUser","userForDB","prepareUserForDB","update","add","error","console","Error","message","isSerializable","undefined","createSafeCopy","Array","isArray","filter","item","result","Object","entries","forEach","val","user","keys","length","getbyId","get","getbyLogin","where","equals","first","getAll","toArray","getApps","USER","getConfig","getSConfig","updateAppSetting","userId","appId","appIndex","findIndex","updatedApps","success","delete","count","search","query","toLowerCase","includes","prepareWindowForDB","wdata","create","appData","windowId","now","Math","random","toString","substr","windowData","modify","values","getSConfig_windows","FindUser","FindSConfig","addSConfig_newWindow","newId","nSystemConfig","nWindows","getSConfig_window_byId","FindWindows","getSConfig_window_byConfig","res","settingsTable","existing","defaultVal","findSetting","initDatabase","userCount","defaultAppsList","defaultUser","log","defaultSettings","set","clearDatabase","Promise","all","clear"],"sources":["/home/kup/my_projects/vue/osi/src/idb/db.js"],"sourcesContent":["import Dexie from \"dexie\";\n\nimport { appsConfig } from \"@/config/applications\";\n\n// конфигураторы БД\nconst db_name = 'OSIDB';\nconst db_version = 1;\n\n// инициализация БД\nconst DB = new Dexie(db_name);\n\n// const defaultApps = await appsConfig.getAllApps();\n// Функция для получения упрощенных объектов приложений\nasync function getDefaultApps() {\n    const apps = await appsConfig.getAllApps();\n    \n    // Преобразуем каждый объект приложения в упрощенную версию\n    return apps.map(app => ({\n        id: app.id,\n        name: app.name,\n        label: app.label,\n        category: app.category || 'Other',\n        icon: app.icon || '',\n        iconclass: app.iconclass || '',\n        description: app.description || '',\n        defWidth: app.defWidth || false,\n        defHeight: app.defHeight || false,\n        isMaximized: app.isMaximized || false,\n        resizable: app.resizable || false,\n        canMinimize: app.canMinimize || false,\n        showOnDesktop: app.showOnDesktop || false,\n        showInStartMenu: app.showInStartMenu || false,\n        // Сохраняем только базовые данные, удаляем функции и компоненты\n        path: app.path || '',\n        component: (app.component && app.component.name) ? app.component.name : 'Component',\n        // Добавляем только примитивные типы данных\n        data: app.data && typeof app.data === 'object' ? JSON.parse(JSON.stringify(app.data)) : {}        \n    }));\n}\n\n// описание схемы БД\nDB.version(db_version).stores({\n    users: '++id, name, login, password, apps, data, config, systemСonfig, createdAt, updatedAt',\n    settings: '++id, key, value, updatedAt',\n});\n\nconst Def_userConfig = {\n    avatar: \"cat.jpg\"\n};\n\nconst Def_userSystemconfig = {\n    desktopWallpaper: \"nwall.jpg\",\n    windows: {},\n};\n\n// -=-=-=-=-=-=-Описание классов моделей-=-=-=-=-=-=-\nexport class User {\n    constructor(data = {}) {\n        this.login = data.login || 'user';\n        this.name = data.name || 'User';\n        this.password = data.password || '';    //ПРОДУМАТЬ РЕАЛЬНУЮ СХЕМУ ЗАЩИТЫ\n        this.apps = data.apps || [];\n        this.data = data.data || {};\n        this.config = data.config || Def_userConfig;\n        this.systemconfig = data.systemconfig || Def_userSystemconfig\n        this.createdAt = data.createdAt || new Date();\n        this.updatedAt = data.updatedAt || new Date();\n\n        // автоматическое присваение id (вариант для \"совместимости\")\n        if (data.id) {\n            this.id = data.id;\n        }\n    }\n}\n\nexport class Setting {\n    constructor(key, value) {\n        this.key = key;\n        this.value = value;\n        this.updatedAt = new Date();\n    }\n}\n\n\n// -=-=-=-=-=-=-Основные операции CRUD-=-=-=-=-=-=-\nexport const usersTable = {\n    // обновление|сохранение учетной записи\n    async save(userData) {\n        try {\n            const NUser = new User(userData);\n\n            if (NUser.id) {\n                // Преобразуем объект User в простой объект для IndexedDB\n                const userForDB = this.prepareUserForDB(NUser);\n\n                userForDB.updatedAt = new Date();\n                await DB.users.update(userForDB.id, userForDB);\n\n                return NUser;\n            } else {\n                // зачищаем id в NUser (автоматически сгенерирует)\n                delete NUser.id;\n\n                NUser.apps = await getDefaultApps();\n                NUser.createdAt = new Date();\n                NUser.updatedAt = new Date();\n\n                return await DB.users.add(NUser);\n            }\n        } catch (error) {\n            console.error('Error operation (users; save):', error);            \n            throw new Error(`Failed to save user: ${error.message}`);\n        }\n    },\n\n    // Функция для проверки сериализуемости\n    isSerializable(value) {\n        if (value === null || value === undefined) return true;\n        if (typeof value === 'boolean' || typeof value === 'number' || typeof value === 'string') return true;\n        if (value instanceof Date) return true;\n        \n        try {\n            JSON.stringify(value);\n            return true;\n        } catch {\n            return false;\n        }\n    },\n\n    // Функция для создания безопасной копии\n    createSafeCopy(value) {\n        if (!this.isSerializable(value)) return undefined;\n        \n        if (Array.isArray(value)) return value.map(this.createSafeCopy).filter(item => item !== undefined);\n        \n        if (value && typeof value === 'object' && !(value instanceof Date)) {\n            const result = {};\n            Object.entries(value).forEach(([key, val]) => {\n                if (typeof val !== 'function' && this.isSerializable(val)) result[key] = this.createSafeCopy(val);\n            });\n            return result;\n        }\n        \n        return value;\n    },\n\n    prepareUserForDB(user) {\n        // // Функция для проверки сериализуемости\n        // const isSerializable = (value) => {\n        //     if (value === null || value === undefined) return true;\n        //     if (typeof value === 'boolean' || typeof value === 'number' || typeof value === 'string') return true;\n        //     if (value instanceof Date) return true;\n            \n        //     try {\n        //         JSON.stringify(value);\n        //         return true;\n        //     } catch {\n        //         return false;\n        //     }\n        // };\n\n        // // Функция для создания безопасной копии\n        // const createSafeCopy = (value) => {\n        //     if (!this.isSerializable(value)) return undefined;\n            \n        //     if (Array.isArray(value)) return value.map(createSafeCopy).filter(item => item !== undefined);\n            \n        //     if (value && typeof value === 'object' && !(value instanceof Date)) {\n        //         const result = {};\n        //         Object.entries(value).forEach(([key, val]) => {\n        //             if (typeof val !== 'function' && this.isSerializable(val)) result[key] = createSafeCopy(val);\n        //         });\n        //         return result;\n        //     }\n            \n        //     return value;\n        // };\n\n        // Создаем безопасный объект для сохранения\n        return {\n            id: user.id,\n            login: user.login || '',\n            name: user.name || '',\n            password: user.password || '',\n            apps: Array.isArray(user.apps) ? user.apps.map(app => this.createSafeCopy(app) || {}).filter(app => Object.keys(app).length > 0) : [],\n            data: this.createSafeCopy(user.data) || {},\n            config: this.createSafeCopy(user.config) || { avatar: \"cat.jpg\" },\n            systemconfig: this.createSafeCopy(user.systemconfig) || { desktopWallpaper: \"nwall.jpg\" },\n            createdAt: user.createdAt instanceof Date ? user.createdAt : (user.createdAt ? new Date(user.createdAt) : new Date()),\n            updatedAt: user.updatedAt instanceof Date ? user.updatedAt : (user.updatedAt ? new Date(user.updatedAt) : new Date())\n        };\n    },\n\n    // поиск учетной записи по id\n    async getbyId(id) {\n        try {\n            return await DB.users.get(id);\n        } catch (error) {\n            console.error('Error operation (users; getbyId):', error);            \n            throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n        }\n    },\n\n    // поиск учетной записи по login\n    async getbyLogin(login) {\n        try {\n            return await DB.users.where('login').equals(login).first();\n        } catch (error) {\n            console.error('Error operation (users; getbyLogin):', error);\n            throw new Error(`Failed to get user by login ${login}: ${error.message}`);\n        }\n    },\n\n    // получить массив всех учетных записей\n    async getAll() {\n        try {\n            return await DB.users.toArray();\n        } catch (error) {\n            console.error('Error operation (users; getAll):', error);\n            throw new Error(`Failed to get all users`);\n        }\n    },\n\n    // получить массив apps учетной записи\n    async getApps(id) {\n        try {\n            const USER = await DB.users.get(id);\n            if (USER && USER.apps) {\n                return USER.apps;\n            } else {\n                console.error('Error operation (users; getApps).');\n            }\n        } catch (error) {\n            console.error('Error operation (users; getApps):', error);            \n            throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n        }\n    },\n\n    // получить config пользователя по id\n    async getConfig(id) {\n        try {\n            const USER = await DB.users.get(id);\n            if (USER && USER.config) {\n                return USER.config;\n            } else {\n                console.error('Error operation (users; getConfig).');\n            }\n        } catch (error) {\n            console.error('Error operation (users; getConfig):', error);            \n            throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n        }\n    },\n\n    // получить systemconfig пользователя по id\n    async getSConfig(id) {\n        try {\n            const USER = await DB.users.get(id);\n            if (USER && USER.systemconfig) {\n                return USER.systemconfig;\n            } else {\n                console.error('Error operation (users; getSConfig).');\n            }\n        } catch (error) {\n            console.error('Error operation (users; getSConfig):', error);            \n            throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n        }\n    },\n\n    // обновление конфигуратора приложений в учетной записи\n    async updateAppSetting(userId, appId, key, value) {\n        try {\n            // Получаем пользователя\n            const user = await DB.users.get(userId);\n            \n            if (!user) {\n                throw new Error(`Пользователь с ID ${userId} не найден`);\n            }\n            \n            // Находим приложение в массиве apps\n            const appIndex = user.apps.findIndex(app => app.id === appId);\n            if (appIndex === -1) {\n                throw new Error(`Приложение с ID ${appId} не найдено у пользователя ${userId}`);\n            }\n            \n            // Обновляем значение ключа\n            // Используем $set для реактивного обновления, если это необходимо\n            const updatedApps = [...user.apps];\n            \n            updatedApps[appIndex] = {\n                ...updatedApps[appIndex],\n                [key]: value\n            };\n            \n            // Сохраняем обновленный массив приложений\n            await DB.users.update(userId, {\n                apps: updatedApps,\n                updatedAt: new Date()\n            });\n            \n            return { success: true, userId, appId, key, value };\n            \n        } catch (error) {\n            console.error('Error operation (users; updateAppSetting):', error);\n            throw new Error(`Failed to update app setting: ${error.message}`);\n        }\n    },\n\n    // удалить учетную запись\n    async delete(id) {\n        try {\n            return await DB.users.delete(id);\n        } catch (error) {\n            console.error('Error operation (users; delete):', error);\n            throw new Error(`Failed to delete user ${id}: ${error.message}`);\n        }\n    },\n\n    // кол-во учетных записей\n    async count() {\n        try {\n            return await DB.users.count();\n        } catch (error) {\n            console.error('Error operation (users; count):', error);\n            throw new Error(`Failed to count users`);\n        }\n    },\n\n    async search(query) {\n        try {\n            return await DB.users\n                .filter(user =>\n                    user.login.toLowerCase().includes(query.toLowerCase()) ||\n                    JSON.stringify(user.data).toLowerCase().includes(query.toLowerCase())\n                ).toArray();\n        } catch (error) {\n            console.error('Error operation (users; search');\n            throw new Error(`Search failed: ${error.message}`);\n        }\n    },\n\n    // =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n\n    prepareWindowForDB(wdata) {\n\n    },\n\n    windows: {\n        async create(userId, appData) {\n            // валидация\n            if (!appData.name) throw new Error('App name required!');\n\n            const windowId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n            appData.id = windowId;\n\n            const windowData = { ...appData };\n\n            await DB.users.where('id').equals(userId)\n                .modify(user => {\n                    user.systemconfig.windows[windowId] = windowData;\n                });\n\n            return windowData;\n        },\n\n        async getAll(userId) {\n            const user = await DB.users.get(userId);\n\n            return Object.values(user?.systemconfig?.windows || {});\n        }\n    },\n\n\n    // получить объект \"окна\" в SConfig пользователя (по его id)\n    async getSConfig_windows(userId) {\n        try {\n            const FindUser = await this.getbyId(userId);\n            const FindSConfig = (FindUser && FindUser.systemconfig) ? FindUser.systemconfig : false;\n            \n            return (FindSConfig && FindSConfig.windows) ? FindSConfig.windows : false;\n        } catch (error) {\n            console.error('Error operation(users; getSConfig_windows).');\n            throw new Error(`Failed: ${error.message}`);\n        }\n    },\n    // создание нового \"окна\" в SConfig пользователя\n    async addSConfig_newWindow(userId, appData) {\n        const newId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n        \n        try {\n            let FindUser = await this.getbyId(userId);\n\n            if (FindUser) {\n                let nSystemConfig = (FindUser.systemconfig) ? FindUser.systemconfig : {windows: {}};\n                let nWindows = (nSystemConfig && nSystemConfig.windows) ? nSystemConfig.windows : false;\n                nWindows[newId] = { ...appData };\n\n                if (nSystemConfig && nWindows) {\n                    nSystemConfig.windows = nWindows;\n                    FindUser.systemconfig = nSystemConfig;\n                    \n                    const userForDB = this.prepareUserForDB(FindUser);\n                    userForDB.updatedAt = new Date();\n\n                    await DB.users.update(userForDB.id, userForDB);\n\n                    return true;\n                } else {\n                    console.error('Error operation(users; addSConfig_newWindow; c:1).');\n                    return false;\n                }\n            } else {\n                console.error('Error operation(users; addSConfig_newWindow; c:2).');\n                return false;\n            }\n\n        } catch (error) {\n            console.error('Error operation(users; addSConfig_newWindow).');\n            throw new Error(`Failed: ${error.message}`);\n        }\n    },\n    // поиск \"окна\" в SConfig пользователя по его id\n    async getSConfig_window_byId(userId, windowId) {\n        try {\n            const FindUser = await this.getbyId(userId);\n            const FindSConfig = (FindUser && FindUser.systemconfig) ? FindUser.systemconfig : false;\n            const FindWindows = (FindSConfig && FindSConfig.windows) ? FindSConfig.windows : false;\n\n            return (FindWindows && Object.keys(FindWindows).includes(windowId)) ? FindWindows[windowId] : false;\n        } catch (error) {\n            console.error('Error operation(users; getSConfig_window_byId).');\n            throw new Error(`Failed: ${error.message}`);\n        }\n    },\n    // поиск \"окна\" в SConfig пользователя по данным приложения\n    async getSConfig_window_byConfig(userId, appData) {\n        try {\n            const FindWindows = await this.getSConfig_windows(userId);\n            \n            if (FindWindows) {\n                let res = false;\n\n                Object.keys(FindWindows).forEach(function(key) {\n                    if (\n                        appData.id\n                        && FindWindows[key].id === appData.id\n                        && appData.name\n                        && FindWindows[key].name === appData.name\n                    ) {\n                        res = FindWindows[key];\n                    }\n                });\n\n                return res;\n            } else { return false; }\n        } catch (error) {\n            console.error('Error operation(users; getSConfig_window_byConfig).');\n            throw new Error(`Failed: ${error.message}`);\n        }\n    },\n};\n\nexport const settingsTable = {\n    // сохранение настройки\n    async save(key, value) {\n        try {\n            const existing = await DB.settings.where('key').equals(key).first();\n\n            if (existing) {\n                await DB.settings.update(existing.id, {\n                    value: value,\n                    updatedAt: new Date(),\n                });\n                return existing.id;\n            } else {\n                return await DB.settings.add(new Setting(key, value));\n            }\n        } catch (error) {\n            console.error('Error operation (settings; save');\n            throw new Error(`Failed to save setting ${key}: ${error.message}`);\n        }\n    },\n\n    // получить настройку\n    async get(key, defaultVal = null) {\n        try {\n            const findSetting = DB.settings.where('key').equals(key).first();\n\n            return findSetting ? findSetting.value : defaultVal;\n        } catch (error) {\n            console.error('Error operation (settings; get');\n            throw new Error(`Failed to get setting ${key}: ${error.message}`);\n        }\n    },\n\n    // удалить настройку\n    async delete(key) {\n        try {\n            const findSetting = await DB.settings.where('key').equals(key).first();\n\n            if (findSetting) {\n                return await DB.settings.delete(findSetting.id);\n            } else {\n                return null;\n            }\n        } catch (error) {\n            console.error('Error operation (settings; delete');\n            throw new Error(`Failed to delete setting ${key}: ${error.message}`);\n        }\n    },\n\n    // получить все настройки\n    async getAll() {\n        try {\n            return await DB.settings.toArray();\n        } catch (error) {\n            console.error('Error operation (settings; getAll');\n            throw new Error(`Failed to get all settings`);\n        }\n    },\n};\n\n\n// -=-=-=-=-=-=-Служебное-=-=-=-=-=-=-\n\n// инициализация БД с тестовыми данными\nexport async function initDatabase() {\n    try {\n        // проверка, пустая ли база\n        const userCount = await usersTable.count();\n\n        if (userCount === 0) {\n            // Загружаем apps асинхронно\n            const defaultAppsList = await getDefaultApps();\n\n            // создание базового пользователя\n            const defaultUser = new User({\n                login: 'user',\n                password: '',\n                apps: defaultAppsList,\n                data: {},\n                config: {\n                    avatar: 'robot.jpg',\n                },\n                systemconfig: {\n                    desktopWallpaper: \"nwall.jpg\"\n                },\n            });\n\n            await usersTable.save(defaultUser);\n            console.log('Default user created.');\n        }\n\n        // инициализация базовых настроек \n        const defaultSettings = [\n            ['theme', 'dark'],\n            ['avatarDefault', 'cat'],\n        ];\n\n        for (const [key, value] of defaultSettings) {\n            const existing = await settingsTable.get(key);\n\n            if (existing === null) {\n                await settingsTable.set(key, value);\n            }\n        }\n\n        console.log('Database initialized successfully');\n        return true;\n    } catch (error) {\n        console.error('Error initializing DB:', error);\n\n        throw error;\n    }    \n}\n\n/**\n * Очистка базы данных (осторожно!)\n */\nexport async function clearDatabase() {\n    try {\n        await Promise.all([\n            DB.users.clear(),\n            DB.settings.clear()\n        ]);\n        console.log('Database cleared');\n    } catch (error) {\n        console.error('Error clearing database:', error);\n        throw error;\n    }\n}\n\n// ==================== МИГРАЦИИ ====================\n\n// Пример добавления миграции при увеличении версии\n// DB.version(2).stores({\n//     users: '++id, login, password, apps, data, config, systemConfig, createdAt, updatedAt, lastLogin',\n//     settings: '++id, key, value, updatedAt',\n//     sessions: '++id, userId, token, expiresAt, createdAt' // Новая таблица\n// }).upgrade(async (tx) => {\n//     // Добавляем поле lastLogin к существующим пользователям\n//     const users = await tx.users.toArray();\n//     await Promise.all(\n//         users.map(user => \n//             tx.users.update(user.id, { \n//                 lastLogin: null,\n//                 updatedAt: new Date() \n//             })\n//         )\n//     );\n    \n//     console.log('Migration to version 2 completed');\n// });\n\nexport { DB };\n\nexport default {\n    DB,\n    User,\n    usersTable,\n    settingsTable,\n    initDatabase,\n    clearDatabase\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}