{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 1,\n  class: \"webos\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_AutorizationArea = _resolveComponent(\"AutorizationArea\");\n  const _component_SimpleWindow = _resolveComponent(\"SimpleWindow\");\n  const _component_DesktopArea = _resolveComponent(\"DesktopArea\");\n  const _component_TaskBar = _resolveComponent(\"TaskBar\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [!$data.isAutorized ? (_openBlock(), _createBlock(_component_AutorizationArea, {\n    key: 0,\n    onSelectUser: $options.selectUser\n  }, null, 8 /* PROPS */, [\"onSelectUser\"])) : _createCommentVNode(\"v-if\", true), $data.isAutorized ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_DesktopArea, {\n    USERID: $data.USERID\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($options.sortedWindows, window => {\n      return _openBlock(), _createBlock(_component_SimpleWindow, {\n        key: window.id,\n        windowId: window.id,\n        title: window.label,\n        appName: window.name,\n        contentApp: window.contentApp,\n        icon: window.icon,\n        iconclass: window.iconclass,\n        defWidth: window.defWidth,\n        defHeight: window.defHeight,\n        isMinimized: window.isMinimized,\n        isActive: $options.osStore.activeWindowId === window.id,\n        isMaximized: window.isMaximized,\n        zIndex: window.zIndex,\n        resizable: window.resizable,\n        canMinimize: window.canMinimize,\n        USERID: $data.USERID,\n        onClose: $options.closeWindow,\n        onMinimize: $options.minimizeWindow,\n        onToggleMaximize: $options.toggleMaximizeWindow,\n        onFocus: $options.activateWindow\n      }, null, 8 /* PROPS */, [\"windowId\", \"title\", \"appName\", \"contentApp\", \"icon\", \"iconclass\", \"defWidth\", \"defHeight\", \"isMinimized\", \"isActive\", \"isMaximized\", \"zIndex\", \"resizable\", \"canMinimize\", \"USERID\", \"onClose\", \"onMinimize\", \"onToggleMaximize\", \"onFocus\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"USERID\"]), _createVNode(_component_TaskBar, {\n    USERID: $data.USERID\n  }, null, 8 /* PROPS */, [\"USERID\"])])) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","$data","isAutorized","_createBlock","_component_AutorizationArea","onSelectUser","$options","selectUser","_createElementBlock","_hoisted_1","_createVNode","_component_DesktopArea","USERID","_Fragment","_renderList","sortedWindows","window","_component_SimpleWindow","key","id","windowId","title","label","appName","name","contentApp","icon","iconclass","defWidth","defHeight","isMinimized","isActive","osStore","activeWindowId","isMaximized","zIndex","resizable","canMinimize","onClose","closeWindow","onMinimize","minimizeWindow","onToggleMaximize","toggleMaximizeWindow","onFocus","activateWindow","_component_TaskBar"],"sources":["/home/kup/my_projects/vue/osi/src/App.vue"],"sourcesContent":["<template>\n    <AutorizationArea v-if=\"!isAutorized\" @selectUser=\"selectUser\" />\n    <div v-if=\"isAutorized\" class=\"webos\">\n        <DesktopArea :USERID=\"USERID\">\n            <SimpleWindow v-for=\"window in sortedWindows\"\n                :key=\"window.id\"\n                :windowId=\"window.id\"\n                :title=\"window.label\"\n                :appName=\"window.name\"\n        \n                :contentApp=\"window.contentApp\"\n                :icon=\"window.icon\"\n                :iconclass=\"window.iconclass\"\n                :defWidth=\"window.defWidth\"\n                :defHeight=\"window.defHeight\"\n                :isMinimized=\"window.isMinimized\"\n                :isActive=\"osStore.activeWindowId === window.id\"\n                :isMaximized=\"window.isMaximized\"\n                :zIndex=\"window.zIndex\"\n                :resizable=\"window.resizable\"\n                :canMinimize=\"window.canMinimize\"\n\n                :USERID=\"USERID\"\n                \n                @close=\"closeWindow\"\n                @minimize=\"minimizeWindow\"\n                @toggleMaximize=\"toggleMaximizeWindow\"\n                @focus=\"activateWindow\"                \n            />\n        </DesktopArea>\n        <TaskBar :USERID=\"USERID\" />\n    </div>\n</template>\n<style src=\"./styles/global.css\"></style>\n<script>\n    import AutorizationArea from './components/os/AutorizationArea/AutorizationArea.vue';\n    import DesktopArea from './components/os/DesktopArea/DesktopArea.vue';\n    import TaskBar from './components/os/TaskBar/TaskBar.vue';\n    import SimpleWindow from './components/os/SimpleWindow/SimpleWindow.vue';\n    import { useOsStore } from './stores/os.store';\n    import { useAppsStore } from './stores/apps.store';\n    import { usersTable, IDBWindows } from './idb/db';\n\n    export default {\n        name: 'App',\n  \n        components: {\n            AutorizationArea,\n            DesktopArea,\n            TaskBar,\n            SimpleWindow\n        },\n  \n        data() {\n            return {\n                isAutorized: false,\n                USERID: null,\n                USER: {},\n            }\n        },\n\n        watch: {\n            // Отслеживаем изменения IDBWindows\n            IDBWindows: {\n                handler(newVal) {\n                    console.log('IDBWindows changed:', newVal);\n                    console.log('zIndices:', newVal?.map(w => ({id: w.id, zIndex: w.zIndex})));\n                },\n                deep: true,\n                immediate: true\n            }\n        },\n\n        computed: {\n            // Сортируем окна по zIndex для правильного отображения\n            sortedWindows() {\n                if (!this.IDBWindows) return [];\n            \n                // Копируем массив и сортируем по zIndex (от меньшего к большему)\n                // Это важно для правильного наложения окон\n                return [...this.IDBWindows].sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\n            },\n\n            IDBWindows() { return IDBWindows.value; },\n            osStore() { return useOsStore(); },\n            appsStore() { return useAppsStore(); },\n        },\n\n        // created() {\n        //     this.osStore = useOsStore();\n        //     this.appsStore = useAppsStore();\n        //     // this.useAppsStore = useAppsStore();\n        //     this.usersTable = usersTable;\n        //     // this.IDBWindows = IDBWindows;\n        // },\n  \n        methods: {\n            async closeWindow(windowId) {\n                if (this.USERID && usersTable) {\n                    try {\n                        await usersTable.windows.close(this.USERID, windowId);\n                        // Обновляем окна после закрытия\n                        await usersTable.windows.reupdate(this.USERID);\n                    } catch (error) {\n                        console.error('Error closing window:', error);\n                    }\n                }\n\n                if (this.appsStore) {\n                    this.appsStore.deleteWindowState(windowId);\n                }\n            },\n    \n            minimizeWindow(windowId) {\n                if (this.osStore) { \n                    this.osStore.minimizeWindow(windowId); \n                }\n            },\n    \n            toggleMaximizeWindow(windowId) {\n                if (this.osStore) { \n                    this.osStore.toggleMaximizeWindow(windowId); \n                }\n            },\n    \n            async activateWindow(windowId) {\n                console.log('activateWindow called in App.vue with:', windowId);\n                if (this.USERID && usersTable) { \n                    try {\n                        await usersTable.windows.activate(this.USERID, windowId);\n                        // После активации принудительно обновляем\n                        await usersTable.windows.reupdate(this.USERID);\n                        console.log('Window activated and reupdated');\n                    } catch (error) {\n                        console.error('Error activating window:', error);\n                    }\n                }\n            },\n\n            async selectUser(userId) {\n                this.USERID = userId;\n\n                if (usersTable) {\n                    await usersTable.windows.reupdate(this.USERID);\n                }\n                \n                this.isAutorized = true;\n            }\n        },\n    }\n</script>"],"mappings":";;;EAE4BA,KAAK,EAAC;;;;;;;8DADLC,KAAA,CAAAC,WAAW,I,cAApCC,YAAA,CAAiEC,2BAAA;;IAA1BC,YAAU,EAAEC,QAAA,CAAAC;kFACxCN,KAAA,CAAAC,WAAW,I,cAAtBM,mBAAA,CA6BM,OA7BNC,UA6BM,GA5BFC,YAAA,CA0BcC,sBAAA;IA1BAC,MAAM,EAAEX,KAAA,CAAAW;EAAM;sBACV,MAA+B,E,kBAA7CJ,mBAAA,CAwBEK,SAAA,QAAAC,WAAA,CAxB6BR,QAAA,CAAAS,aAAa,EAAvBC,MAAM;2BAA3Bb,YAAA,CAwBEc,uBAAA;QAvBGC,GAAG,EAAEF,MAAM,CAACG,EAAE;QACdC,QAAQ,EAAEJ,MAAM,CAACG,EAAE;QACnBE,KAAK,EAAEL,MAAM,CAACM,KAAK;QACnBC,OAAO,EAAEP,MAAM,CAACQ,IAAI;QAEpBC,UAAU,EAAET,MAAM,CAACS,UAAU;QAC7BC,IAAI,EAAEV,MAAM,CAACU,IAAI;QACjBC,SAAS,EAAEX,MAAM,CAACW,SAAS;QAC3BC,QAAQ,EAAEZ,MAAM,CAACY,QAAQ;QACzBC,SAAS,EAAEb,MAAM,CAACa,SAAS;QAC3BC,WAAW,EAAEd,MAAM,CAACc,WAAW;QAC/BC,QAAQ,EAAEzB,QAAA,CAAA0B,OAAO,CAACC,cAAc,KAAKjB,MAAM,CAACG,EAAE;QAC9Ce,WAAW,EAAElB,MAAM,CAACkB,WAAW;QAC/BC,MAAM,EAAEnB,MAAM,CAACmB,MAAM;QACrBC,SAAS,EAAEpB,MAAM,CAACoB,SAAS;QAC3BC,WAAW,EAAErB,MAAM,CAACqB,WAAW;QAE/BzB,MAAM,EAAEX,KAAA,CAAAW,MAAM;QAEd0B,OAAK,EAAEhC,QAAA,CAAAiC,WAAW;QAClBC,UAAQ,EAAElC,QAAA,CAAAmC,cAAc;QACxBC,gBAAc,EAAEpC,QAAA,CAAAqC,oBAAoB;QACpCC,OAAK,EAAEtC,QAAA,CAAAuC;;;;iCAGhBnC,YAAA,CAA4BoC,kBAAA;IAAlBlC,MAAM,EAAEX,KAAA,CAAAW;EAAM,oC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}