{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 1,\n  class: \"webos\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_AutorizationArea = _resolveComponent(\"AutorizationArea\");\n  const _component_SimpleWindow = _resolveComponent(\"SimpleWindow\");\n  const _component_DesktopArea = _resolveComponent(\"DesktopArea\");\n  const _component_TaskBar = _resolveComponent(\"TaskBar\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [!$data.isAutorized ? (_openBlock(), _createBlock(_component_AutorizationArea, {\n    key: 0,\n    onSelectUser: $options.selectUser\n  }, null, 8 /* PROPS */, [\"onSelectUser\"])) : _createCommentVNode(\"v-if\", true), $data.isAutorized ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_DesktopArea, {\n    USERID: $data.USERID\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($options.sortedWindows, window => {\n      return _openBlock(), _createBlock(_component_SimpleWindow, {\n        key: window.id,\n        windowId: window.id,\n        title: window.label,\n        appName: window.name,\n        contentApp: window.contentApp,\n        icon: window.icon,\n        iconclass: window.iconclass,\n        defWidth: window.defWidth,\n        defHeight: window.defHeight,\n        isMinimized: window.isMinimized,\n        isActive: $options.isActiveElem(window.id),\n        isMaximized: window.isMaximized,\n        zIndex: window.zIndex,\n        resizable: window.resizable,\n        canMinimize: window.canMinimize,\n        USERID: $data.USERID,\n        onClose: $options.closeWindow,\n        onMinimize: $options.minimizeWindow,\n        onToggleMaximize: $options.toggleMaximizeWindow,\n        onFocus: $options.activateWindow\n      }, null, 8 /* PROPS */, [\"windowId\", \"title\", \"appName\", \"contentApp\", \"icon\", \"iconclass\", \"defWidth\", \"defHeight\", \"isMinimized\", \"isActive\", \"isMaximized\", \"zIndex\", \"resizable\", \"canMinimize\", \"USERID\", \"onClose\", \"onMinimize\", \"onToggleMaximize\", \"onFocus\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"USERID\"]), _createVNode(_component_TaskBar, {\n    USERID: $data.USERID\n  }, null, 8 /* PROPS */, [\"USERID\"])])) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","$data","isAutorized","_createBlock","_component_AutorizationArea","onSelectUser","$options","selectUser","_createElementBlock","_hoisted_1","_createVNode","_component_DesktopArea","USERID","_Fragment","_renderList","sortedWindows","window","_component_SimpleWindow","key","id","windowId","title","label","appName","name","contentApp","icon","iconclass","defWidth","defHeight","isMinimized","isActive","isActiveElem","isMaximized","zIndex","resizable","canMinimize","onClose","closeWindow","onMinimize","minimizeWindow","onToggleMaximize","toggleMaximizeWindow","onFocus","activateWindow","_component_TaskBar"],"sources":["/home/kup/my_projects/vue/osi/src/App.vue"],"sourcesContent":["<template>\n    <AutorizationArea v-if=\"!isAutorized\" @selectUser=\"selectUser\" />\n    <div v-if=\"isAutorized\" class=\"webos\">\n        <DesktopArea :USERID=\"USERID\">\n            <SimpleWindow \n                v-for=\"window in sortedWindows\"\n                :key=\"window.id\"\n                :windowId=\"window.id\"\n                :title=\"window.label\"\n                :appName=\"window.name\"\n                :contentApp=\"window.contentApp\"\n                :icon=\"window.icon\"\n                :iconclass=\"window.iconclass\"\n                :defWidth=\"window.defWidth\"\n                :defHeight=\"window.defHeight\"\n                :isMinimized=\"window.isMinimized\"\n                :isActive=\"isActiveElem(window.id)\"\n                :isMaximized=\"window.isMaximized\"\n                :zIndex=\"window.zIndex\"\n                :resizable=\"window.resizable\"\n                :canMinimize=\"window.canMinimize\"\n                :USERID=\"USERID\"\n                @close=\"closeWindow\"\n                @minimize=\"minimizeWindow\"\n                @toggleMaximize=\"toggleMaximizeWindow\"\n                @focus=\"activateWindow\"\n            />\n        </DesktopArea>\n        <TaskBar :USERID=\"USERID\" />\n    </div>\n</template>\n<style src=\"./styles/global.css\"></style>\n<script>\nimport AutorizationArea from './components/os/AutorizationArea/AutorizationArea.vue';\nimport DesktopArea from './components/os/DesktopArea/DesktopArea.vue';\nimport TaskBar from './components/os/TaskBar/TaskBar.vue';\nimport SimpleWindow from './components/os/SimpleWindow/SimpleWindow.vue';\n// import { useOsStore } from './stores/os.store';\nimport { useAppsStore } from './stores/apps.store';\nimport { usersTable, IDBWindows, activeWindowId } from './idb/db';\n\nexport default {\n    name: 'App',\n\n    components: {\n        AutorizationArea,\n        DesktopArea,\n        TaskBar,\n        SimpleWindow\n    },\n\n    data() {\n        return {\n            isAutorized: false,\n            USERID: null,\n            USER: {},\n        }\n    },\n\n    watch: {\n        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è IDBWindows\n        IDBWindows: {\n            handler(newVal) {\n                console.log('IDBWindows changed:', newVal?.map(w => ({id: w.id, zIndex: w.zIndex, isMinimized: w.isMinimized})));\n            },\n            deep: true,\n            immediate: true\n        }\n    },\n\n    computed: {\n        IDBWindows() { return IDBWindows.value; },        \n        // osStore() { return useOsStore(); },\n        appsStore() { return useAppsStore(); },\n        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –æ–∫–Ω–∞ –ø–æ zIndex –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n        sortedWindows() {\n            if (!this.IDBWindows) {\n                return [];\n            } else {\n                // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–≤–µ—Ä–Ω—É—Ç—ã–µ –æ–∫–Ω–∞ - –æ–Ω–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ\n                const visibleWindows = this.IDBWindows.filter(w => !w.isMinimized);\n            \n                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ zIndex (–æ—Ç –º–µ–Ω—å—à–µ–≥–æ –∫ –±–æ–ª—å—à–µ–º—É)\n                return [...visibleWindows].sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\n            }\n        },\n    },\n\n    methods: {\n        // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ \"—ç—Ç–æ –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç\"\n        isActiveElem(windowId) { return windowId === activeWindowId.value; },\n\n        async closeWindow(windowId) {\n            console.log('closeWindow called:', windowId);\n            \n            if (this.USERID && usersTable) {\n                try {\n                    await usersTable.windows.close(this.USERID, windowId);\n                    await usersTable.windows.reupdate(this.USERID);\n                } catch (error) {\n                    console.error('Error closing window:', error);\n                }\n            }\n\n            if (this.appsStore) {\n                this.appsStore.deleteWindowState(windowId);\n            }\n        },\n    \n        async minimizeWindow(windowId) {\n            console.log('minimizeWindow called:', windowId);\n            \n            if (this.USERID && usersTable) {\n                try {\n                    await usersTable.windows.minimize(this.USERID, windowId);\n                    await usersTable.windows.reupdate(this.USERID);\n                    \n                    console.log('Window minimized successfully');\n                } catch (error) {\n                    console.error('Error minimizing window:', error);\n                }\n            }\n        },\n    \n        async toggleMaximizeWindow(windowId) {\n            console.log('toggleMaximizeWindow called:', windowId);\n            \n            if (this.USERID && usersTable) {\n                try {\n                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∫–Ω–∞\n                    const windows = IDBWindows.value || [];\n                    const window = windows.find(w => w.id === windowId);\n                    \n                    if (window) {\n                        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏\n                        window.isMaximized = !window.isMaximized;\n                        \n                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ë–î\n                        const user = await usersTable.getbyId(this.USERID);\n                        const updatedWindows = windows.map(w => \n                            w.id === windowId ? window : w\n                        );\n                        \n                        await usersTable.save({\n                            ...user,\n                            systemconfig: {\n                                ...user.systemconfig,\n                                windows: updatedWindows\n                            }\n                        });\n                        \n                        await usersTable.windows.reupdate(this.USERID);\n                    }\n                } catch (error) {\n                    console.error('Error toggling maximize window:', error);\n                }\n            }\n        },\n    \n        async activateWindow(windowId) {\n            console.log('üéØ App.activateWindow called with:', windowId);\n            console.log('Current USERID:', this.USERID);\n            \n            if (this.USERID && usersTable) { \n                try {\n                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–∫–Ω–æ (–æ–±–Ω–æ–≤–ª—è–µ—Ç zIndex –∏ —Å–Ω–∏–º–∞–µ—Ç —Å–≤–µ—Ä–Ω—É—Ç–æ—Å—Ç—å)\n                    await usersTable.windows.activate(this.USERID, windowId);\n                    \n                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω\n                    await usersTable.windows.reupdate(this.USERID);\n                    \n                    console.log('Window activated successfully');\n                } catch (error) {\n                    console.error('Error activating window:', error);\n                }\n            } else {\n                console.log('Cannot activate: USERID or usersTable missing');\n            }\n        },\n\n        async selectUser(userId) {\n            console.log('selectUser called:', userId);\n            this.USERID = userId;\n\n            if (usersTable) {\n                try {\n                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n                    this.USER = await usersTable.getbyId(userId);\n                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω\n                    await usersTable.windows.reupdate(userId);\n                } catch (error) {\n                    console.error('Error loading user data:', error);\n                }\n            }\n            \n            this.isAutorized = true;\n        },\n\n        // –ú–µ—Ç–æ–¥ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ–∫–Ω–∞ –∏–∑ —Å–≤–µ—Ä–Ω—É—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è\n        async restoreWindow(windowId) {\n            console.log('restoreWindow called:', windowId);\n            \n            if (this.USERID && usersTable) {\n                try {\n                    // –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –º–µ—Ç–æ–¥ restore –≤ usersTable.windows\n                    if (usersTable.windows.restore) {\n                        await usersTable.windows.restore(this.USERID, windowId);\n                    } else {\n                        // –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º activate –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n                        await usersTable.windows.activate(this.USERID, windowId);\n                    }\n                    await usersTable.windows.reupdate(this.USERID);\n                } catch (error) {\n                    console.error('Error restoring window:', error);\n                }\n            }\n        }\n    },\n}\n</script>\n\n<style>\n.webos {\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n    position: relative;\n    background: #1a1a1a;\n}\n</style>"],"mappings":";;;EAE4BA,KAAK,EAAC;;;;;;;8DADLC,KAAA,CAAAC,WAAW,I,cAApCC,YAAA,CAAiEC,2BAAA;;IAA1BC,YAAU,EAAEC,QAAA,CAAAC;kFACxCN,KAAA,CAAAC,WAAW,I,cAAtBM,mBAAA,CA2BM,OA3BNC,UA2BM,GA1BFC,YAAA,CAwBcC,sBAAA;IAxBAC,MAAM,EAAEX,KAAA,CAAAW;EAAM;sBAEpB,MAA+B,E,kBADnCJ,mBAAA,CAsBEK,SAAA,QAAAC,WAAA,CArBmBR,QAAA,CAAAS,aAAa,EAAvBC,MAAM;2BADjBb,YAAA,CAsBEc,uBAAA;QApBGC,GAAG,EAAEF,MAAM,CAACG,EAAE;QACdC,QAAQ,EAAEJ,MAAM,CAACG,EAAE;QACnBE,KAAK,EAAEL,MAAM,CAACM,KAAK;QACnBC,OAAO,EAAEP,MAAM,CAACQ,IAAI;QACpBC,UAAU,EAAET,MAAM,CAACS,UAAU;QAC7BC,IAAI,EAAEV,MAAM,CAACU,IAAI;QACjBC,SAAS,EAAEX,MAAM,CAACW,SAAS;QAC3BC,QAAQ,EAAEZ,MAAM,CAACY,QAAQ;QACzBC,SAAS,EAAEb,MAAM,CAACa,SAAS;QAC3BC,WAAW,EAAEd,MAAM,CAACc,WAAW;QAC/BC,QAAQ,EAAEzB,QAAA,CAAA0B,YAAY,CAAChB,MAAM,CAACG,EAAE;QAChCc,WAAW,EAAEjB,MAAM,CAACiB,WAAW;QAC/BC,MAAM,EAAElB,MAAM,CAACkB,MAAM;QACrBC,SAAS,EAAEnB,MAAM,CAACmB,SAAS;QAC3BC,WAAW,EAAEpB,MAAM,CAACoB,WAAW;QAC/BxB,MAAM,EAAEX,KAAA,CAAAW,MAAM;QACdyB,OAAK,EAAE/B,QAAA,CAAAgC,WAAW;QAClBC,UAAQ,EAAEjC,QAAA,CAAAkC,cAAc;QACxBC,gBAAc,EAAEnC,QAAA,CAAAoC,oBAAoB;QACpCC,OAAK,EAAErC,QAAA,CAAAsC;;;;iCAGhBlC,YAAA,CAA4BmC,kBAAA;IAAlBjC,MAAM,EAAEX,KAAA,CAAAW;EAAM,oC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}