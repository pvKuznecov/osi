{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport * as Token from 'token-types';\nimport * as util from '../common/Util.js';\nimport { FrameParser, Id3v2ContentError } from './FrameParser.js';\nimport { ExtendedHeader, ID3v2Header, UINT32SYNCSAFE } from './ID3v2Token.js';\nimport { textDecode } from '@borewit/text-codec';\nexport class ID3v2Parser {\n  constructor() {\n    this.tokenizer = undefined;\n    this.id3Header = undefined;\n    this.metadata = undefined;\n    this.headerType = undefined;\n    this.options = undefined;\n  }\n  static removeUnsyncBytes(buffer) {\n    let readI = 0;\n    let writeI = 0;\n    while (readI < buffer.length - 1) {\n      if (readI !== writeI) {\n        buffer[writeI] = buffer[readI];\n      }\n      readI += buffer[readI] === 0xFF && buffer[readI + 1] === 0 ? 2 : 1;\n      writeI++;\n    }\n    if (readI < buffer.length) {\n      buffer[writeI++] = buffer[readI];\n    }\n    return buffer.subarray(0, writeI);\n  }\n  static getFrameHeaderLength(majorVer) {\n    switch (majorVer) {\n      case 2:\n        return 6;\n      case 3:\n      case 4:\n        return 10;\n      default:\n        throw makeUnexpectedMajorVersionError(majorVer);\n    }\n  }\n  static readFrameFlags(b) {\n    return {\n      status: {\n        tag_alter_preservation: util.getBit(b, 0, 6),\n        file_alter_preservation: util.getBit(b, 0, 5),\n        read_only: util.getBit(b, 0, 4)\n      },\n      format: {\n        grouping_identity: util.getBit(b, 1, 7),\n        compression: util.getBit(b, 1, 3),\n        encryption: util.getBit(b, 1, 2),\n        unsynchronisation: util.getBit(b, 1, 1),\n        data_length_indicator: util.getBit(b, 1, 0)\n      }\n    };\n  }\n  static readFrameData(uint8Array, frameHeader, majorVer, includeCovers, warningCollector) {\n    const frameParser = new FrameParser(majorVer, warningCollector);\n    switch (majorVer) {\n      case 2:\n        return frameParser.readData(uint8Array, frameHeader.id, includeCovers);\n      case 3:\n      case 4:\n        if (frameHeader.flags?.format.unsynchronisation) {\n          uint8Array = ID3v2Parser.removeUnsyncBytes(uint8Array);\n        }\n        if (frameHeader.flags?.format.data_length_indicator) {\n          uint8Array = uint8Array.subarray(4, uint8Array.length);\n        }\n        return frameParser.readData(uint8Array, frameHeader.id, includeCovers);\n      default:\n        throw makeUnexpectedMajorVersionError(majorVer);\n    }\n  }\n  /**\n   * Create a combined tag key, of tag & description\n   * @param tag e.g.: COM\n   * @param description e.g. iTunPGAP\n   * @returns string e.g. COM:iTunPGAP\n   */\n  static makeDescriptionTagName(tag, description) {\n    return tag + (description ? `:${description}` : '');\n  }\n  async parse(metadata, tokenizer, options) {\n    this.tokenizer = tokenizer;\n    this.metadata = metadata;\n    this.options = options;\n    const id3Header = await this.tokenizer.readToken(ID3v2Header);\n    if (id3Header.fileIdentifier !== 'ID3') {\n      throw new Id3v2ContentError('expected ID3-header file-identifier \\'ID3\\' was not found');\n    }\n    this.id3Header = id3Header;\n    this.headerType = `ID3v2.${id3Header.version.major}`;\n    return id3Header.flags.isExtendedHeader ? this.parseExtendedHeader() : this.parseId3Data(id3Header.size);\n  }\n  async parseExtendedHeader() {\n    const extendedHeader = await this.tokenizer.readToken(ExtendedHeader);\n    const dataRemaining = extendedHeader.size - ExtendedHeader.len;\n    return dataRemaining > 0 ? this.parseExtendedHeaderData(dataRemaining, extendedHeader.size) : this.parseId3Data(this.id3Header.size - extendedHeader.size);\n  }\n  async parseExtendedHeaderData(dataRemaining, extendedHeaderSize) {\n    await this.tokenizer.ignore(dataRemaining);\n    return this.parseId3Data(this.id3Header.size - extendedHeaderSize);\n  }\n  async parseId3Data(dataLen) {\n    const uint8Array = await this.tokenizer.readToken(new Token.Uint8ArrayType(dataLen));\n    for (const tag of this.parseMetadata(uint8Array)) {\n      switch (tag.id) {\n        case 'TXXX':\n          if (tag.value) {\n            await this.handleTag(tag, tag.value.text, () => tag.value.description);\n          }\n          break;\n        default:\n          await (Array.isArray(tag.value) ? Promise.all(tag.value.map(value => this.addTag(tag.id, value))) : this.addTag(tag.id, tag.value));\n      }\n    }\n  }\n  async handleTag(tag, values, descriptor, resolveValue = value => value) {\n    await Promise.all(values.map(value => this.addTag(ID3v2Parser.makeDescriptionTagName(tag.id, descriptor(value)), resolveValue(value))));\n  }\n  async addTag(id, value) {\n    await this.metadata.addTag(this.headerType, id, value);\n  }\n  parseMetadata(data) {\n    let offset = 0;\n    const tags = [];\n    while (true) {\n      if (offset === data.length) break;\n      const frameHeaderLength = ID3v2Parser.getFrameHeaderLength(this.id3Header.version.major);\n      if (offset + frameHeaderLength > data.length) {\n        this.metadata.addWarning('Illegal ID3v2 tag length');\n        break;\n      }\n      const frameHeaderBytes = data.subarray(offset, offset + frameHeaderLength);\n      offset += frameHeaderLength;\n      const frameHeader = this.readFrameHeader(frameHeaderBytes, this.id3Header.version.major);\n      const frameDataBytes = data.subarray(offset, offset + frameHeader.length);\n      offset += frameHeader.length;\n      const values = ID3v2Parser.readFrameData(frameDataBytes, frameHeader, this.id3Header.version.major, !this.options.skipCovers, this.metadata);\n      if (values) {\n        tags.push({\n          id: frameHeader.id,\n          value: values\n        });\n      }\n    }\n    return tags;\n  }\n  readFrameHeader(uint8Array, majorVer) {\n    let header;\n    switch (majorVer) {\n      case 2:\n        header = {\n          id: textDecode(uint8Array.subarray(0, 3), 'ascii'),\n          length: Token.UINT24_BE.get(uint8Array, 3)\n        };\n        if (!header.id.match(/[A-Z0-9]{3}/g)) {\n          this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${header.id}`);\n        }\n        break;\n      case 3:\n      case 4:\n        header = {\n          id: textDecode(uint8Array.subarray(0, 4), 'ascii'),\n          length: (majorVer === 4 ? UINT32SYNCSAFE : Token.UINT32_BE).get(uint8Array, 4),\n          flags: ID3v2Parser.readFrameFlags(uint8Array.subarray(8, 10))\n        };\n        if (!header.id.match(/[A-Z0-9]{4}/g)) {\n          this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${header.id}`);\n        }\n        break;\n      default:\n        throw makeUnexpectedMajorVersionError(majorVer);\n    }\n    return header;\n  }\n}\nfunction makeUnexpectedMajorVersionError(majorVer) {\n  throw new Id3v2ContentError(`Unexpected majorVer: ${majorVer}`);\n}","map":{"version":3,"names":["Token","util","FrameParser","Id3v2ContentError","ExtendedHeader","ID3v2Header","UINT32SYNCSAFE","textDecode","ID3v2Parser","constructor","tokenizer","undefined","id3Header","metadata","headerType","options","removeUnsyncBytes","buffer","readI","writeI","length","subarray","getFrameHeaderLength","majorVer","makeUnexpectedMajorVersionError","readFrameFlags","b","status","tag_alter_preservation","getBit","file_alter_preservation","read_only","format","grouping_identity","compression","encryption","unsynchronisation","data_length_indicator","readFrameData","uint8Array","frameHeader","includeCovers","warningCollector","frameParser","readData","id","flags","makeDescriptionTagName","tag","description","parse","readToken","fileIdentifier","version","major","isExtendedHeader","parseExtendedHeader","parseId3Data","size","extendedHeader","dataRemaining","len","parseExtendedHeaderData","extendedHeaderSize","ignore","dataLen","Uint8ArrayType","parseMetadata","value","handleTag","text","Array","isArray","Promise","all","map","addTag","values","descriptor","resolveValue","data","offset","tags","frameHeaderLength","addWarning","frameHeaderBytes","readFrameHeader","frameDataBytes","skipCovers","push","header","UINT24_BE","get","match","UINT32_BE"],"sources":["/home/kup/my_projects/vue/osi/node_modules/music-metadata/lib/id3v2/ID3v2Parser.js"],"sourcesContent":["import * as Token from 'token-types';\nimport * as util from '../common/Util.js';\nimport { FrameParser, Id3v2ContentError } from './FrameParser.js';\nimport { ExtendedHeader, ID3v2Header, UINT32SYNCSAFE } from './ID3v2Token.js';\nimport { textDecode } from '@borewit/text-codec';\nexport class ID3v2Parser {\n    constructor() {\n        this.tokenizer = undefined;\n        this.id3Header = undefined;\n        this.metadata = undefined;\n        this.headerType = undefined;\n        this.options = undefined;\n    }\n    static removeUnsyncBytes(buffer) {\n        let readI = 0;\n        let writeI = 0;\n        while (readI < buffer.length - 1) {\n            if (readI !== writeI) {\n                buffer[writeI] = buffer[readI];\n            }\n            readI += (buffer[readI] === 0xFF && buffer[readI + 1] === 0) ? 2 : 1;\n            writeI++;\n        }\n        if (readI < buffer.length) {\n            buffer[writeI++] = buffer[readI];\n        }\n        return buffer.subarray(0, writeI);\n    }\n    static getFrameHeaderLength(majorVer) {\n        switch (majorVer) {\n            case 2:\n                return 6;\n            case 3:\n            case 4:\n                return 10;\n            default:\n                throw makeUnexpectedMajorVersionError(majorVer);\n        }\n    }\n    static readFrameFlags(b) {\n        return {\n            status: {\n                tag_alter_preservation: util.getBit(b, 0, 6),\n                file_alter_preservation: util.getBit(b, 0, 5),\n                read_only: util.getBit(b, 0, 4)\n            },\n            format: {\n                grouping_identity: util.getBit(b, 1, 7),\n                compression: util.getBit(b, 1, 3),\n                encryption: util.getBit(b, 1, 2),\n                unsynchronisation: util.getBit(b, 1, 1),\n                data_length_indicator: util.getBit(b, 1, 0)\n            }\n        };\n    }\n    static readFrameData(uint8Array, frameHeader, majorVer, includeCovers, warningCollector) {\n        const frameParser = new FrameParser(majorVer, warningCollector);\n        switch (majorVer) {\n            case 2:\n                return frameParser.readData(uint8Array, frameHeader.id, includeCovers);\n            case 3:\n            case 4:\n                if (frameHeader.flags?.format.unsynchronisation) {\n                    uint8Array = ID3v2Parser.removeUnsyncBytes(uint8Array);\n                }\n                if (frameHeader.flags?.format.data_length_indicator) {\n                    uint8Array = uint8Array.subarray(4, uint8Array.length);\n                }\n                return frameParser.readData(uint8Array, frameHeader.id, includeCovers);\n            default:\n                throw makeUnexpectedMajorVersionError(majorVer);\n        }\n    }\n    /**\n     * Create a combined tag key, of tag & description\n     * @param tag e.g.: COM\n     * @param description e.g. iTunPGAP\n     * @returns string e.g. COM:iTunPGAP\n     */\n    static makeDescriptionTagName(tag, description) {\n        return tag + (description ? `:${description}` : '');\n    }\n    async parse(metadata, tokenizer, options) {\n        this.tokenizer = tokenizer;\n        this.metadata = metadata;\n        this.options = options;\n        const id3Header = await this.tokenizer.readToken(ID3v2Header);\n        if (id3Header.fileIdentifier !== 'ID3') {\n            throw new Id3v2ContentError('expected ID3-header file-identifier \\'ID3\\' was not found');\n        }\n        this.id3Header = id3Header;\n        this.headerType = (`ID3v2.${id3Header.version.major}`);\n        return id3Header.flags.isExtendedHeader ? this.parseExtendedHeader() : this.parseId3Data(id3Header.size);\n    }\n    async parseExtendedHeader() {\n        const extendedHeader = await this.tokenizer.readToken(ExtendedHeader);\n        const dataRemaining = extendedHeader.size - ExtendedHeader.len;\n        return dataRemaining > 0 ? this.parseExtendedHeaderData(dataRemaining, extendedHeader.size) : this.parseId3Data(this.id3Header.size - extendedHeader.size);\n    }\n    async parseExtendedHeaderData(dataRemaining, extendedHeaderSize) {\n        await this.tokenizer.ignore(dataRemaining);\n        return this.parseId3Data(this.id3Header.size - extendedHeaderSize);\n    }\n    async parseId3Data(dataLen) {\n        const uint8Array = await this.tokenizer.readToken(new Token.Uint8ArrayType(dataLen));\n        for (const tag of this.parseMetadata(uint8Array)) {\n            switch (tag.id) {\n                case 'TXXX':\n                    if (tag.value) {\n                        await this.handleTag(tag, tag.value.text, () => tag.value.description);\n                    }\n                    break;\n                default:\n                    await (Array.isArray(tag.value) ? Promise.all(tag.value.map(value => this.addTag(tag.id, value))) : this.addTag(tag.id, tag.value));\n            }\n        }\n    }\n    async handleTag(tag, values, descriptor, resolveValue = value => value) {\n        await Promise.all(values.map(value => this.addTag(ID3v2Parser.makeDescriptionTagName(tag.id, descriptor(value)), resolveValue(value))));\n    }\n    async addTag(id, value) {\n        await this.metadata.addTag(this.headerType, id, value);\n    }\n    parseMetadata(data) {\n        let offset = 0;\n        const tags = [];\n        while (true) {\n            if (offset === data.length)\n                break;\n            const frameHeaderLength = ID3v2Parser.getFrameHeaderLength(this.id3Header.version.major);\n            if (offset + frameHeaderLength > data.length) {\n                this.metadata.addWarning('Illegal ID3v2 tag length');\n                break;\n            }\n            const frameHeaderBytes = data.subarray(offset, offset + frameHeaderLength);\n            offset += frameHeaderLength;\n            const frameHeader = this.readFrameHeader(frameHeaderBytes, this.id3Header.version.major);\n            const frameDataBytes = data.subarray(offset, offset + frameHeader.length);\n            offset += frameHeader.length;\n            const values = ID3v2Parser.readFrameData(frameDataBytes, frameHeader, this.id3Header.version.major, !this.options.skipCovers, this.metadata);\n            if (values) {\n                tags.push({ id: frameHeader.id, value: values });\n            }\n        }\n        return tags;\n    }\n    readFrameHeader(uint8Array, majorVer) {\n        let header;\n        switch (majorVer) {\n            case 2:\n                header = {\n                    id: textDecode(uint8Array.subarray(0, 3), 'ascii'),\n                    length: Token.UINT24_BE.get(uint8Array, 3)\n                };\n                if (!header.id.match(/[A-Z0-9]{3}/g)) {\n                    this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${header.id}`);\n                }\n                break;\n            case 3:\n            case 4:\n                header = {\n                    id: textDecode(uint8Array.subarray(0, 4), 'ascii'),\n                    length: (majorVer === 4 ? UINT32SYNCSAFE : Token.UINT32_BE).get(uint8Array, 4),\n                    flags: ID3v2Parser.readFrameFlags(uint8Array.subarray(8, 10))\n                };\n                if (!header.id.match(/[A-Z0-9]{4}/g)) {\n                    this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${header.id}`);\n                }\n                break;\n            default:\n                throw makeUnexpectedMajorVersionError(majorVer);\n        }\n        return header;\n    }\n}\nfunction makeUnexpectedMajorVersionError(majorVer) {\n    throw new Id3v2ContentError(`Unexpected majorVer: ${majorVer}`);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}