{"ast":null,"code":"import { EndOfStreamError } from 'strtok3';\nimport initDebug from 'debug';\nimport { ID3v2Header } from './ID3v2Token.js';\nimport { ID3v2Parser } from './ID3v2Parser.js';\nimport { ID3v1Parser } from '../id3v1/ID3v1Parser.js';\nimport { BasicParser } from '../common/BasicParser.js';\nconst debug = initDebug('music-metadata:parser:ID3');\n/**\r\n * Abstract parser which tries take ID3v2 and ID3v1 headers.\r\n */\nexport class AbstractID3Parser extends BasicParser {\n  constructor() {\n    super(...arguments);\n    this.id3parser = new ID3v2Parser();\n  }\n  static async startsWithID3v2Header(tokenizer) {\n    return (await tokenizer.peekToken(ID3v2Header)).fileIdentifier === 'ID3';\n  }\n  async parse() {\n    try {\n      await this.parseID3v2();\n    } catch (err) {\n      if (err instanceof EndOfStreamError) {\n        debug(\"End-of-stream\");\n      } else {\n        throw err;\n      }\n    }\n  }\n  finalize() {\n    return;\n  }\n  async parseID3v2() {\n    await this.tryReadId3v2Headers();\n    debug('End of ID3v2 header, go to MPEG-parser: pos=%s', this.tokenizer.position);\n    await this.postId3v2Parse();\n    if (this.options.skipPostHeaders && this.metadata.hasAny()) {\n      this.finalize();\n    } else {\n      const id3v1parser = new ID3v1Parser(this.metadata, this.tokenizer, this.options);\n      await id3v1parser.parse();\n      this.finalize();\n    }\n  }\n  async tryReadId3v2Headers() {\n    const id3Header = await this.tokenizer.peekToken(ID3v2Header);\n    if (id3Header.fileIdentifier === 'ID3') {\n      debug('Found ID3v2 header, pos=%s', this.tokenizer.position);\n      await this.id3parser.parse(this.metadata, this.tokenizer, this.options);\n      return this.tryReadId3v2Headers();\n    }\n  }\n}","map":{"version":3,"names":["EndOfStreamError","initDebug","ID3v2Header","ID3v2Parser","ID3v1Parser","BasicParser","debug","AbstractID3Parser","constructor","arguments","id3parser","startsWithID3v2Header","tokenizer","peekToken","fileIdentifier","parse","parseID3v2","err","finalize","tryReadId3v2Headers","position","postId3v2Parse","options","skipPostHeaders","metadata","hasAny","id3v1parser","id3Header"],"sources":["C:/projects/My projects/Vue/osi/node_modules/music-metadata/lib/id3v2/AbstractID3Parser.js"],"sourcesContent":["import { EndOfStreamError } from 'strtok3';\r\nimport initDebug from 'debug';\r\nimport { ID3v2Header } from './ID3v2Token.js';\r\nimport { ID3v2Parser } from './ID3v2Parser.js';\r\nimport { ID3v1Parser } from '../id3v1/ID3v1Parser.js';\r\nimport { BasicParser } from '../common/BasicParser.js';\r\nconst debug = initDebug('music-metadata:parser:ID3');\r\n/**\r\n * Abstract parser which tries take ID3v2 and ID3v1 headers.\r\n */\r\nexport class AbstractID3Parser extends BasicParser {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.id3parser = new ID3v2Parser();\r\n    }\r\n    static async startsWithID3v2Header(tokenizer) {\r\n        return (await tokenizer.peekToken(ID3v2Header)).fileIdentifier === 'ID3';\r\n    }\r\n    async parse() {\r\n        try {\r\n            await this.parseID3v2();\r\n        }\r\n        catch (err) {\r\n            if (err instanceof EndOfStreamError) {\r\n                debug(\"End-of-stream\");\r\n            }\r\n            else {\r\n                throw err;\r\n            }\r\n        }\r\n    }\r\n    finalize() {\r\n        return;\r\n    }\r\n    async parseID3v2() {\r\n        await this.tryReadId3v2Headers();\r\n        debug('End of ID3v2 header, go to MPEG-parser: pos=%s', this.tokenizer.position);\r\n        await this.postId3v2Parse();\r\n        if (this.options.skipPostHeaders && this.metadata.hasAny()) {\r\n            this.finalize();\r\n        }\r\n        else {\r\n            const id3v1parser = new ID3v1Parser(this.metadata, this.tokenizer, this.options);\r\n            await id3v1parser.parse();\r\n            this.finalize();\r\n        }\r\n    }\r\n    async tryReadId3v2Headers() {\r\n        const id3Header = await this.tokenizer.peekToken(ID3v2Header);\r\n        if (id3Header.fileIdentifier === 'ID3') {\r\n            debug('Found ID3v2 header, pos=%s', this.tokenizer.position);\r\n            await this.id3parser.parse(this.metadata, this.tokenizer, this.options);\r\n            return this.tryReadId3v2Headers();\r\n        }\r\n    }\r\n}\r\n"],"mappings":"AAAA,SAASA,gBAAgB,QAAQ,SAAS;AAC1C,OAAOC,SAAS,MAAM,OAAO;AAC7B,SAASC,WAAW,QAAQ,iBAAiB;AAC7C,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,WAAW,QAAQ,yBAAyB;AACrD,SAASC,WAAW,QAAQ,0BAA0B;AACtD,MAAMC,KAAK,GAAGL,SAAS,CAAC,2BAA2B,CAAC;AACpD;AACA;AACA;AACA,OAAO,MAAMM,iBAAiB,SAASF,WAAW,CAAC;EAC/CG,WAAWA,CAAA,EAAG;IACV,KAAK,CAAC,GAAGC,SAAS,CAAC;IACnB,IAAI,CAACC,SAAS,GAAG,IAAIP,WAAW,CAAC,CAAC;EACtC;EACA,aAAaQ,qBAAqBA,CAACC,SAAS,EAAE;IAC1C,OAAO,CAAC,MAAMA,SAAS,CAACC,SAAS,CAACX,WAAW,CAAC,EAAEY,cAAc,KAAK,KAAK;EAC5E;EACA,MAAMC,KAAKA,CAAA,EAAG;IACV,IAAI;MACA,MAAM,IAAI,CAACC,UAAU,CAAC,CAAC;IAC3B,CAAC,CACD,OAAOC,GAAG,EAAE;MACR,IAAIA,GAAG,YAAYjB,gBAAgB,EAAE;QACjCM,KAAK,CAAC,eAAe,CAAC;MAC1B,CAAC,MACI;QACD,MAAMW,GAAG;MACb;IACJ;EACJ;EACAC,QAAQA,CAAA,EAAG;IACP;EACJ;EACA,MAAMF,UAAUA,CAAA,EAAG;IACf,MAAM,IAAI,CAACG,mBAAmB,CAAC,CAAC;IAChCb,KAAK,CAAC,gDAAgD,EAAE,IAAI,CAACM,SAAS,CAACQ,QAAQ,CAAC;IAChF,MAAM,IAAI,CAACC,cAAc,CAAC,CAAC;IAC3B,IAAI,IAAI,CAACC,OAAO,CAACC,eAAe,IAAI,IAAI,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC,EAAE;MACxD,IAAI,CAACP,QAAQ,CAAC,CAAC;IACnB,CAAC,MACI;MACD,MAAMQ,WAAW,GAAG,IAAItB,WAAW,CAAC,IAAI,CAACoB,QAAQ,EAAE,IAAI,CAACZ,SAAS,EAAE,IAAI,CAACU,OAAO,CAAC;MAChF,MAAMI,WAAW,CAACX,KAAK,CAAC,CAAC;MACzB,IAAI,CAACG,QAAQ,CAAC,CAAC;IACnB;EACJ;EACA,MAAMC,mBAAmBA,CAAA,EAAG;IACxB,MAAMQ,SAAS,GAAG,MAAM,IAAI,CAACf,SAAS,CAACC,SAAS,CAACX,WAAW,CAAC;IAC7D,IAAIyB,SAAS,CAACb,cAAc,KAAK,KAAK,EAAE;MACpCR,KAAK,CAAC,4BAA4B,EAAE,IAAI,CAACM,SAAS,CAACQ,QAAQ,CAAC;MAC5D,MAAM,IAAI,CAACV,SAAS,CAACK,KAAK,CAAC,IAAI,CAACS,QAAQ,EAAE,IAAI,CAACZ,SAAS,EAAE,IAAI,CAACU,OAAO,CAAC;MACvE,OAAO,IAAI,CAACH,mBAAmB,CAAC,CAAC;IACrC;EACJ;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}