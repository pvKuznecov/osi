{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.to-array.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport Dexie from \"dexie\";\n\n// конфигураторы БД\nconst db_name = 'OSIDB';\nconst db_version = 1;\n\n// инициализация БД\nconst DB = new Dexie(db_name);\n\n// описание схемы БД\nDB.version(db_version).stores({\n  users: '++id, login, password, apps, data, config, systemСonfig, createdAt, updatedAt',\n  settings: '++id, key, value, updatedAt'\n});\n\n// -=-=-=-=-=-=-Описание классов моделей-=-=-=-=-=-=-\nexport class User {\n  constructor(data = {}) {\n    this.login = data.login || '';\n    this.password = data.password || ''; //ПРОДУМАТЬ РЕАЛЬНУЮ СХЕМУ ЗАЩИТЫ\n    this.apps = data.apps || [];\n    this.data = data.data || {};\n    this.config = data.config || {\n      avatar: \"cat.jpg\"\n    };\n    this.systemconfig = data.systemconfig || {\n      desktopWallpaper: \"nwall.jpg\"\n    };\n    this.createdAt = data.createdAt || new Date();\n    this.updatedAt = data.updatedAt || new Date();\n\n    // автоматическое присваение id (вариант для \"совместимости\")\n    if (data.id) {\n      this.id = data.id;\n    }\n  }\n}\nexport class Setting {\n  constructor(key, value) {\n    this.key = key;\n    this.value = value;\n    this.updatedAt = new Date();\n  }\n}\n\n// -=-=-=-=-=-=-Основные операции CRUD-=-=-=-=-=-=-\nexport const usersTable = {\n  // обновление|сохранение учетной записи\n  // async save(userData) {\n  //     try {\n  //         const NUser = new User(userData);\n\n  //         if (NUser.id) {\n  //             NUser.updatedAt = new Date();\n  //             await DB.users.update(NUser.id, NUser);\n\n  //             return NUser.id;\n  //         } else {\n  //             // зачищаем id в NUser (автоматически сгенерирует)\n  //             delete NUser.id;\n\n  //             NUser.createdAt = new Date();\n  //             NUser.updatedAt = new Date();\n\n  //             return await DB.users.add(NUser);\n  //         }\n  //     } catch (error) {\n  //         console.error('Error operation (users; save):', error);            \n  //         throw new Error(`Failed to save user: ${error.message}`);\n  //     }\n  // },\n  async save(userData) {\n    try {\n      const NUser = new User(userData);\n      if (NUser.id) {\n        NUser.updatedAt = new Date();\n        await DB.users.update(NUser.id, NUser);\n        return NUser.id;\n      } else {\n        // зачищаем id в NUser (автоматически сгенерирует)\n        delete NUser.id;\n        NUser.createdAt = new Date();\n        NUser.updatedAt = new Date();\n        return await DB.users.add(NUser);\n      }\n    } catch (error) {\n      console.error('Error operation (users; save):', error);\n      throw new Error(`Failed to save user: ${error.message}`);\n    }\n  },\n  prepareUserForDB(user) {\n    // Создаем простой объект, который можно сохранить в IndexedDB\n    return {\n      id: user.id,\n      login: user.login,\n      password: user.password,\n      config: user.config ? {\n        avatar: user.config.avatar\n      } : {\n        avatar: \"cat.jpg\"\n      },\n      systemconfig: user.systemconfig ? {\n        desktopWallpaper: user.systemconfig.desktopWallpaper || \"nwall.jpg\"\n      } : {\n        desktopWallpaper: \"nwall.jpg\"\n      },\n      createdAt: user.createdAt,\n      updatedAt: user.updatedAt\n    };\n  },\n  // поиск учетной записи по id\n  async getbyId(id) {\n    try {\n      return await DB.users.get(id);\n    } catch (error) {\n      console.error('Error operation (users; getbyId):', error);\n      throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n    }\n  },\n  // поиск учетной записи по login\n  async getbyLogin(login) {\n    try {\n      return await DB.users.where('login').equals(login).first();\n    } catch (error) {\n      console.error('Error operation (users; getbyLogin):', error);\n      throw new Error(`Failed to get user by login ${login}: ${error.message}`);\n    }\n  },\n  // получить массив всех учетных записей\n  async getAll() {\n    try {\n      return await DB.users.toArray();\n    } catch (error) {\n      console.error('Error operation (users; getAll):', error);\n      throw new Error(`Failed to get all users`);\n    }\n  },\n  // удалить учетную запись\n  async delete(id) {\n    try {\n      return await DB.users.delete(id);\n    } catch (error) {\n      console.error('Error operation (users; delete):', error);\n      throw new Error(`Failed to delete user ${id}: ${error.message}`);\n    }\n  },\n  // кол-во учетных записей\n  async count() {\n    try {\n      return await DB.users.count();\n    } catch (error) {\n      console.error('Error operation (users; count):', error);\n      throw new Error(`Failed to count users`);\n    }\n  },\n  async search(query) {\n    try {\n      return await DB.users.filter(user => user.login.toLowerCase().includes(query.toLowerCase()) || JSON.stringify(user.data).toLowerCase().includes(query.toLowerCase())).toArray();\n    } catch (error) {\n      console.error('Error operation (users; search');\n      throw new Error(`Search failed: ${error.message}`);\n    }\n  }\n};\nexport const settingsTable = {\n  // сохранение настройки\n  async save(key, value) {\n    try {\n      const existing = await DB.settings.where('key').equals(key).first();\n      if (existing) {\n        await DB.settings.update(existing.id, {\n          value: value,\n          updatedAt: new Date()\n        });\n        return existing.id;\n      } else {\n        return await DB.settings.add(new Setting(key, value));\n      }\n    } catch (error) {\n      console.error('Error operation (settings; save');\n      throw new Error(`Failed to save setting ${key}: ${error.message}`);\n    }\n  },\n  // получить настройку\n  async get(key, defaultVal = null) {\n    try {\n      const findSetting = DB.settings.where('key').equals(key).first();\n      return findSetting ? findSetting.value : defaultVal;\n    } catch (error) {\n      console.error('Error operation (settings; get');\n      throw new Error(`Failed to get setting ${key}: ${error.message}`);\n    }\n  },\n  // удалить настройку\n  async delete(key) {\n    try {\n      const findSetting = await DB.settings.where('key').equals(key).first();\n      if (findSetting) {\n        return await DB.settings.delete(findSetting.id);\n      } else {\n        return null;\n      }\n    } catch (error) {\n      console.error('Error operation (settings; delete');\n      throw new Error(`Failed to delete setting ${key}: ${error.message}`);\n    }\n  },\n  // получить все настройки\n  async getAll() {\n    try {\n      return await DB.settings.toArray();\n    } catch (error) {\n      console.error('Error operation (settings; getAll');\n      throw new Error(`Failed to get all settings`);\n    }\n  }\n};\n\n// -=-=-=-=-=-=-Служебное-=-=-=-=-=-=-\n\n// инициализация БД с тестовыми данными\nexport async function initDatabase() {\n  try {\n    // проверка, пустая ли база\n    const userCount = await usersTable.count();\n    if (userCount === 0) {\n      // создание базового пользователя\n      const defaultUser = new User({\n        login: 'user',\n        password: '',\n        apps: [],\n        data: {},\n        config: {\n          avatar: 'robot.jpg'\n        },\n        systemconfig: {}\n      });\n      await usersTable.save(defaultUser);\n      console.log('Default user created.');\n    }\n\n    // инициализация базовых настроек \n    const defaultSettings = [['theme', 'dark'], ['avatarDefault', 'cat']];\n    for (const [key, value] of defaultSettings) {\n      const existing = await settingsTable.get(key);\n      if (existing === null) {\n        await settingsTable.set(key, value);\n      }\n    }\n    console.log('Database initialized successfully');\n    return true;\n  } catch (error) {\n    console.error('Error initializing DB:', error);\n    throw error;\n  }\n}\n\n/**\n * Очистка базы данных (осторожно!)\n */\nexport async function clearDatabase() {\n  try {\n    await Promise.all([DB.users.clear(), DB.settings.clear()]);\n    console.log('Database cleared');\n  } catch (error) {\n    console.error('Error clearing database:', error);\n    throw error;\n  }\n}\n\n// ==================== МИГРАЦИИ ====================\n\n// Пример добавления миграции при увеличении версии\n// DB.version(2).stores({\n//     users: '++id, login, password, apps, data, config, systemConfig, createdAt, updatedAt, lastLogin',\n//     settings: '++id, key, value, updatedAt',\n//     sessions: '++id, userId, token, expiresAt, createdAt' // Новая таблица\n// }).upgrade(async (tx) => {\n//     // Добавляем поле lastLogin к существующим пользователям\n//     const users = await tx.users.toArray();\n//     await Promise.all(\n//         users.map(user => \n//             tx.users.update(user.id, { \n//                 lastLogin: null,\n//                 updatedAt: new Date() \n//             })\n//         )\n//     );\n\n//     console.log('Migration to version 2 completed');\n// });\n\nexport { DB };\nexport default {\n  DB,\n  User,\n  usersTable,\n  settingsTable,\n  initDatabase,\n  clearDatabase\n};","map":{"version":3,"names":["Dexie","db_name","db_version","DB","version","stores","users","settings","User","constructor","data","login","password","apps","config","avatar","systemconfig","desktopWallpaper","createdAt","Date","updatedAt","id","Setting","key","value","usersTable","save","userData","NUser","update","add","error","console","Error","message","prepareUserForDB","user","getbyId","get","getbyLogin","where","equals","first","getAll","toArray","delete","count","search","query","filter","toLowerCase","includes","JSON","stringify","settingsTable","existing","defaultVal","findSetting","initDatabase","userCount","defaultUser","log","defaultSettings","set","clearDatabase","Promise","all","clear"],"sources":["/home/kup/my_projects/vue/osi/src/idb/db.js"],"sourcesContent":["import Dexie from \"dexie\";\n\n// конфигураторы БД\nconst db_name = 'OSIDB';\nconst db_version = 1;\n\n// инициализация БД\nconst DB = new Dexie(db_name);\n\n// описание схемы БД\nDB.version(db_version).stores({\n    users: '++id, login, password, apps, data, config, systemСonfig, createdAt, updatedAt',\n    settings: '++id, key, value, updatedAt',\n});\n\n// -=-=-=-=-=-=-Описание классов моделей-=-=-=-=-=-=-\nexport class User {\n    constructor(data = {}) {\n        this.login = data.login || '';\n        this.password = data.password || '';    //ПРОДУМАТЬ РЕАЛЬНУЮ СХЕМУ ЗАЩИТЫ\n        this.apps = data.apps || [];\n        this.data = data.data || {};\n        this.config = data.config || {avatar: \"cat.jpg\"};\n        this.systemconfig = data.systemconfig || {desktopWallpaper: \"nwall.jpg\"};\n        this.createdAt = data.createdAt || new Date();\n        this.updatedAt = data.updatedAt || new Date();\n\n        // автоматическое присваение id (вариант для \"совместимости\")\n        if (data.id) {\n            this.id = data.id;\n        }\n    }\n}\n\nexport class Setting {\n    constructor(key, value) {\n        this.key = key;\n        this.value = value;\n        this.updatedAt = new Date();\n    }\n}\n\n\n// -=-=-=-=-=-=-Основные операции CRUD-=-=-=-=-=-=-\nexport const usersTable = {\n    // обновление|сохранение учетной записи\n    // async save(userData) {\n    //     try {\n    //         const NUser = new User(userData);\n\n    //         if (NUser.id) {\n    //             NUser.updatedAt = new Date();\n    //             await DB.users.update(NUser.id, NUser);\n\n    //             return NUser.id;\n    //         } else {\n    //             // зачищаем id в NUser (автоматически сгенерирует)\n    //             delete NUser.id;\n\n    //             NUser.createdAt = new Date();\n    //             NUser.updatedAt = new Date();\n\n    //             return await DB.users.add(NUser);\n    //         }\n    //     } catch (error) {\n    //         console.error('Error operation (users; save):', error);            \n    //         throw new Error(`Failed to save user: ${error.message}`);\n    //     }\n    // },\n    async save(userData) {\n        try {\n            const NUser = new User(userData);\n\n            if (NUser.id) {\n                NUser.updatedAt = new Date();\n                await DB.users.update(NUser.id, NUser);\n\n                return NUser.id;\n            } else {\n                // зачищаем id в NUser (автоматически сгенерирует)\n                delete NUser.id;\n\n                NUser.createdAt = new Date();\n                NUser.updatedAt = new Date();\n\n                return await DB.users.add(NUser);\n            }\n        } catch (error) {\n            console.error('Error operation (users; save):', error);            \n            throw new Error(`Failed to save user: ${error.message}`);\n        }\n    },\n\n    prepareUserForDB(user) {\n        // Создаем простой объект, который можно сохранить в IndexedDB\n        return {\n            id: user.id,\n            login: user.login,\n            password: user.password,\n            config: user.config ? {\n                avatar: user.config.avatar,\n            \n            } : {avatar: \"cat.jpg\"},\n            systemconfig: user.systemconfig ? {\n                desktopWallpaper: user.systemconfig.desktopWallpaper || \"nwall.jpg\"\n            \n            } : {desktopWallpaper: \"nwall.jpg\"},\n            createdAt: user.createdAt,\n            updatedAt: user.updatedAt\n        };\n    },\n\n    // поиск учетной записи по id\n    async getbyId(id) {\n        try {\n            return await DB.users.get(id);\n        } catch (error) {\n            console.error('Error operation (users; getbyId):', error);            \n            throw new Error(`Failed to get user by id ${id}: ${error.message}`);\n        }\n    },\n\n    // поиск учетной записи по login\n    async getbyLogin(login) {\n        try {\n            return await DB.users.where('login').equals(login).first();\n        } catch (error) {\n            console.error('Error operation (users; getbyLogin):', error);\n            throw new Error(`Failed to get user by login ${login}: ${error.message}`);\n        }\n    },\n\n    // получить массив всех учетных записей\n    async getAll() {\n        try {\n            return await DB.users.toArray();\n        } catch (error) {\n            console.error('Error operation (users; getAll):', error);\n            throw new Error(`Failed to get all users`);\n        }\n    },\n\n    // удалить учетную запись\n    async delete(id) {\n        try {\n            return await DB.users.delete(id);\n        } catch (error) {\n            console.error('Error operation (users; delete):', error);\n            throw new Error(`Failed to delete user ${id}: ${error.message}`);\n        }\n    },\n\n    // кол-во учетных записей\n    async count() {\n        try {\n            return await DB.users.count();\n        } catch (error) {\n            console.error('Error operation (users; count):', error);\n            throw new Error(`Failed to count users`);\n        }\n    },\n\n    async search(query) {\n        try {\n            return await DB.users\n                .filter(user =>\n                    user.login.toLowerCase().includes(query.toLowerCase()) ||\n                    JSON.stringify(user.data).toLowerCase().includes(query.toLowerCase())\n                ).toArray();\n        } catch (error) {\n            console.error('Error operation (users; search');\n            throw new Error(`Search failed: ${error.message}`);\n        }\n    },\n};\n\nexport const settingsTable = {\n    // сохранение настройки\n    async save(key, value) {\n        try {\n            const existing = await DB.settings.where('key').equals(key).first();\n\n            if (existing) {\n                await DB.settings.update(existing.id, {\n                    value: value,\n                    updatedAt: new Date(),\n                });\n                return existing.id;\n            } else {\n                return await DB.settings.add(new Setting(key, value));\n            }\n        } catch (error) {\n            console.error('Error operation (settings; save');\n            throw new Error(`Failed to save setting ${key}: ${error.message}`);\n        }\n    },\n\n    // получить настройку\n    async get(key, defaultVal = null) {\n        try {\n            const findSetting = DB.settings.where('key').equals(key).first();\n\n            return findSetting ? findSetting.value : defaultVal;\n        } catch (error) {\n            console.error('Error operation (settings; get');\n            throw new Error(`Failed to get setting ${key}: ${error.message}`);\n        }\n    },\n\n    // удалить настройку\n    async delete(key) {\n        try {\n            const findSetting = await DB.settings.where('key').equals(key).first();\n\n            if (findSetting) {\n                return await DB.settings.delete(findSetting.id);\n            } else {\n                return null;\n            }\n        } catch (error) {\n            console.error('Error operation (settings; delete');\n            throw new Error(`Failed to delete setting ${key}: ${error.message}`);\n        }\n    },\n\n    // получить все настройки\n    async getAll() {\n        try {\n            return await DB.settings.toArray();\n        } catch (error) {\n            console.error('Error operation (settings; getAll');\n            throw new Error(`Failed to get all settings`);\n        }\n    },\n};\n\n\n// -=-=-=-=-=-=-Служебное-=-=-=-=-=-=-\n\n// инициализация БД с тестовыми данными\nexport async function initDatabase() {\n    try {\n        // проверка, пустая ли база\n        const userCount = await usersTable.count();\n\n        if (userCount === 0) {\n            // создание базового пользователя\n            const defaultUser = new User({\n                login: 'user',\n                password: '',\n                apps: [],\n                data: {},\n                config: {\n                    avatar: 'robot.jpg',\n                },\n                systemconfig: {},\n            });\n\n            await usersTable.save(defaultUser);\n            console.log('Default user created.');\n        }\n\n        // инициализация базовых настроек \n        const defaultSettings = [\n            ['theme', 'dark'],\n            ['avatarDefault', 'cat'],\n        ];\n\n        for (const [key, value] of defaultSettings) {\n            const existing = await settingsTable.get(key);\n\n            if (existing === null) {\n                await settingsTable.set(key, value);\n            }\n        }\n\n        console.log('Database initialized successfully');\n        return true;\n    } catch (error) {\n        console.error('Error initializing DB:', error);\n\n        throw error;\n    }    \n}\n\n/**\n * Очистка базы данных (осторожно!)\n */\nexport async function clearDatabase() {\n    try {\n        await Promise.all([\n            DB.users.clear(),\n            DB.settings.clear()\n        ]);\n        console.log('Database cleared');\n    } catch (error) {\n        console.error('Error clearing database:', error);\n        throw error;\n    }\n}\n\n// ==================== МИГРАЦИИ ====================\n\n// Пример добавления миграции при увеличении версии\n// DB.version(2).stores({\n//     users: '++id, login, password, apps, data, config, systemConfig, createdAt, updatedAt, lastLogin',\n//     settings: '++id, key, value, updatedAt',\n//     sessions: '++id, userId, token, expiresAt, createdAt' // Новая таблица\n// }).upgrade(async (tx) => {\n//     // Добавляем поле lastLogin к существующим пользователям\n//     const users = await tx.users.toArray();\n//     await Promise.all(\n//         users.map(user => \n//             tx.users.update(user.id, { \n//                 lastLogin: null,\n//                 updatedAt: new Date() \n//             })\n//         )\n//     );\n    \n//     console.log('Migration to version 2 completed');\n// });\n\nexport { DB };\n\nexport default {\n    DB,\n    User,\n    usersTable,\n    settingsTable,\n    initDatabase,\n    clearDatabase\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}