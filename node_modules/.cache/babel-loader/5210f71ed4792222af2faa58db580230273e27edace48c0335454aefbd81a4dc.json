{"ast":null,"code":"import { EndOfStreamError } from './Errors.js';\nimport { AbstractStreamReader } from \"./AbstractStreamReader.js\";\nexport class WebStreamDefaultReader extends AbstractStreamReader {\n  constructor(reader) {\n    super();\n    this.reader = reader;\n    this.buffer = null; // Internal buffer to store excess data\n  }\n  /**\n   * Copy chunk to target, and store the remainder in this.buffer\n   */\n  writeChunk(target, chunk) {\n    const written = Math.min(chunk.length, target.length);\n    target.set(chunk.subarray(0, written));\n    // Adjust the remainder of the buffer\n    if (written < chunk.length) {\n      this.buffer = chunk.subarray(written);\n    } else {\n      this.buffer = null;\n    }\n    return written;\n  }\n  /**\n   * Read from stream\n   * @param buffer - Target Uint8Array (or Buffer) to store data read from stream in\n   * @param mayBeLess - If true, may fill the buffer partially\n   * @protected Bytes read\n   */\n  async readFromStream(buffer, mayBeLess) {\n    if (buffer.length === 0) return 0;\n    let totalBytesRead = 0;\n    // Serve from the internal buffer first\n    if (this.buffer) {\n      totalBytesRead += this.writeChunk(buffer, this.buffer);\n    }\n    // Continue reading from the stream if more data is needed\n    while (totalBytesRead < buffer.length && !this.endOfStream) {\n      const result = await this.reader.read();\n      if (result.done) {\n        this.endOfStream = true;\n        break;\n      }\n      if (result.value) {\n        totalBytesRead += this.writeChunk(buffer.subarray(totalBytesRead), result.value);\n      }\n    }\n    if (!mayBeLess && totalBytesRead === 0 && this.endOfStream) {\n      throw new EndOfStreamError();\n    }\n    return totalBytesRead;\n  }\n  abort() {\n    this.interrupted = true;\n    return this.reader.cancel();\n  }\n  async close() {\n    await this.abort();\n    this.reader.releaseLock();\n  }\n}","map":{"version":3,"names":["EndOfStreamError","AbstractStreamReader","WebStreamDefaultReader","constructor","reader","buffer","writeChunk","target","chunk","written","Math","min","length","set","subarray","readFromStream","mayBeLess","totalBytesRead","endOfStream","result","read","done","value","abort","interrupted","cancel","close","releaseLock"],"sources":["/home/kup/my_projects/vue/osi/node_modules/strtok3/lib/stream/WebStreamDefaultReader.js"],"sourcesContent":["import { EndOfStreamError } from './Errors.js';\nimport { AbstractStreamReader } from \"./AbstractStreamReader.js\";\nexport class WebStreamDefaultReader extends AbstractStreamReader {\n    constructor(reader) {\n        super();\n        this.reader = reader;\n        this.buffer = null; // Internal buffer to store excess data\n    }\n    /**\n     * Copy chunk to target, and store the remainder in this.buffer\n     */\n    writeChunk(target, chunk) {\n        const written = Math.min(chunk.length, target.length);\n        target.set(chunk.subarray(0, written));\n        // Adjust the remainder of the buffer\n        if (written < chunk.length) {\n            this.buffer = chunk.subarray(written);\n        }\n        else {\n            this.buffer = null;\n        }\n        return written;\n    }\n    /**\n     * Read from stream\n     * @param buffer - Target Uint8Array (or Buffer) to store data read from stream in\n     * @param mayBeLess - If true, may fill the buffer partially\n     * @protected Bytes read\n     */\n    async readFromStream(buffer, mayBeLess) {\n        if (buffer.length === 0)\n            return 0;\n        let totalBytesRead = 0;\n        // Serve from the internal buffer first\n        if (this.buffer) {\n            totalBytesRead += this.writeChunk(buffer, this.buffer);\n        }\n        // Continue reading from the stream if more data is needed\n        while (totalBytesRead < buffer.length && !this.endOfStream) {\n            const result = await this.reader.read();\n            if (result.done) {\n                this.endOfStream = true;\n                break;\n            }\n            if (result.value) {\n                totalBytesRead += this.writeChunk(buffer.subarray(totalBytesRead), result.value);\n            }\n        }\n        if (!mayBeLess && totalBytesRead === 0 && this.endOfStream) {\n            throw new EndOfStreamError();\n        }\n        return totalBytesRead;\n    }\n    abort() {\n        this.interrupted = true;\n        return this.reader.cancel();\n    }\n    async close() {\n        await this.abort();\n        this.reader.releaseLock();\n    }\n}\n"],"mappings":"AAAA,SAASA,gBAAgB,QAAQ,aAAa;AAC9C,SAASC,oBAAoB,QAAQ,2BAA2B;AAChE,OAAO,MAAMC,sBAAsB,SAASD,oBAAoB,CAAC;EAC7DE,WAAWA,CAACC,MAAM,EAAE;IAChB,KAAK,CAAC,CAAC;IACP,IAAI,CAACA,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACC,MAAM,GAAG,IAAI,CAAC,CAAC;EACxB;EACA;AACJ;AACA;EACIC,UAAUA,CAACC,MAAM,EAAEC,KAAK,EAAE;IACtB,MAAMC,OAAO,GAAGC,IAAI,CAACC,GAAG,CAACH,KAAK,CAACI,MAAM,EAAEL,MAAM,CAACK,MAAM,CAAC;IACrDL,MAAM,CAACM,GAAG,CAACL,KAAK,CAACM,QAAQ,CAAC,CAAC,EAAEL,OAAO,CAAC,CAAC;IACtC;IACA,IAAIA,OAAO,GAAGD,KAAK,CAACI,MAAM,EAAE;MACxB,IAAI,CAACP,MAAM,GAAGG,KAAK,CAACM,QAAQ,CAACL,OAAO,CAAC;IACzC,CAAC,MACI;MACD,IAAI,CAACJ,MAAM,GAAG,IAAI;IACtB;IACA,OAAOI,OAAO;EAClB;EACA;AACJ;AACA;AACA;AACA;AACA;EACI,MAAMM,cAAcA,CAACV,MAAM,EAAEW,SAAS,EAAE;IACpC,IAAIX,MAAM,CAACO,MAAM,KAAK,CAAC,EACnB,OAAO,CAAC;IACZ,IAAIK,cAAc,GAAG,CAAC;IACtB;IACA,IAAI,IAAI,CAACZ,MAAM,EAAE;MACbY,cAAc,IAAI,IAAI,CAACX,UAAU,CAACD,MAAM,EAAE,IAAI,CAACA,MAAM,CAAC;IAC1D;IACA;IACA,OAAOY,cAAc,GAAGZ,MAAM,CAACO,MAAM,IAAI,CAAC,IAAI,CAACM,WAAW,EAAE;MACxD,MAAMC,MAAM,GAAG,MAAM,IAAI,CAACf,MAAM,CAACgB,IAAI,CAAC,CAAC;MACvC,IAAID,MAAM,CAACE,IAAI,EAAE;QACb,IAAI,CAACH,WAAW,GAAG,IAAI;QACvB;MACJ;MACA,IAAIC,MAAM,CAACG,KAAK,EAAE;QACdL,cAAc,IAAI,IAAI,CAACX,UAAU,CAACD,MAAM,CAACS,QAAQ,CAACG,cAAc,CAAC,EAAEE,MAAM,CAACG,KAAK,CAAC;MACpF;IACJ;IACA,IAAI,CAACN,SAAS,IAAIC,cAAc,KAAK,CAAC,IAAI,IAAI,CAACC,WAAW,EAAE;MACxD,MAAM,IAAIlB,gBAAgB,CAAC,CAAC;IAChC;IACA,OAAOiB,cAAc;EACzB;EACAM,KAAKA,CAAA,EAAG;IACJ,IAAI,CAACC,WAAW,GAAG,IAAI;IACvB,OAAO,IAAI,CAACpB,MAAM,CAACqB,MAAM,CAAC,CAAC;EAC/B;EACA,MAAMC,KAAKA,CAAA,EAAG;IACV,MAAM,IAAI,CAACH,KAAK,CAAC,CAAC;IAClB,IAAI,CAACnB,MAAM,CAACuB,WAAW,CAAC,CAAC;EAC7B;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}