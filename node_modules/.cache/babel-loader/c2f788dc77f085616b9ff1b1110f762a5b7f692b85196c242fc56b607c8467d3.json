{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport { usersTable } from '@/idb/db';\nimport { JSH } from '@/core/helpers';\n// import { useOSIAppsStore } from '@/stores/os.apps.store';\nimport { useOsStore } from '@/stores/os.store';\nimport { appsConfig } from '@/config/applications';\nexport default {\n  name: \"TaskBar\",\n  props: {\n    USERID: {\n      type: Number,\n      default: 0\n    }\n  },\n  data() {\n    return {\n      currentTime: '',\n      currentDate: '',\n      timer: null,\n      showMenu: false,\n      USERApps: [],\n      USER: null,\n      GLangData: {}\n    };\n  },\n  provide() {\n    return {\n      reloadBar: this.reloadBar\n    };\n  },\n  async mounted() {\n    this.reloadBar();\n    // const GlobalLangPack = JSH.lang;\n    // const userLang = navigator.language || navigator.userLanguage;\n    // const userLangS = userLang.split('-')[0];\n    // this.UserLang = userLangS; \n\n    // this.GLangData = (userLangS && GlobalLangPack && GlobalLangPack[userLangS]) ? GlobalLangPack[userLangS] : GlobalLangPack.en;\n\n    // this.findUser();\n    // this.updateTime();\n    // this.timer = setInterval(this.updateTime, 1000);\n  },\n  computed: {\n    appManager_data() {\n      let resObj = {};\n      for (let i = 0; i < this.appsList.length; i++) {\n        if (this.appsList[i].id == 'osiappmanager') {\n          resObj = this.appsList[i];\n          break;\n        }\n      }\n      return resObj;\n    },\n    osStore() {\n      return useOsStore();\n    },\n    appsList() {\n      const SMApps = appsConfig.getStartMenuApps();\n      return SMApps.sort((n1, n2) => n1.label.toLowerCase() >= n2.label.toLowerCase() ? 1 : -1);\n    },\n    sortByType_appsList() {\n      const resultObj = {};\n      const apps = this.appsList;\n      apps.forEach(element => {\n        const category = element.category;\n        if (!resultObj[category]) {\n          resultObj[category] = [];\n        }\n        resultObj[category].push(element);\n      });\n      Object.keys(resultObj).forEach(key => {\n        resultObj[key].sort((a, b) => a.label - b.label);\n      });\n      return resultObj;\n    }\n  },\n  methods: {\n    async reloadBar() {\n      const GlobalLangPack = JSH.lang;\n      const userLang = navigator.language || navigator.userLanguage;\n      const userLangS = userLang.split('-')[0];\n      this.UserLang = userLangS;\n      this.GLangData = userLangS && GlobalLangPack && GlobalLangPack[userLangS] ? GlobalLangPack[userLangS] : GlobalLangPack.en;\n      await this.findUser();\n      this.updateTime();\n      this.timer = setInterval(this.updateTime, 1000);\n      const defAppsList = appsConfig.getAllApps();\n      const findUserApps = await usersTable.getApps(this.USERID);\n      this.apps = defAppsList;\n      this.USERApps = findUserApps ? findUserApps : defAppsList;\n    },\n    async findUser() {\n      try {\n        this.USER = await usersTable.getbyId(this.USERID);\n      } catch (error) {\n        console.error('Ошибка поиска пользователя:', error);\n        this.$toast.error('Не удалось загрузить данные пользователя');\n      }\n    },\n    getAvatarUrl(avatarName) {\n      const res = `url(${require('@/assets/avatars/' + avatarName)})`;\n      return res;\n    },\n    avatarStyle(avatarName) {\n      return {\n        backgroundImage: this.getAvatarUrl(avatarName),\n        backgroundSize: 'cover',\n        backgroundPosition: 'center'\n      };\n    },\n    updateTime() {\n      const now = new Date();\n      this.currentDate = now.toLocaleDateString();\n      this.currentTime = now.toLocaleTimeString('ru-RU', {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    },\n    toggleWindow(windowId) {\n      const window = this.osStore.windows.find(w => w.id === windowId);\n      if (window) {\n        console.log('window', window);\n        if (window.isMinimized) {\n          this.osStore.restoreWindow(windowId);\n        } else {\n          this.osStore.activateWindow(windowId);\n        }\n      }\n    },\n    toggleStartMenu() {\n      this.showMenu = !this.showMenu;\n    },\n    launchApp(appData) {\n      const appName = appData.name;\n      const contentApp = appData.contentapp;\n\n      // Ищем окно по windowId или по типу приложения\n      const existingWindow = this.osStore.windows.find(w => w.appName === appName && w.contentApp === contentApp);\n      if (existingWindow) {\n        // Если окно существует, активируем его\n        if (existingWindow.isMinimized) {\n          this.osStore.restoreWindow(existingWindow.id);\n        } else {\n          this.osStore.activateWindow(existingWindow.id);\n        }\n      } else {\n        // Создаем новое окно\n        this.osStore.openWindow({\n          ...appData,\n          defWidth: appData.defWidth || 800,\n          defHeight: appData.defHeight || 600\n        });\n      }\n    },\n    launchApp_byMenu(appData) {\n      this.launchApp(appData);\n      this.toggleStartMenu();\n    }\n  },\n  beforeUnmount() {\n    if (this.timer) {\n      clearInterval(this.timer);\n    }\n  }\n};","map":{"version":3,"names":["usersTable","JSH","useOsStore","appsConfig","name","props","USERID","type","Number","default","data","currentTime","currentDate","timer","showMenu","USERApps","USER","GLangData","provide","reloadBar","mounted","computed","appManager_data","resObj","i","appsList","length","id","osStore","SMApps","getStartMenuApps","sort","n1","n2","label","toLowerCase","sortByType_appsList","resultObj","apps","forEach","element","category","push","Object","keys","key","a","b","methods","GlobalLangPack","lang","userLang","navigator","language","userLanguage","userLangS","split","UserLang","en","findUser","updateTime","setInterval","defAppsList","getAllApps","findUserApps","getApps","getbyId","error","console","$toast","getAvatarUrl","avatarName","res","require","avatarStyle","backgroundImage","backgroundSize","backgroundPosition","now","Date","toLocaleDateString","toLocaleTimeString","hour","minute","toggleWindow","windowId","window","windows","find","w","log","isMinimized","restoreWindow","activateWindow","toggleStartMenu","launchApp","appData","appName","contentApp","contentapp","existingWindow","openWindow","defWidth","defHeight","launchApp_byMenu","beforeUnmount","clearInterval"],"sources":["/home/kup/my_projects/vue/osi/src/components/os/TaskBar/TaskBar.vue"],"sourcesContent":["<template src=\"./template.html\"></template>\n<style src=\"./style.css\"></style>\n<script>\n    import { usersTable } from '@/idb/db';\n    import { JSH } from '@/core/helpers';\n    // import { useOSIAppsStore } from '@/stores/os.apps.store';\n    import { useOsStore } from '@/stores/os.store';\n    import { appsConfig } from '@/config/applications';\n\n    export default {\n        name: \"TaskBar\",\n\n        props: {\n            USERID: {type: Number, default: 0}\n        },\n  \n        data() {\n            return {\n                currentTime: '',\n                currentDate: '',\n                timer: null,\n                showMenu: false,\n                USERApps: [],\n                USER: null,\n                GLangData: {},\n            };\n        },\n\n        provide() {\n            return {\n                reloadBar: this.reloadBar,\n            };\n        },\n\n        async mounted() {\n            this.reloadBar();\n            // const GlobalLangPack = JSH.lang;\n            // const userLang = navigator.language || navigator.userLanguage;\n            // const userLangS = userLang.split('-')[0];\n            // this.UserLang = userLangS; \n            \n            // this.GLangData = (userLangS && GlobalLangPack && GlobalLangPack[userLangS]) ? GlobalLangPack[userLangS] : GlobalLangPack.en;\n\n            // this.findUser();\n            // this.updateTime();\n            // this.timer = setInterval(this.updateTime, 1000);\n        },\n  \n        computed: {\n            appManager_data() {\n                let resObj = {};\n\n                for (let i = 0; i < this.appsList.length; i++) {\n                    if (this.appsList[i].id == 'osiappmanager') {\n                        resObj = this.appsList[i];\n                        break;\n                    }\n                }\n\n                return resObj;\n            },\n            osStore() {\n                return useOsStore();\n            },\n\n            appsList() {\n                const SMApps = appsConfig.getStartMenuApps();\n                return SMApps.sort((n1, n2) => (n1.label.toLowerCase() >= n2.label.toLowerCase()) ? 1 : -1);\n            },\n\n            sortByType_appsList() {\n                const resultObj = {};\n                const apps = this.appsList;\n                \n                apps.forEach(element => {\n                    const category = element.category;\n                    \n                    if (!resultObj[category]) { resultObj[category] = []; }\n                    resultObj[category].push(element);\n                });\n\n                Object.keys(resultObj).forEach(key => {\n                    resultObj[key].sort((a, b) => a.label - b.label);\n                });\n\n                return resultObj;\n            },\n        },\n  \n        methods: {\n            async reloadBar() {\n                const GlobalLangPack = JSH.lang;\n                const userLang = navigator.language || navigator.userLanguage;\n                const userLangS = userLang.split('-')[0];\n                this.UserLang = userLangS; \n                \n                this.GLangData = (userLangS && GlobalLangPack && GlobalLangPack[userLangS]) ? GlobalLangPack[userLangS] : GlobalLangPack.en;\n\n                await this.findUser();\n\n                this.updateTime();\n                this.timer = setInterval(this.updateTime, 1000);\n\n                const defAppsList = appsConfig.getAllApps();\n                const findUserApps = await usersTable.getApps(this.USERID);                \n\n                this.apps = defAppsList;\n                this.USERApps = (findUserApps) ? findUserApps : defAppsList;\n            },\n\n            async findUser() {\n                try {                    \n                    this.USER = await usersTable.getbyId(this.USERID);\n                } catch (error) {\n                    console.error('Ошибка поиска пользователя:', error);\n                    this.$toast.error('Не удалось загрузить данные пользователя');\n                }\n            },\n\n            getAvatarUrl(avatarName) {\n                const res = `url(${require('@/assets/avatars/' + avatarName)})`;\n                return res;\n            },\n\n            avatarStyle(avatarName) {\n                return {\n                    backgroundImage: this.getAvatarUrl(avatarName),\n                    backgroundSize: 'cover',\n                    backgroundPosition: 'center',\n                };\n            },\n\n            updateTime() {\n                const now = new Date();\n\n                this.currentDate = now.toLocaleDateString();\n                this.currentTime = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});\n            },\n    \n            toggleWindow(windowId) {\n                const window = this.osStore.windows.find(w => w.id === windowId);\n                \n                if (window) {\n                    console.log('window', window);\n                    if (window.isMinimized) {\n                        this.osStore.restoreWindow(windowId);\n                    } else {\n                        this.osStore.activateWindow(windowId);\n                    }\n                }\n            },\n    \n            toggleStartMenu() { this.showMenu = !this.showMenu; },\n\n            launchApp(appData) {\n                const appName = appData.name;\n                const contentApp = appData.contentapp;\n\n                // Ищем окно по windowId или по типу приложения\n                const existingWindow = this.osStore.windows.find(\n                    w => w.appName === appName && w.contentApp === contentApp\n                );\n                \n                if (existingWindow) {\n                    // Если окно существует, активируем его\n                    if (existingWindow.isMinimized) {\n                        this.osStore.restoreWindow(existingWindow.id);\n                    } else {\n                        this.osStore.activateWindow(existingWindow.id);\n                    }\n                } else {\n                    // Создаем новое окно\n                    this.osStore.openWindow({\n                        ...appData,\n                        defWidth: appData.defWidth || 800,\n                        defHeight: appData.defHeight || 600\n                    });\n                }\n            },\n\n            launchApp_byMenu(appData) {\n                this.launchApp(appData);\n                this.toggleStartMenu();\n            },\n        },\n  \n        beforeUnmount() {\n            if (this.timer) {\n                clearInterval(this.timer);\n            }\n        }\n    }\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}