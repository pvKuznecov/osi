{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport { defineStore } from 'pinia';\nimport { ref } from 'vue';\nexport const useAppsStore = defineStore('apps', () => {\n  // Храним состояния окон по их ID\n  const windowStates = ref({});\n  const LOCALSTORAGE_KEY = \"osi_app_store\";\n  const loadFromStorage = () => {\n    try {\n      const saved = localStorage.getItem(LOCALSTORAGE_KEY);\n      if (saved) {\n        const parsed = JSON.parse(saved);\n        windowStates.value = parsed || {};\n        console.log('Loaded app states from localStorage:', Object.keys(windowStates.value).length, 'windows');\n      }\n    } catch (error) {\n      console.error('Failed to load app states from localStorage:', error);\n      // В случае ошибки очищаем localStorage\n      localStorage.removeItem(LOCALSTORAGE_KEY);\n    }\n  };\n  const saveToStorage = () => {\n    try {\n      localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(windowStates.value));\n    } catch (error) {\n      console.error('Failed to save app states to localStorage:', error);\n    }\n  };\n  watch(windowStates, newStates => {\n    clearTimeout(windowStates.saveTimeout);\n    windowStates.saveTimeout = setTimeout(() => {\n      saveToStorage();\n    }, 500);\n  }, {\n    deep: true\n  });\n\n  // инициализыция local store\n  loadFromStorage();\n\n  // Сохранить состояние окна\n  const saveWindowState = (windowId, state) => {\n    if (!windowId) {\n      console.warn('Cannot save window state: windowId is required');\n      return;\n    }\n    windowStates.value[windowId] = {\n      ...windowStates.value[windowId],\n      ...state,\n      lastUpdated: Date.now(),\n      windowId: windowId\n    };\n    console.log('State saved for window:', windowId, windowStates.value[windowId]);\n  };\n\n  // Получить состояние окна\n  const getWindowState = windowId => {\n    if (!windowId) {\n      console.warn('Cannot get window state: windowId is required');\n      return null;\n    }\n    return windowStates.value[windowId] || null;\n  };\n\n  // Удалить состояние окна\n  const deleteWindowState = windowId => {\n    if (!windowId) {\n      console.warn('Cannot delete window state: windowId is required');\n      return;\n    }\n    delete windowStates.value[windowId];\n    console.log('State deleted for window:', windowId);\n  };\n\n  // Очистить все состояния\n  const clearAllStates = () => {\n    windowStates.value = {};\n    localStorage.removeItem(STORAGE_KEY);\n    console.log('All app states cleared');\n  };\n\n  // Получить состояние конкретного приложения по типу\n  const getAppState = (appType, windowId) => {\n    if (!windowId) return null;\n    const state = windowStates.value[windowId];\n    return state && state.appType === appType ? state : null;\n  };\n\n  // Получить все состояния определенного типа приложения\n  const getAllAppStates = appType => {\n    return Object.entries(windowStates.value).filter(([_, state]) => state.appType === appType).map(([windowId, state]) => ({\n      windowId,\n      ...state\n    }));\n  };\n\n  // Получить статистику по состояниям\n  const getStats = () => {\n    const windows = Object.keys(windowStates.value);\n    const byAppType = {};\n    windows.forEach(windowId => {\n      const state = windowStates.value[windowId];\n      const type = state?.appType || 'unknown';\n      byAppType[type] = (byAppType[type] || 0) + 1;\n    });\n    return {\n      totalWindows: windows.length,\n      byAppType,\n      lastUpdate: Math.max(...windows.map(id => windowStates.value[id]?.lastUpdated || 0))\n    };\n  };\n\n  // Экспортируем также функцию для ручного сохранения\n  const forceSave = () => {\n    saveToStorage();\n  };\n  return {\n    windowStates,\n    saveWindowState,\n    getWindowState,\n    deleteWindowState,\n    clearAllStates,\n    getAppState,\n    getAllAppStates,\n    getStats,\n    forceSave\n  };\n});","map":{"version":3,"names":["defineStore","ref","useAppsStore","windowStates","LOCALSTORAGE_KEY","loadFromStorage","saved","localStorage","getItem","parsed","JSON","parse","value","console","log","Object","keys","length","error","removeItem","saveToStorage","setItem","stringify","watch","newStates","clearTimeout","saveTimeout","setTimeout","deep","saveWindowState","windowId","state","warn","lastUpdated","Date","now","getWindowState","deleteWindowState","clearAllStates","STORAGE_KEY","getAppState","appType","getAllAppStates","entries","filter","_","map","getStats","windows","byAppType","forEach","type","totalWindows","lastUpdate","Math","max","id","forceSave"],"sources":["/home/kup/my_projects/vue/osi/src/stores/apps.store.js"],"sourcesContent":["import { defineStore } from 'pinia';\nimport { ref } from 'vue';\n\nexport const useAppsStore = defineStore('apps', () => {\n    // Храним состояния окон по их ID\n    const windowStates = ref({});\n\n    const LOCALSTORAGE_KEY = \"osi_app_store\";\n    const loadFromStorage = () => {\n        try {\n            const saved = localStorage.getItem(LOCALSTORAGE_KEY);\n            if (saved) {\n                const parsed = JSON.parse(saved);\n                windowStates.value = parsed || {};\n                console.log('Loaded app states from localStorage:', Object.keys(windowStates.value).length, 'windows');\n            }\n        } catch (error) {\n            console.error('Failed to load app states from localStorage:', error);\n            // В случае ошибки очищаем localStorage\n            localStorage.removeItem(LOCALSTORAGE_KEY);\n        }\n    };\n\n    const saveToStorage = () => {\n        try {\n            localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(windowStates.value));\n        } catch (error) {\n            console.error('Failed to save app states to localStorage:', error);\n        }\n    };\n\n    watch (\n        windowStates,\n        (newStates) => {\n             clearTimeout(windowStates.saveTimeout);\n            windowStates.saveTimeout = setTimeout(() => {\n                saveToStorage();\n            }, 500);\n        },\n        { deep: true }\n    );\n\n    // инициализыция local store\n    loadFromStorage();\n    \n    // Сохранить состояние окна\n    const saveWindowState = (windowId, state) => {\n        if (!windowId) {\n            console.warn('Cannot save window state: windowId is required');\n            return;\n        }\n        \n        windowStates.value[windowId] = {\n            ...windowStates.value[windowId],\n            ...state,\n            lastUpdated: Date.now(),\n            windowId: windowId\n        };\n        \n        console.log('State saved for window:', windowId, windowStates.value[windowId]);\n    };\n    \n    // Получить состояние окна\n    const getWindowState = (windowId) => {\n        if (!windowId) {\n            console.warn('Cannot get window state: windowId is required');\n            return null;\n        }\n        return windowStates.value[windowId] || null;\n    };\n    \n    // Удалить состояние окна\n    const deleteWindowState = (windowId) => {\n        if (!windowId) {\n            console.warn('Cannot delete window state: windowId is required');\n            return;\n        }\n        \n        delete windowStates.value[windowId];\n        console.log('State deleted for window:', windowId);\n    };\n    \n    // Очистить все состояния\n     const clearAllStates = () => {\n        windowStates.value = {};\n        localStorage.removeItem(STORAGE_KEY);\n        console.log('All app states cleared');\n    };\n    \n    // Получить состояние конкретного приложения по типу\n    const getAppState = (appType, windowId) => {\n        if (!windowId) return null;\n        const state = windowStates.value[windowId];\n        return state && state.appType === appType ? state : null;\n    };\n\n    // Получить все состояния определенного типа приложения\n    const getAllAppStates = (appType) => {\n        return Object.entries(windowStates.value).filter(([_, state]) => state.appType === appType).map(([windowId, state]) => ({ windowId, ...state }));\n    };\n    \n    // Получить статистику по состояниям\n    const getStats = () => {\n        const windows = Object.keys(windowStates.value);\n        const byAppType = {};\n        \n        windows.forEach(windowId => {\n            const state = windowStates.value[windowId];\n            const type = state?.appType || 'unknown';\n            byAppType[type] = (byAppType[type] || 0) + 1;\n        });\n        \n        return {\n            totalWindows: windows.length,\n            byAppType,\n            lastUpdate: Math.max(...windows.map(id => windowStates.value[id]?.lastUpdated || 0))\n        };\n    };\n    \n    // Экспортируем также функцию для ручного сохранения\n    const forceSave = () => {\n        saveToStorage();\n    };\n\n     return {\n        windowStates,\n        saveWindowState,\n        getWindowState,\n        deleteWindowState,\n        clearAllStates,\n        getAppState,\n        getAllAppStates,\n        getStats,\n        forceSave\n    };\n});"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}