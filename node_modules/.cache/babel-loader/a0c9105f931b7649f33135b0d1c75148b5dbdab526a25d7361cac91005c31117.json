{"ast":null,"code":"import _defineProperty from \"C:/projects/My projects/Vue/osi/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport \"core-js/modules/esnext.uint8-array.set-from-base64.js\";\nimport \"core-js/modules/esnext.uint8-array.set-from-hex.js\";\nimport \"core-js/modules/esnext.uint8-array.to-base64.js\";\nimport \"core-js/modules/esnext.uint8-array.to-hex.js\";\n/**\r\nPrimary entry point, Node.js specific entry point is index.js\r\n*/\n\nimport * as Token from 'token-types';\nimport * as strtok3 from 'strtok3/core';\nimport { ZipHandler, GzipHandler } from '@tokenizer/inflate';\nimport { getUintBE } from 'uint8array-extras';\nimport { stringToBytes, tarHeaderChecksumMatches, uint32SyncSafeToken } from './util.js';\nimport { extensions, mimeTypes } from './supported.js';\nexport const reasonableDetectionSizeInBytes = 4100; // A fair amount of file-types are detectable within this range.\n\nexport async function fileTypeFromStream(stream, options) {\n  return new FileTypeParser(options).fromStream(stream);\n}\nexport async function fileTypeFromBuffer(input, options) {\n  return new FileTypeParser(options).fromBuffer(input);\n}\nexport async function fileTypeFromBlob(blob, options) {\n  return new FileTypeParser(options).fromBlob(blob);\n}\nfunction getFileTypeFromMimeType(mimeType) {\n  mimeType = mimeType.toLowerCase();\n  switch (mimeType) {\n    case 'application/epub+zip':\n      return {\n        ext: 'epub',\n        mime: mimeType\n      };\n    case 'application/vnd.oasis.opendocument.text':\n      return {\n        ext: 'odt',\n        mime: mimeType\n      };\n    case 'application/vnd.oasis.opendocument.text-template':\n      return {\n        ext: 'ott',\n        mime: mimeType\n      };\n    case 'application/vnd.oasis.opendocument.spreadsheet':\n      return {\n        ext: 'ods',\n        mime: mimeType\n      };\n    case 'application/vnd.oasis.opendocument.spreadsheet-template':\n      return {\n        ext: 'ots',\n        mime: mimeType\n      };\n    case 'application/vnd.oasis.opendocument.presentation':\n      return {\n        ext: 'odp',\n        mime: mimeType\n      };\n    case 'application/vnd.oasis.opendocument.presentation-template':\n      return {\n        ext: 'otp',\n        mime: mimeType\n      };\n    case 'application/vnd.oasis.opendocument.graphics':\n      return {\n        ext: 'odg',\n        mime: mimeType\n      };\n    case 'application/vnd.oasis.opendocument.graphics-template':\n      return {\n        ext: 'otg',\n        mime: mimeType\n      };\n    case 'application/vnd.openxmlformats-officedocument.presentationml.slideshow':\n      return {\n        ext: 'ppsx',\n        mime: mimeType\n      };\n    case 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':\n      return {\n        ext: 'xlsx',\n        mime: mimeType\n      };\n    case 'application/vnd.ms-excel.sheet.macroenabled':\n      return {\n        ext: 'xlsm',\n        mime: 'application/vnd.ms-excel.sheet.macroenabled.12'\n      };\n    case 'application/vnd.openxmlformats-officedocument.spreadsheetml.template':\n      return {\n        ext: 'xltx',\n        mime: mimeType\n      };\n    case 'application/vnd.ms-excel.template.macroenabled':\n      return {\n        ext: 'xltm',\n        mime: 'application/vnd.ms-excel.template.macroenabled.12'\n      };\n    case 'application/vnd.ms-powerpoint.slideshow.macroenabled':\n      return {\n        ext: 'ppsm',\n        mime: 'application/vnd.ms-powerpoint.slideshow.macroenabled.12'\n      };\n    case 'application/vnd.openxmlformats-officedocument.wordprocessingml.document':\n      return {\n        ext: 'docx',\n        mime: mimeType\n      };\n    case 'application/vnd.ms-word.document.macroenabled':\n      return {\n        ext: 'docm',\n        mime: 'application/vnd.ms-word.document.macroenabled.12'\n      };\n    case 'application/vnd.openxmlformats-officedocument.wordprocessingml.template':\n      return {\n        ext: 'dotx',\n        mime: mimeType\n      };\n    case 'application/vnd.ms-word.template.macroenabledtemplate':\n      return {\n        ext: 'dotm',\n        mime: 'application/vnd.ms-word.template.macroenabled.12'\n      };\n    case 'application/vnd.openxmlformats-officedocument.presentationml.template':\n      return {\n        ext: 'potx',\n        mime: mimeType\n      };\n    case 'application/vnd.ms-powerpoint.template.macroenabled':\n      return {\n        ext: 'potm',\n        mime: 'application/vnd.ms-powerpoint.template.macroenabled.12'\n      };\n    case 'application/vnd.openxmlformats-officedocument.presentationml.presentation':\n      return {\n        ext: 'pptx',\n        mime: mimeType\n      };\n    case 'application/vnd.ms-powerpoint.presentation.macroenabled':\n      return {\n        ext: 'pptm',\n        mime: 'application/vnd.ms-powerpoint.presentation.macroenabled.12'\n      };\n    case 'application/vnd.ms-visio.drawing':\n      return {\n        ext: 'vsdx',\n        mime: 'application/vnd.visio'\n      };\n    case 'application/vnd.ms-package.3dmanufacturing-3dmodel+xml':\n      return {\n        ext: '3mf',\n        mime: 'model/3mf'\n      };\n    default:\n  }\n}\nfunction _check(buffer, headers, options) {\n  options = {\n    offset: 0,\n    ...options\n  };\n  for (const [index, header] of headers.entries()) {\n    // If a bitmask is set\n    if (options.mask) {\n      // If header doesn't equal `buf` with bits masked off\n      if (header !== (options.mask[index] & buffer[index + options.offset])) {\n        return false;\n      }\n    } else if (header !== buffer[index + options.offset]) {\n      return false;\n    }\n  }\n  return true;\n}\nexport async function fileTypeFromTokenizer(tokenizer, options) {\n  return new FileTypeParser(options).fromTokenizer(tokenizer);\n}\nexport async function fileTypeStream(webStream, options) {\n  return new FileTypeParser(options).toDetectionStream(webStream, options);\n}\nexport class FileTypeParser {\n  constructor(options) {\n    // Detections with a high degree of certainty in identifying the correct file type\n    _defineProperty(this, \"detectConfident\", async tokenizer => {\n      this.buffer = new Uint8Array(reasonableDetectionSizeInBytes);\n\n      // Keep reading until EOF if the file size is unknown.\n      if (tokenizer.fileInfo.size === undefined) {\n        tokenizer.fileInfo.size = Number.MAX_SAFE_INTEGER;\n      }\n      this.tokenizer = tokenizer;\n      await tokenizer.peekBuffer(this.buffer, {\n        length: 32,\n        mayBeLess: true\n      });\n\n      // -- 2-byte signatures --\n\n      if (this.check([0x42, 0x4D])) {\n        return {\n          ext: 'bmp',\n          mime: 'image/bmp'\n        };\n      }\n      if (this.check([0x0B, 0x77])) {\n        return {\n          ext: 'ac3',\n          mime: 'audio/vnd.dolby.dd-raw'\n        };\n      }\n      if (this.check([0x78, 0x01])) {\n        return {\n          ext: 'dmg',\n          mime: 'application/x-apple-diskimage'\n        };\n      }\n      if (this.check([0x4D, 0x5A])) {\n        return {\n          ext: 'exe',\n          mime: 'application/x-msdownload'\n        };\n      }\n      if (this.check([0x25, 0x21])) {\n        await tokenizer.peekBuffer(this.buffer, {\n          length: 24,\n          mayBeLess: true\n        });\n        if (this.checkString('PS-Adobe-', {\n          offset: 2\n        }) && this.checkString(' EPSF-', {\n          offset: 14\n        })) {\n          return {\n            ext: 'eps',\n            mime: 'application/eps'\n          };\n        }\n        return {\n          ext: 'ps',\n          mime: 'application/postscript'\n        };\n      }\n      if (this.check([0x1F, 0xA0]) || this.check([0x1F, 0x9D])) {\n        return {\n          ext: 'Z',\n          mime: 'application/x-compress'\n        };\n      }\n      if (this.check([0xC7, 0x71])) {\n        return {\n          ext: 'cpio',\n          mime: 'application/x-cpio'\n        };\n      }\n      if (this.check([0x60, 0xEA])) {\n        return {\n          ext: 'arj',\n          mime: 'application/x-arj'\n        };\n      }\n\n      // -- 3-byte signatures --\n\n      if (this.check([0xEF, 0xBB, 0xBF])) {\n        // UTF-8-BOM\n        // Strip off UTF-8-BOM\n        this.tokenizer.ignore(3);\n        return this.detectConfident(tokenizer);\n      }\n      if (this.check([0x47, 0x49, 0x46])) {\n        return {\n          ext: 'gif',\n          mime: 'image/gif'\n        };\n      }\n      if (this.check([0x49, 0x49, 0xBC])) {\n        return {\n          ext: 'jxr',\n          mime: 'image/vnd.ms-photo'\n        };\n      }\n      if (this.check([0x1F, 0x8B, 0x8])) {\n        const gzipHandler = new GzipHandler(tokenizer);\n        const stream = gzipHandler.inflate();\n        let shouldCancelStream = true;\n        try {\n          let compressedFileType;\n          try {\n            compressedFileType = await this.fromStream(stream);\n          } catch {\n            shouldCancelStream = false;\n          }\n          if (compressedFileType && compressedFileType.ext === 'tar') {\n            return {\n              ext: 'tar.gz',\n              mime: 'application/gzip'\n            };\n          }\n        } finally {\n          if (shouldCancelStream) {\n            await stream.cancel();\n          }\n        }\n        return {\n          ext: 'gz',\n          mime: 'application/gzip'\n        };\n      }\n      if (this.check([0x42, 0x5A, 0x68])) {\n        return {\n          ext: 'bz2',\n          mime: 'application/x-bzip2'\n        };\n      }\n      if (this.checkString('ID3')) {\n        await tokenizer.ignore(6); // Skip ID3 header until the header size\n        const id3HeaderLength = await tokenizer.readToken(uint32SyncSafeToken);\n        if (tokenizer.position + id3HeaderLength > tokenizer.fileInfo.size) {\n          // Guess file type based on ID3 header for backward compatibility\n          return {\n            ext: 'mp3',\n            mime: 'audio/mpeg'\n          };\n        }\n        await tokenizer.ignore(id3HeaderLength);\n        return this.fromTokenizer(tokenizer); // Skip ID3 header, recursion\n      }\n\n      // Musepack, SV7\n      if (this.checkString('MP+')) {\n        return {\n          ext: 'mpc',\n          mime: 'audio/x-musepack'\n        };\n      }\n      if ((this.buffer[0] === 0x43 || this.buffer[0] === 0x46) && this.check([0x57, 0x53], {\n        offset: 1\n      })) {\n        return {\n          ext: 'swf',\n          mime: 'application/x-shockwave-flash'\n        };\n      }\n\n      // -- 4-byte signatures --\n\n      // Requires a sample size of 4 bytes\n      if (this.check([0xFF, 0xD8, 0xFF])) {\n        if (this.check([0xF7], {\n          offset: 3\n        })) {\n          // JPG7/SOF55, indicating a ISO/IEC 14495 / JPEG-LS file\n          return {\n            ext: 'jls',\n            mime: 'image/jls'\n          };\n        }\n        return {\n          ext: 'jpg',\n          mime: 'image/jpeg'\n        };\n      }\n      if (this.check([0x4F, 0x62, 0x6A, 0x01])) {\n        return {\n          ext: 'avro',\n          mime: 'application/avro'\n        };\n      }\n      if (this.checkString('FLIF')) {\n        return {\n          ext: 'flif',\n          mime: 'image/flif'\n        };\n      }\n      if (this.checkString('8BPS')) {\n        return {\n          ext: 'psd',\n          mime: 'image/vnd.adobe.photoshop'\n        };\n      }\n\n      // Musepack, SV8\n      if (this.checkString('MPCK')) {\n        return {\n          ext: 'mpc',\n          mime: 'audio/x-musepack'\n        };\n      }\n      if (this.checkString('FORM')) {\n        return {\n          ext: 'aif',\n          mime: 'audio/aiff'\n        };\n      }\n      if (this.checkString('icns', {\n        offset: 0\n      })) {\n        return {\n          ext: 'icns',\n          mime: 'image/icns'\n        };\n      }\n\n      // Zip-based file formats\n      // Need to be before the `zip` check\n      if (this.check([0x50, 0x4B, 0x3, 0x4])) {\n        // Local file header signature\n        let fileType;\n        await new ZipHandler(tokenizer).unzip(zipHeader => {\n          switch (zipHeader.filename) {\n            case 'META-INF/mozilla.rsa':\n              fileType = {\n                ext: 'xpi',\n                mime: 'application/x-xpinstall'\n              };\n              return {\n                stop: true\n              };\n            case 'META-INF/MANIFEST.MF':\n              fileType = {\n                ext: 'jar',\n                mime: 'application/java-archive'\n              };\n              return {\n                stop: true\n              };\n            case 'mimetype':\n              return {\n                async handler(fileData) {\n                  // Use TextDecoder to decode the UTF-8 encoded data\n                  const mimeType = new TextDecoder('utf-8').decode(fileData).trim();\n                  fileType = getFileTypeFromMimeType(mimeType);\n                },\n                stop: true\n              };\n            case '[Content_Types].xml':\n              return {\n                async handler(fileData) {\n                  // Use TextDecoder to decode the UTF-8 encoded data\n                  let xmlContent = new TextDecoder('utf-8').decode(fileData);\n                  const endPos = xmlContent.indexOf('.main+xml\"');\n                  if (endPos === -1) {\n                    const mimeType = 'application/vnd.ms-package.3dmanufacturing-3dmodel+xml';\n                    if (xmlContent.includes(`ContentType=\"${mimeType}\"`)) {\n                      fileType = getFileTypeFromMimeType(mimeType);\n                    }\n                  } else {\n                    xmlContent = xmlContent.slice(0, Math.max(0, endPos));\n                    const firstPos = xmlContent.lastIndexOf('\"');\n                    const mimeType = xmlContent.slice(Math.max(0, firstPos + 1));\n                    fileType = getFileTypeFromMimeType(mimeType);\n                  }\n                },\n                stop: true\n              };\n            default:\n              if (/classes\\d*\\.dex/.test(zipHeader.filename)) {\n                fileType = {\n                  ext: 'apk',\n                  mime: 'application/vnd.android.package-archive'\n                };\n                return {\n                  stop: true\n                };\n              }\n              return {};\n          }\n        }).catch(error => {\n          if (!(error instanceof strtok3.EndOfStreamError)) {\n            throw error; // Re-throw non-EndOfStreamError\n          }\n        });\n        return fileType ?? {\n          ext: 'zip',\n          mime: 'application/zip'\n        };\n      }\n      if (this.checkString('OggS')) {\n        // This is an OGG container\n        await tokenizer.ignore(28);\n        const type = new Uint8Array(8);\n        await tokenizer.readBuffer(type);\n\n        // Needs to be before `ogg` check\n        if (_check(type, [0x4F, 0x70, 0x75, 0x73, 0x48, 0x65, 0x61, 0x64])) {\n          return {\n            ext: 'opus',\n            mime: 'audio/ogg; codecs=opus'\n          };\n        }\n\n        // If ' theora' in header.\n        if (_check(type, [0x80, 0x74, 0x68, 0x65, 0x6F, 0x72, 0x61])) {\n          return {\n            ext: 'ogv',\n            mime: 'video/ogg'\n          };\n        }\n\n        // If '\\x01video' in header.\n        if (_check(type, [0x01, 0x76, 0x69, 0x64, 0x65, 0x6F, 0x00])) {\n          return {\n            ext: 'ogm',\n            mime: 'video/ogg'\n          };\n        }\n\n        // If ' FLAC' in header  https://xiph.org/flac/faq.html\n        if (_check(type, [0x7F, 0x46, 0x4C, 0x41, 0x43])) {\n          return {\n            ext: 'oga',\n            mime: 'audio/ogg'\n          };\n        }\n\n        // 'Speex  ' in header https://en.wikipedia.org/wiki/Speex\n        if (_check(type, [0x53, 0x70, 0x65, 0x65, 0x78, 0x20, 0x20])) {\n          return {\n            ext: 'spx',\n            mime: 'audio/ogg'\n          };\n        }\n\n        // If '\\x01vorbis' in header\n        if (_check(type, [0x01, 0x76, 0x6F, 0x72, 0x62, 0x69, 0x73])) {\n          return {\n            ext: 'ogg',\n            mime: 'audio/ogg'\n          };\n        }\n\n        // Default OGG container https://www.iana.org/assignments/media-types/application/ogg\n        return {\n          ext: 'ogx',\n          mime: 'application/ogg'\n        };\n      }\n      if (this.check([0x50, 0x4B]) && (this.buffer[2] === 0x3 || this.buffer[2] === 0x5 || this.buffer[2] === 0x7) && (this.buffer[3] === 0x4 || this.buffer[3] === 0x6 || this.buffer[3] === 0x8)) {\n        return {\n          ext: 'zip',\n          mime: 'application/zip'\n        };\n      }\n      if (this.checkString('MThd')) {\n        return {\n          ext: 'mid',\n          mime: 'audio/midi'\n        };\n      }\n      if (this.checkString('wOFF') && (this.check([0x00, 0x01, 0x00, 0x00], {\n        offset: 4\n      }) || this.checkString('OTTO', {\n        offset: 4\n      }))) {\n        return {\n          ext: 'woff',\n          mime: 'font/woff'\n        };\n      }\n      if (this.checkString('wOF2') && (this.check([0x00, 0x01, 0x00, 0x00], {\n        offset: 4\n      }) || this.checkString('OTTO', {\n        offset: 4\n      }))) {\n        return {\n          ext: 'woff2',\n          mime: 'font/woff2'\n        };\n      }\n      if (this.check([0xD4, 0xC3, 0xB2, 0xA1]) || this.check([0xA1, 0xB2, 0xC3, 0xD4])) {\n        return {\n          ext: 'pcap',\n          mime: 'application/vnd.tcpdump.pcap'\n        };\n      }\n\n      // Sony DSD Stream File (DSF)\n      if (this.checkString('DSD ')) {\n        return {\n          ext: 'dsf',\n          mime: 'audio/x-dsf' // Non-standard\n        };\n      }\n      if (this.checkString('LZIP')) {\n        return {\n          ext: 'lz',\n          mime: 'application/x-lzip'\n        };\n      }\n      if (this.checkString('fLaC')) {\n        return {\n          ext: 'flac',\n          mime: 'audio/flac'\n        };\n      }\n      if (this.check([0x42, 0x50, 0x47, 0xFB])) {\n        return {\n          ext: 'bpg',\n          mime: 'image/bpg'\n        };\n      }\n      if (this.checkString('wvpk')) {\n        return {\n          ext: 'wv',\n          mime: 'audio/wavpack'\n        };\n      }\n      if (this.checkString('%PDF')) {\n        // Assume this is just a normal PDF\n        return {\n          ext: 'pdf',\n          mime: 'application/pdf'\n        };\n      }\n      if (this.check([0x00, 0x61, 0x73, 0x6D])) {\n        return {\n          ext: 'wasm',\n          mime: 'application/wasm'\n        };\n      }\n\n      // TIFF, little-endian type\n      if (this.check([0x49, 0x49])) {\n        const fileType = await this.readTiffHeader(false);\n        if (fileType) {\n          return fileType;\n        }\n      }\n\n      // TIFF, big-endian type\n      if (this.check([0x4D, 0x4D])) {\n        const fileType = await this.readTiffHeader(true);\n        if (fileType) {\n          return fileType;\n        }\n      }\n      if (this.checkString('MAC ')) {\n        return {\n          ext: 'ape',\n          mime: 'audio/ape'\n        };\n      }\n\n      // https://github.com/file/file/blob/master/magic/Magdir/matroska\n      if (this.check([0x1A, 0x45, 0xDF, 0xA3])) {\n        // Root element: EBML\n        async function readField() {\n          const msb = await tokenizer.peekNumber(Token.UINT8);\n          let mask = 0x80;\n          let ic = 0; // 0 = A, 1 = B, 2 = C, 3 = D\n\n          while ((msb & mask) === 0 && mask !== 0) {\n            ++ic;\n            mask >>= 1;\n          }\n          const id = new Uint8Array(ic + 1);\n          await tokenizer.readBuffer(id);\n          return id;\n        }\n        async function readElement() {\n          const idField = await readField();\n          const lengthField = await readField();\n          lengthField[0] ^= 0x80 >> lengthField.length - 1;\n          const nrLength = Math.min(6, lengthField.length); // JavaScript can max read 6 bytes integer\n\n          const idView = new DataView(idField.buffer);\n          const lengthView = new DataView(lengthField.buffer, lengthField.length - nrLength, nrLength);\n          return {\n            id: getUintBE(idView),\n            len: getUintBE(lengthView)\n          };\n        }\n        async function readChildren(children) {\n          while (children > 0) {\n            const element = await readElement();\n            if (element.id === 0x42_82) {\n              const rawValue = await tokenizer.readToken(new Token.StringType(element.len));\n              return rawValue.replaceAll(/\\00.*$/g, ''); // Return DocType\n            }\n            await tokenizer.ignore(element.len); // ignore payload\n            --children;\n          }\n        }\n        const re = await readElement();\n        const documentType = await readChildren(re.len);\n        switch (documentType) {\n          case 'webm':\n            return {\n              ext: 'webm',\n              mime: 'video/webm'\n            };\n          case 'matroska':\n            return {\n              ext: 'mkv',\n              mime: 'video/matroska'\n            };\n          default:\n            return;\n        }\n      }\n      if (this.checkString('SQLi')) {\n        return {\n          ext: 'sqlite',\n          mime: 'application/x-sqlite3'\n        };\n      }\n      if (this.check([0x4E, 0x45, 0x53, 0x1A])) {\n        return {\n          ext: 'nes',\n          mime: 'application/x-nintendo-nes-rom'\n        };\n      }\n      if (this.checkString('Cr24')) {\n        return {\n          ext: 'crx',\n          mime: 'application/x-google-chrome-extension'\n        };\n      }\n      if (this.checkString('MSCF') || this.checkString('ISc(')) {\n        return {\n          ext: 'cab',\n          mime: 'application/vnd.ms-cab-compressed'\n        };\n      }\n      if (this.check([0xED, 0xAB, 0xEE, 0xDB])) {\n        return {\n          ext: 'rpm',\n          mime: 'application/x-rpm'\n        };\n      }\n      if (this.check([0xC5, 0xD0, 0xD3, 0xC6])) {\n        return {\n          ext: 'eps',\n          mime: 'application/eps'\n        };\n      }\n      if (this.check([0x28, 0xB5, 0x2F, 0xFD])) {\n        return {\n          ext: 'zst',\n          mime: 'application/zstd'\n        };\n      }\n      if (this.check([0x7F, 0x45, 0x4C, 0x46])) {\n        return {\n          ext: 'elf',\n          mime: 'application/x-elf'\n        };\n      }\n      if (this.check([0x21, 0x42, 0x44, 0x4E])) {\n        return {\n          ext: 'pst',\n          mime: 'application/vnd.ms-outlook'\n        };\n      }\n      if (this.checkString('PAR1') || this.checkString('PARE')) {\n        return {\n          ext: 'parquet',\n          mime: 'application/vnd.apache.parquet'\n        };\n      }\n      if (this.checkString('ttcf')) {\n        return {\n          ext: 'ttc',\n          mime: 'font/collection'\n        };\n      }\n      if (this.check([0xCF, 0xFA, 0xED, 0xFE])) {\n        return {\n          ext: 'macho',\n          mime: 'application/x-mach-binary'\n        };\n      }\n      if (this.check([0x04, 0x22, 0x4D, 0x18])) {\n        return {\n          ext: 'lz4',\n          mime: 'application/x-lz4' // Invented by us\n        };\n      }\n      if (this.checkString('regf')) {\n        return {\n          ext: 'dat',\n          mime: 'application/x-ft-windows-registry-hive'\n        };\n      }\n\n      // -- 5-byte signatures --\n\n      if (this.check([0x4F, 0x54, 0x54, 0x4F, 0x00])) {\n        return {\n          ext: 'otf',\n          mime: 'font/otf'\n        };\n      }\n      if (this.checkString('#!AMR')) {\n        return {\n          ext: 'amr',\n          mime: 'audio/amr'\n        };\n      }\n      if (this.checkString('{\\\\rtf')) {\n        return {\n          ext: 'rtf',\n          mime: 'application/rtf'\n        };\n      }\n      if (this.check([0x46, 0x4C, 0x56, 0x01])) {\n        return {\n          ext: 'flv',\n          mime: 'video/x-flv'\n        };\n      }\n      if (this.checkString('IMPM')) {\n        return {\n          ext: 'it',\n          mime: 'audio/x-it'\n        };\n      }\n      if (this.checkString('-lh0-', {\n        offset: 2\n      }) || this.checkString('-lh1-', {\n        offset: 2\n      }) || this.checkString('-lh2-', {\n        offset: 2\n      }) || this.checkString('-lh3-', {\n        offset: 2\n      }) || this.checkString('-lh4-', {\n        offset: 2\n      }) || this.checkString('-lh5-', {\n        offset: 2\n      }) || this.checkString('-lh6-', {\n        offset: 2\n      }) || this.checkString('-lh7-', {\n        offset: 2\n      }) || this.checkString('-lzs-', {\n        offset: 2\n      }) || this.checkString('-lz4-', {\n        offset: 2\n      }) || this.checkString('-lz5-', {\n        offset: 2\n      }) || this.checkString('-lhd-', {\n        offset: 2\n      })) {\n        return {\n          ext: 'lzh',\n          mime: 'application/x-lzh-compressed'\n        };\n      }\n\n      // MPEG program stream (PS or MPEG-PS)\n      if (this.check([0x00, 0x00, 0x01, 0xBA])) {\n        //  MPEG-PS, MPEG-1 Part 1\n        if (this.check([0x21], {\n          offset: 4,\n          mask: [0xF1]\n        })) {\n          return {\n            ext: 'mpg',\n            // May also be .ps, .mpeg\n            mime: 'video/MP1S'\n          };\n        }\n\n        // MPEG-PS, MPEG-2 Part 1\n        if (this.check([0x44], {\n          offset: 4,\n          mask: [0xC4]\n        })) {\n          return {\n            ext: 'mpg',\n            // May also be .mpg, .m2p, .vob or .sub\n            mime: 'video/MP2P'\n          };\n        }\n      }\n      if (this.checkString('ITSF')) {\n        return {\n          ext: 'chm',\n          mime: 'application/vnd.ms-htmlhelp'\n        };\n      }\n      if (this.check([0xCA, 0xFE, 0xBA, 0xBE])) {\n        return {\n          ext: 'class',\n          mime: 'application/java-vm'\n        };\n      }\n      if (this.checkString('.RMF')) {\n        return {\n          ext: 'rm',\n          mime: 'application/vnd.rn-realmedia'\n        };\n      }\n\n      // -- 5-byte signatures --\n\n      if (this.checkString('DRACO')) {\n        return {\n          ext: 'drc',\n          mime: 'application/vnd.google.draco' // Invented by us\n        };\n      }\n\n      // -- 6-byte signatures --\n\n      if (this.check([0xFD, 0x37, 0x7A, 0x58, 0x5A, 0x00])) {\n        return {\n          ext: 'xz',\n          mime: 'application/x-xz'\n        };\n      }\n      if (this.checkString('<?xml ')) {\n        return {\n          ext: 'xml',\n          mime: 'application/xml'\n        };\n      }\n      if (this.check([0x37, 0x7A, 0xBC, 0xAF, 0x27, 0x1C])) {\n        return {\n          ext: '7z',\n          mime: 'application/x-7z-compressed'\n        };\n      }\n      if (this.check([0x52, 0x61, 0x72, 0x21, 0x1A, 0x7]) && (this.buffer[6] === 0x0 || this.buffer[6] === 0x1)) {\n        return {\n          ext: 'rar',\n          mime: 'application/x-rar-compressed'\n        };\n      }\n      if (this.checkString('solid ')) {\n        return {\n          ext: 'stl',\n          mime: 'model/stl'\n        };\n      }\n      if (this.checkString('AC')) {\n        const version = new Token.StringType(4, 'latin1').get(this.buffer, 2);\n        if (version.match('^d*') && version >= 1000 && version <= 1050) {\n          return {\n            ext: 'dwg',\n            mime: 'image/vnd.dwg'\n          };\n        }\n      }\n      if (this.checkString('070707')) {\n        return {\n          ext: 'cpio',\n          mime: 'application/x-cpio'\n        };\n      }\n\n      // -- 7-byte signatures --\n\n      if (this.checkString('BLENDER')) {\n        return {\n          ext: 'blend',\n          mime: 'application/x-blender'\n        };\n      }\n      if (this.checkString('!<arch>')) {\n        await tokenizer.ignore(8);\n        const string = await tokenizer.readToken(new Token.StringType(13, 'ascii'));\n        if (string === 'debian-binary') {\n          return {\n            ext: 'deb',\n            mime: 'application/x-deb'\n          };\n        }\n        return {\n          ext: 'ar',\n          mime: 'application/x-unix-archive'\n        };\n      }\n      if (this.checkString('WEBVTT') &&\n      // One of LF, CR, tab, space, or end of file must follow \"WEBVTT\" per the spec (see `fixture/fixture-vtt-*.vtt` for examples). Note that `\\0` is technically the null character (there is no such thing as an EOF character). However, checking for `\\0` gives us the same result as checking for the end of the stream.\n      ['\\n', '\\r', '\\t', ' ', '\\0'].some(char7 => this.checkString(char7, {\n        offset: 6\n      }))) {\n        return {\n          ext: 'vtt',\n          mime: 'text/vtt'\n        };\n      }\n\n      // -- 8-byte signatures --\n\n      if (this.check([0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A])) {\n        // APNG format (https://wiki.mozilla.org/APNG_Specification)\n        // 1. Find the first IDAT (image data) chunk (49 44 41 54)\n        // 2. Check if there is an \"acTL\" chunk before the IDAT one (61 63 54 4C)\n\n        // Offset calculated as follows:\n        // - 8 bytes: PNG signature\n        // - 4 (length) + 4 (chunk type) + 13 (chunk data) + 4 (CRC): IHDR chunk\n\n        await tokenizer.ignore(8); // ignore PNG signature\n\n        async function readChunkHeader() {\n          return {\n            length: await tokenizer.readToken(Token.INT32_BE),\n            type: await tokenizer.readToken(new Token.StringType(4, 'latin1'))\n          };\n        }\n        do {\n          const chunk = await readChunkHeader();\n          if (chunk.length < 0) {\n            return; // Invalid chunk length\n          }\n          switch (chunk.type) {\n            case 'IDAT':\n              return {\n                ext: 'png',\n                mime: 'image/png'\n              };\n            case 'acTL':\n              return {\n                ext: 'apng',\n                mime: 'image/apng'\n              };\n            default:\n              await tokenizer.ignore(chunk.length + 4);\n            // Ignore chunk-data + CRC\n          }\n        } while (tokenizer.position + 8 < tokenizer.fileInfo.size);\n        return {\n          ext: 'png',\n          mime: 'image/png'\n        };\n      }\n      if (this.check([0x41, 0x52, 0x52, 0x4F, 0x57, 0x31, 0x00, 0x00])) {\n        return {\n          ext: 'arrow',\n          mime: 'application/vnd.apache.arrow.file'\n        };\n      }\n      if (this.check([0x67, 0x6C, 0x54, 0x46, 0x02, 0x00, 0x00, 0x00])) {\n        return {\n          ext: 'glb',\n          mime: 'model/gltf-binary'\n        };\n      }\n\n      // `mov` format variants\n      if (this.check([0x66, 0x72, 0x65, 0x65], {\n        offset: 4\n      }) // `free`\n      || this.check([0x6D, 0x64, 0x61, 0x74], {\n        offset: 4\n      }) // `mdat` MJPEG\n      || this.check([0x6D, 0x6F, 0x6F, 0x76], {\n        offset: 4\n      }) // `moov`\n      || this.check([0x77, 0x69, 0x64, 0x65], {\n        offset: 4\n      }) // `wide`\n      ) {\n        return {\n          ext: 'mov',\n          mime: 'video/quicktime'\n        };\n      }\n\n      // -- 9-byte signatures --\n\n      if (this.check([0x49, 0x49, 0x52, 0x4F, 0x08, 0x00, 0x00, 0x00, 0x18])) {\n        return {\n          ext: 'orf',\n          mime: 'image/x-olympus-orf'\n        };\n      }\n      if (this.checkString('gimp xcf ')) {\n        return {\n          ext: 'xcf',\n          mime: 'image/x-xcf'\n        };\n      }\n\n      // File Type Box (https://en.wikipedia.org/wiki/ISO_base_media_file_format)\n      // It's not required to be first, but it's recommended to be. Almost all ISO base media files start with `ftyp` box.\n      // `ftyp` box must contain a brand major identifier, which must consist of ISO 8859-1 printable characters.\n      // Here we check for 8859-1 printable characters (for simplicity, it's a mask which also catches one non-printable character).\n      if (this.checkString('ftyp', {\n        offset: 4\n      }) && (this.buffer[8] & 0x60) !== 0x00 // Brand major, first character ASCII?\n      ) {\n        // They all can have MIME `video/mp4` except `application/mp4` special-case which is hard to detect.\n        // For some cases, we're specific, everything else falls to `video/mp4` with `mp4` extension.\n        const brandMajor = new Token.StringType(4, 'latin1').get(this.buffer, 8).replace('\\0', ' ').trim();\n        switch (brandMajor) {\n          case 'avif':\n          case 'avis':\n            return {\n              ext: 'avif',\n              mime: 'image/avif'\n            };\n          case 'mif1':\n            return {\n              ext: 'heic',\n              mime: 'image/heif'\n            };\n          case 'msf1':\n            return {\n              ext: 'heic',\n              mime: 'image/heif-sequence'\n            };\n          case 'heic':\n          case 'heix':\n            return {\n              ext: 'heic',\n              mime: 'image/heic'\n            };\n          case 'hevc':\n          case 'hevx':\n            return {\n              ext: 'heic',\n              mime: 'image/heic-sequence'\n            };\n          case 'qt':\n            return {\n              ext: 'mov',\n              mime: 'video/quicktime'\n            };\n          case 'M4V':\n          case 'M4VH':\n          case 'M4VP':\n            return {\n              ext: 'm4v',\n              mime: 'video/x-m4v'\n            };\n          case 'M4P':\n            return {\n              ext: 'm4p',\n              mime: 'video/mp4'\n            };\n          case 'M4B':\n            return {\n              ext: 'm4b',\n              mime: 'audio/mp4'\n            };\n          case 'M4A':\n            return {\n              ext: 'm4a',\n              mime: 'audio/x-m4a'\n            };\n          case 'F4V':\n            return {\n              ext: 'f4v',\n              mime: 'video/mp4'\n            };\n          case 'F4P':\n            return {\n              ext: 'f4p',\n              mime: 'video/mp4'\n            };\n          case 'F4A':\n            return {\n              ext: 'f4a',\n              mime: 'audio/mp4'\n            };\n          case 'F4B':\n            return {\n              ext: 'f4b',\n              mime: 'audio/mp4'\n            };\n          case 'crx':\n            return {\n              ext: 'cr3',\n              mime: 'image/x-canon-cr3'\n            };\n          default:\n            if (brandMajor.startsWith('3g')) {\n              if (brandMajor.startsWith('3g2')) {\n                return {\n                  ext: '3g2',\n                  mime: 'video/3gpp2'\n                };\n              }\n              return {\n                ext: '3gp',\n                mime: 'video/3gpp'\n              };\n            }\n            return {\n              ext: 'mp4',\n              mime: 'video/mp4'\n            };\n        }\n      }\n\n      // -- 10-byte signatures --\n\n      if (this.checkString('REGEDIT4\\r\\n')) {\n        return {\n          ext: 'reg',\n          mime: 'application/x-ms-regedit'\n        };\n      }\n\n      // -- 12-byte signatures --\n\n      // RIFF file format which might be AVI, WAV, QCP, etc\n      if (this.check([0x52, 0x49, 0x46, 0x46])) {\n        if (this.checkString('WEBP', {\n          offset: 8\n        })) {\n          return {\n            ext: 'webp',\n            mime: 'image/webp'\n          };\n        }\n        if (this.check([0x41, 0x56, 0x49], {\n          offset: 8\n        })) {\n          return {\n            ext: 'avi',\n            mime: 'video/vnd.avi'\n          };\n        }\n        if (this.check([0x57, 0x41, 0x56, 0x45], {\n          offset: 8\n        })) {\n          return {\n            ext: 'wav',\n            mime: 'audio/wav'\n          };\n        }\n\n        // QLCM, QCP file\n        if (this.check([0x51, 0x4C, 0x43, 0x4D], {\n          offset: 8\n        })) {\n          return {\n            ext: 'qcp',\n            mime: 'audio/qcelp'\n          };\n        }\n      }\n      if (this.check([0x49, 0x49, 0x55, 0x00, 0x18, 0x00, 0x00, 0x00, 0x88, 0xE7, 0x74, 0xD8])) {\n        return {\n          ext: 'rw2',\n          mime: 'image/x-panasonic-rw2'\n        };\n      }\n\n      // ASF_Header_Object first 80 bytes\n      if (this.check([0x30, 0x26, 0xB2, 0x75, 0x8E, 0x66, 0xCF, 0x11, 0xA6, 0xD9])) {\n        async function readHeader() {\n          const guid = new Uint8Array(16);\n          await tokenizer.readBuffer(guid);\n          return {\n            id: guid,\n            size: Number(await tokenizer.readToken(Token.UINT64_LE))\n          };\n        }\n        await tokenizer.ignore(30);\n        // Search for header should be in first 1KB of file.\n        while (tokenizer.position + 24 < tokenizer.fileInfo.size) {\n          const header = await readHeader();\n          let payload = header.size - 24;\n          if (_check(header.id, [0x91, 0x07, 0xDC, 0xB7, 0xB7, 0xA9, 0xCF, 0x11, 0x8E, 0xE6, 0x00, 0xC0, 0x0C, 0x20, 0x53, 0x65])) {\n            // Sync on Stream-Properties-Object (B7DC0791-A9B7-11CF-8EE6-00C00C205365)\n            const typeId = new Uint8Array(16);\n            payload -= await tokenizer.readBuffer(typeId);\n            if (_check(typeId, [0x40, 0x9E, 0x69, 0xF8, 0x4D, 0x5B, 0xCF, 0x11, 0xA8, 0xFD, 0x00, 0x80, 0x5F, 0x5C, 0x44, 0x2B])) {\n              // Found audio:\n              return {\n                ext: 'asf',\n                mime: 'audio/x-ms-asf'\n              };\n            }\n            if (_check(typeId, [0xC0, 0xEF, 0x19, 0xBC, 0x4D, 0x5B, 0xCF, 0x11, 0xA8, 0xFD, 0x00, 0x80, 0x5F, 0x5C, 0x44, 0x2B])) {\n              // Found video:\n              return {\n                ext: 'asf',\n                mime: 'video/x-ms-asf'\n              };\n            }\n            break;\n          }\n          await tokenizer.ignore(payload);\n        }\n\n        // Default to ASF generic extension\n        return {\n          ext: 'asf',\n          mime: 'application/vnd.ms-asf'\n        };\n      }\n      if (this.check([0xAB, 0x4B, 0x54, 0x58, 0x20, 0x31, 0x31, 0xBB, 0x0D, 0x0A, 0x1A, 0x0A])) {\n        return {\n          ext: 'ktx',\n          mime: 'image/ktx'\n        };\n      }\n      if ((this.check([0x7E, 0x10, 0x04]) || this.check([0x7E, 0x18, 0x04])) && this.check([0x30, 0x4D, 0x49, 0x45], {\n        offset: 4\n      })) {\n        return {\n          ext: 'mie',\n          mime: 'application/x-mie'\n        };\n      }\n      if (this.check([0x27, 0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], {\n        offset: 2\n      })) {\n        return {\n          ext: 'shp',\n          mime: 'application/x-esri-shape'\n        };\n      }\n      if (this.check([0xFF, 0x4F, 0xFF, 0x51])) {\n        return {\n          ext: 'j2c',\n          mime: 'image/j2c'\n        };\n      }\n      if (this.check([0x00, 0x00, 0x00, 0x0C, 0x6A, 0x50, 0x20, 0x20, 0x0D, 0x0A, 0x87, 0x0A])) {\n        // JPEG-2000 family\n\n        await tokenizer.ignore(20);\n        const type = await tokenizer.readToken(new Token.StringType(4, 'ascii'));\n        switch (type) {\n          case 'jp2 ':\n            return {\n              ext: 'jp2',\n              mime: 'image/jp2'\n            };\n          case 'jpx ':\n            return {\n              ext: 'jpx',\n              mime: 'image/jpx'\n            };\n          case 'jpm ':\n            return {\n              ext: 'jpm',\n              mime: 'image/jpm'\n            };\n          case 'mjp2':\n            return {\n              ext: 'mj2',\n              mime: 'image/mj2'\n            };\n          default:\n            return;\n        }\n      }\n      if (this.check([0xFF, 0x0A]) || this.check([0x00, 0x00, 0x00, 0x0C, 0x4A, 0x58, 0x4C, 0x20, 0x0D, 0x0A, 0x87, 0x0A])) {\n        return {\n          ext: 'jxl',\n          mime: 'image/jxl'\n        };\n      }\n      if (this.check([0xFE, 0xFF])) {\n        // UTF-16-BOM-BE\n        if (this.checkString('<?xml ', {\n          offset: 2,\n          encoding: 'utf-16be'\n        })) {\n          return {\n            ext: 'xml',\n            mime: 'application/xml'\n          };\n        }\n        return undefined; // Some unknown text based format\n      }\n      if (this.check([0xD0, 0xCF, 0x11, 0xE0, 0xA1, 0xB1, 0x1A, 0xE1])) {\n        // Detected Microsoft Compound File Binary File (MS-CFB) Format.\n        return {\n          ext: 'cfb',\n          mime: 'application/x-cfb'\n        };\n      }\n\n      // Increase sample size from 32 to 256.\n      await tokenizer.peekBuffer(this.buffer, {\n        length: Math.min(256, tokenizer.fileInfo.size),\n        mayBeLess: true\n      });\n      if (this.check([0x61, 0x63, 0x73, 0x70], {\n        offset: 36\n      })) {\n        return {\n          ext: 'icc',\n          mime: 'application/vnd.iccprofile'\n        };\n      }\n\n      // ACE: requires 14 bytes in the buffer\n      if (this.checkString('**ACE', {\n        offset: 7\n      }) && this.checkString('**', {\n        offset: 12\n      })) {\n        return {\n          ext: 'ace',\n          mime: 'application/x-ace-compressed'\n        };\n      }\n\n      // -- 15-byte signatures --\n\n      if (this.checkString('BEGIN:')) {\n        if (this.checkString('VCARD', {\n          offset: 6\n        })) {\n          return {\n            ext: 'vcf',\n            mime: 'text/vcard'\n          };\n        }\n        if (this.checkString('VCALENDAR', {\n          offset: 6\n        })) {\n          return {\n            ext: 'ics',\n            mime: 'text/calendar'\n          };\n        }\n      }\n\n      // `raf` is here just to keep all the raw image detectors together.\n      if (this.checkString('FUJIFILMCCD-RAW')) {\n        return {\n          ext: 'raf',\n          mime: 'image/x-fujifilm-raf'\n        };\n      }\n      if (this.checkString('Extended Module:')) {\n        return {\n          ext: 'xm',\n          mime: 'audio/x-xm'\n        };\n      }\n      if (this.checkString('Creative Voice File')) {\n        return {\n          ext: 'voc',\n          mime: 'audio/x-voc'\n        };\n      }\n      if (this.check([0x04, 0x00, 0x00, 0x00]) && this.buffer.length >= 16) {\n        // Rough & quick check Pickle/ASAR\n        const jsonSize = new DataView(this.buffer.buffer).getUint32(12, true);\n        if (jsonSize > 12 && this.buffer.length >= jsonSize + 16) {\n          try {\n            const header = new TextDecoder().decode(this.buffer.subarray(16, jsonSize + 16));\n            const json = JSON.parse(header);\n            // Check if Pickle is ASAR\n            if (json.files) {\n              // Final check, assuring Pickle/ASAR format\n              return {\n                ext: 'asar',\n                mime: 'application/x-asar'\n              };\n            }\n          } catch {}\n        }\n      }\n      if (this.check([0x06, 0x0E, 0x2B, 0x34, 0x02, 0x05, 0x01, 0x01, 0x0D, 0x01, 0x02, 0x01, 0x01, 0x02])) {\n        return {\n          ext: 'mxf',\n          mime: 'application/mxf'\n        };\n      }\n      if (this.checkString('SCRM', {\n        offset: 44\n      })) {\n        return {\n          ext: 's3m',\n          mime: 'audio/x-s3m'\n        };\n      }\n\n      // Raw MPEG-2 transport stream (188-byte packets)\n      if (this.check([0x47]) && this.check([0x47], {\n        offset: 188\n      })) {\n        return {\n          ext: 'mts',\n          mime: 'video/mp2t'\n        };\n      }\n\n      // Blu-ray Disc Audio-Video (BDAV) MPEG-2 transport stream has 4-byte TP_extra_header before each 188-byte packet\n      if (this.check([0x47], {\n        offset: 4\n      }) && this.check([0x47], {\n        offset: 196\n      })) {\n        return {\n          ext: 'mts',\n          mime: 'video/mp2t'\n        };\n      }\n      if (this.check([0x42, 0x4F, 0x4F, 0x4B, 0x4D, 0x4F, 0x42, 0x49], {\n        offset: 60\n      })) {\n        return {\n          ext: 'mobi',\n          mime: 'application/x-mobipocket-ebook'\n        };\n      }\n      if (this.check([0x44, 0x49, 0x43, 0x4D], {\n        offset: 128\n      })) {\n        return {\n          ext: 'dcm',\n          mime: 'application/dicom'\n        };\n      }\n      if (this.check([0x4C, 0x00, 0x00, 0x00, 0x01, 0x14, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x46])) {\n        return {\n          ext: 'lnk',\n          mime: 'application/x.ms.shortcut' // Invented by us\n        };\n      }\n      if (this.check([0x62, 0x6F, 0x6F, 0x6B, 0x00, 0x00, 0x00, 0x00, 0x6D, 0x61, 0x72, 0x6B, 0x00, 0x00, 0x00, 0x00])) {\n        return {\n          ext: 'alias',\n          mime: 'application/x.apple.alias' // Invented by us\n        };\n      }\n      if (this.checkString('Kaydara FBX Binary  \\u0000')) {\n        return {\n          ext: 'fbx',\n          mime: 'application/x.autodesk.fbx' // Invented by us\n        };\n      }\n      if (this.check([0x4C, 0x50], {\n        offset: 34\n      }) && (this.check([0x00, 0x00, 0x01], {\n        offset: 8\n      }) || this.check([0x01, 0x00, 0x02], {\n        offset: 8\n      }) || this.check([0x02, 0x00, 0x02], {\n        offset: 8\n      }))) {\n        return {\n          ext: 'eot',\n          mime: 'application/vnd.ms-fontobject'\n        };\n      }\n      if (this.check([0x06, 0x06, 0xED, 0xF5, 0xD8, 0x1D, 0x46, 0xE5, 0xBD, 0x31, 0xEF, 0xE7, 0xFE, 0x74, 0xB7, 0x1D])) {\n        return {\n          ext: 'indd',\n          mime: 'application/x-indesign'\n        };\n      }\n\n      // Increase sample size from 256 to 512\n      await tokenizer.peekBuffer(this.buffer, {\n        length: Math.min(512, tokenizer.fileInfo.size),\n        mayBeLess: true\n      });\n\n      // Requires a buffer size of 512 bytes\n      if (this.checkString('ustar', {\n        offset: 257\n      }) && (this.checkString('\\0', {\n        offset: 262\n      }) || this.checkString(' ', {\n        offset: 262\n      })) || this.check([0, 0, 0, 0, 0, 0], {\n        offset: 257\n      }) && tarHeaderChecksumMatches(this.buffer)) {\n        return {\n          ext: 'tar',\n          mime: 'application/x-tar'\n        };\n      }\n      if (this.check([0xFF, 0xFE])) {\n        // UTF-16-BOM-LE\n        const encoding = 'utf-16le';\n        if (this.checkString('<?xml ', {\n          offset: 2,\n          encoding\n        })) {\n          return {\n            ext: 'xml',\n            mime: 'application/xml'\n          };\n        }\n        if (this.check([0xFF, 0x0E], {\n          offset: 2\n        }) && this.checkString('SketchUp Model', {\n          offset: 4,\n          encoding\n        })) {\n          return {\n            ext: 'skp',\n            mime: 'application/vnd.sketchup.skp'\n          };\n        }\n        if (this.checkString('Windows Registry Editor Version 5.00\\r\\n', {\n          offset: 2,\n          encoding\n        })) {\n          return {\n            ext: 'reg',\n            mime: 'application/x-ms-regedit'\n          };\n        }\n        return undefined; // Some text based format\n      }\n      if (this.checkString('-----BEGIN PGP MESSAGE-----')) {\n        return {\n          ext: 'pgp',\n          mime: 'application/pgp-encrypted'\n        };\n      }\n    });\n    // Detections with limited supporting data, resulting in a higher likelihood of false positives\n    _defineProperty(this, \"detectImprecise\", async tokenizer => {\n      this.buffer = new Uint8Array(reasonableDetectionSizeInBytes);\n\n      // Read initial sample size of 8 bytes\n      await tokenizer.peekBuffer(this.buffer, {\n        length: Math.min(8, tokenizer.fileInfo.size),\n        mayBeLess: true\n      });\n      if (this.check([0x0, 0x0, 0x1, 0xBA]) || this.check([0x0, 0x0, 0x1, 0xB3])) {\n        return {\n          ext: 'mpg',\n          mime: 'video/mpeg'\n        };\n      }\n      if (this.check([0x00, 0x01, 0x00, 0x00, 0x00])) {\n        return {\n          ext: 'ttf',\n          mime: 'font/ttf'\n        };\n      }\n      if (this.check([0x00, 0x00, 0x01, 0x00])) {\n        return {\n          ext: 'ico',\n          mime: 'image/x-icon'\n        };\n      }\n      if (this.check([0x00, 0x00, 0x02, 0x00])) {\n        return {\n          ext: 'cur',\n          mime: 'image/x-icon'\n        };\n      }\n\n      // Adjust buffer to `mpegOffsetTolerance`\n      await tokenizer.peekBuffer(this.buffer, {\n        length: Math.min(2 + this.options.mpegOffsetTolerance, tokenizer.fileInfo.size),\n        mayBeLess: true\n      });\n\n      // Check MPEG 1 or 2 Layer 3 header, or 'layer 0' for ADTS (MPEG sync-word 0xFFE)\n      if (this.buffer.length >= 2 + this.options.mpegOffsetTolerance) {\n        for (let depth = 0; depth <= this.options.mpegOffsetTolerance; ++depth) {\n          const type = this.scanMpeg(depth);\n          if (type) {\n            return type;\n          }\n        }\n      }\n    });\n    this.options = {\n      mpegOffsetTolerance: 0,\n      ...options\n    };\n    this.detectors = [...(options?.customDetectors ?? []), {\n      id: 'core',\n      detect: this.detectConfident\n    }, {\n      id: 'core.imprecise',\n      detect: this.detectImprecise\n    }];\n    this.tokenizerOptions = {\n      abortSignal: options?.signal\n    };\n  }\n  async fromTokenizer(tokenizer) {\n    const initialPosition = tokenizer.position;\n\n    // Iterate through all file-type detectors\n    for (const detector of this.detectors) {\n      const fileType = await detector.detect(tokenizer);\n      if (fileType) {\n        return fileType;\n      }\n      if (initialPosition !== tokenizer.position) {\n        return undefined; // Cannot proceed scanning of the tokenizer is at an arbitrary position\n      }\n    }\n  }\n  async fromBuffer(input) {\n    if (!(input instanceof Uint8Array || input instanceof ArrayBuffer)) {\n      throw new TypeError(`Expected the \\`input\\` argument to be of type \\`Uint8Array\\` or \\`ArrayBuffer\\`, got \\`${typeof input}\\``);\n    }\n    const buffer = input instanceof Uint8Array ? input : new Uint8Array(input);\n    if (!(buffer?.length > 1)) {\n      return;\n    }\n    return this.fromTokenizer(strtok3.fromBuffer(buffer, this.tokenizerOptions));\n  }\n  async fromBlob(blob) {\n    const tokenizer = strtok3.fromBlob(blob, this.tokenizerOptions);\n    try {\n      return await this.fromTokenizer(tokenizer);\n    } finally {\n      await tokenizer.close();\n    }\n  }\n  async fromStream(stream) {\n    const tokenizer = strtok3.fromWebStream(stream, this.tokenizerOptions);\n    try {\n      return await this.fromTokenizer(tokenizer);\n    } finally {\n      await tokenizer.close();\n    }\n  }\n  async toDetectionStream(stream, options) {\n    const {\n      sampleSize = reasonableDetectionSizeInBytes\n    } = options;\n    let detectedFileType;\n    let firstChunk;\n    const reader = stream.getReader({\n      mode: 'byob'\n    });\n    try {\n      // Read the first chunk from the stream\n      const {\n        value: chunk,\n        done\n      } = await reader.read(new Uint8Array(sampleSize));\n      firstChunk = chunk;\n      if (!done && chunk) {\n        try {\n          // Attempt to detect the file type from the chunk\n          detectedFileType = await this.fromBuffer(chunk.subarray(0, sampleSize));\n        } catch (error) {\n          if (!(error instanceof strtok3.EndOfStreamError)) {\n            throw error; // Re-throw non-EndOfStreamError\n          }\n          detectedFileType = undefined;\n        }\n      }\n      firstChunk = chunk;\n    } finally {\n      reader.releaseLock(); // Ensure the reader is released\n    }\n\n    // Create a new ReadableStream to manage locking issues\n    const transformStream = new TransformStream({\n      async start(controller) {\n        controller.enqueue(firstChunk); // Enqueue the initial chunk\n      },\n      transform(chunk, controller) {\n        // Pass through the chunks without modification\n        controller.enqueue(chunk);\n      }\n    });\n    const newStream = stream.pipeThrough(transformStream);\n    newStream.fileType = detectedFileType;\n    return newStream;\n  }\n  check(header, options) {\n    return _check(this.buffer, header, options);\n  }\n  checkString(header, options) {\n    return this.check(stringToBytes(header, options?.encoding), options);\n  }\n  async readTiffTag(bigEndian) {\n    const tagId = await this.tokenizer.readToken(bigEndian ? Token.UINT16_BE : Token.UINT16_LE);\n    this.tokenizer.ignore(10);\n    switch (tagId) {\n      case 50_341:\n        return {\n          ext: 'arw',\n          mime: 'image/x-sony-arw'\n        };\n      case 50_706:\n        return {\n          ext: 'dng',\n          mime: 'image/x-adobe-dng'\n        };\n      default:\n    }\n  }\n  async readTiffIFD(bigEndian) {\n    const numberOfTags = await this.tokenizer.readToken(bigEndian ? Token.UINT16_BE : Token.UINT16_LE);\n    for (let n = 0; n < numberOfTags; ++n) {\n      const fileType = await this.readTiffTag(bigEndian);\n      if (fileType) {\n        return fileType;\n      }\n    }\n  }\n  async readTiffHeader(bigEndian) {\n    const version = (bigEndian ? Token.UINT16_BE : Token.UINT16_LE).get(this.buffer, 2);\n    const ifdOffset = (bigEndian ? Token.UINT32_BE : Token.UINT32_LE).get(this.buffer, 4);\n    if (version === 42) {\n      // TIFF file header\n      if (ifdOffset >= 6) {\n        if (this.checkString('CR', {\n          offset: 8\n        })) {\n          return {\n            ext: 'cr2',\n            mime: 'image/x-canon-cr2'\n          };\n        }\n        if (ifdOffset >= 8) {\n          const someId1 = (bigEndian ? Token.UINT16_BE : Token.UINT16_LE).get(this.buffer, 8);\n          const someId2 = (bigEndian ? Token.UINT16_BE : Token.UINT16_LE).get(this.buffer, 10);\n          if (someId1 === 0x1C && someId2 === 0xFE || someId1 === 0x1F && someId2 === 0x0B) {\n            return {\n              ext: 'nef',\n              mime: 'image/x-nikon-nef'\n            };\n          }\n        }\n      }\n      await this.tokenizer.ignore(ifdOffset);\n      const fileType = await this.readTiffIFD(bigEndian);\n      return fileType ?? {\n        ext: 'tif',\n        mime: 'image/tiff'\n      };\n    }\n    if (version === 43) {\n      // Big TIFF file header\n      return {\n        ext: 'tif',\n        mime: 'image/tiff'\n      };\n    }\n  }\n\n  /**\r\n  Scan check MPEG 1 or 2 Layer 3 header, or 'layer 0' for ADTS (MPEG sync-word 0xFFE).\r\n  \n  @param offset - Offset to scan for sync-preamble.\r\n  @returns {{ext: string, mime: string}}\r\n  */\n  scanMpeg(offset) {\n    if (this.check([0xFF, 0xE0], {\n      offset,\n      mask: [0xFF, 0xE0]\n    })) {\n      if (this.check([0x10], {\n        offset: offset + 1,\n        mask: [0x16]\n      })) {\n        // Check for (ADTS) MPEG-2\n        if (this.check([0x08], {\n          offset: offset + 1,\n          mask: [0x08]\n        })) {\n          return {\n            ext: 'aac',\n            mime: 'audio/aac'\n          };\n        }\n\n        // Must be (ADTS) MPEG-4\n        return {\n          ext: 'aac',\n          mime: 'audio/aac'\n        };\n      }\n\n      // MPEG 1 or 2 Layer 3 header\n      // Check for MPEG layer 3\n      if (this.check([0x02], {\n        offset: offset + 1,\n        mask: [0x06]\n      })) {\n        return {\n          ext: 'mp3',\n          mime: 'audio/mpeg'\n        };\n      }\n\n      // Check for MPEG layer 2\n      if (this.check([0x04], {\n        offset: offset + 1,\n        mask: [0x06]\n      })) {\n        return {\n          ext: 'mp2',\n          mime: 'audio/mpeg'\n        };\n      }\n\n      // Check for MPEG layer 1\n      if (this.check([0x06], {\n        offset: offset + 1,\n        mask: [0x06]\n      })) {\n        return {\n          ext: 'mp1',\n          mime: 'audio/mpeg'\n        };\n      }\n    }\n  }\n}\nexport const supportedExtensions = new Set(extensions);\nexport const supportedMimeTypes = new Set(mimeTypes);","map":{"version":3,"names":["Token","strtok3","ZipHandler","GzipHandler","getUintBE","stringToBytes","tarHeaderChecksumMatches","uint32SyncSafeToken","extensions","mimeTypes","reasonableDetectionSizeInBytes","fileTypeFromStream","stream","options","FileTypeParser","fromStream","fileTypeFromBuffer","input","fromBuffer","fileTypeFromBlob","blob","fromBlob","getFileTypeFromMimeType","mimeType","toLowerCase","ext","mime","_check","buffer","headers","offset","index","header","entries","mask","fileTypeFromTokenizer","tokenizer","fromTokenizer","fileTypeStream","webStream","toDetectionStream","constructor","_defineProperty","Uint8Array","fileInfo","size","undefined","Number","MAX_SAFE_INTEGER","peekBuffer","length","mayBeLess","check","checkString","ignore","detectConfident","gzipHandler","inflate","shouldCancelStream","compressedFileType","cancel","id3HeaderLength","readToken","position","fileType","unzip","zipHeader","filename","stop","handler","fileData","TextDecoder","decode","trim","xmlContent","endPos","indexOf","includes","slice","Math","max","firstPos","lastIndexOf","test","catch","error","EndOfStreamError","type","readBuffer","readTiffHeader","readField","msb","peekNumber","UINT8","ic","id","readElement","idField","lengthField","nrLength","min","idView","DataView","lengthView","len","readChildren","children","element","rawValue","StringType","replaceAll","re","documentType","version","get","match","string","some","char7","readChunkHeader","INT32_BE","chunk","brandMajor","replace","startsWith","readHeader","guid","UINT64_LE","payload","typeId","encoding","jsonSize","getUint32","subarray","json","JSON","parse","files","mpegOffsetTolerance","depth","scanMpeg","detectors","customDetectors","detect","detectImprecise","tokenizerOptions","abortSignal","signal","initialPosition","detector","ArrayBuffer","TypeError","close","fromWebStream","sampleSize","detectedFileType","firstChunk","reader","getReader","mode","value","done","read","releaseLock","transformStream","TransformStream","start","controller","enqueue","transform","newStream","pipeThrough","readTiffTag","bigEndian","tagId","UINT16_BE","UINT16_LE","readTiffIFD","numberOfTags","n","ifdOffset","UINT32_BE","UINT32_LE","someId1","someId2","supportedExtensions","Set","supportedMimeTypes"],"sources":["C:/projects/My projects/Vue/osi/node_modules/file-type/core.js"],"sourcesContent":["/**\r\nPrimary entry point, Node.js specific entry point is index.js\r\n*/\r\n\r\nimport * as Token from 'token-types';\r\nimport * as strtok3 from 'strtok3/core';\r\nimport {ZipHandler, GzipHandler} from '@tokenizer/inflate';\r\nimport {getUintBE} from 'uint8array-extras';\r\nimport {\r\n\tstringToBytes,\r\n\ttarHeaderChecksumMatches,\r\n\tuint32SyncSafeToken,\r\n} from './util.js';\r\nimport {extensions, mimeTypes} from './supported.js';\r\n\r\nexport const reasonableDetectionSizeInBytes = 4100; // A fair amount of file-types are detectable within this range.\r\n\r\nexport async function fileTypeFromStream(stream, options) {\r\n\treturn new FileTypeParser(options).fromStream(stream);\r\n}\r\n\r\nexport async function fileTypeFromBuffer(input, options) {\r\n\treturn new FileTypeParser(options).fromBuffer(input);\r\n}\r\n\r\nexport async function fileTypeFromBlob(blob, options) {\r\n\treturn new FileTypeParser(options).fromBlob(blob);\r\n}\r\n\r\nfunction getFileTypeFromMimeType(mimeType) {\r\n\tmimeType = mimeType.toLowerCase();\r\n\tswitch (mimeType) {\r\n\t\tcase 'application/epub+zip':\r\n\t\t\treturn {\r\n\t\t\t\text: 'epub',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.oasis.opendocument.text':\r\n\t\t\treturn {\r\n\t\t\t\text: 'odt',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.oasis.opendocument.text-template':\r\n\t\t\treturn {\r\n\t\t\t\text: 'ott',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.oasis.opendocument.spreadsheet':\r\n\t\t\treturn {\r\n\t\t\t\text: 'ods',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.oasis.opendocument.spreadsheet-template':\r\n\t\t\treturn {\r\n\t\t\t\text: 'ots',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.oasis.opendocument.presentation':\r\n\t\t\treturn {\r\n\t\t\t\text: 'odp',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.oasis.opendocument.presentation-template':\r\n\t\t\treturn {\r\n\t\t\t\text: 'otp',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.oasis.opendocument.graphics':\r\n\t\t\treturn {\r\n\t\t\t\text: 'odg',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.oasis.opendocument.graphics-template':\r\n\t\t\treturn {\r\n\t\t\t\text: 'otg',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.openxmlformats-officedocument.presentationml.slideshow':\r\n\t\t\treturn {\r\n\t\t\t\text: 'ppsx',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':\r\n\t\t\treturn {\r\n\t\t\t\text: 'xlsx',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-excel.sheet.macroenabled':\r\n\t\t\treturn {\r\n\t\t\t\text: 'xlsm',\r\n\t\t\t\tmime: 'application/vnd.ms-excel.sheet.macroenabled.12',\r\n\t\t\t};\r\n\t\tcase 'application/vnd.openxmlformats-officedocument.spreadsheetml.template':\r\n\t\t\treturn {\r\n\t\t\t\text: 'xltx',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-excel.template.macroenabled':\r\n\t\t\treturn {\r\n\t\t\t\text: 'xltm',\r\n\t\t\t\tmime: 'application/vnd.ms-excel.template.macroenabled.12',\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-powerpoint.slideshow.macroenabled':\r\n\t\t\treturn {\r\n\t\t\t\text: 'ppsm',\r\n\t\t\t\tmime: 'application/vnd.ms-powerpoint.slideshow.macroenabled.12',\r\n\t\t\t};\r\n\t\tcase 'application/vnd.openxmlformats-officedocument.wordprocessingml.document':\r\n\t\t\treturn {\r\n\t\t\t\text: 'docx',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-word.document.macroenabled':\r\n\t\t\treturn {\r\n\t\t\t\text: 'docm',\r\n\t\t\t\tmime: 'application/vnd.ms-word.document.macroenabled.12',\r\n\t\t\t};\r\n\t\tcase 'application/vnd.openxmlformats-officedocument.wordprocessingml.template':\r\n\t\t\treturn {\r\n\t\t\t\text: 'dotx',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-word.template.macroenabledtemplate':\r\n\t\t\treturn {\r\n\t\t\t\text: 'dotm',\r\n\t\t\t\tmime: 'application/vnd.ms-word.template.macroenabled.12',\r\n\t\t\t};\r\n\t\tcase 'application/vnd.openxmlformats-officedocument.presentationml.template':\r\n\t\t\treturn {\r\n\t\t\t\text: 'potx',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-powerpoint.template.macroenabled':\r\n\t\t\treturn {\r\n\t\t\t\text: 'potm',\r\n\t\t\t\tmime: 'application/vnd.ms-powerpoint.template.macroenabled.12',\r\n\t\t\t};\r\n\t\tcase 'application/vnd.openxmlformats-officedocument.presentationml.presentation':\r\n\t\t\treturn {\r\n\t\t\t\text: 'pptx',\r\n\t\t\t\tmime: mimeType,\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-powerpoint.presentation.macroenabled':\r\n\t\t\treturn {\r\n\t\t\t\text: 'pptm',\r\n\t\t\t\tmime: 'application/vnd.ms-powerpoint.presentation.macroenabled.12',\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-visio.drawing':\r\n\t\t\treturn {\r\n\t\t\t\text: 'vsdx',\r\n\t\t\t\tmime: 'application/vnd.visio',\r\n\t\t\t};\r\n\t\tcase 'application/vnd.ms-package.3dmanufacturing-3dmodel+xml':\r\n\t\t\treturn {\r\n\t\t\t\text: '3mf',\r\n\t\t\t\tmime: 'model/3mf',\r\n\t\t\t};\r\n\t\tdefault:\r\n\t}\r\n}\r\n\r\nfunction _check(buffer, headers, options) {\r\n\toptions = {\r\n\t\toffset: 0,\r\n\t\t...options,\r\n\t};\r\n\r\n\tfor (const [index, header] of headers.entries()) {\r\n\t\t// If a bitmask is set\r\n\t\tif (options.mask) {\r\n\t\t\t// If header doesn't equal `buf` with bits masked off\r\n\t\t\tif (header !== (options.mask[index] & buffer[index + options.offset])) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else if (header !== buffer[index + options.offset]) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nexport async function fileTypeFromTokenizer(tokenizer, options) {\r\n\treturn new FileTypeParser(options).fromTokenizer(tokenizer);\r\n}\r\n\r\nexport async function fileTypeStream(webStream, options) {\r\n\treturn new FileTypeParser(options).toDetectionStream(webStream, options);\r\n}\r\n\r\nexport class FileTypeParser {\r\n\tconstructor(options) {\r\n\t\tthis.options = {\r\n\t\t\tmpegOffsetTolerance: 0,\r\n\t\t\t...options,\r\n\t\t};\r\n\r\n\t\tthis.detectors = [...(options?.customDetectors ?? []),\r\n\t\t\t{id: 'core', detect: this.detectConfident},\r\n\t\t\t{id: 'core.imprecise', detect: this.detectImprecise}];\r\n\t\tthis.tokenizerOptions = {\r\n\t\t\tabortSignal: options?.signal,\r\n\t\t};\r\n\t}\r\n\r\n\tasync fromTokenizer(tokenizer) {\r\n\t\tconst initialPosition = tokenizer.position;\r\n\r\n\t\t// Iterate through all file-type detectors\r\n\t\tfor (const detector of this.detectors) {\r\n\t\t\tconst fileType = await detector.detect(tokenizer);\r\n\t\t\tif (fileType) {\r\n\t\t\t\treturn fileType;\r\n\t\t\t}\r\n\r\n\t\t\tif (initialPosition !== tokenizer.position) {\r\n\t\t\t\treturn undefined; // Cannot proceed scanning of the tokenizer is at an arbitrary position\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync fromBuffer(input) {\r\n\t\tif (!(input instanceof Uint8Array || input instanceof ArrayBuffer)) {\r\n\t\t\tthrow new TypeError(`Expected the \\`input\\` argument to be of type \\`Uint8Array\\` or \\`ArrayBuffer\\`, got \\`${typeof input}\\``);\r\n\t\t}\r\n\r\n\t\tconst buffer = input instanceof Uint8Array ? input : new Uint8Array(input);\r\n\r\n\t\tif (!(buffer?.length > 1)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn this.fromTokenizer(strtok3.fromBuffer(buffer, this.tokenizerOptions));\r\n\t}\r\n\r\n\tasync fromBlob(blob) {\r\n\t\tconst tokenizer = strtok3.fromBlob(blob, this.tokenizerOptions);\r\n\t\ttry {\r\n\t\t\treturn await this.fromTokenizer(tokenizer);\r\n\t\t} finally {\r\n\t\t\tawait tokenizer.close();\r\n\t\t}\r\n\t}\r\n\r\n\tasync fromStream(stream) {\r\n\t\tconst tokenizer = strtok3.fromWebStream(stream, this.tokenizerOptions);\r\n\t\ttry {\r\n\t\t\treturn await this.fromTokenizer(tokenizer);\r\n\t\t} finally {\r\n\t\t\tawait tokenizer.close();\r\n\t\t}\r\n\t}\r\n\r\n\tasync toDetectionStream(stream, options) {\r\n\t\tconst {sampleSize = reasonableDetectionSizeInBytes} = options;\r\n\t\tlet detectedFileType;\r\n\t\tlet firstChunk;\r\n\r\n\t\tconst reader = stream.getReader({mode: 'byob'});\r\n\t\ttry {\r\n\t\t\t// Read the first chunk from the stream\r\n\t\t\tconst {value: chunk, done} = await reader.read(new Uint8Array(sampleSize));\r\n\t\t\tfirstChunk = chunk;\r\n\t\t\tif (!done && chunk) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Attempt to detect the file type from the chunk\r\n\t\t\t\t\tdetectedFileType = await this.fromBuffer(chunk.subarray(0, sampleSize));\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tif (!(error instanceof strtok3.EndOfStreamError)) {\r\n\t\t\t\t\t\tthrow error; // Re-throw non-EndOfStreamError\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdetectedFileType = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfirstChunk = chunk;\r\n\t\t} finally {\r\n\t\t\treader.releaseLock(); // Ensure the reader is released\r\n\t\t}\r\n\r\n\t\t// Create a new ReadableStream to manage locking issues\r\n\t\tconst transformStream = new TransformStream({\r\n\t\t\tasync start(controller) {\r\n\t\t\t\tcontroller.enqueue(firstChunk); // Enqueue the initial chunk\r\n\t\t\t},\r\n\t\t\ttransform(chunk, controller) {\r\n\t\t\t\t// Pass through the chunks without modification\r\n\t\t\t\tcontroller.enqueue(chunk);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst newStream = stream.pipeThrough(transformStream);\r\n\t\tnewStream.fileType = detectedFileType;\r\n\r\n\t\treturn newStream;\r\n\t}\r\n\r\n\tcheck(header, options) {\r\n\t\treturn _check(this.buffer, header, options);\r\n\t}\r\n\r\n\tcheckString(header, options) {\r\n\t\treturn this.check(stringToBytes(header, options?.encoding), options);\r\n\t}\r\n\r\n\t// Detections with a high degree of certainty in identifying the correct file type\r\n\tdetectConfident = async tokenizer => {\r\n\t\tthis.buffer = new Uint8Array(reasonableDetectionSizeInBytes);\r\n\r\n\t\t// Keep reading until EOF if the file size is unknown.\r\n\t\tif (tokenizer.fileInfo.size === undefined) {\r\n\t\t\ttokenizer.fileInfo.size = Number.MAX_SAFE_INTEGER;\r\n\t\t}\r\n\r\n\t\tthis.tokenizer = tokenizer;\r\n\r\n\t\tawait tokenizer.peekBuffer(this.buffer, {length: 32, mayBeLess: true});\r\n\r\n\t\t// -- 2-byte signatures --\r\n\r\n\t\tif (this.check([0x42, 0x4D])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'bmp',\r\n\t\t\t\tmime: 'image/bmp',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x0B, 0x77])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'ac3',\r\n\t\t\t\tmime: 'audio/vnd.dolby.dd-raw',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x78, 0x01])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'dmg',\r\n\t\t\t\tmime: 'application/x-apple-diskimage',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x4D, 0x5A])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'exe',\r\n\t\t\t\tmime: 'application/x-msdownload',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x25, 0x21])) {\r\n\t\t\tawait tokenizer.peekBuffer(this.buffer, {length: 24, mayBeLess: true});\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.checkString('PS-Adobe-', {offset: 2})\r\n\t\t\t\t&& this.checkString(' EPSF-', {offset: 14})\r\n\t\t\t) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'eps',\r\n\t\t\t\t\tmime: 'application/eps',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\text: 'ps',\r\n\t\t\t\tmime: 'application/postscript',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.check([0x1F, 0xA0])\r\n\t\t\t|| this.check([0x1F, 0x9D])\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'Z',\r\n\t\t\t\tmime: 'application/x-compress',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xC7, 0x71])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'cpio',\r\n\t\t\t\tmime: 'application/x-cpio',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x60, 0xEA])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'arj',\r\n\t\t\t\tmime: 'application/x-arj',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 3-byte signatures --\r\n\r\n\t\tif (this.check([0xEF, 0xBB, 0xBF])) { // UTF-8-BOM\r\n\t\t\t// Strip off UTF-8-BOM\r\n\t\t\tthis.tokenizer.ignore(3);\r\n\t\t\treturn this.detectConfident(tokenizer);\r\n\t\t}\r\n\r\n\t\tif (this.check([0x47, 0x49, 0x46])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'gif',\r\n\t\t\t\tmime: 'image/gif',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x49, 0x49, 0xBC])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'jxr',\r\n\t\t\t\tmime: 'image/vnd.ms-photo',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x1F, 0x8B, 0x8])) {\r\n\t\t\tconst gzipHandler = new GzipHandler(tokenizer);\r\n\r\n\t\t\tconst stream = gzipHandler.inflate();\r\n\t\t\tlet shouldCancelStream = true;\r\n\t\t\ttry {\r\n\t\t\t\tlet compressedFileType;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcompressedFileType = await this.fromStream(stream);\r\n\t\t\t\t} catch {\r\n\t\t\t\t\tshouldCancelStream = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (compressedFileType && compressedFileType.ext === 'tar') {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'tar.gz',\r\n\t\t\t\t\t\tmime: 'application/gzip',\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tif (shouldCancelStream) {\r\n\t\t\t\t\tawait stream.cancel();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\text: 'gz',\r\n\t\t\t\tmime: 'application/gzip',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x42, 0x5A, 0x68])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'bz2',\r\n\t\t\t\tmime: 'application/x-bzip2',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('ID3')) {\r\n\t\t\tawait tokenizer.ignore(6); // Skip ID3 header until the header size\r\n\t\t\tconst id3HeaderLength = await tokenizer.readToken(uint32SyncSafeToken);\r\n\t\t\tif (tokenizer.position + id3HeaderLength > tokenizer.fileInfo.size) {\r\n\t\t\t\t// Guess file type based on ID3 header for backward compatibility\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'mp3',\r\n\t\t\t\t\tmime: 'audio/mpeg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tawait tokenizer.ignore(id3HeaderLength);\r\n\t\t\treturn this.fromTokenizer(tokenizer); // Skip ID3 header, recursion\r\n\t\t}\r\n\r\n\t\t// Musepack, SV7\r\n\t\tif (this.checkString('MP+')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mpc',\r\n\t\t\t\tmime: 'audio/x-musepack',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\t(this.buffer[0] === 0x43 || this.buffer[0] === 0x46)\r\n\t\t\t&& this.check([0x57, 0x53], {offset: 1})\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'swf',\r\n\t\t\t\tmime: 'application/x-shockwave-flash',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 4-byte signatures --\r\n\r\n\t\t// Requires a sample size of 4 bytes\r\n\t\tif (this.check([0xFF, 0xD8, 0xFF])) {\r\n\t\t\tif (this.check([0xF7], {offset: 3})) { // JPG7/SOF55, indicating a ISO/IEC 14495 / JPEG-LS file\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'jls',\r\n\t\t\t\t\tmime: 'image/jls',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\text: 'jpg',\r\n\t\t\t\tmime: 'image/jpeg',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x4F, 0x62, 0x6A, 0x01])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'avro',\r\n\t\t\t\tmime: 'application/avro',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('FLIF')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'flif',\r\n\t\t\t\tmime: 'image/flif',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('8BPS')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'psd',\r\n\t\t\t\tmime: 'image/vnd.adobe.photoshop',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Musepack, SV8\r\n\t\tif (this.checkString('MPCK')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mpc',\r\n\t\t\t\tmime: 'audio/x-musepack',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('FORM')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'aif',\r\n\t\t\t\tmime: 'audio/aiff',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('icns', {offset: 0})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'icns',\r\n\t\t\t\tmime: 'image/icns',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Zip-based file formats\r\n\t\t// Need to be before the `zip` check\r\n\t\tif (this.check([0x50, 0x4B, 0x3, 0x4])) { // Local file header signature\r\n\t\t\tlet fileType;\r\n\t\t\tawait new ZipHandler(tokenizer).unzip(zipHeader => {\r\n\t\t\t\tswitch (zipHeader.filename) {\r\n\t\t\t\t\tcase 'META-INF/mozilla.rsa':\r\n\t\t\t\t\t\tfileType = {\r\n\t\t\t\t\t\t\text: 'xpi',\r\n\t\t\t\t\t\t\tmime: 'application/x-xpinstall',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tstop: true,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\tcase 'META-INF/MANIFEST.MF':\r\n\t\t\t\t\t\tfileType = {\r\n\t\t\t\t\t\t\text: 'jar',\r\n\t\t\t\t\t\t\tmime: 'application/java-archive',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tstop: true,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\tcase 'mimetype':\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tasync handler(fileData) {\r\n\t\t\t\t\t\t\t\t// Use TextDecoder to decode the UTF-8 encoded data\r\n\t\t\t\t\t\t\t\tconst mimeType = new TextDecoder('utf-8').decode(fileData).trim();\r\n\t\t\t\t\t\t\t\tfileType = getFileTypeFromMimeType(mimeType);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tstop: true,\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\tcase '[Content_Types].xml':\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tasync handler(fileData) {\r\n\t\t\t\t\t\t\t\t// Use TextDecoder to decode the UTF-8 encoded data\r\n\t\t\t\t\t\t\t\tlet xmlContent = new TextDecoder('utf-8').decode(fileData);\r\n\t\t\t\t\t\t\t\tconst endPos = xmlContent.indexOf('.main+xml\"');\r\n\t\t\t\t\t\t\t\tif (endPos === -1) {\r\n\t\t\t\t\t\t\t\t\tconst mimeType = 'application/vnd.ms-package.3dmanufacturing-3dmodel+xml';\r\n\t\t\t\t\t\t\t\t\tif (xmlContent.includes(`ContentType=\"${mimeType}\"`)) {\r\n\t\t\t\t\t\t\t\t\t\tfileType = getFileTypeFromMimeType(mimeType);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\txmlContent = xmlContent.slice(0, Math.max(0, endPos));\r\n\t\t\t\t\t\t\t\t\tconst firstPos = xmlContent.lastIndexOf('\"');\r\n\t\t\t\t\t\t\t\t\tconst mimeType = xmlContent.slice(Math.max(0, firstPos + 1));\r\n\t\t\t\t\t\t\t\t\tfileType = getFileTypeFromMimeType(mimeType);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tstop: true,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (/classes\\d*\\.dex/.test(zipHeader.filename)) {\r\n\t\t\t\t\t\t\tfileType = {\r\n\t\t\t\t\t\t\t\text: 'apk',\r\n\t\t\t\t\t\t\t\tmime: 'application/vnd.android.package-archive',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\treturn {stop: true};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn {};\r\n\t\t\t\t}\r\n\t\t\t}).catch(error => {\r\n\t\t\t\tif (!(error instanceof strtok3.EndOfStreamError)) {\r\n\t\t\t\t\tthrow error; // Re-throw non-EndOfStreamError\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn fileType ?? {\r\n\t\t\t\text: 'zip',\r\n\t\t\t\tmime: 'application/zip',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('OggS')) {\r\n\t\t\t// This is an OGG container\r\n\t\t\tawait tokenizer.ignore(28);\r\n\t\t\tconst type = new Uint8Array(8);\r\n\t\t\tawait tokenizer.readBuffer(type);\r\n\r\n\t\t\t// Needs to be before `ogg` check\r\n\t\t\tif (_check(type, [0x4F, 0x70, 0x75, 0x73, 0x48, 0x65, 0x61, 0x64])) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'opus',\r\n\t\t\t\t\tmime: 'audio/ogg; codecs=opus',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// If ' theora' in header.\r\n\t\t\tif (_check(type, [0x80, 0x74, 0x68, 0x65, 0x6F, 0x72, 0x61])) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'ogv',\r\n\t\t\t\t\tmime: 'video/ogg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// If '\\x01video' in header.\r\n\t\t\tif (_check(type, [0x01, 0x76, 0x69, 0x64, 0x65, 0x6F, 0x00])) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'ogm',\r\n\t\t\t\t\tmime: 'video/ogg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// If ' FLAC' in header  https://xiph.org/flac/faq.html\r\n\t\t\tif (_check(type, [0x7F, 0x46, 0x4C, 0x41, 0x43])) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'oga',\r\n\t\t\t\t\tmime: 'audio/ogg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// 'Speex  ' in header https://en.wikipedia.org/wiki/Speex\r\n\t\t\tif (_check(type, [0x53, 0x70, 0x65, 0x65, 0x78, 0x20, 0x20])) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'spx',\r\n\t\t\t\t\tmime: 'audio/ogg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// If '\\x01vorbis' in header\r\n\t\t\tif (_check(type, [0x01, 0x76, 0x6F, 0x72, 0x62, 0x69, 0x73])) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'ogg',\r\n\t\t\t\t\tmime: 'audio/ogg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Default OGG container https://www.iana.org/assignments/media-types/application/ogg\r\n\t\t\treturn {\r\n\t\t\t\text: 'ogx',\r\n\t\t\t\tmime: 'application/ogg',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.check([0x50, 0x4B])\r\n\t\t\t&& (this.buffer[2] === 0x3 || this.buffer[2] === 0x5 || this.buffer[2] === 0x7)\r\n\t\t\t&& (this.buffer[3] === 0x4 || this.buffer[3] === 0x6 || this.buffer[3] === 0x8)\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'zip',\r\n\t\t\t\tmime: 'application/zip',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('MThd')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mid',\r\n\t\t\t\tmime: 'audio/midi',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.checkString('wOFF')\r\n\t\t\t&& (\r\n\t\t\t\tthis.check([0x00, 0x01, 0x00, 0x00], {offset: 4})\r\n\t\t\t\t|| this.checkString('OTTO', {offset: 4})\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'woff',\r\n\t\t\t\tmime: 'font/woff',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.checkString('wOF2')\r\n\t\t\t&& (\r\n\t\t\t\tthis.check([0x00, 0x01, 0x00, 0x00], {offset: 4})\r\n\t\t\t\t|| this.checkString('OTTO', {offset: 4})\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'woff2',\r\n\t\t\t\tmime: 'font/woff2',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xD4, 0xC3, 0xB2, 0xA1]) || this.check([0xA1, 0xB2, 0xC3, 0xD4])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'pcap',\r\n\t\t\t\tmime: 'application/vnd.tcpdump.pcap',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Sony DSD Stream File (DSF)\r\n\t\tif (this.checkString('DSD ')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'dsf',\r\n\t\t\t\tmime: 'audio/x-dsf', // Non-standard\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('LZIP')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'lz',\r\n\t\t\t\tmime: 'application/x-lzip',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('fLaC')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'flac',\r\n\t\t\t\tmime: 'audio/flac',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x42, 0x50, 0x47, 0xFB])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'bpg',\r\n\t\t\t\tmime: 'image/bpg',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('wvpk')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'wv',\r\n\t\t\t\tmime: 'audio/wavpack',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('%PDF')) {\r\n\t\t\t// Assume this is just a normal PDF\r\n\t\t\treturn {\r\n\t\t\t\text: 'pdf',\r\n\t\t\t\tmime: 'application/pdf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x00, 0x61, 0x73, 0x6D])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'wasm',\r\n\t\t\t\tmime: 'application/wasm',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// TIFF, little-endian type\r\n\t\tif (this.check([0x49, 0x49])) {\r\n\t\t\tconst fileType = await this.readTiffHeader(false);\r\n\t\t\tif (fileType) {\r\n\t\t\t\treturn fileType;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// TIFF, big-endian type\r\n\t\tif (this.check([0x4D, 0x4D])) {\r\n\t\t\tconst fileType = await this.readTiffHeader(true);\r\n\t\t\tif (fileType) {\r\n\t\t\t\treturn fileType;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.checkString('MAC ')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'ape',\r\n\t\t\t\tmime: 'audio/ape',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// https://github.com/file/file/blob/master/magic/Magdir/matroska\r\n\t\tif (this.check([0x1A, 0x45, 0xDF, 0xA3])) { // Root element: EBML\r\n\t\t\tasync function readField() {\r\n\t\t\t\tconst msb = await tokenizer.peekNumber(Token.UINT8);\r\n\t\t\t\tlet mask = 0x80;\r\n\t\t\t\tlet ic = 0; // 0 = A, 1 = B, 2 = C, 3 = D\r\n\r\n\t\t\t\twhile ((msb & mask) === 0 && mask !== 0) {\r\n\t\t\t\t\t++ic;\r\n\t\t\t\t\tmask >>= 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst id = new Uint8Array(ic + 1);\r\n\t\t\t\tawait tokenizer.readBuffer(id);\r\n\t\t\t\treturn id;\r\n\t\t\t}\r\n\r\n\t\t\tasync function readElement() {\r\n\t\t\t\tconst idField = await readField();\r\n\t\t\t\tconst lengthField = await readField();\r\n\r\n\t\t\t\tlengthField[0] ^= 0x80 >> (lengthField.length - 1);\r\n\t\t\t\tconst nrLength = Math.min(6, lengthField.length); // JavaScript can max read 6 bytes integer\r\n\r\n\t\t\t\tconst idView = new DataView(idField.buffer);\r\n\t\t\t\tconst lengthView = new DataView(lengthField.buffer, lengthField.length - nrLength, nrLength);\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: getUintBE(idView),\r\n\t\t\t\t\tlen: getUintBE(lengthView),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tasync function readChildren(children) {\r\n\t\t\t\twhile (children > 0) {\r\n\t\t\t\t\tconst element = await readElement();\r\n\t\t\t\t\tif (element.id === 0x42_82) {\r\n\t\t\t\t\t\tconst rawValue = await tokenizer.readToken(new Token.StringType(element.len));\r\n\t\t\t\t\t\treturn rawValue.replaceAll(/\\00.*$/g, ''); // Return DocType\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tawait tokenizer.ignore(element.len); // ignore payload\r\n\t\t\t\t\t--children;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst re = await readElement();\r\n\t\t\tconst documentType = await readChildren(re.len);\r\n\r\n\t\t\tswitch (documentType) {\r\n\t\t\t\tcase 'webm':\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'webm',\r\n\t\t\t\t\t\tmime: 'video/webm',\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\tcase 'matroska':\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'mkv',\r\n\t\t\t\t\t\tmime: 'video/matroska',\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.checkString('SQLi')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'sqlite',\r\n\t\t\t\tmime: 'application/x-sqlite3',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x4E, 0x45, 0x53, 0x1A])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'nes',\r\n\t\t\t\tmime: 'application/x-nintendo-nes-rom',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('Cr24')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'crx',\r\n\t\t\t\tmime: 'application/x-google-chrome-extension',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.checkString('MSCF')\r\n\t\t\t|| this.checkString('ISc(')\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'cab',\r\n\t\t\t\tmime: 'application/vnd.ms-cab-compressed',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xED, 0xAB, 0xEE, 0xDB])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'rpm',\r\n\t\t\t\tmime: 'application/x-rpm',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xC5, 0xD0, 0xD3, 0xC6])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'eps',\r\n\t\t\t\tmime: 'application/eps',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x28, 0xB5, 0x2F, 0xFD])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'zst',\r\n\t\t\t\tmime: 'application/zstd',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x7F, 0x45, 0x4C, 0x46])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'elf',\r\n\t\t\t\tmime: 'application/x-elf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x21, 0x42, 0x44, 0x4E])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'pst',\r\n\t\t\t\tmime: 'application/vnd.ms-outlook',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('PAR1') || this.checkString('PARE')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'parquet',\r\n\t\t\t\tmime: 'application/vnd.apache.parquet',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('ttcf')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'ttc',\r\n\t\t\t\tmime: 'font/collection',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xCF, 0xFA, 0xED, 0xFE])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'macho',\r\n\t\t\t\tmime: 'application/x-mach-binary',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x04, 0x22, 0x4D, 0x18])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'lz4',\r\n\t\t\t\tmime: 'application/x-lz4', // Invented by us\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('regf')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'dat',\r\n\t\t\t\tmime: 'application/x-ft-windows-registry-hive',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 5-byte signatures --\r\n\r\n\t\tif (this.check([0x4F, 0x54, 0x54, 0x4F, 0x00])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'otf',\r\n\t\t\t\tmime: 'font/otf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('#!AMR')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'amr',\r\n\t\t\t\tmime: 'audio/amr',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('{\\\\rtf')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'rtf',\r\n\t\t\t\tmime: 'application/rtf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x46, 0x4C, 0x56, 0x01])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'flv',\r\n\t\t\t\tmime: 'video/x-flv',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('IMPM')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'it',\r\n\t\t\t\tmime: 'audio/x-it',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.checkString('-lh0-', {offset: 2})\r\n\t\t\t|| this.checkString('-lh1-', {offset: 2})\r\n\t\t\t|| this.checkString('-lh2-', {offset: 2})\r\n\t\t\t|| this.checkString('-lh3-', {offset: 2})\r\n\t\t\t|| this.checkString('-lh4-', {offset: 2})\r\n\t\t\t|| this.checkString('-lh5-', {offset: 2})\r\n\t\t\t|| this.checkString('-lh6-', {offset: 2})\r\n\t\t\t|| this.checkString('-lh7-', {offset: 2})\r\n\t\t\t|| this.checkString('-lzs-', {offset: 2})\r\n\t\t\t|| this.checkString('-lz4-', {offset: 2})\r\n\t\t\t|| this.checkString('-lz5-', {offset: 2})\r\n\t\t\t|| this.checkString('-lhd-', {offset: 2})\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'lzh',\r\n\t\t\t\tmime: 'application/x-lzh-compressed',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// MPEG program stream (PS or MPEG-PS)\r\n\t\tif (this.check([0x00, 0x00, 0x01, 0xBA])) {\r\n\t\t\t//  MPEG-PS, MPEG-1 Part 1\r\n\t\t\tif (this.check([0x21], {offset: 4, mask: [0xF1]})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'mpg', // May also be .ps, .mpeg\r\n\t\t\t\t\tmime: 'video/MP1S',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// MPEG-PS, MPEG-2 Part 1\r\n\t\t\tif (this.check([0x44], {offset: 4, mask: [0xC4]})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'mpg', // May also be .mpg, .m2p, .vob or .sub\r\n\t\t\t\t\tmime: 'video/MP2P',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.checkString('ITSF')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'chm',\r\n\t\t\t\tmime: 'application/vnd.ms-htmlhelp',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xCA, 0xFE, 0xBA, 0xBE])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'class',\r\n\t\t\t\tmime: 'application/java-vm',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('.RMF')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'rm',\r\n\t\t\t\tmime: 'application/vnd.rn-realmedia',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 5-byte signatures --\r\n\r\n\t\tif (this.checkString('DRACO')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'drc',\r\n\t\t\t\tmime: 'application/vnd.google.draco', // Invented by us\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 6-byte signatures --\r\n\r\n\t\tif (this.check([0xFD, 0x37, 0x7A, 0x58, 0x5A, 0x00])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'xz',\r\n\t\t\t\tmime: 'application/x-xz',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('<?xml ')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'xml',\r\n\t\t\t\tmime: 'application/xml',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x37, 0x7A, 0xBC, 0xAF, 0x27, 0x1C])) {\r\n\t\t\treturn {\r\n\t\t\t\text: '7z',\r\n\t\t\t\tmime: 'application/x-7z-compressed',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.check([0x52, 0x61, 0x72, 0x21, 0x1A, 0x7])\r\n\t\t\t&& (this.buffer[6] === 0x0 || this.buffer[6] === 0x1)\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'rar',\r\n\t\t\t\tmime: 'application/x-rar-compressed',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('solid ')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'stl',\r\n\t\t\t\tmime: 'model/stl',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('AC')) {\r\n\t\t\tconst version = new Token.StringType(4, 'latin1').get(this.buffer, 2);\r\n\t\t\tif (version.match('^d*') && version >= 1000 && version <= 1050) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'dwg',\r\n\t\t\t\t\tmime: 'image/vnd.dwg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.checkString('070707')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'cpio',\r\n\t\t\t\tmime: 'application/x-cpio',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 7-byte signatures --\r\n\r\n\t\tif (this.checkString('BLENDER')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'blend',\r\n\t\t\t\tmime: 'application/x-blender',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('!<arch>')) {\r\n\t\t\tawait tokenizer.ignore(8);\r\n\t\t\tconst string = await tokenizer.readToken(new Token.StringType(13, 'ascii'));\r\n\t\t\tif (string === 'debian-binary') {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'deb',\r\n\t\t\t\t\tmime: 'application/x-deb',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\text: 'ar',\r\n\t\t\t\tmime: 'application/x-unix-archive',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.checkString('WEBVTT')\r\n\t\t\t&&\t(\r\n\t\t\t\t// One of LF, CR, tab, space, or end of file must follow \"WEBVTT\" per the spec (see `fixture/fixture-vtt-*.vtt` for examples). Note that `\\0` is technically the null character (there is no such thing as an EOF character). However, checking for `\\0` gives us the same result as checking for the end of the stream.\r\n\t\t\t\t(['\\n', '\\r', '\\t', ' ', '\\0'].some(char7 => this.checkString(char7, {offset: 6}))))\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'vtt',\r\n\t\t\t\tmime: 'text/vtt',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 8-byte signatures --\r\n\r\n\t\tif (this.check([0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A])) {\r\n\t\t\t// APNG format (https://wiki.mozilla.org/APNG_Specification)\r\n\t\t\t// 1. Find the first IDAT (image data) chunk (49 44 41 54)\r\n\t\t\t// 2. Check if there is an \"acTL\" chunk before the IDAT one (61 63 54 4C)\r\n\r\n\t\t\t// Offset calculated as follows:\r\n\t\t\t// - 8 bytes: PNG signature\r\n\t\t\t// - 4 (length) + 4 (chunk type) + 13 (chunk data) + 4 (CRC): IHDR chunk\r\n\r\n\t\t\tawait tokenizer.ignore(8); // ignore PNG signature\r\n\r\n\t\t\tasync function readChunkHeader() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tlength: await tokenizer.readToken(Token.INT32_BE),\r\n\t\t\t\t\ttype: await tokenizer.readToken(new Token.StringType(4, 'latin1')),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tdo {\r\n\t\t\t\tconst chunk = await readChunkHeader();\r\n\t\t\t\tif (chunk.length < 0) {\r\n\t\t\t\t\treturn; // Invalid chunk length\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (chunk.type) {\r\n\t\t\t\t\tcase 'IDAT':\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\text: 'png',\r\n\t\t\t\t\t\t\tmime: 'image/png',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\tcase 'acTL':\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\text: 'apng',\r\n\t\t\t\t\t\t\tmime: 'image/apng',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tawait tokenizer.ignore(chunk.length + 4); // Ignore chunk-data + CRC\r\n\t\t\t\t}\r\n\t\t\t} while (tokenizer.position + 8 < tokenizer.fileInfo.size);\r\n\r\n\t\t\treturn {\r\n\t\t\t\text: 'png',\r\n\t\t\t\tmime: 'image/png',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x41, 0x52, 0x52, 0x4F, 0x57, 0x31, 0x00, 0x00])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'arrow',\r\n\t\t\t\tmime: 'application/vnd.apache.arrow.file',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x67, 0x6C, 0x54, 0x46, 0x02, 0x00, 0x00, 0x00])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'glb',\r\n\t\t\t\tmime: 'model/gltf-binary',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// `mov` format variants\r\n\t\tif (\r\n\t\t\tthis.check([0x66, 0x72, 0x65, 0x65], {offset: 4}) // `free`\r\n\t\t\t|| this.check([0x6D, 0x64, 0x61, 0x74], {offset: 4}) // `mdat` MJPEG\r\n\t\t\t|| this.check([0x6D, 0x6F, 0x6F, 0x76], {offset: 4}) // `moov`\r\n\t\t\t|| this.check([0x77, 0x69, 0x64, 0x65], {offset: 4}) // `wide`\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mov',\r\n\t\t\t\tmime: 'video/quicktime',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 9-byte signatures --\r\n\r\n\t\tif (this.check([0x49, 0x49, 0x52, 0x4F, 0x08, 0x00, 0x00, 0x00, 0x18])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'orf',\r\n\t\t\t\tmime: 'image/x-olympus-orf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('gimp xcf ')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'xcf',\r\n\t\t\t\tmime: 'image/x-xcf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// File Type Box (https://en.wikipedia.org/wiki/ISO_base_media_file_format)\r\n\t\t// It's not required to be first, but it's recommended to be. Almost all ISO base media files start with `ftyp` box.\r\n\t\t// `ftyp` box must contain a brand major identifier, which must consist of ISO 8859-1 printable characters.\r\n\t\t// Here we check for 8859-1 printable characters (for simplicity, it's a mask which also catches one non-printable character).\r\n\t\tif (\r\n\t\t\tthis.checkString('ftyp', {offset: 4})\r\n\t\t\t&& (this.buffer[8] & 0x60) !== 0x00 // Brand major, first character ASCII?\r\n\t\t) {\r\n\t\t\t// They all can have MIME `video/mp4` except `application/mp4` special-case which is hard to detect.\r\n\t\t\t// For some cases, we're specific, everything else falls to `video/mp4` with `mp4` extension.\r\n\t\t\tconst brandMajor = new Token.StringType(4, 'latin1').get(this.buffer, 8).replace('\\0', ' ').trim();\r\n\t\t\tswitch (brandMajor) {\r\n\t\t\t\tcase 'avif':\r\n\t\t\t\tcase 'avis':\r\n\t\t\t\t\treturn {ext: 'avif', mime: 'image/avif'};\r\n\t\t\t\tcase 'mif1':\r\n\t\t\t\t\treturn {ext: 'heic', mime: 'image/heif'};\r\n\t\t\t\tcase 'msf1':\r\n\t\t\t\t\treturn {ext: 'heic', mime: 'image/heif-sequence'};\r\n\t\t\t\tcase 'heic':\r\n\t\t\t\tcase 'heix':\r\n\t\t\t\t\treturn {ext: 'heic', mime: 'image/heic'};\r\n\t\t\t\tcase 'hevc':\r\n\t\t\t\tcase 'hevx':\r\n\t\t\t\t\treturn {ext: 'heic', mime: 'image/heic-sequence'};\r\n\t\t\t\tcase 'qt':\r\n\t\t\t\t\treturn {ext: 'mov', mime: 'video/quicktime'};\r\n\t\t\t\tcase 'M4V':\r\n\t\t\t\tcase 'M4VH':\r\n\t\t\t\tcase 'M4VP':\r\n\t\t\t\t\treturn {ext: 'm4v', mime: 'video/x-m4v'};\r\n\t\t\t\tcase 'M4P':\r\n\t\t\t\t\treturn {ext: 'm4p', mime: 'video/mp4'};\r\n\t\t\t\tcase 'M4B':\r\n\t\t\t\t\treturn {ext: 'm4b', mime: 'audio/mp4'};\r\n\t\t\t\tcase 'M4A':\r\n\t\t\t\t\treturn {ext: 'm4a', mime: 'audio/x-m4a'};\r\n\t\t\t\tcase 'F4V':\r\n\t\t\t\t\treturn {ext: 'f4v', mime: 'video/mp4'};\r\n\t\t\t\tcase 'F4P':\r\n\t\t\t\t\treturn {ext: 'f4p', mime: 'video/mp4'};\r\n\t\t\t\tcase 'F4A':\r\n\t\t\t\t\treturn {ext: 'f4a', mime: 'audio/mp4'};\r\n\t\t\t\tcase 'F4B':\r\n\t\t\t\t\treturn {ext: 'f4b', mime: 'audio/mp4'};\r\n\t\t\t\tcase 'crx':\r\n\t\t\t\t\treturn {ext: 'cr3', mime: 'image/x-canon-cr3'};\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (brandMajor.startsWith('3g')) {\r\n\t\t\t\t\t\tif (brandMajor.startsWith('3g2')) {\r\n\t\t\t\t\t\t\treturn {ext: '3g2', mime: 'video/3gpp2'};\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn {ext: '3gp', mime: 'video/3gpp'};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn {ext: 'mp4', mime: 'video/mp4'};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// -- 10-byte signatures --\r\n\r\n\t\tif (this.checkString('REGEDIT4\\r\\n')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'reg',\r\n\t\t\t\tmime: 'application/x-ms-regedit',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 12-byte signatures --\r\n\r\n\t\t// RIFF file format which might be AVI, WAV, QCP, etc\r\n\t\tif (this.check([0x52, 0x49, 0x46, 0x46])) {\r\n\t\t\tif (this.checkString('WEBP', {offset: 8})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'webp',\r\n\t\t\t\t\tmime: 'image/webp',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (this.check([0x41, 0x56, 0x49], {offset: 8})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'avi',\r\n\t\t\t\t\tmime: 'video/vnd.avi',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (this.check([0x57, 0x41, 0x56, 0x45], {offset: 8})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'wav',\r\n\t\t\t\t\tmime: 'audio/wav',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// QLCM, QCP file\r\n\t\t\tif (this.check([0x51, 0x4C, 0x43, 0x4D], {offset: 8})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'qcp',\r\n\t\t\t\t\tmime: 'audio/qcelp',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.check([0x49, 0x49, 0x55, 0x00, 0x18, 0x00, 0x00, 0x00, 0x88, 0xE7, 0x74, 0xD8])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'rw2',\r\n\t\t\t\tmime: 'image/x-panasonic-rw2',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// ASF_Header_Object first 80 bytes\r\n\t\tif (this.check([0x30, 0x26, 0xB2, 0x75, 0x8E, 0x66, 0xCF, 0x11, 0xA6, 0xD9])) {\r\n\t\t\tasync function readHeader() {\r\n\t\t\t\tconst guid = new Uint8Array(16);\r\n\t\t\t\tawait tokenizer.readBuffer(guid);\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: guid,\r\n\t\t\t\t\tsize: Number(await tokenizer.readToken(Token.UINT64_LE)),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tawait tokenizer.ignore(30);\r\n\t\t\t// Search for header should be in first 1KB of file.\r\n\t\t\twhile (tokenizer.position + 24 < tokenizer.fileInfo.size) {\r\n\t\t\t\tconst header = await readHeader();\r\n\t\t\t\tlet payload = header.size - 24;\r\n\t\t\t\tif (_check(header.id, [0x91, 0x07, 0xDC, 0xB7, 0xB7, 0xA9, 0xCF, 0x11, 0x8E, 0xE6, 0x00, 0xC0, 0x0C, 0x20, 0x53, 0x65])) {\r\n\t\t\t\t\t// Sync on Stream-Properties-Object (B7DC0791-A9B7-11CF-8EE6-00C00C205365)\r\n\t\t\t\t\tconst typeId = new Uint8Array(16);\r\n\t\t\t\t\tpayload -= await tokenizer.readBuffer(typeId);\r\n\r\n\t\t\t\t\tif (_check(typeId, [0x40, 0x9E, 0x69, 0xF8, 0x4D, 0x5B, 0xCF, 0x11, 0xA8, 0xFD, 0x00, 0x80, 0x5F, 0x5C, 0x44, 0x2B])) {\r\n\t\t\t\t\t\t// Found audio:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\text: 'asf',\r\n\t\t\t\t\t\t\tmime: 'audio/x-ms-asf',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (_check(typeId, [0xC0, 0xEF, 0x19, 0xBC, 0x4D, 0x5B, 0xCF, 0x11, 0xA8, 0xFD, 0x00, 0x80, 0x5F, 0x5C, 0x44, 0x2B])) {\r\n\t\t\t\t\t\t// Found video:\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\text: 'asf',\r\n\t\t\t\t\t\t\tmime: 'video/x-ms-asf',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tawait tokenizer.ignore(payload);\r\n\t\t\t}\r\n\r\n\t\t\t// Default to ASF generic extension\r\n\t\t\treturn {\r\n\t\t\t\text: 'asf',\r\n\t\t\t\tmime: 'application/vnd.ms-asf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xAB, 0x4B, 0x54, 0x58, 0x20, 0x31, 0x31, 0xBB, 0x0D, 0x0A, 0x1A, 0x0A])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'ktx',\r\n\t\t\t\tmime: 'image/ktx',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif ((this.check([0x7E, 0x10, 0x04]) || this.check([0x7E, 0x18, 0x04])) && this.check([0x30, 0x4D, 0x49, 0x45], {offset: 4})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mie',\r\n\t\t\t\tmime: 'application/x-mie',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x27, 0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00], {offset: 2})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'shp',\r\n\t\t\t\tmime: 'application/x-esri-shape',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xFF, 0x4F, 0xFF, 0x51])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'j2c',\r\n\t\t\t\tmime: 'image/j2c',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x00, 0x00, 0x00, 0x0C, 0x6A, 0x50, 0x20, 0x20, 0x0D, 0x0A, 0x87, 0x0A])) {\r\n\t\t\t// JPEG-2000 family\r\n\r\n\t\t\tawait tokenizer.ignore(20);\r\n\t\t\tconst type = await tokenizer.readToken(new Token.StringType(4, 'ascii'));\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'jp2 ':\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'jp2',\r\n\t\t\t\t\t\tmime: 'image/jp2',\r\n\t\t\t\t\t};\r\n\t\t\t\tcase 'jpx ':\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'jpx',\r\n\t\t\t\t\t\tmime: 'image/jpx',\r\n\t\t\t\t\t};\r\n\t\t\t\tcase 'jpm ':\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'jpm',\r\n\t\t\t\t\t\tmime: 'image/jpm',\r\n\t\t\t\t\t};\r\n\t\t\t\tcase 'mjp2':\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'mj2',\r\n\t\t\t\t\t\tmime: 'image/mj2',\r\n\t\t\t\t\t};\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.check([0xFF, 0x0A])\r\n\t\t\t|| this.check([0x00, 0x00, 0x00, 0x0C, 0x4A, 0x58, 0x4C, 0x20, 0x0D, 0x0A, 0x87, 0x0A])\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'jxl',\r\n\t\t\t\tmime: 'image/jxl',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xFE, 0xFF])) { // UTF-16-BOM-BE\r\n\t\t\tif (this.checkString('<?xml ', {offset: 2, encoding: 'utf-16be'})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'xml',\r\n\t\t\t\t\tmime: 'application/xml',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn undefined; // Some unknown text based format\r\n\t\t}\r\n\r\n\t\tif (this.check([0xD0, 0xCF, 0x11, 0xE0, 0xA1, 0xB1, 0x1A, 0xE1])) {\r\n\t\t\t// Detected Microsoft Compound File Binary File (MS-CFB) Format.\r\n\t\t\treturn {\r\n\t\t\t\text: 'cfb',\r\n\t\t\t\tmime: 'application/x-cfb',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Increase sample size from 32 to 256.\r\n\t\tawait tokenizer.peekBuffer(this.buffer, {length: Math.min(256, tokenizer.fileInfo.size), mayBeLess: true});\r\n\r\n\t\tif (this.check([0x61, 0x63, 0x73, 0x70], {offset: 36})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'icc',\r\n\t\t\t\tmime: 'application/vnd.iccprofile',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// ACE: requires 14 bytes in the buffer\r\n\t\tif (this.checkString('**ACE', {offset: 7}) && this.checkString('**', {offset: 12})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'ace',\r\n\t\t\t\tmime: 'application/x-ace-compressed',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// -- 15-byte signatures --\r\n\r\n\t\tif (this.checkString('BEGIN:')) {\r\n\t\t\tif (this.checkString('VCARD', {offset: 6})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'vcf',\r\n\t\t\t\t\tmime: 'text/vcard',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (this.checkString('VCALENDAR', {offset: 6})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'ics',\r\n\t\t\t\t\tmime: 'text/calendar',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// `raf` is here just to keep all the raw image detectors together.\r\n\t\tif (this.checkString('FUJIFILMCCD-RAW')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'raf',\r\n\t\t\t\tmime: 'image/x-fujifilm-raf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('Extended Module:')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'xm',\r\n\t\t\t\tmime: 'audio/x-xm',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('Creative Voice File')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'voc',\r\n\t\t\t\tmime: 'audio/x-voc',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x04, 0x00, 0x00, 0x00]) && this.buffer.length >= 16) { // Rough & quick check Pickle/ASAR\r\n\t\t\tconst jsonSize = new DataView(this.buffer.buffer).getUint32(12, true);\r\n\r\n\t\t\tif (jsonSize > 12 && this.buffer.length >= jsonSize + 16) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst header = new TextDecoder().decode(this.buffer.subarray(16, jsonSize + 16));\r\n\t\t\t\t\tconst json = JSON.parse(header);\r\n\t\t\t\t\t// Check if Pickle is ASAR\r\n\t\t\t\t\tif (json.files) { // Final check, assuring Pickle/ASAR format\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\text: 'asar',\r\n\t\t\t\t\t\t\tmime: 'application/x-asar',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch {}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.check([0x06, 0x0E, 0x2B, 0x34, 0x02, 0x05, 0x01, 0x01, 0x0D, 0x01, 0x02, 0x01, 0x01, 0x02])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mxf',\r\n\t\t\t\tmime: 'application/mxf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('SCRM', {offset: 44})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 's3m',\r\n\t\t\t\tmime: 'audio/x-s3m',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Raw MPEG-2 transport stream (188-byte packets)\r\n\t\tif (this.check([0x47]) && this.check([0x47], {offset: 188})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mts',\r\n\t\t\t\tmime: 'video/mp2t',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Blu-ray Disc Audio-Video (BDAV) MPEG-2 transport stream has 4-byte TP_extra_header before each 188-byte packet\r\n\t\tif (this.check([0x47], {offset: 4}) && this.check([0x47], {offset: 196})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mts',\r\n\t\t\t\tmime: 'video/mp2t',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x42, 0x4F, 0x4F, 0x4B, 0x4D, 0x4F, 0x42, 0x49], {offset: 60})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mobi',\r\n\t\t\t\tmime: 'application/x-mobipocket-ebook',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x44, 0x49, 0x43, 0x4D], {offset: 128})) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'dcm',\r\n\t\t\t\tmime: 'application/dicom',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x4C, 0x00, 0x00, 0x00, 0x01, 0x14, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x46])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'lnk',\r\n\t\t\t\tmime: 'application/x.ms.shortcut', // Invented by us\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x62, 0x6F, 0x6F, 0x6B, 0x00, 0x00, 0x00, 0x00, 0x6D, 0x61, 0x72, 0x6B, 0x00, 0x00, 0x00, 0x00])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'alias',\r\n\t\t\t\tmime: 'application/x.apple.alias', // Invented by us\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.checkString('Kaydara FBX Binary  \\u0000')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'fbx',\r\n\t\t\t\tmime: 'application/x.autodesk.fbx', // Invented by us\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tthis.check([0x4C, 0x50], {offset: 34})\r\n\t\t\t&& (\r\n\t\t\t\tthis.check([0x00, 0x00, 0x01], {offset: 8})\r\n\t\t\t\t|| this.check([0x01, 0x00, 0x02], {offset: 8})\r\n\t\t\t\t|| this.check([0x02, 0x00, 0x02], {offset: 8})\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'eot',\r\n\t\t\t\tmime: 'application/vnd.ms-fontobject',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x06, 0x06, 0xED, 0xF5, 0xD8, 0x1D, 0x46, 0xE5, 0xBD, 0x31, 0xEF, 0xE7, 0xFE, 0x74, 0xB7, 0x1D])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'indd',\r\n\t\t\t\tmime: 'application/x-indesign',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Increase sample size from 256 to 512\r\n\t\tawait tokenizer.peekBuffer(this.buffer, {length: Math.min(512, tokenizer.fileInfo.size), mayBeLess: true});\r\n\r\n\t\t// Requires a buffer size of 512 bytes\r\n\t\tif ((this.checkString('ustar', {offset: 257}) && (this.checkString('\\0', {offset: 262}) || this.checkString(' ', {offset: 262})))\r\n\t\t\t|| (this.check([0, 0, 0, 0, 0, 0], {offset: 257}) && tarHeaderChecksumMatches(this.buffer))) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'tar',\r\n\t\t\t\tmime: 'application/x-tar',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0xFF, 0xFE])) { // UTF-16-BOM-LE\r\n\t\t\tconst encoding = 'utf-16le';\r\n\t\t\tif (this.checkString('<?xml ', {offset: 2, encoding})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'xml',\r\n\t\t\t\t\tmime: 'application/xml',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (this.check([0xFF, 0x0E], {offset: 2}) && this.checkString('SketchUp Model', {offset: 4, encoding})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'skp',\r\n\t\t\t\t\tmime: 'application/vnd.sketchup.skp',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (this.checkString('Windows Registry Editor Version 5.00\\r\\n', {offset: 2, encoding})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'reg',\r\n\t\t\t\t\tmime: 'application/x-ms-regedit',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn undefined; // Some text based format\r\n\t\t}\r\n\r\n\t\tif (this.checkString('-----BEGIN PGP MESSAGE-----')) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'pgp',\r\n\t\t\t\tmime: 'application/pgp-encrypted',\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\t// Detections with limited supporting data, resulting in a higher likelihood of false positives\r\n\tdetectImprecise = async tokenizer => {\r\n\t\tthis.buffer = new Uint8Array(reasonableDetectionSizeInBytes);\r\n\r\n\t\t// Read initial sample size of 8 bytes\r\n\t\tawait tokenizer.peekBuffer(this.buffer, {length: Math.min(8, tokenizer.fileInfo.size), mayBeLess: true});\r\n\r\n\t\tif (\r\n\t\t\tthis.check([0x0, 0x0, 0x1, 0xBA])\r\n\t\t\t|| this.check([0x0, 0x0, 0x1, 0xB3])\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'mpg',\r\n\t\t\t\tmime: 'video/mpeg',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x00, 0x01, 0x00, 0x00, 0x00])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'ttf',\r\n\t\t\t\tmime: 'font/ttf',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x00, 0x00, 0x01, 0x00])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'ico',\r\n\t\t\t\tmime: 'image/x-icon',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.check([0x00, 0x00, 0x02, 0x00])) {\r\n\t\t\treturn {\r\n\t\t\t\text: 'cur',\r\n\t\t\t\tmime: 'image/x-icon',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Adjust buffer to `mpegOffsetTolerance`\r\n\t\tawait tokenizer.peekBuffer(this.buffer, {length: Math.min(2 + this.options.mpegOffsetTolerance, tokenizer.fileInfo.size), mayBeLess: true});\r\n\r\n\t\t// Check MPEG 1 or 2 Layer 3 header, or 'layer 0' for ADTS (MPEG sync-word 0xFFE)\r\n\t\tif (this.buffer.length >= (2 + this.options.mpegOffsetTolerance)) {\r\n\t\t\tfor (let depth = 0; depth <= this.options.mpegOffsetTolerance; ++depth) {\r\n\t\t\t\tconst type = this.scanMpeg(depth);\r\n\t\t\t\tif (type) {\r\n\t\t\t\t\treturn type;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tasync readTiffTag(bigEndian) {\r\n\t\tconst tagId = await this.tokenizer.readToken(bigEndian ? Token.UINT16_BE : Token.UINT16_LE);\r\n\t\tthis.tokenizer.ignore(10);\r\n\t\tswitch (tagId) {\r\n\t\t\tcase 50_341:\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'arw',\r\n\t\t\t\t\tmime: 'image/x-sony-arw',\r\n\t\t\t\t};\r\n\t\t\tcase 50_706:\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'dng',\r\n\t\t\t\t\tmime: 'image/x-adobe-dng',\r\n\t\t\t\t};\r\n\t\t\tdefault:\r\n\t\t}\r\n\t}\r\n\r\n\tasync readTiffIFD(bigEndian) {\r\n\t\tconst numberOfTags = await this.tokenizer.readToken(bigEndian ? Token.UINT16_BE : Token.UINT16_LE);\r\n\t\tfor (let n = 0; n < numberOfTags; ++n) {\r\n\t\t\tconst fileType = await this.readTiffTag(bigEndian);\r\n\t\t\tif (fileType) {\r\n\t\t\t\treturn fileType;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync readTiffHeader(bigEndian) {\r\n\t\tconst version = (bigEndian ? Token.UINT16_BE : Token.UINT16_LE).get(this.buffer, 2);\r\n\t\tconst ifdOffset = (bigEndian ? Token.UINT32_BE : Token.UINT32_LE).get(this.buffer, 4);\r\n\r\n\t\tif (version === 42) {\r\n\t\t\t// TIFF file header\r\n\t\t\tif (ifdOffset >= 6) {\r\n\t\t\t\tif (this.checkString('CR', {offset: 8})) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'cr2',\r\n\t\t\t\t\t\tmime: 'image/x-canon-cr2',\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (ifdOffset >= 8) {\r\n\t\t\t\t\tconst someId1 = (bigEndian ? Token.UINT16_BE : Token.UINT16_LE).get(this.buffer, 8);\r\n\t\t\t\t\tconst someId2 = (bigEndian ? Token.UINT16_BE : Token.UINT16_LE).get(this.buffer, 10);\r\n\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\t(someId1 === 0x1C && someId2 === 0xFE)\r\n\t\t\t\t\t\t|| (someId1 === 0x1F && someId2 === 0x0B)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\text: 'nef',\r\n\t\t\t\t\t\t\tmime: 'image/x-nikon-nef',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tawait this.tokenizer.ignore(ifdOffset);\r\n\t\t\tconst fileType = await this.readTiffIFD(bigEndian);\r\n\t\t\treturn fileType ?? {\r\n\t\t\t\text: 'tif',\r\n\t\t\t\tmime: 'image/tiff',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (version === 43) {\t// Big TIFF file header\r\n\t\t\treturn {\r\n\t\t\t\text: 'tif',\r\n\t\t\t\tmime: 'image/tiff',\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\tScan check MPEG 1 or 2 Layer 3 header, or 'layer 0' for ADTS (MPEG sync-word 0xFFE).\r\n\r\n\t@param offset - Offset to scan for sync-preamble.\r\n\t@returns {{ext: string, mime: string}}\r\n\t*/\r\n\tscanMpeg(offset) {\r\n\t\tif (this.check([0xFF, 0xE0], {offset, mask: [0xFF, 0xE0]})) {\r\n\t\t\tif (this.check([0x10], {offset: offset + 1, mask: [0x16]})) {\r\n\t\t\t\t// Check for (ADTS) MPEG-2\r\n\t\t\t\tif (this.check([0x08], {offset: offset + 1, mask: [0x08]})) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\text: 'aac',\r\n\t\t\t\t\t\tmime: 'audio/aac',\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Must be (ADTS) MPEG-4\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'aac',\r\n\t\t\t\t\tmime: 'audio/aac',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// MPEG 1 or 2 Layer 3 header\r\n\t\t\t// Check for MPEG layer 3\r\n\t\t\tif (this.check([0x02], {offset: offset + 1, mask: [0x06]})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'mp3',\r\n\t\t\t\t\tmime: 'audio/mpeg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Check for MPEG layer 2\r\n\t\t\tif (this.check([0x04], {offset: offset + 1, mask: [0x06]})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'mp2',\r\n\t\t\t\t\tmime: 'audio/mpeg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t// Check for MPEG layer 1\r\n\t\t\tif (this.check([0x06], {offset: offset + 1, mask: [0x06]})) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\text: 'mp1',\r\n\t\t\t\t\tmime: 'audio/mpeg',\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport const supportedExtensions = new Set(extensions);\r\nexport const supportedMimeTypes = new Set(mimeTypes);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}