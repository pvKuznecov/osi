{"ast":null,"code":"import * as Token from 'token-types';\nimport { FourCcToken } from '../common/FourCC.js';\nconst SampleRates = [6000, 8000, 9600, 11025, 12000, 16000, 22050, 24000, 32000, 44100, 48000, 64000, 88200, 96000, 192000, -1];\n/**\n * WavPack Block Header\n *\n * 32-byte little-endian header at the front of every WavPack block\n *\n * Ref: http://www.wavpack.com/WavPack5FileFormat.pdf (page 2/6: 2.0 \"Block Header\")\n */\nexport const BlockHeaderToken = {\n  len: 32,\n  get: (buf, off) => {\n    const flags = Token.UINT32_LE.get(buf, off + 24);\n    const res = {\n      // should equal 'wvpk'\n      BlockID: FourCcToken.get(buf, off),\n      //  0x402 to 0x410 are valid for decode\n      blockSize: Token.UINT32_LE.get(buf, off + 4),\n      //  0x402 (1026) to 0x410 are valid for decode\n      version: Token.UINT16_LE.get(buf, off + 8),\n      //  40-bit total samples for entire file (if block_index == 0 and a value of -1 indicates an unknown length)\n      totalSamples: /* replace with bigint? (Token.UINT8.get(buf, off + 11) << 32) + */Token.UINT32_LE.get(buf, off + 12),\n      // 40-bit block_index\n      blockIndex: /* replace with bigint? (Token.UINT8.get(buf, off + 10) << 32) + */Token.UINT32_LE.get(buf, off + 16),\n      // 40-bit total samples for entire file (if block_index == 0 and a value of -1 indicates an unknown length)\n      blockSamples: Token.UINT32_LE.get(buf, off + 20),\n      // various flags for id and decoding\n      flags: {\n        bitsPerSample: (1 + getBitAllignedNumber(flags, 0, 2)) * 8,\n        isMono: isBitSet(flags, 2),\n        isHybrid: isBitSet(flags, 3),\n        isJointStereo: isBitSet(flags, 4),\n        crossChannel: isBitSet(flags, 5),\n        hybridNoiseShaping: isBitSet(flags, 6),\n        floatingPoint: isBitSet(flags, 7),\n        samplingRate: SampleRates[getBitAllignedNumber(flags, 23, 4)],\n        isDSD: isBitSet(flags, 31)\n      },\n      // crc for actual decoded data\n      crc: new Token.Uint8ArrayType(4).get(buf, off + 28)\n    };\n    if (res.flags.isDSD) {\n      res.totalSamples *= 8;\n    }\n    return res;\n  }\n};\n/**\n * 3.0 Metadata Sub-Blocks\n * Ref: http://www.wavpack.com/WavPack5FileFormat.pdf (page 4/6: 3.0 \"Metadata Sub-Block\")\n */\nexport const MetadataIdToken = {\n  len: 1,\n  get: (buf, off) => {\n    return {\n      functionId: getBitAllignedNumber(buf[off], 0, 6),\n      // functionId overlaps with isOptional flag\n      isOptional: isBitSet(buf[off], 5),\n      isOddSize: isBitSet(buf[off], 6),\n      largeBlock: isBitSet(buf[off], 7)\n    };\n  }\n};\nfunction isBitSet(flags, bitOffset) {\n  return getBitAllignedNumber(flags, bitOffset, 1) === 1;\n}\nfunction getBitAllignedNumber(flags, bitOffset, len) {\n  return flags >>> bitOffset & 0xffffffff >>> 32 - len;\n}","map":{"version":3,"names":["Token","FourCcToken","SampleRates","BlockHeaderToken","len","get","buf","off","flags","UINT32_LE","res","BlockID","blockSize","version","UINT16_LE","totalSamples","blockIndex","blockSamples","bitsPerSample","getBitAllignedNumber","isMono","isBitSet","isHybrid","isJointStereo","crossChannel","hybridNoiseShaping","floatingPoint","samplingRate","isDSD","crc","Uint8ArrayType","MetadataIdToken","functionId","isOptional","isOddSize","largeBlock","bitOffset"],"sources":["/home/kup/my_projects/vue/osi/node_modules/music-metadata/lib/wavpack/WavPackToken.js"],"sourcesContent":["import * as Token from 'token-types';\nimport { FourCcToken } from '../common/FourCC.js';\nconst SampleRates = [6000, 8000, 9600, 11025, 12000, 16000, 22050, 24000, 32000, 44100,\n    48000, 64000, 88200, 96000, 192000, -1];\n/**\n * WavPack Block Header\n *\n * 32-byte little-endian header at the front of every WavPack block\n *\n * Ref: http://www.wavpack.com/WavPack5FileFormat.pdf (page 2/6: 2.0 \"Block Header\")\n */\nexport const BlockHeaderToken = {\n    len: 32,\n    get: (buf, off) => {\n        const flags = Token.UINT32_LE.get(buf, off + 24);\n        const res = {\n            // should equal 'wvpk'\n            BlockID: FourCcToken.get(buf, off),\n            //  0x402 to 0x410 are valid for decode\n            blockSize: Token.UINT32_LE.get(buf, off + 4),\n            //  0x402 (1026) to 0x410 are valid for decode\n            version: Token.UINT16_LE.get(buf, off + 8),\n            //  40-bit total samples for entire file (if block_index == 0 and a value of -1 indicates an unknown length)\n            totalSamples: /* replace with bigint? (Token.UINT8.get(buf, off + 11) << 32) + */ Token.UINT32_LE.get(buf, off + 12),\n            // 40-bit block_index\n            blockIndex: /* replace with bigint? (Token.UINT8.get(buf, off + 10) << 32) + */ Token.UINT32_LE.get(buf, off + 16),\n            // 40-bit total samples for entire file (if block_index == 0 and a value of -1 indicates an unknown length)\n            blockSamples: Token.UINT32_LE.get(buf, off + 20),\n            // various flags for id and decoding\n            flags: {\n                bitsPerSample: (1 + getBitAllignedNumber(flags, 0, 2)) * 8,\n                isMono: isBitSet(flags, 2),\n                isHybrid: isBitSet(flags, 3),\n                isJointStereo: isBitSet(flags, 4),\n                crossChannel: isBitSet(flags, 5),\n                hybridNoiseShaping: isBitSet(flags, 6),\n                floatingPoint: isBitSet(flags, 7),\n                samplingRate: SampleRates[getBitAllignedNumber(flags, 23, 4)],\n                isDSD: isBitSet(flags, 31)\n            },\n            // crc for actual decoded data\n            crc: new Token.Uint8ArrayType(4).get(buf, off + 28)\n        };\n        if (res.flags.isDSD) {\n            res.totalSamples *= 8;\n        }\n        return res;\n    }\n};\n/**\n * 3.0 Metadata Sub-Blocks\n * Ref: http://www.wavpack.com/WavPack5FileFormat.pdf (page 4/6: 3.0 \"Metadata Sub-Block\")\n */\nexport const MetadataIdToken = {\n    len: 1,\n    get: (buf, off) => {\n        return {\n            functionId: getBitAllignedNumber(buf[off], 0, 6), // functionId overlaps with isOptional flag\n            isOptional: isBitSet(buf[off], 5),\n            isOddSize: isBitSet(buf[off], 6),\n            largeBlock: isBitSet(buf[off], 7)\n        };\n    }\n};\nfunction isBitSet(flags, bitOffset) {\n    return getBitAllignedNumber(flags, bitOffset, 1) === 1;\n}\nfunction getBitAllignedNumber(flags, bitOffset, len) {\n    return (flags >>> bitOffset) & (0xffffffff >>> (32 - len));\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}