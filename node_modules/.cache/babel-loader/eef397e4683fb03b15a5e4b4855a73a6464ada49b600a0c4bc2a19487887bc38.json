{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport AutorizationArea from './components/os/AutorizationArea/AutorizationArea.vue';\nimport DesktopArea from './components/os/DesktopArea/DesktopArea.vue';\nimport TaskBar from './components/os/TaskBar/TaskBar.vue';\nimport SimpleWindow from './components/os/SimpleWindow/SimpleWindow.vue';\nimport { useOsStore } from './stores/os.store';\nimport { useAppsStore } from './stores/apps.store';\nimport { usersTable, IDBWindows } from './idb/db';\nexport default {\n  name: 'App',\n  components: {\n    AutorizationArea,\n    DesktopArea,\n    TaskBar,\n    SimpleWindow\n  },\n  data() {\n    return {\n      isAutorized: false,\n      USERID: null,\n      USER: {}\n    };\n  },\n  watch: {\n    // ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ IDBWindows\n    IDBWindows: {\n      handler(newVal) {\n        console.log('IDBWindows changed:', newVal);\n        console.log('zIndices:', newVal?.map(w => ({\n          id: w.id,\n          zIndex: w.zIndex\n        })));\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  computed: {\n    // Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÐºÐ½Ð° Ð¿Ð¾ zIndex Ð´Ð»Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ\n    sortedWindows() {\n      if (!this.IDBWindows) return [];\n\n      // ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ð¼Ð°ÑÑÐ¸Ð² Ð¸ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð¾ zIndex (Ð¾Ñ‚ Ð¼ÐµÐ½ÑŒÑˆÐµÐ³Ð¾ Ðº Ð±Ð¾Ð»ÑŒÑˆÐµÐ¼Ñƒ)\n      // Ð­Ñ‚Ð¾ Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð½Ð°Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¾ÐºÐ¾Ð½\n      return [...this.IDBWindows].sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\n    },\n    IDBWindows() {\n      return IDBWindows.value;\n    },\n    osStore() {\n      return useOsStore();\n    },\n    appsStore() {\n      return useAppsStore();\n    }\n  },\n  // created() {\n  //     this.osStore = useOsStore();\n  //     this.appsStore = useAppsStore();\n  //     // this.useAppsStore = useAppsStore();\n  //     this.usersTable = usersTable;\n  //     // this.IDBWindows = IDBWindows;\n  // },\n\n  methods: {\n    async closeWindow(windowId) {\n      if (this.USERID && usersTable) {\n        try {\n          await usersTable.windows.close(this.USERID, windowId);\n          // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð¾ÐºÐ½Ð° Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ\n          await usersTable.windows.reupdate(this.USERID);\n        } catch (error) {\n          console.error('Error closing window:', error);\n        }\n      }\n      if (this.appsStore) {\n        this.appsStore.deleteWindowState(windowId);\n      }\n    },\n    minimizeWindow(windowId) {\n      if (this.osStore) {\n        this.osStore.minimizeWindow(windowId);\n      }\n    },\n    toggleMaximizeWindow(windowId) {\n      if (this.osStore) {\n        this.osStore.toggleMaximizeWindow(windowId);\n      }\n    },\n    async activateWindow(windowId) {\n      console.log('ðŸŽ¯ App.activateWindow called with:', windowId);\n      console.log('Current USERID:', this.USERID);\n      if (this.USERID && usersTable) {\n        try {\n          // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÐºÐ½Ð¾\n          const result = await usersTable.windows.activate(this.USERID, windowId);\n          console.log('Activation result:', result);\n\n          // Ð—Ð°Ñ‚ÐµÐ¼ Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¾ÐºÐ¾Ð½\n          await usersTable.windows.reupdate(this.USERID);\n          console.log('Reupdate completed');\n\n          // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ\n          console.log('IDBWindows.value after all:', IDBWindows.value.map(w => ({\n            id: w.id,\n            zIndex: w.zIndex\n          })));\n        } catch (error) {\n          console.error('Error activating window:', error);\n        }\n      } else {\n        console.log('Cannot activate: USERID or usersTable missing');\n      }\n    },\n    async selectUser(userId) {\n      this.USERID = userId;\n      if (usersTable) {\n        await usersTable.windows.reupdate(this.USERID);\n      }\n      this.isAutorized = true;\n    }\n  }\n};","map":{"version":3,"names":["AutorizationArea","DesktopArea","TaskBar","SimpleWindow","useOsStore","useAppsStore","usersTable","IDBWindows","name","components","data","isAutorized","USERID","USER","watch","handler","newVal","console","log","map","w","id","zIndex","deep","immediate","computed","sortedWindows","sort","a","b","value","osStore","appsStore","methods","closeWindow","windowId","windows","close","reupdate","error","deleteWindowState","minimizeWindow","toggleMaximizeWindow","activateWindow","result","activate","selectUser","userId"],"sources":["/home/kup/my_projects/vue/osi/src/App.vue"],"sourcesContent":["<template>\n    <AutorizationArea v-if=\"!isAutorized\" @selectUser=\"selectUser\" />\n    <div v-if=\"isAutorized\" class=\"webos\">\n        <DesktopArea :USERID=\"USERID\">\n            <SimpleWindow v-for=\"window in sortedWindows\"\n                :key=\"window.id\"\n                :windowId=\"window.id\"\n                :title=\"window.label\"\n                :appName=\"window.name\"\n        \n                :contentApp=\"window.contentApp\"\n                :icon=\"window.icon\"\n                :iconclass=\"window.iconclass\"\n                :defWidth=\"window.defWidth\"\n                :defHeight=\"window.defHeight\"\n                :isMinimized=\"window.isMinimized\"\n                :isActive=\"osStore.activeWindowId === window.id\"\n                :isMaximized=\"window.isMaximized\"\n                :zIndex=\"window.zIndex\"\n                :resizable=\"window.resizable\"\n                :canMinimize=\"window.canMinimize\"\n\n                :USERID=\"USERID\"\n                \n                @close=\"closeWindow\"\n                @minimize=\"minimizeWindow\"\n                @toggleMaximize=\"toggleMaximizeWindow\"\n                @focus=\"activateWindow\"                \n            />\n        </DesktopArea>\n        <TaskBar :USERID=\"USERID\" />\n    </div>\n</template>\n<style src=\"./styles/global.css\"></style>\n<script>\n    import AutorizationArea from './components/os/AutorizationArea/AutorizationArea.vue';\n    import DesktopArea from './components/os/DesktopArea/DesktopArea.vue';\n    import TaskBar from './components/os/TaskBar/TaskBar.vue';\n    import SimpleWindow from './components/os/SimpleWindow/SimpleWindow.vue';\n    import { useOsStore } from './stores/os.store';\n    import { useAppsStore } from './stores/apps.store';\n    import { usersTable, IDBWindows } from './idb/db';\n\n    export default {\n        name: 'App',\n  \n        components: {\n            AutorizationArea,\n            DesktopArea,\n            TaskBar,\n            SimpleWindow\n        },\n  \n        data() {\n            return {\n                isAutorized: false,\n                USERID: null,\n                USER: {},\n            }\n        },\n\n        watch: {\n            // ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÐ¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ IDBWindows\n            IDBWindows: {\n                handler(newVal) {\n                    console.log('IDBWindows changed:', newVal);\n                    console.log('zIndices:', newVal?.map(w => ({id: w.id, zIndex: w.zIndex})));\n                },\n                deep: true,\n                immediate: true\n            }\n        },\n\n        computed: {\n            // Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÐºÐ½Ð° Ð¿Ð¾ zIndex Ð´Ð»Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ\n            sortedWindows() {\n                if (!this.IDBWindows) return [];\n            \n                // ÐšÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ð¼Ð°ÑÑÐ¸Ð² Ð¸ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð¾ zIndex (Ð¾Ñ‚ Ð¼ÐµÐ½ÑŒÑˆÐµÐ³Ð¾ Ðº Ð±Ð¾Ð»ÑŒÑˆÐµÐ¼Ñƒ)\n                // Ð­Ñ‚Ð¾ Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð½Ð°Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¾ÐºÐ¾Ð½\n                return [...this.IDBWindows].sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\n            },\n\n            IDBWindows() { return IDBWindows.value; },\n            osStore() { return useOsStore(); },\n            appsStore() { return useAppsStore(); },\n        },\n\n        // created() {\n        //     this.osStore = useOsStore();\n        //     this.appsStore = useAppsStore();\n        //     // this.useAppsStore = useAppsStore();\n        //     this.usersTable = usersTable;\n        //     // this.IDBWindows = IDBWindows;\n        // },\n  \n        methods: {\n            async closeWindow(windowId) {\n                if (this.USERID && usersTable) {\n                    try {\n                        await usersTable.windows.close(this.USERID, windowId);\n                        // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð¾ÐºÐ½Ð° Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ\n                        await usersTable.windows.reupdate(this.USERID);\n                    } catch (error) {\n                        console.error('Error closing window:', error);\n                    }\n                }\n\n                if (this.appsStore) {\n                    this.appsStore.deleteWindowState(windowId);\n                }\n            },\n    \n            minimizeWindow(windowId) {\n                if (this.osStore) { \n                    this.osStore.minimizeWindow(windowId); \n                }\n            },\n    \n            toggleMaximizeWindow(windowId) {\n                if (this.osStore) { \n                    this.osStore.toggleMaximizeWindow(windowId); \n                }\n            },\n    \n            async activateWindow(windowId) {\n                console.log('ðŸŽ¯ App.activateWindow called with:', windowId);\n                console.log('Current USERID:', this.USERID);\n                \n                if (this.USERID && usersTable) { \n                    try {\n                        // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÐ¼ Ð¾ÐºÐ½Ð¾\n                        const result = await usersTable.windows.activate(this.USERID, windowId);\n                        console.log('Activation result:', result);\n                        \n                        // Ð—Ð°Ñ‚ÐµÐ¼ Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¾ÐºÐ¾Ð½\n                        await usersTable.windows.reupdate(this.USERID);\n                        console.log('Reupdate completed');\n                        \n                        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ\n                        console.log('IDBWindows.value after all:', IDBWindows.value.map(w => ({id: w.id, zIndex: w.zIndex})));\n                    } catch (error) {\n                        console.error('Error activating window:', error);\n                    }\n                } else {\n                    console.log('Cannot activate: USERID or usersTable missing');\n                }\n            },\n\n            async selectUser(userId) {\n                this.USERID = userId;\n\n                if (usersTable) {\n                    await usersTable.windows.reupdate(this.USERID);\n                }\n                \n                this.isAutorized = true;\n            }\n        },\n    }\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}