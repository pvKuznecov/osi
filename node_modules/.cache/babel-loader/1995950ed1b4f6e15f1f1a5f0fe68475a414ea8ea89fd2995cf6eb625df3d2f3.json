{"ast":null,"code":"import { usersTable } from '@/idb/db';\nimport { JSH } from '@/core/helpers';\nimport { LangPack } from './lang';\nconst EmptyUser = {\n  name: 'User',\n  login: '',\n  password: '',\n  avatar: 'cat.jpg'\n};\nexport default {\n  name: 'AutorizationArea',\n  data() {\n    return {\n      users: [],\n      LangData: {},\n      creating: false,\n      deletion: false,\n      avatarsList: JSH.system.getAvatarsList(),\n      defaultUser: EmptyUser,\n      deletingUser: null,\n      operationNewUserResult: null,\n      operationDelUserResult: null,\n      inpPass: '',\n      introPass: '',\n      addIntro: false,\n      selectedUser: null,\n      introErrorTxt: false\n    };\n  },\n  emits: ['selectUser'],\n  computed: {\n    isNeedPass() {\n      const sUser = this.selectedUser;\n      return sUser && sUser.password !== '' ? true : false;\n    },\n    needInpPassword() {\n      const delUser = this.deletingUser;\n      return delUser && delUser.password === '' ? false : true;\n    },\n    isInpPassword() {\n      const inPass = this.inpPass;\n      return inPass && inPass.length > 0 ? true : false;\n    }\n  },\n  methods: {\n    // // Перезагрузить текущую страницу\n    // reloadPage() { document.location.reload(); },\n\n    pre_selectUser(userData) {\n      this.selectedUser = userData;\n      this.addIntro = true;\n      this.introErrorTxt = false;\n      if (this.isNeedPass) {\n        return true;\n      } else {\n        this.selectUser(userData);\n      }\n    },\n    selectUser(userData) {\n      // todo: придумать адекватную схему защиты учетной записи, пока это скорее затычка\n      if (userData && this.isNeedPass && this.introPass === userData.password) {\n        this.$emit('selectUser', userData.id);\n      } else if (!this.isNeedPass) {\n        this.$emit('selectUser', userData.id);\n      } else {\n        this.introErrorTxt = 'Ошибка! Указан не корректный пароль!';\n      }\n    },\n    async loadUsers() {\n      try {\n        this.users = await usersTable.getAll();\n      } catch (error) {\n        console.error('Ошибка загрузки пользователей:', error);\n        this.$toast.error('Не удалось загрузить пользователей');\n      }\n    },\n    async saveUser() {\n      if (this.defaultUser.login && this.defaultUser.login !== '') {\n        const NUserData = {\n          name: this.defaultUser.name || 'User',\n          login: this.defaultUser.login,\n          password: this.defaultUser.password || '',\n          config: {\n            avatar: this.defaultUser.avatar\n          }\n        };\n        try {\n          const operResult = await usersTable.save(NUserData);\n          console.log('operResult', operResult);\n          this.loadUsers();\n          this.showForm_addUser();\n          this.defaultUser = EmptyUser;\n        } catch (error) {\n          console.error('Ошибка создания пользователя:', error);\n          this.operationNewUserResult = 'Ошибка при создании учетной записи.';\n        }\n      } else {\n        this.operationNewUserResult = 'Ошибка при создании учетной записи: обязательные поля не заполнены!';\n      }\n    },\n    async deleteUser(userId) {\n      const needPass = this.needInpPassword;\n      const iPass = this.inpPass;\n      const targetUser = this.deletingUser;\n      let isValidOper = false;\n\n      // todo: придумать адекватную схему защиты учетной записи, пока это скорее затычка\n      if (targetUser && targetUser.id == userId && needPass && iPass && iPass === targetUser.password) {\n        isValidOper = true;\n      } else if (targetUser && targetUser.id == userId && !needPass) {\n        isValidOper = true;\n      } else {\n        isValidOper = false;\n      }\n      if (isValidOper) {\n        try {\n          const operResult = await usersTable.delete(userId);\n          console.log('operResult', operResult);\n          this.loadUsers();\n          this.defaultUser = EmptyUser;\n          this.deletion = false;\n          this.deletingUser = null;\n          this.inpPass = '';\n        } catch (error) {\n          console.error('Ошибка удаления пользователя:', error);\n          this.operationDelUserResult = 'Ошибка при удалении учетной записи.';\n        }\n      } else if (!isValidOper && needPass) {\n        this.operationDelUserResult = 'Ошибка при удалении учетной записи: указан некорректный пароль.';\n      } else {\n        this.operationDelUserResult = 'Неизвестная ошибка при удалении учетной записи.';\n      }\n    },\n    showForm_addUser() {\n      this.deletingUser = null;\n      this.deletion = false;\n      this.creating = !this.creating;\n    },\n    showForm_delUser(userData = false) {\n      this.operationDelUserResult = null;\n      if (userData) {\n        this.deletingUser = userData;\n        this.creating = false;\n      } else {\n        this.deletingUser = null;\n      }\n      this.deletion = !this.deletion;\n    },\n    getAvatarUrl(avatarName) {\n      const res = `url(${require('@/assets/avatars/' + avatarName)})`;\n      return res;\n    },\n    avatarStyle(avatarName) {\n      const AvatarTemp = {\n        backgroundImage: this.getAvatarUrl(avatarName),\n        backgroundSize: 'cover',\n        backgroundPosition: 'center'\n      };\n      return AvatarTemp;\n    },\n    selectedNewAvatar(avatarName) {\n      this.defaultUser.avatar = avatarName;\n    }\n  },\n  async mounted() {\n    await this.loadUsers();\n    const userLang = navigator.language || navigator.userLanguage;\n    const userLangS = userLang.split('-')[0];\n    this.UserLang = userLangS;\n    const LangPackData = LangPack;\n    this.LangData = userLangS && LangPackData && LangPackData[userLangS] ? LangPackData[userLangS] : LangPackData.en;\n  }\n};","map":{"version":3,"names":["usersTable","JSH","LangPack","EmptyUser","name","login","password","avatar","data","users","LangData","creating","deletion","avatarsList","system","getAvatarsList","defaultUser","deletingUser","operationNewUserResult","operationDelUserResult","inpPass","introPass","addIntro","selectedUser","introErrorTxt","emits","computed","isNeedPass","sUser","needInpPassword","delUser","isInpPassword","inPass","length","methods","pre_selectUser","userData","selectUser","$emit","id","loadUsers","getAll","error","console","$toast","saveUser","NUserData","config","operResult","save","log","showForm_addUser","deleteUser","userId","needPass","iPass","targetUser","isValidOper","delete","showForm_delUser","getAvatarUrl","avatarName","res","require","avatarStyle","AvatarTemp","backgroundImage","backgroundSize","backgroundPosition","selectedNewAvatar","mounted","userLang","navigator","language","userLanguage","userLangS","split","UserLang","LangPackData","en"],"sources":["/home/kup/my_projects/vue/osi/src/components/os/AutorizationArea/AutorizationArea.vue"],"sourcesContent":["<template src=\"./template.html\"></template>\n<style src=\"./style.css\"></style>\n<script>\n    import { usersTable } from '@/idb/db';\n    import { JSH } from '@/core/helpers';\n    import { LangPack } from './lang';\n\n    const EmptyUser = {\n        name: 'User',\n        login: '',\n        password: '',\n        avatar: 'cat.jpg',\n    };\n    \n    export default {\n        name: 'AutorizationArea',\n  \n        data() {\n            return {\n                users: [],\n                LangData: {},\n                creating: false,\n                deletion: false,\n                avatarsList: JSH.system.getAvatarsList(),\n                defaultUser: EmptyUser,\n                deletingUser: null,\n                operationNewUserResult: null,\n                operationDelUserResult: null,\n                inpPass: '',\n                introPass: '',\n                addIntro: false,\n                selectedUser: null,\n                introErrorTxt: false,\n            }            \n        },\n\n        emits: ['selectUser'],\n\n        computed: {\n            isNeedPass() {\n                const sUser = this.selectedUser;\n\n                return (sUser && sUser.password !== '') ? true : false;\n            },\n\n            needInpPassword() {\n                const delUser = this.deletingUser;\n\n                return (delUser && delUser.password === '') ? false : true;\n            },\n\n            isInpPassword() {\n                const inPass = this.inpPass;\n                return (inPass && inPass.length > 0) ? true : false;\n            },\n        },\n\n        methods: {\n            // // Перезагрузить текущую страницу\n            // reloadPage() { document.location.reload(); },\n\n            pre_selectUser(userData) {\n                this.selectedUser = userData;\n                this.addIntro = true;\n                this.introErrorTxt = false;\n\n                if (this.isNeedPass) {\n                    return true;\n                } else {\n                    this.selectUser(userData);\n                }\n            },\n\n            selectUser(userData) {\n                // todo: придумать адекватную схему защиты учетной записи, пока это скорее затычка\n                if (userData && this.isNeedPass && this.introPass === userData.password) {\n                    this.$emit('selectUser', userData.id);\n                } else if (!this.isNeedPass) {\n                    this.$emit('selectUser', userData.id);\n                } else {\n                    this.introErrorTxt = 'Ошибка! Указан не корректный пароль!';\n                }                \n            },\n\n            async loadUsers() {\n                try {\n                    this.users = await usersTable.getAll();\n                } catch (error) {\n                    console.error('Ошибка загрузки пользователей:', error);\n                    this.$toast.error('Не удалось загрузить пользователей');\n                }\n            },\n\n            async saveUser() {\n                if (this.defaultUser.login && this.defaultUser.login !== '') {\n                    const NUserData = {\n                        name: this.defaultUser.name || 'User',\n                        login: this.defaultUser.login,\n                        password: this.defaultUser.password || '',\n                        config: {\n                            avatar: this.defaultUser.avatar\n                        }\n                    };\n\n                    try {\n                        const operResult = await usersTable.save(NUserData);\n                        console.log('operResult', operResult);\n                        \n                        this.loadUsers();\n                        this.showForm_addUser();\n                        this.defaultUser = EmptyUser;\n                    } catch (error) {\n                        console.error('Ошибка создания пользователя:', error);\n                        this.operationNewUserResult = 'Ошибка при создании учетной записи.'\n                    }\n                } else {\n                    this.operationNewUserResult = 'Ошибка при создании учетной записи: обязательные поля не заполнены!'\n                }\n            },\n\n            async deleteUser(userId) {\n                const needPass = this.needInpPassword;\n                const iPass = this.inpPass;\n                const targetUser = this.deletingUser;\n\n                let isValidOper = false;\n                \n                // todo: придумать адекватную схему защиты учетной записи, пока это скорее затычка\n                if (targetUser && targetUser.id == userId && needPass && iPass && iPass === targetUser.password) {\n                    isValidOper = true;\n                } else if (targetUser && targetUser.id == userId && !needPass) {\n                    isValidOper = true;\n                } else {\n                    isValidOper = false;\n                }\n\n                if (isValidOper) {\n                    try {\n                        const operResult = await usersTable.delete(userId);\n                        console.log('operResult', operResult);\n\n                        this.loadUsers();\n                        this.defaultUser = EmptyUser;\n                        this.deletion = false;\n                        this.deletingUser = null;\n                        this.inpPass = '';\n                    } catch (error) {\n                        console.error('Ошибка удаления пользователя:', error);\n                        this.operationDelUserResult = 'Ошибка при удалении учетной записи.'\n                    }\n                } else if (!isValidOper && needPass) {\n                    this.operationDelUserResult = 'Ошибка при удалении учетной записи: указан некорректный пароль.'\n                } else {\n                    this.operationDelUserResult = 'Неизвестная ошибка при удалении учетной записи.'\n                }            \n            },\n\n            showForm_addUser() {\n                this.deletingUser = null;\n                this.deletion = false;\n                this.creating = !this.creating;\n            },\n\n            showForm_delUser(userData = false) {\n                this.operationDelUserResult = null;\n\n                if (userData) {\n                    this.deletingUser = userData;\n                    this.creating = false;\n                } else {\n                    this.deletingUser = null;\n                }\n\n                this.deletion = !this.deletion;                \n            },\n\n            getAvatarUrl(avatarName) {\n                const res = `url(${require('@/assets/avatars/' + avatarName)})`;\n                return res;\n            },\n\n            avatarStyle(avatarName) {\n                const AvatarTemp = {\n                    backgroundImage: this.getAvatarUrl(avatarName),\n                    backgroundSize: 'cover',\n                    backgroundPosition: 'center',\n                };\n\n                return AvatarTemp;\n            },\n\n            selectedNewAvatar(avatarName) { this.defaultUser.avatar = avatarName; },\n        },\n\n        async mounted() {\n            await this.loadUsers();\n\n            const userLang = navigator.language || navigator.userLanguage;\n            const userLangS = userLang.split('-')[0];\n            \n            this.UserLang = userLangS; \n            \n            const LangPackData = LangPack;\n            this.LangData = (userLangS && LangPackData && LangPackData[userLangS]) ? LangPackData[userLangS] : LangPackData.en;\n        },\n    }\n</script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}