{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"browser-app\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"browser-controls\"\n};\nconst _hoisted_3 = {\n  class: \"url-bar\"\n};\nconst _hoisted_4 = [\"disabled\"];\nconst _hoisted_5 = [\"disabled\"];\nconst _hoisted_6 = {\n  class: \"iframe-wrapper\"\n};\nconst _hoisted_7 = [\"src\"];\nconst _hoisted_8 = {\n  key: 1,\n  class: \"loading-indicator\"\n};\nconst _hoisted_9 = {\n  key: 2,\n  class: \"error-message\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$props.showControls ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.goBack && $options.goBack(...args)),\n    disabled: !$options.canGoBack,\n    title: \"Назад\"\n  }, \"←\", 8, _hoisted_4), _createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.goForward && $options.goForward(...args)),\n    disabled: !$options.canGoForward,\n    title: \"Вперёд\"\n  }, \"→\", 8, _hoisted_5), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.reload && $options.reload(...args)),\n    title: \"Обновить\"\n  }, \"↻\"), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.currentUrl = $event),\n    onKeyup: _cache[4] || (_cache[4] = _withKeys((...args) => $options.navigate && $options.navigate(...args), [\"enter\"])),\n    class: \"url-input\",\n    placeholder: \"Введите URL...\"\n  }, null, 544), [[_vModelText, $data.currentUrl]]), _createElementVNode(\"button\", {\n    onClick: _cache[5] || (_cache[5] = (...args) => $options.navigate && $options.navigate(...args)),\n    class: \"go-btn\"\n  }, \"Перейти\")])])) : _createCommentVNode(\"\", true), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"iframe\", {\n    ref: \"iframeRef\",\n    src: $data.iframeSrc,\n    onLoad: _cache[6] || (_cache[6] = (...args) => $options.onIframeLoad && $options.onIframeLoad(...args)),\n    onError: _cache[7] || (_cache[7] = (...args) => $options.onIframeError && $options.onIframeError(...args)),\n    sandbox: \"allow-scripts allow-same-origin allow-forms allow-popups\",\n    referrerpolicy: \"no-referrer\"\n  }, null, 40, _hoisted_7)]), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [...(_cache[9] || (_cache[9] = [_createElementVNode(\"div\", {\n    class: \"spinner\"\n  }, null, -1), _createElementVNode(\"span\", null, \"Загрузка...\", -1)]))])) : _createCommentVNode(\"\", true), $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_cache[10] || (_cache[10] = _createElementVNode(\"p\", null, \"⚠️ Не удалось загрузить страницу\", -1)), _createElementVNode(\"button\", {\n    onClick: _cache[8] || (_cache[8] = (...args) => $options.reload && $options.reload(...args))\n  }, \"Повторить\")])) : _createCommentVNode(\"\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","$props","showControls","_hoisted_2","_createElementVNode","_hoisted_3","onClick","_cache","args","$options","goBack","disabled","canGoBack","title","_hoisted_4","goForward","canGoForward","_hoisted_5","reload","$data","currentUrl","$event","onKeyup","_withKeys","navigate","placeholder","_hoisted_6","ref","src","iframeSrc","onLoad","onIframeLoad","onError","onIframeError","sandbox","referrerpolicy","loading","_hoisted_8","error","_hoisted_9"],"sources":["/home/kup/my_projects/vue/osi/src/apps/learn/AppWiki/AppWiki.vue"],"sourcesContent":["<template>\n    <div class=\"browser-app\">    \n        <!-- Панель управления браузером -->\n        <div class=\"browser-controls\" v-if=\"showControls\">\n            <div class=\"url-bar\">\n                <button @click=\"goBack\" :disabled=\"!canGoBack\" title=\"Назад\">←</button>\n                <button @click=\"goForward\" :disabled=\"!canGoForward\" title=\"Вперёд\">→</button>\n                <button @click=\"reload\" title=\"Обновить\">↻</button>\n                \n                <input \n                    v-model=\"currentUrl\" \n                    @keyup.enter=\"navigate\" \n                    class=\"url-input\" \n                    placeholder=\"Введите URL...\"\n                />\n                \n                <button @click=\"navigate\" class=\"go-btn\">Перейти</button>\n            </div>\n        </div>\n        \n        <div class=\"iframe-wrapper\">\n            <iframe \n                ref=\"iframeRef\" \n                :src=\"iframeSrc\" \n                @load=\"onIframeLoad\" \n                @error=\"onIframeError\" \n                sandbox=\"allow-scripts allow-same-origin allow-forms allow-popups\" \n                referrerpolicy=\"no-referrer\" \n            ></iframe>\n        </div>    \n        \n        <div v-if=\"loading\" class=\"loading-indicator\">\n            <div class=\"spinner\"></div>\n            <span>Загрузка...</span>\n        </div>\n        \n        <div v-if=\"error\" class=\"error-message\">\n            <p>⚠️ Не удалось загрузить страницу</p>\n            <button @click=\"reload\">Повторить</button>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { useAppsStore } from '@/stores/apps.store';\nimport { mapStores } from 'pinia';\n\nexport default {\n    name: 'AppWiki',\n\n    props: {\n        windowId: {\n            type: String,\n            required: true\n        },\n        showControls: {\n            type: Boolean,\n            default: true\n        }\n    },\n    \n    data() {\n        const defLink = 'https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0';\n\n        // В data() мы НЕ можем использовать this.appsStore\n        // Возвращаем только базовые данные\n        return {\n            currentUrl: defLink,\n            iframeSrc: defLink,\n            loading: true,\n            error: false,\n            history: [defLink],\n            currentHistoryIndex: 0\n        };\n    },\n    \n    computed: {\n        // Подключаем store через mapStores\n        ...mapStores(useAppsStore),\n        \n        canGoBack() {\n            return this.currentHistoryIndex > 0;\n        },\n        \n        canGoForward() {\n            return this.currentHistoryIndex < this.history.length - 1;\n        }\n    },\n\n    watch: {\n        currentUrl(newUrl) {\n            console.log(\"URL changed to:\", newUrl);\n            this.saveState();\n        },\n        currentHistoryIndex() {\n            this.saveState();\n        },\n        history: {\n            handler() {\n                this.saveState();\n            },\n            deep: true\n        }\n    },\n\n    methods: {\n        // Инициализация из store (вызывается в mounted)\n        initFromStore() {\n            if (!this.windowId) return;\n            \n            const savedState = this.appsStore.getWindowState(this.windowId);\n            console.log('Loaded state from store:', savedState);\n            \n            if (savedState) {\n                this.currentUrl = savedState.currentUrl || this.currentUrl;\n                this.iframeSrc = savedState.currentUrl || this.iframeSrc;\n                this.history = savedState.history || this.history;\n                this.currentHistoryIndex = savedState.currentHistoryIndex || this.currentHistoryIndex;\n            }\n        },\n\n        // Сохраняем текущее состояние в store\n        saveState() {\n            if (!this.windowId || !this.appsStore) return;\n            \n            const state = {\n                appType: 'wiki',\n                currentUrl: this.currentUrl,\n                history: [...this.history],\n                currentHistoryIndex: this.currentHistoryIndex,\n                timestamp: Date.now()\n            };\n            \n            this.appsStore.saveWindowState(this.windowId, state);\n        },\n\n        // Навигация по URL\n        navigate() {\n            let url = this.currentUrl.trim();\n            \n            // Добавляем протокол если нужно\n            if (!url.startsWith('http://') && !url.startsWith('https://')) {\n                url = 'https://' + url;\n            }\n            \n            try {\n                // Валидация URL\n                new URL(url);\n                this.iframeSrc = url;\n                this.loading = true;\n                this.error = false;\n                \n                // Добавляем в историю\n                if (url !== this.history[this.currentHistoryIndex]) {\n                    // Отрезаем будущее если мы не на конце истории\n                    this.history = this.history.slice(0, this.currentHistoryIndex + 1);\n                    this.history.push(url);\n                    this.currentHistoryIndex = this.history.length - 1;\n                }\n                \n            } catch (e) {\n                console.error('Invalid URL:', url);\n                this.error = true;\n                this.loading = false;\n            }\n        },\n        \n        // Назад по истории\n        goBack() {\n            if (this.canGoBack) {\n                this.currentHistoryIndex--;\n                this.currentUrl = this.history[this.currentHistoryIndex];\n                this.iframeSrc = this.currentUrl;\n                this.loading = true;\n            }\n        },\n        \n        // Вперёд по истории\n        goForward() {\n            if (this.canGoForward) {\n                this.currentHistoryIndex++;\n                this.currentUrl = this.history[this.currentHistoryIndex];\n                this.iframeSrc = this.currentUrl;\n                this.loading = true;\n            }\n        },\n\n        // Обновление страницы\n        reload() {\n            this.loading = true;\n            this.error = false;\n            \n            // Форсируем перезагрузку iframe\n            const tempSrc = this.iframeSrc;\n            this.iframeSrc = '';\n            \n            // Небольшая задержка для гарантии перезагрузки\n            setTimeout(() => {\n                this.iframeSrc = tempSrc;\n            }, 50);\n        },\n\n        // Загрузка завершена\n        onIframeLoad() {\n            console.log('Wiki iframe loaded successfully');\n            this.loading = false;\n            this.error = false;\n            this.safeGetTitle();\n        },\n\n        // Ошибка загрузки\n        onIframeError() {\n            console.error('Wiki iframe failed to load');\n            this.loading = false;\n            this.error = true;\n        },\n\n        // Безопасное получение заголовка\n        safeGetTitle() {\n            try {\n                const iframe = this.$refs.iframeRef;\n                if (iframe && iframe.contentDocument) {\n                    const title = iframe.contentDocument.title;\n                    if (title) {\n                        console.log('Wiki page title:', title);\n                        // Можно обновить заголовок окна, если нужно\n                        this.$emit('title-change', title);\n                    }\n                }\n            } catch (e) {\n                console.log('Cannot access iframe content due to CORS');\n            }\n        },\n        \n        // Открыть в новой вкладке\n        openInNewTab() {\n            window.open(this.currentUrl, '_blank', 'noopener,noreferrer');\n        }\n    },\n\n    mounted() {\n        console.log('AppWiki mounted with windowId:', this.windowId);\n        \n        // Инициализируем данные из store после монтирования\n        this.initFromStore();\n        \n        // Сохраняем начальное состояние\n        this.saveState();\n    },\n\n    beforeUnmount() {\n        console.log('AppWiki unmounting, windowId:', this.windowId);\n        // Решите, нужно ли удалять состояние при закрытии окна\n        // this.appsStore.deleteWindowState(this.windowId);\n    }\n};\n</script>\n\n<style scoped>\n/* Стили остаются без изменений */\n.browser-app {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    background: white;\n    position: relative;\n}\n\n.browser-controls {\n    background: #f8f9fa;\n    border-bottom: 1px solid #dee2e6;\n    padding: 10px;\n    flex-shrink: 0;\n}\n\n.url-bar {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n.url-bar button {\n    padding: 6px 12px;\n    border: 1px solid #ced4da;\n    background: white;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    min-width: 36px;\n    transition: all 0.2s;\n}\n\n.url-bar button:hover:not(:disabled) {\n    background: #e9ecef;\n}\n\n.url-bar button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.url-input {\n    flex: 1;\n    padding: 8px 12px;\n    border: 1px solid #ced4da;\n    border-radius: 4px;\n    font-size: 14px;\n}\n\n.go-btn {\n    background: #007bff !important;\n    color: white !important;\n    border-color: #007bff !important;\n}\n\n.go-btn:hover {\n    background: #0056b3;\n}\n\n.iframe-wrapper {\n    flex: 1;\n    position: relative;\n    overflow: hidden;\n}\n\n.iframe-wrapper iframe {\n    width: 100%;\n    height: 100%;\n    border: none;\n    display: block;\n}\n\n.loading-indicator {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 10px;\n    background: rgba(255, 255, 255, 0.9);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n    z-index: 10;\n}\n\n.spinner {\n    width: 40px;\n    height: 40px;\n    border: 4px solid #f3f3f3;\n    border-top: 4px solid #007bff;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.error-message {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    text-align: center;\n    background: #f8d7da;\n    border: 1px solid #f5c6cb;\n    padding: 20px;\n    border-radius: 8px;\n    color: #721c24;\n    z-index: 10;\n}\n\n.error-message button {\n    margin-top: 10px;\n    padding: 8px 16px;\n    background: #dc3545;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n}\n</style>"],"mappings":";;EACSA,KAAK,EAAC;AAAa;;;EAEfA,KAAK,EAAC;;;EACFA,KAAK,EAAC;AAAS;;;;EAgBnBA,KAAK,EAAC;AAAgB;;;;EAWPA,KAAK,EAAC;;;;EAKRA,KAAK,EAAC;;;uBAnC5BC,mBAAA,CAuCM,OAvCNC,UAuCM,GArCkCC,MAAA,CAAAC,YAAY,I,cAAhDH,mBAAA,CAeM,OAfNI,UAeM,GAdFC,mBAAA,CAaM,OAbNC,UAaM,GAZFD,mBAAA,CAAuE;IAA9DE,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAC,MAAA,IAAAD,QAAA,CAAAC,MAAA,IAAAF,IAAA,CAAM;IAAGG,QAAQ,GAAGF,QAAA,CAAAG,SAAS;IAAEC,KAAK,EAAC;KAAQ,GAAC,KAAAC,UAAA,GAC9DV,mBAAA,CAA8E;IAArEE,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAM,SAAA,IAAAN,QAAA,CAAAM,SAAA,IAAAP,IAAA,CAAS;IAAGG,QAAQ,GAAGF,QAAA,CAAAO,YAAY;IAAEH,KAAK,EAAC;KAAS,GAAC,KAAAI,UAAA,GACrEb,mBAAA,CAAmD;IAA1CE,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAS,MAAA,IAAAT,QAAA,CAAAS,MAAA,IAAAV,IAAA,CAAM;IAAEK,KAAK,EAAC;KAAW,GAAC,G,gBAE1CT,mBAAA,CAKE;+DAJWe,KAAA,CAAAC,UAAU,GAAAC,MAAA;IAClBC,OAAK,EAAAf,MAAA,QAAAA,MAAA,MAAAgB,SAAA,KAAAf,IAAA,KAAQC,QAAA,CAAAe,QAAA,IAAAf,QAAA,CAAAe,QAAA,IAAAhB,IAAA,CAAQ;IACtBV,KAAK,EAAC,WAAW;IACjB2B,WAAW,EAAC;gCAHHN,KAAA,CAAAC,UAAU,E,GAMvBhB,mBAAA,CAAyD;IAAhDE,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAe,QAAA,IAAAf,QAAA,CAAAe,QAAA,IAAAhB,IAAA,CAAQ;IAAEV,KAAK,EAAC;KAAS,SAAO,E,sCAIxDM,mBAAA,CASM,OATNsB,UASM,GARFtB,mBAAA,CAOU;IANNuB,GAAG,EAAC,WAAW;IACdC,GAAG,EAAET,KAAA,CAAAU,SAAS;IACdC,MAAI,EAAAvB,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAsB,YAAA,IAAAtB,QAAA,CAAAsB,YAAA,IAAAvB,IAAA,CAAY;IAClBwB,OAAK,EAAAzB,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAwB,aAAA,IAAAxB,QAAA,CAAAwB,aAAA,IAAAzB,IAAA,CAAa;IACrB0B,OAAO,EAAC,0DAA0D;IAClEC,cAAc,EAAC;8BAIZhB,KAAA,CAAAiB,OAAO,I,cAAlBrC,mBAAA,CAGM,OAHNsC,UAGM,OAAA9B,MAAA,QAAAA,MAAA,OAFFH,mBAAA,CAA2B;IAAtBN,KAAK,EAAC;EAAS,cACpBM,mBAAA,CAAwB,cAAlB,aAAW,M,uCAGVe,KAAA,CAAAmB,KAAK,I,cAAhBvC,mBAAA,CAGM,OAHNwC,UAGM,G,4BAFFnC,mBAAA,CAAuC,WAApC,kCAAgC,QACnCA,mBAAA,CAA0C;IAAjCE,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAS,MAAA,IAAAT,QAAA,CAAAS,MAAA,IAAAV,IAAA,CAAM;KAAE,WAAS,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}