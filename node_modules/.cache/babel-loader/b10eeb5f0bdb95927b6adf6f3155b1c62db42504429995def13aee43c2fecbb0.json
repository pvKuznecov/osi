{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 1,\n  class: \"webos\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_AutorizationArea = _resolveComponent(\"AutorizationArea\");\n  const _component_SimpleWindow = _resolveComponent(\"SimpleWindow\");\n  const _component_DesktopArea = _resolveComponent(\"DesktopArea\");\n  const _component_TaskBar = _resolveComponent(\"TaskBar\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [!$setup.isAutorized ? (_openBlock(), _createBlock(_component_AutorizationArea, {\n    key: 0,\n    onSelectUser: $setup.selectUser\n  }, null, 8 /* PROPS */, [\"onSelectUser\"])) : _createCommentVNode(\"v-if\", true), $setup.isAutorized ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_DesktopArea, {\n    USERID: $setup.USERID\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.sortedWindows, window => {\n      return _openBlock(), _createBlock(_component_SimpleWindow, {\n        key: window.id,\n        windowId: window.id,\n        title: window.label,\n        appName: window.name,\n        icon: window.icon,\n        iconclass: window.iconclass,\n        defWidth: window.defWidth,\n        defHeight: window.defHeight,\n        isMinimized: window.isMinimized,\n        isActive: $setup.activeWindowId === window.id,\n        isMaximized: window.isMaximized,\n        zIndex: window.zIndex,\n        resizable: window.resizable,\n        canMinimize: window.canMinimize,\n        USERID: $setup.USERID,\n        onClose: $setup.closeWindow,\n        onMinimize: $setup.minimizeWindow,\n        onToggleMaximize: $setup.toggleMaximizeWindow,\n        onFocus: $setup.activateWindow\n      }, null, 8 /* PROPS */, [\"windowId\", \"title\", \"appName\", \"icon\", \"iconclass\", \"defWidth\", \"defHeight\", \"isMinimized\", \"isActive\", \"isMaximized\", \"zIndex\", \"resizable\", \"canMinimize\", \"USERID\", \"onClose\", \"onMinimize\", \"onToggleMaximize\", \"onFocus\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"USERID\"]), _createVNode(_component_TaskBar, {\n    USERID: $setup.USERID\n  }, null, 8 /* PROPS */, [\"USERID\"])])) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","$setup","isAutorized","_createBlock","_component_AutorizationArea","onSelectUser","selectUser","_createElementBlock","_hoisted_1","_createVNode","_component_DesktopArea","USERID","_Fragment","_renderList","sortedWindows","window","_component_SimpleWindow","key","id","windowId","title","label","appName","name","icon","iconclass","defWidth","defHeight","isMinimized","isActive","activeWindowId","isMaximized","zIndex","resizable","canMinimize","onClose","closeWindow","onMinimize","minimizeWindow","onToggleMaximize","toggleMaximizeWindow","onFocus","activateWindow","_component_TaskBar"],"sources":["/home/kup/my_projects/vue/osi/src/App.vue"],"sourcesContent":["<template>\n    <AutorizationArea v-if=\"!isAutorized\" @selectUser=\"selectUser\" />\n    <div v-if=\"isAutorized\" class=\"webos\">\n        <DesktopArea :USERID=\"USERID\">\n            <SimpleWindow \n                v-for=\"window in sortedWindows\"\n                :key=\"window.id\"\n                :windowId=\"window.id\"\n                :title=\"window.label\"\n                :appName=\"window.name\"\n                :icon=\"window.icon\"\n                :iconclass=\"window.iconclass\"\n                :defWidth=\"window.defWidth\"\n                :defHeight=\"window.defHeight\"\n                :isMinimized=\"window.isMinimized\"\n                :isActive=\"activeWindowId === window.id\"\n                :isMaximized=\"window.isMaximized\"\n                :zIndex=\"window.zIndex\"\n                :resizable=\"window.resizable\"\n                :canMinimize=\"window.canMinimize\"\n                :USERID=\"USERID\"\n                @close=\"closeWindow\"\n                @minimize=\"minimizeWindow\"\n                @toggleMaximize=\"toggleMaximizeWindow\"\n                @focus=\"activateWindow\"\n            />\n        </DesktopArea>\n        <TaskBar :USERID=\"USERID\" />\n    </div>\n</template>\n\n<style src=\"./styles/global.css\"></style>\n\n<script>\nimport { ref, computed, onMounted, watch } from 'vue';\nimport { useOsStore } from './stores/os.store';\nimport { useAppsStore } from './stores/apps.store';\nimport { usersTable, IDBWindows, activeWindowId } from './idb/db';\n\nimport AutorizationArea from './components/os/AutorizationArea/AutorizationArea.vue';\nimport DesktopArea from './components/os/DesktopArea/DesktopArea.vue';\nimport TaskBar from './components/os/TaskBar/TaskBar.vue';\nimport SimpleWindow from './components/os/SimpleWindow/SimpleWindow.vue';\n\nexport default {\n    name: 'App',\n  \n    components: {\n        AutorizationArea,\n        DesktopArea,\n        TaskBar,\n        SimpleWindow\n    },\n  \n    setup() {\n        console.log('App setup started');\n        \n        // –°–æ—Å—Ç–æ—è–Ω–∏–µ\n        const isAutorized = ref(false);\n        const USERID = ref(null);\n        const USER = ref({});\n        \n        // –°—Ç–æ—Ä—ã\n        const osStore = useOsStore();\n        const appsStore = useAppsStore();\n        \n        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –æ–∫–Ω–∞ –ø–æ zIndex –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –Ω–∞–ª–æ–∂–µ–Ω–∏—è\n        // –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π zIndex –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–µ—Ä—Ö—É, –ø–æ—ç—Ç–æ–º—É —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é\n        const sortedWindows = computed(() => {\n            const windows = IDBWindows.value || [];\n            console.log('Computing sortedWindows:', windows.map(w => ({id: w.id, zIndex: w.zIndex})));\n            \n            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é zIndex (–±–æ–ª—å—à–∏–π zIndex - —Å–≤–µ—Ä—Ö—É)\n            return [...windows].sort((a, b) => (b.zIndex || 0) - (a.zIndex || 0));\n        });\n        \n        // –ê–∫—Ç–∏–≤–Ω—ã–π windowId –∏–∑ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ ref\n        const currentActiveWindowId = computed(() => activeWindowId.value);\n        \n        // –ú–µ—Ç–æ–¥—ã\n        const selectUser = async (userId) => {\n            console.log('selectUser called with userId:', userId);\n            USERID.value = userId;\n            \n            if (usersTable) {\n                try {\n                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n                    const user = await usersTable.getbyId(userId);\n                    USER.value = user;\n                    \n                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω\n                    await usersTable.windows.reupdate(userId);\n                    console.log('Windows reupdated after user selection');\n                } catch (error) {\n                    console.error('Error loading user data:', error);\n                }\n            }\n            \n            isAutorized.value = true;\n            console.log('User authorized');\n        };\n        \n        const closeWindow = async (windowId) => {\n            console.log('closeWindow called with windowId:', windowId);\n            \n            if (USERID.value && usersTable) {\n                try {\n                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤ –ë–î\n                    await usersTable.windows.close(USERID.value, windowId);\n                    \n                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω\n                    await usersTable.windows.reupdate(USERID.value);\n                    \n                    console.log('Window closed successfully');\n                } catch (error) {\n                    console.error('Error closing window:', error);\n                }\n            }\n\n            // –£–¥–∞–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ store\n            if (appsStore) {\n                appsStore.deleteWindowState(windowId);\n            }\n        };\n    \n        const minimizeWindow = async (windowId) => {\n            console.log('minimizeWindow called with windowId:', windowId);\n            \n            if (USERID.value && usersTable) {\n                try {\n                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–∫–Ω–∞\n                    const windows = IDBWindows.value || [];\n                    const windowIndex = windows.findIndex(w => w.id === windowId);\n                    \n                    if (windowIndex !== -1) {\n                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å isMinimized\n                        windows[windowIndex].isMinimized = true;\n                        \n                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ë–î\n                        const user = await usersTable.getbyId(USERID.value);\n                        const uSystemconfig = {\n                            ...user.systemconfig,\n                            windows: windows\n                        };\n                        \n                        await DB.users.where('id').equals(USERID.value)\n                            .modify(user => {\n                                user.systemconfig = uSystemconfig;\n                                user.updatedAt = new Date();\n                            });\n                        \n                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∞–∫—Ç–∏–≤–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é\n                        IDBWindows.value = [...windows];\n                        \n                        console.log('Window minimized');\n                    }\n                } catch (error) {\n                    console.error('Error minimizing window:', error);\n                }\n            }\n        };\n    \n        const toggleMaximizeWindow = async (windowId) => {\n            console.log('toggleMaximizeWindow called with windowId:', windowId);\n            \n            if (USERID.value && usersTable) {\n                try {\n                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–∫–Ω–∞\n                    const windows = IDBWindows.value || [];\n                    const windowIndex = windows.findIndex(w => w.id === windowId);\n                    \n                    if (windowIndex !== -1) {\n                        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ç—É—Å isMaximized\n                        windows[windowIndex].isMaximized = !windows[windowIndex].isMaximized;\n                        \n                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ë–î\n                        const user = await usersTable.getbyId(USERID.value);\n                        const uSystemconfig = {\n                            ...user.systemconfig,\n                            windows: windows\n                        };\n                        \n                        await DB.users.where('id').equals(USERID.value)\n                            .modify(user => {\n                                user.systemconfig = uSystemconfig;\n                                user.updatedAt = new Date();\n                            });\n                        \n                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∞–∫—Ç–∏–≤–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é\n                        IDBWindows.value = [...windows];\n                        \n                        console.log('Window maximized toggled');\n                    }\n                } catch (error) {\n                    console.error('Error toggling maximize window:', error);\n                }\n            }\n        };\n    \n        const activateWindow = async (windowId) => {\n            console.log('üéØ activateWindow called in App.vue with windowId:', windowId);\n            console.log('Current USERID:', USERID.value);\n            \n            if (USERID.value && usersTable) {\n                try {\n                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–∫–Ω–æ (–æ–±–Ω–æ–≤–ª—è–µ–º zIndex)\n                    await usersTable.windows.activate(USERID.value, windowId);\n                    \n                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ–∫–æ–Ω\n                    await usersTable.windows.reupdate(USERID.value);\n                    \n                    console.log('Window activated successfully');\n                } catch (error) {\n                    console.error('Error activating window:', error);\n                }\n            } else {\n                console.log('Cannot activate: USERID or usersTable missing');\n            }\n        };\n        \n        // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ IDBWindows –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\n        watch(() => IDBWindows.value, (newVal, oldVal) => {\n            console.log('IDBWindows changed:', {\n                new: newVal?.map(w => ({id: w.id, zIndex: w.zIndex})),\n                old: oldVal?.map(w => ({id: w.id, zIndex: w.zIndex}))\n            });\n        }, { deep: true, immediate: true });\n        \n        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏\n        onMounted(() => {\n            console.log('App mounted');\n        });\n        \n        return {\n            // –°–æ—Å—Ç–æ—è–Ω–∏–µ\n            isAutorized,\n            USERID,\n            USER,\n            \n            // –°—Ç–æ—Ä—ã\n            osStore,\n            appsStore,\n            \n            // Computed\n            sortedWindows,\n            activeWindowId: currentActiveWindowId,\n            \n            // –ú–µ—Ç–æ–¥—ã\n            selectUser,\n            closeWindow,\n            minimizeWindow,\n            toggleMaximizeWindow,\n            activateWindow\n        };\n    }\n}\n</script>\n\n<style>\n.webos {\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n    position: relative;\n}\n</style>"],"mappings":";;;EAE4BA,KAAK,EAAC;;;;;;;8DADLC,MAAA,CAAAC,WAAW,I,cAApCC,YAAA,CAAiEC,2BAAA;;IAA1BC,YAAU,EAAEJ,MAAA,CAAAK;kFACxCL,MAAA,CAAAC,WAAW,I,cAAtBK,mBAAA,CA0BM,OA1BNC,UA0BM,GAzBFC,YAAA,CAuBcC,sBAAA;IAvBAC,MAAM,EAAEV,MAAA,CAAAU;EAAM;sBAEpB,MAA+B,E,kBADnCJ,mBAAA,CAqBEK,SAAA,QAAAC,WAAA,CApBmBZ,MAAA,CAAAa,aAAa,EAAvBC,MAAM;2BADjBZ,YAAA,CAqBEa,uBAAA;QAnBGC,GAAG,EAAEF,MAAM,CAACG,EAAE;QACdC,QAAQ,EAAEJ,MAAM,CAACG,EAAE;QACnBE,KAAK,EAAEL,MAAM,CAACM,KAAK;QACnBC,OAAO,EAAEP,MAAM,CAACQ,IAAI;QACpBC,IAAI,EAAET,MAAM,CAACS,IAAI;QACjBC,SAAS,EAAEV,MAAM,CAACU,SAAS;QAC3BC,QAAQ,EAAEX,MAAM,CAACW,QAAQ;QACzBC,SAAS,EAAEZ,MAAM,CAACY,SAAS;QAC3BC,WAAW,EAAEb,MAAM,CAACa,WAAW;QAC/BC,QAAQ,EAAE5B,MAAA,CAAA6B,cAAc,KAAKf,MAAM,CAACG,EAAE;QACtCa,WAAW,EAAEhB,MAAM,CAACgB,WAAW;QAC/BC,MAAM,EAAEjB,MAAM,CAACiB,MAAM;QACrBC,SAAS,EAAElB,MAAM,CAACkB,SAAS;QAC3BC,WAAW,EAAEnB,MAAM,CAACmB,WAAW;QAC/BvB,MAAM,EAAEV,MAAA,CAAAU,MAAM;QACdwB,OAAK,EAAElC,MAAA,CAAAmC,WAAW;QAClBC,UAAQ,EAAEpC,MAAA,CAAAqC,cAAc;QACxBC,gBAAc,EAAEtC,MAAA,CAAAuC,oBAAoB;QACpCC,OAAK,EAAExC,MAAA,CAAAyC;;;;iCAGhBjC,YAAA,CAA4BkC,kBAAA;IAAlBhC,MAAM,EAAEV,MAAA,CAAAU;EAAM,oC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}