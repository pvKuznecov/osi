{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  key: 1,\n  class: \"webos\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_AutorizationArea = _resolveComponent(\"AutorizationArea\");\n  const _component_SimpleWindow = _resolveComponent(\"SimpleWindow\");\n  const _component_DesktopArea = _resolveComponent(\"DesktopArea\");\n  const _component_TaskBar = _resolveComponent(\"TaskBar\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [!$data.isAutorized ? (_openBlock(), _createBlock(_component_AutorizationArea, {\n    key: 0,\n    onSelectUser: $options.selectUser\n  }, null, 8 /* PROPS */, [\"onSelectUser\"])) : _createCommentVNode(\"v-if\", true), $data.isAutorized ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_DesktopArea, {\n    USERID: $data.USERID\n  }, {\n    default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($options.sortedWindows, win => {\n      return _openBlock(), _createElementBlock(\"div\", null, _toDisplayString(win), 1 /* TEXT */);\n    }), 256 /* UNKEYED_FRAGMENT */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($options.sortedWindows, window => {\n      return _openBlock(), _createBlock(_component_SimpleWindow, {\n        key: window.id,\n        windowId: window.id,\n        title: window.label,\n        appName: window.name,\n        contentApp: window.contentApp,\n        icon: window.icon,\n        iconclass: window.iconclass,\n        defWidth: window.defWidth,\n        defHeight: window.defHeight,\n        isMinimized: window.isMinimized,\n        isActive: $options.isActiveElem(window.id),\n        isMaximized: window.isMaximized,\n        zIndex: window.zIndex,\n        resizable: window.resizable,\n        canMinimize: window.canMinimize,\n        USERID: $data.USERID,\n        positionx: window.positionx,\n        positiony: window.positiony,\n        onClose: $options.closeWindow,\n        onMinimize: $options.minimizeWindow,\n        onToggleMaximize: $options.toggleMaximizeWindow,\n        onFocus: $options.activateWindow\n      }, null, 8 /* PROPS */, [\"windowId\", \"title\", \"appName\", \"contentApp\", \"icon\", \"iconclass\", \"defWidth\", \"defHeight\", \"isMinimized\", \"isActive\", \"isMaximized\", \"zIndex\", \"resizable\", \"canMinimize\", \"USERID\", \"positionx\", \"positiony\", \"onClose\", \"onMinimize\", \"onToggleMaximize\", \"onFocus\"]);\n    }), 128 /* KEYED_FRAGMENT */))]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"USERID\"]), _createVNode(_component_TaskBar, {\n    USERID: $data.USERID\n  }, null, 8 /* PROPS */, [\"USERID\"])])) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","$data","isAutorized","_createBlock","_component_AutorizationArea","onSelectUser","$options","selectUser","_createElementBlock","_hoisted_1","_createVNode","_component_DesktopArea","USERID","_Fragment","_renderList","sortedWindows","win","_toDisplayString","window","_component_SimpleWindow","key","id","windowId","title","label","appName","name","contentApp","icon","iconclass","defWidth","defHeight","isMinimized","isActive","isActiveElem","isMaximized","zIndex","resizable","canMinimize","positionx","positiony","onClose","closeWindow","onMinimize","minimizeWindow","onToggleMaximize","toggleMaximizeWindow","onFocus","activateWindow","_component_TaskBar"],"sources":["/home/kup/my_projects/vue/osi/src/App.vue"],"sourcesContent":["<template>\n    <AutorizationArea v-if=\"!isAutorized\" @selectUser=\"selectUser\" />\n    <div v-if=\"isAutorized\" class=\"webos\">\n        <DesktopArea :USERID=\"USERID\">\n            <div v-for=\"win in sortedWindows\">{{ win }}</div>\n            <SimpleWindow \n                v-for=\"window in sortedWindows\"\n                :key=\"window.id\"\n                :windowId=\"window.id\"\n                :title=\"window.label\"\n                :appName=\"window.name\"\n                :contentApp=\"window.contentApp\"\n                :icon=\"window.icon\"\n                :iconclass=\"window.iconclass\"\n                :defWidth=\"window.defWidth\"\n                :defHeight=\"window.defHeight\"\n                :isMinimized=\"window.isMinimized\"\n                :isActive=\"isActiveElem(window.id)\"\n                :isMaximized=\"window.isMaximized\"\n                :zIndex=\"window.zIndex\"\n                :resizable=\"window.resizable\"\n                :canMinimize=\"window.canMinimize\"\n                :USERID=\"USERID\"\n                :positionx=\"window.positionx\"\n                :positiony=\"window.positiony\"\n                \n                @close=\"closeWindow\"\n                @minimize=\"minimizeWindow\"\n                @toggleMaximize=\"toggleMaximizeWindow\"\n                @focus=\"activateWindow\"\n            />\n        </DesktopArea>\n        <TaskBar :USERID=\"USERID\" />\n    </div>\n</template>\n<style src=\"./styles/global.css\"></style>\n<script>\nimport AutorizationArea from './components/os/AutorizationArea/AutorizationArea.vue';\nimport DesktopArea from './components/os/DesktopArea/DesktopArea.vue';\nimport TaskBar from './components/os/TaskBar/TaskBar.vue';\nimport SimpleWindow from './components/os/SimpleWindow/SimpleWindow.vue';\nimport { usersTable, IDBWindows, activeWindowId } from './idb/db';\n\nimport { useAppsStore } from './stores/apps.store';\n\nexport default {\n    name: 'App',\n\n    components: {\n        AutorizationArea,\n        DesktopArea,\n        TaskBar,\n        SimpleWindow\n    },\n\n    data() {\n        return {\n            isAutorized: false,\n            USERID: null,\n            USER: {},\n        }\n    },\n\n    computed: {\n        IDBWindows() { return IDBWindows.value; },\n        appsStore() { return useAppsStore(); },\n        // Сортируем окна по zIndex для правильного отображения\n        sortedWindows() {\n            if (!this.IDBWindows) {\n                return [];\n            } else {\n                // Фильтруем свернутые окна - они не отображаются на рабочем столе\n                const visibleWindows = this.IDBWindows.filter(w => !w.isMinimized);\n            \n                // Сортируем по zIndex (от меньшего к большему)\n                return [...visibleWindows].sort((a, b) => (a.zIndex || 0) - (b.zIndex || 0));\n            }\n        },\n    },\n\n    methods: {\n        // проверка на \"это активный элемент\"\n        isActiveElem(windowId) { return windowId === activeWindowId.value; },\n\n        async closeWindow(windowId) {            \n            if (this.USERID && usersTable) {\n                try {\n                    await usersTable.windows.close(this.USERID, windowId);\n                    await usersTable.windows.reupdate(this.USERID);\n                } catch (error) {\n                    console.error('Error closing window:', error);\n                }\n            }\n\n            if (this.appsStore) this.appsStore.deleteWindowState(windowId);\n        },\n    \n        async minimizeWindow(windowId) {            \n            if (this.USERID && usersTable) {\n                try {\n                    await usersTable.windows.minimize(this.USERID, windowId);\n                    await usersTable.windows.reupdate(this.USERID);\n                } catch (error) {\n                    console.error('Error minimizing window:', error);\n                }\n            }\n        },\n    \n        async toggleMaximizeWindow(windowId) {            \n            if (this.USERID && usersTable) {\n                try {\n                    // Получаем текущее состояние окна\n                    const windows = IDBWindows.value || [];\n                    const window = windows.find(w => w.id === windowId);\n                    \n                    if (window) {\n                        // Переключаем состояние максимизации\n                        window.isMaximized = !window.isMaximized;\n                        \n                        // Обновляем в БД\n                        const user = await usersTable.getbyId(this.USERID);\n                        const updatedWindows = windows.map(w => \n                            w.id === windowId ? window : w\n                        );\n                        \n                        await usersTable.save({\n                            ...user,\n                            systemconfig: {\n                                ...user.systemconfig,\n                                windows: updatedWindows\n                            }\n                        });\n                        \n                        await usersTable.windows.reupdate(this.USERID);\n                    }\n                } catch (error) {\n                    console.error('Error toggling maximize window:', error);\n                }\n            }\n        },\n    \n        async activateWindow(windowId) {            \n            if (this.USERID && usersTable) { \n                try {\n                    // Активируем окно (обновляет zIndex и снимает свернутость)\n                    await usersTable.windows.activate(this.USERID, windowId);\n                    // Обновляем список окон\n                    await usersTable.windows.reupdate(this.USERID);\n                } catch (error) {\n                    console.error('Error activating window:', error);\n                }\n            } else {\n                console.log('Cannot activate: USERID or usersTable missing');\n            }\n        },\n\n        async selectUser(userId) {\n            this.USERID = userId;\n\n            if (usersTable) {\n                try {\n                    // Загружаем пользователя\n                    this.USER = await usersTable.getbyId(userId);\n                    // Обновляем список окон\n                    await usersTable.windows.reupdate(userId);\n                } catch (error) {\n                    console.error('Error loading user data:', error);\n                }\n            }\n            \n            this.isAutorized = true;\n        },\n\n        // Метод для восстановления окна из свернутого состояния\n        async restoreWindow(windowId) {            \n            if (this.USERID && usersTable) {\n                try {\n                    // Если у вас есть метод restore в usersTable.windows\n                    if (usersTable.windows.restore) {\n                        await usersTable.windows.restore(this.USERID, windowId);\n                    } else {\n                        // Или используем activate для восстановления\n                        await usersTable.windows.activate(this.USERID, windowId);\n                    }\n                    await usersTable.windows.reupdate(this.USERID);\n                } catch (error) {\n                    console.error('Error restoring window:', error);\n                }\n            }\n        }\n    },\n}\n</script>\n\n<style>\n.webos {\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n    position: relative;\n    background: #1a1a1a;\n}\n</style>"],"mappings":";;;EAE4BA,KAAK,EAAC;;;;;;;8DADLC,KAAA,CAAAC,WAAW,I,cAApCC,YAAA,CAAiEC,2BAAA;;IAA1BC,YAAU,EAAEC,QAAA,CAAAC;kFACxCN,KAAA,CAAAC,WAAW,I,cAAtBM,mBAAA,CA+BM,OA/BNC,UA+BM,GA9BFC,YAAA,CA4BcC,sBAAA;IA5BAC,MAAM,EAAEX,KAAA,CAAAW;EAAM;sBACnB,MAA4B,E,kBAAjCJ,mBAAA,CAAiDK,SAAA,QAAAC,WAAA,CAA9BR,QAAA,CAAAS,aAAa,EAApBC,GAAG;2BAAfR,mBAAA,CAAiD,aAAAS,gBAAA,CAAZD,GAAG;yDACxCR,mBAAA,CAyBEK,SAAA,QAAAC,WAAA,CAxBmBR,QAAA,CAAAS,aAAa,EAAvBG,MAAM;2BADjBf,YAAA,CAyBEgB,uBAAA;QAvBGC,GAAG,EAAEF,MAAM,CAACG,EAAE;QACdC,QAAQ,EAAEJ,MAAM,CAACG,EAAE;QACnBE,KAAK,EAAEL,MAAM,CAACM,KAAK;QACnBC,OAAO,EAAEP,MAAM,CAACQ,IAAI;QACpBC,UAAU,EAAET,MAAM,CAACS,UAAU;QAC7BC,IAAI,EAAEV,MAAM,CAACU,IAAI;QACjBC,SAAS,EAAEX,MAAM,CAACW,SAAS;QAC3BC,QAAQ,EAAEZ,MAAM,CAACY,QAAQ;QACzBC,SAAS,EAAEb,MAAM,CAACa,SAAS;QAC3BC,WAAW,EAAEd,MAAM,CAACc,WAAW;QAC/BC,QAAQ,EAAE3B,QAAA,CAAA4B,YAAY,CAAChB,MAAM,CAACG,EAAE;QAChCc,WAAW,EAAEjB,MAAM,CAACiB,WAAW;QAC/BC,MAAM,EAAElB,MAAM,CAACkB,MAAM;QACrBC,SAAS,EAAEnB,MAAM,CAACmB,SAAS;QAC3BC,WAAW,EAAEpB,MAAM,CAACoB,WAAW;QAC/B1B,MAAM,EAAEX,KAAA,CAAAW,MAAM;QACd2B,SAAS,EAAErB,MAAM,CAACqB,SAAS;QAC3BC,SAAS,EAAEtB,MAAM,CAACsB,SAAS;QAE3BC,OAAK,EAAEnC,QAAA,CAAAoC,WAAW;QAClBC,UAAQ,EAAErC,QAAA,CAAAsC,cAAc;QACxBC,gBAAc,EAAEvC,QAAA,CAAAwC,oBAAoB;QACpCC,OAAK,EAAEzC,QAAA,CAAA0C;;;;iCAGhBtC,YAAA,CAA4BuC,kBAAA;IAAlBrC,MAAM,EAAEX,KAAA,CAAAW;EAAM,oC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}