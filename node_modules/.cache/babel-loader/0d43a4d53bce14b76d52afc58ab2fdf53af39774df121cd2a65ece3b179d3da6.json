{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"browser-app\"\n};\nconst _hoisted_2 = {\n  class: \"iframe-wrapper\"\n};\nconst _hoisted_3 = [\"src\"];\nconst _hoisted_4 = {\n  key: 0,\n  class: \"loading-indicator\"\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"error-message\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [(_openBlock(), _createElementBlock(\"iframe\", {\n    ref: \"iframeRef\",\n    src: $data.iframeSrc,\n    onLoad: _cache[0] || (_cache[0] = (...args) => $options.onIframeLoad && $options.onIframeLoad(...args)),\n    onError: _cache[1] || (_cache[1] = (...args) => $options.onIframeError && $options.onIframeError(...args)),\n    sandbox: \"allow-scripts allow-same-origin allow-forms allow-popups\",\n    referrerpolicy: \"no-referrer\",\n    key: $data.iframeKey\n  }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_3))]), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [...(_cache[3] || (_cache[3] = [_createElementVNode(\"div\", {\n    class: \"spinner\"\n  }, null, -1 /* CACHED */), _createElementVNode(\"span\", null, \"Загрузка...\", -1 /* CACHED */)]))])) : _createCommentVNode(\"v-if\", true), $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_cache[4] || (_cache[4] = _createElementVNode(\"p\", null, \"⚠️ Не удалось загрузить страницу\", -1 /* CACHED */)), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.reload && $options.reload(...args))\n  }, \"Повторить\")])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","ref","src","$data","iframeSrc","onLoad","_cache","args","$options","onIframeLoad","onError","onIframeError","sandbox","referrerpolicy","key","iframeKey","loading","_hoisted_4","error","_hoisted_5","onClick","reload"],"sources":["/home/kup/my_projects/vue/osi/src/apps/learn/AppWiki/AppWiki.vue"],"sourcesContent":["<template>\n    <div class=\"browser-app\">\n        <div class=\"iframe-wrapper\">\n            <iframe ref=\"iframeRef\" :src=\"iframeSrc\" @load=\"onIframeLoad\" @error=\"onIframeError\" sandbox=\"allow-scripts allow-same-origin allow-forms allow-popups\" referrerpolicy=\"no-referrer\" :key=\"iframeKey\"></iframe>\n        </div>    \n        <div v-if=\"loading\" class=\"loading-indicator\">\n            <div class=\"spinner\"></div>\n            <span>Загрузка...</span>\n        </div>\n        \n        <div v-if=\"error\" class=\"error-message\">\n            <p>⚠️ Не удалось загрузить страницу</p>\n            <button @click=\"reload\">Повторить</button>\n        </div>\n    </div>\n</template>\n<script>\n    export default {\n        name: 'AppWiki',\n\n        props: {\n            initialState: {\n                type: Object,\n                default: () => ({})\n            }\n        },\n  \n        data() {\n            return {\n                // Используем сохранённое состояние или дефолтные значения\n                currentUrl: this.initialState.currentUrl || 'https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0',\n                iframeSrc: this.initialState.currentUrl || 'https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%B0%D1%8F_%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B8%D1%86%D0%B0',\n                //   currentUrl: this.initialUrl,\n                // iframeSrc: this.initialUrl,\n                loading: false,\n                error: false,\n      \n                history: this.initialState.history || [this.currentUrl],\n                currentHistoryIndex: this.initialState.currentHistoryIndex || 0,\n      \n                // Ключ для принудительного пересоздания iframe\n                iframeKey: 0\n            };\n        },\n  \n        computed: {\n            canGoBack() {\n                return this.currentHistoryIndex > 0;\n            },\n    \n            canGoForward() {\n                return this.currentHistoryIndex < this.history.length - 1;\n            }\n        },\n  \n        methods: {\n            saveState() {\n                const state = {\n                    currentUrl: this.currentUrl,\n                    history: [...this.history],\n                    currentHistoryIndex: this.currentHistoryIndex\n                };\n                \n                // Эмитим событие для родительского компонента\n                this.$emit('state-change', state);\n            },\n\n\n\n            // Корректный метод навигации\n            navigate() {\n                let url = this.currentUrl.trim();\n      \n                // Добавляем протокол если нужно\n                if (!url.startsWith('http://') && !url.startsWith('https://')) {\n                    url = 'https://' + url;\n                }\n      \n                try {\n                    // Валидация URL\n                    new URL(url);\n                    this.iframeSrc = url;\n                    this.loading = true;\n                    this.error = false;\n        \n                    // Добавляем в историю\n                    if (url !== this.history[this.currentHistoryIndex]) {\n                        // Отрезаем будущее если мы не на конце истории\n                        this.history = this.history.slice(0, this.currentHistoryIndex + 1);\n                        this.history.push(url);\n                        this.currentHistoryIndex = this.history.length - 1;\n                    }\n        \n                    // Принудительно обновляем iframe\n                    this.iframeKey++;\n                    this.saveState();\n                } catch (e) {\n                    console.error('Invalid URL:', url);\n                    this.error = true;\n                }\n            },\n    \n            // Назад/вперёд по НАШЕЙ истории (не iframe!)\n            goBack() {\n                if (this.canGoBack) {\n                    this.currentHistoryIndex--;\n                    this.currentUrl = this.history[this.currentHistoryIndex];\n                    this.iframeSrc = this.currentUrl;\n                    this.loading = true;\n                    this.iframeKey++;\n                }\n            },\n    \n            goForward() {\n                if (this.canGoForward) {\n                    this.currentHistoryIndex++;\n                    this.currentUrl = this.history[this.currentHistoryIndex];\n                    this.iframeSrc = this.currentUrl;\n                    this.loading = true;\n                    this.iframeKey++;\n                }\n            },\n    \n            // Обновление через пересоздание iframe\n            reload() {\n                this.loading = true;\n                this.error = false;\n                // Просто меняем ключ, чтобы Vue пересоздал iframe\n                this.iframeKey++;\n            },\n    \n            // Загрузка завершена\n            onIframeLoad() {\n                this.loading = false;\n                this.error = false;\n                \n                // НЕ пытаемся получить URL из iframe - это вызовет CORS ошибку!\n                // Вместо этого используем наш сохранённый URL\n                \n                // Можно попробовать безопасно получить заголовок\n                this.safeGetTitle();\n            },\n    \n            // Ошибка загрузки\n            onIframeError() {\n                this.loading = false;\n                this.error = true;\n            },\n    \n            // Безопасное получение заголовка (если разрешено)\n            safeGetTitle() {\n                try {\n                    const iframe = this.$refs.iframeRef;\n                    \n                    if (iframe && iframe.contentDocument) {\n                        const title = iframe.contentDocument.title;\n                        if (title) {\n                            console.log('Page title:', title);\n                            // Можно обновить заголовок окна если нужно\n                        }\n                    }\n                } catch (e) {\n                    // CORS - игнорируем\n                    console.log('Cannot access iframe content due to CORS');\n                }\n            },\n    \n            // Открыть в новой вкладке\n            openInNewTab() {\n                window.open(this.currentUrl, '_blank', 'noopener,noreferrer');\n            },\n    \n            // Безопасная навигация внутри iframe (если это наш домен)\n            safeNavigate(url) {\n                try {\n                    const iframe = this.$refs.iframeRef;\n                    \n                    if (iframe && iframe.contentWindow) {\n                        // Только если это тот же origin\n                        if (this.isSameOrigin(iframe.contentWindow.location.href)) {\n                            iframe.contentWindow.location.href = url;\n                        }\n                    }\n                } catch (e) {\n                    // Используем обычную навигацию\n                    this.currentUrl = url;\n                    this.navigate();\n                }\n            },\n    \n            // Проверка same-origin (упрощённо)\n            isSameOrigin(url) {\n                try {\n                    const currentOrigin = window.location.origin;\n                    const targetOrigin = new URL(url).origin;\n                    return currentOrigin === targetOrigin;\n                } catch {\n                    return false;\n                }\n            }\n        },\n  \n        mounted() {\n            this.loading = true;\n        }\n    };\n</script>\n\n<style scoped>\n.browser-app {\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  background: white;\n}\n\n.browser-controls {\n  background: #f8f9fa;\n  border-bottom: 1px solid #dee2e6;\n  padding: 10px;\n  flex-shrink: 0;\n}\n\n.url-bar {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n\n.url-bar button {\n  padding: 6px 12px;\n  border: 1px solid #ced4da;\n  background: white;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n  min-width: 36px;\n  transition: all 0.2s;\n}\n\n.url-bar button:hover:not(:disabled) {\n  background: #e9ecef;\n}\n\n.url-bar button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.url-input {\n  flex: 1;\n  padding: 8px 12px;\n  border: 1px solid #ced4da;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.go-btn {\n  background: #007bff;\n  color: white;\n  border-color: #007bff;\n}\n\n.go-btn:hover {\n  background: #0056b3;\n}\n\n.external-btn {\n  background: #28a745;\n  color: white;\n  border-color: #28a745;\n}\n\n.external-btn:hover {\n  background: #1e7e34;\n}\n\n.iframe-wrapper {\n  flex: 1;\n  position: relative;\n  overflow: hidden;\n}\n\n.iframe-wrapper iframe {\n  width: 100%;\n  height: 100%;\n  border: none;\n  display: block;\n}\n\n.loading-indicator {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 10px;\n  background: rgba(255, 255, 255, 0.9);\n  padding: 20px;\n  border-radius: 8px;\n  box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n}\n\n.spinner {\n  width: 40px;\n  height: 40px;\n  border: 4px solid #f3f3f3;\n  border-top: 4px solid #007bff;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n.error-message {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  text-align: center;\n  background: #f8d7da;\n  border: 1px solid #f5c6cb;\n  padding: 20px;\n  border-radius: 8px;\n  color: #721c24;\n}\n\n.error-message button {\n  margin-top: 10px;\n  padding: 8px 16px;\n  background: #dc3545;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n</style>"],"mappings":";;EACSA,KAAK,EAAC;AAAa;;EACfA,KAAK,EAAC;AAAgB;;;;EAGPA,KAAK,EAAC;;;;EAKRA,KAAK,EAAC;;;uBAT5BC,mBAAA,CAaM,OAbNC,UAaM,GAZFC,mBAAA,CAEM,OAFNC,UAEM,I,cADFH,mBAAA,CAA+M;IAAvMI,GAAG,EAAC,WAAW;IAAEC,GAAG,EAAEC,KAAA,CAAAC,SAAS;IAAGC,MAAI,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAC,YAAA,IAAAD,QAAA,CAAAC,YAAA,IAAAF,IAAA,CAAY;IAAGG,OAAK,EAAAJ,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAG,aAAA,IAAAH,QAAA,CAAAG,aAAA,IAAAJ,IAAA,CAAa;IAAEK,OAAO,EAAC,0DAA0D;IAACC,cAAc,EAAC,aAAa;IAAEC,GAAG,EAAEX,KAAA,CAAAY;2DAEpLZ,KAAA,CAAAa,OAAO,I,cAAlBnB,mBAAA,CAGM,OAHNoB,UAGM,OAAAX,MAAA,QAAAA,MAAA,OAFFP,mBAAA,CAA2B;IAAtBH,KAAK,EAAC;EAAS,2BACpBG,mBAAA,CAAwB,cAAlB,aAAW,mB,2CAGVI,KAAA,CAAAe,KAAK,I,cAAhBrB,mBAAA,CAGM,OAHNsB,UAGM,G,0BAFFpB,mBAAA,CAAuC,WAApC,kCAAgC,qBACnCA,mBAAA,CAA0C;IAAjCqB,OAAK,EAAAd,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAa,MAAA,IAAAb,QAAA,CAAAa,MAAA,IAAAd,IAAA,CAAM;KAAE,WAAS,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}