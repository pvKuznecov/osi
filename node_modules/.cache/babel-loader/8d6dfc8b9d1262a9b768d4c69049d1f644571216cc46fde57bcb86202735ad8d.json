{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { TrackTypeValueToKeyMap } from '../type.js';\nimport initDebug from 'debug';\nimport { isSingleton, isUnique } from './GenericTagTypes.js';\nimport { CombinedTagMapper } from './CombinedTagMapper.js';\nimport { CommonTagMapper } from './GenericTagMapper.js';\nimport { toRatio } from './Util.js';\nimport { fileTypeFromBuffer } from 'file-type';\nimport { parseLyrics } from '../lrc/LyricsParser.js';\nconst debug = initDebug('music-metadata:collector');\nconst TagPriority = ['matroska', 'APEv2', 'vorbis', 'ID3v2.4', 'ID3v2.3', 'ID3v2.2', 'exif', 'asf', 'iTunes', 'AIFF', 'ID3v1'];\n/**\n * Provided to the parser to uodate the metadata result.\n * Responsible for triggering async updates\n */\nexport class MetadataCollector {\n  constructor(opts) {\n    this.format = {\n      tagTypes: [],\n      trackInfo: []\n    };\n    this.native = {};\n    this.common = {\n      track: {\n        no: null,\n        of: null\n      },\n      disk: {\n        no: null,\n        of: null\n      },\n      movementIndex: {\n        no: null,\n        of: null\n      }\n    };\n    this.quality = {\n      warnings: []\n    };\n    /**\n     * Keeps track of origin priority for each mapped id\n     */\n    this.commonOrigin = {};\n    /**\n     * Maps a tag type to a priority\n     */\n    this.originPriority = {};\n    this.tagMapper = new CombinedTagMapper();\n    this.opts = opts;\n    let priority = 1;\n    for (const tagType of TagPriority) {\n      this.originPriority[tagType] = priority++;\n    }\n    this.originPriority.artificial = 500; // Filled using alternative tags\n    this.originPriority.id3v1 = 600; // Consider as the worst because of the field length limit\n  }\n  /**\n   * @returns {boolean} true if one or more tags have been found\n   */\n  hasAny() {\n    return Object.keys(this.native).length > 0;\n  }\n  addStreamInfo(streamInfo) {\n    debug(`streamInfo: type=${streamInfo.type ? TrackTypeValueToKeyMap[streamInfo.type] : '?'}, codec=${streamInfo.codecName}`);\n    this.format.trackInfo.push(streamInfo);\n  }\n  setFormat(key, value) {\n    debug(`format: ${key} = ${value}`);\n    this.format[key] = value; // as any to override readonly\n    if (this.opts?.observer) {\n      this.opts.observer({\n        metadata: this,\n        tag: {\n          type: 'format',\n          id: key,\n          value\n        }\n      });\n    }\n  }\n  setAudioOnly() {\n    this.setFormat('hasAudio', true);\n    this.setFormat('hasVideo', false);\n  }\n  async addTag(tagType, tagId, value) {\n    debug(`tag ${tagType}.${tagId} = ${value}`);\n    if (!this.native[tagType]) {\n      this.format.tagTypes.push(tagType);\n      this.native[tagType] = [];\n    }\n    this.native[tagType].push({\n      id: tagId,\n      value\n    });\n    await this.toCommon(tagType, tagId, value);\n  }\n  addWarning(warning) {\n    this.quality.warnings.push({\n      message: warning\n    });\n  }\n  async postMap(tagType, tag) {\n    // Common tag (alias) found\n    // check if we need to do something special with common tag\n    // if the event has been aliased then we need to clean it before\n    // it is emitted to the user. e.g. genre (20) -> Electronic\n    switch (tag.id) {\n      case 'artist':\n        if (this.commonOrigin.artist === this.originPriority[tagType]) {\n          // Assume the artist field is used as artists\n          return this.postMap('artificial', {\n            id: 'artists',\n            value: tag.value\n          });\n        }\n        if (!this.common.artists) {\n          // Fill artists using artist source\n          this.setGenericTag('artificial', {\n            id: 'artists',\n            value: tag.value\n          });\n        }\n        break;\n      case 'artists':\n        if (!this.common.artist || this.commonOrigin.artist === this.originPriority.artificial) {\n          if (!this.common.artists || this.common.artists.indexOf(tag.value) === -1) {\n            // Fill artist using artists source\n            const artists = (this.common.artists || []).concat([tag.value]);\n            const value = joinArtists(artists);\n            const artistTag = {\n              id: 'artist',\n              value\n            };\n            this.setGenericTag('artificial', artistTag);\n          }\n        }\n        break;\n      case 'picture':\n        return this.postFixPicture(tag.value).then(picture => {\n          if (picture !== null) {\n            tag.value = picture;\n            this.setGenericTag(tagType, tag);\n          }\n        });\n      case 'totaltracks':\n        this.common.track.of = CommonTagMapper.toIntOrNull(tag.value);\n        return;\n      case 'totaldiscs':\n        this.common.disk.of = CommonTagMapper.toIntOrNull(tag.value);\n        return;\n      case 'movementTotal':\n        this.common.movementIndex.of = CommonTagMapper.toIntOrNull(tag.value);\n        return;\n      case 'track':\n      case 'disk':\n      case 'movementIndex':\n        {\n          const of = this.common[tag.id].of; // store of value, maybe maybe overwritten\n          this.common[tag.id] = CommonTagMapper.normalizeTrack(tag.value);\n          this.common[tag.id].of = of != null ? of : this.common[tag.id].of;\n          return;\n        }\n      case 'bpm':\n      case 'year':\n      case 'originalyear':\n        tag.value = Number.parseInt(tag.value, 10);\n        break;\n      case 'date':\n        {\n          // ToDo: be more strict on 'YYYY...'\n          const year = Number.parseInt(tag.value.substr(0, 4), 10);\n          if (!Number.isNaN(year)) {\n            this.common.year = year;\n          }\n          break;\n        }\n      case 'discogs_label_id':\n      case 'discogs_release_id':\n      case 'discogs_master_release_id':\n      case 'discogs_artist_id':\n      case 'discogs_votes':\n        tag.value = typeof tag.value === 'string' ? Number.parseInt(tag.value, 10) : tag.value;\n        break;\n      case 'replaygain_track_gain':\n      case 'replaygain_track_peak':\n      case 'replaygain_album_gain':\n      case 'replaygain_album_peak':\n        tag.value = toRatio(tag.value);\n        break;\n      case 'replaygain_track_minmax':\n        tag.value = tag.value.split(',').map(v => Number.parseInt(v, 10));\n        break;\n      case 'replaygain_undo':\n        {\n          const minMix = tag.value.split(',').map(v => Number.parseInt(v, 10));\n          tag.value = {\n            leftChannel: minMix[0],\n            rightChannel: minMix[1]\n          };\n          break;\n        }\n      case 'gapless': // iTunes gap-less flag\n      case 'compilation':\n      case 'podcast':\n      case 'showMovement':\n        tag.value = tag.value === '1' || tag.value === 1; // boolean\n        break;\n      case 'isrc':\n        {\n          // Only keep unique values\n          const commonTag = this.common[tag.id];\n          if (commonTag && commonTag.indexOf(tag.value) !== -1) return;\n          break;\n        }\n      case 'comment':\n        if (typeof tag.value === 'string') {\n          tag.value = {\n            text: tag.value\n          };\n        }\n        if (tag.value.descriptor === 'iTunPGAP') {\n          this.setGenericTag(tagType, {\n            id: 'gapless',\n            value: tag.value.text === '1'\n          });\n        }\n        break;\n      case 'lyrics':\n        if (typeof tag.value === 'string') {\n          tag.value = parseLyrics(tag.value);\n        }\n        break;\n      default:\n      // nothing to do\n    }\n    if (tag.value !== null) {\n      this.setGenericTag(tagType, tag);\n    }\n  }\n  /**\n   * Convert native tags to common tags\n   * @returns {IAudioMetadata} Native + common tags\n   */\n  toCommonMetadata() {\n    return {\n      format: this.format,\n      native: this.native,\n      quality: this.quality,\n      common: this.common\n    };\n  }\n  /**\n   * Fix some common issues with picture object\n   * @param picture Picture\n   */\n  async postFixPicture(picture) {\n    if (picture.data && picture.data.length > 0) {\n      if (!picture.format) {\n        const fileType = await fileTypeFromBuffer(Uint8Array.from(picture.data)); // ToDO: remove Buffer\n        if (fileType) {\n          picture.format = fileType.mime;\n        } else {\n          return null;\n        }\n      }\n      picture.format = picture.format.toLocaleLowerCase();\n      switch (picture.format) {\n        case 'image/jpg':\n          picture.format = 'image/jpeg';\n        // ToDo: register warning\n      }\n      return picture;\n    }\n    this.addWarning(\"Empty picture tag found\");\n    return null;\n  }\n  /**\n   * Convert native tag to common tags\n   */\n  async toCommon(tagType, tagId, value) {\n    const tag = {\n      id: tagId,\n      value\n    };\n    const genericTag = this.tagMapper.mapTag(tagType, tag, this);\n    if (genericTag) {\n      await this.postMap(tagType, genericTag);\n    }\n  }\n  /**\n   * Set generic tag\n   */\n  setGenericTag(tagType, tag) {\n    debug(`common.${tag.id} = ${tag.value}`);\n    const prio0 = this.commonOrigin[tag.id] || 1000;\n    const prio1 = this.originPriority[tagType];\n    if (isSingleton(tag.id)) {\n      if (prio1 <= prio0) {\n        this.common[tag.id] = tag.value;\n        this.commonOrigin[tag.id] = prio1;\n      } else {\n        return debug(`Ignore native tag (singleton): ${tagType}.${tag.id} = ${tag.value}`);\n      }\n    } else {\n      if (prio1 === prio0) {\n        if (!isUnique(tag.id) || this.common[tag.id].indexOf(tag.value) === -1) {\n          this.common[tag.id].push(tag.value);\n        } else {\n          debug(`Ignore duplicate value: ${tagType}.${tag.id} = ${tag.value}`);\n        }\n        // no effect? this.commonOrigin[tag.id] = prio1;\n      } else if (prio1 < prio0) {\n        this.common[tag.id] = [tag.value];\n        this.commonOrigin[tag.id] = prio1;\n      } else {\n        return debug(`Ignore native tag (list): ${tagType}.${tag.id} = ${tag.value}`);\n      }\n    }\n    if (this.opts?.observer) {\n      this.opts.observer({\n        metadata: this,\n        tag: {\n          type: 'common',\n          id: tag.id,\n          value: tag.value\n        }\n      });\n    }\n    // ToDo: trigger metadata event\n  }\n}\nexport function joinArtists(artists) {\n  if (artists.length > 2) {\n    return `${artists.slice(0, artists.length - 1).join(', ')} & ${artists[artists.length - 1]}`;\n  }\n  return artists.join(' & ');\n}","map":{"version":3,"names":["TrackTypeValueToKeyMap","initDebug","isSingleton","isUnique","CombinedTagMapper","CommonTagMapper","toRatio","fileTypeFromBuffer","parseLyrics","debug","TagPriority","MetadataCollector","constructor","opts","format","tagTypes","trackInfo","native","common","track","no","of","disk","movementIndex","quality","warnings","commonOrigin","originPriority","tagMapper","priority","tagType","artificial","id3v1","hasAny","Object","keys","length","addStreamInfo","streamInfo","type","codecName","push","setFormat","key","value","observer","metadata","tag","id","setAudioOnly","addTag","tagId","toCommon","addWarning","warning","message","postMap","artist","artists","setGenericTag","indexOf","concat","joinArtists","artistTag","postFixPicture","then","picture","toIntOrNull","normalizeTrack","Number","parseInt","year","substr","isNaN","split","map","v","minMix","leftChannel","rightChannel","commonTag","text","descriptor","toCommonMetadata","data","fileType","Uint8Array","from","mime","toLocaleLowerCase","genericTag","mapTag","prio0","prio1","slice","join"],"sources":["/home/kup/my_projects/vue/osi/node_modules/music-metadata/lib/common/MetadataCollector.js"],"sourcesContent":["import { TrackTypeValueToKeyMap, } from '../type.js';\nimport initDebug from 'debug';\nimport { isSingleton, isUnique } from './GenericTagTypes.js';\nimport { CombinedTagMapper } from './CombinedTagMapper.js';\nimport { CommonTagMapper } from './GenericTagMapper.js';\nimport { toRatio } from './Util.js';\nimport { fileTypeFromBuffer } from 'file-type';\nimport { parseLyrics } from '../lrc/LyricsParser.js';\nconst debug = initDebug('music-metadata:collector');\nconst TagPriority = ['matroska', 'APEv2', 'vorbis', 'ID3v2.4', 'ID3v2.3', 'ID3v2.2', 'exif', 'asf', 'iTunes', 'AIFF', 'ID3v1'];\n/**\n * Provided to the parser to uodate the metadata result.\n * Responsible for triggering async updates\n */\nexport class MetadataCollector {\n    constructor(opts) {\n        this.format = {\n            tagTypes: [],\n            trackInfo: []\n        };\n        this.native = {};\n        this.common = {\n            track: { no: null, of: null },\n            disk: { no: null, of: null },\n            movementIndex: { no: null, of: null }\n        };\n        this.quality = {\n            warnings: []\n        };\n        /**\n         * Keeps track of origin priority for each mapped id\n         */\n        this.commonOrigin = {};\n        /**\n         * Maps a tag type to a priority\n         */\n        this.originPriority = {};\n        this.tagMapper = new CombinedTagMapper();\n        this.opts = opts;\n        let priority = 1;\n        for (const tagType of TagPriority) {\n            this.originPriority[tagType] = priority++;\n        }\n        this.originPriority.artificial = 500; // Filled using alternative tags\n        this.originPriority.id3v1 = 600; // Consider as the worst because of the field length limit\n    }\n    /**\n     * @returns {boolean} true if one or more tags have been found\n     */\n    hasAny() {\n        return Object.keys(this.native).length > 0;\n    }\n    addStreamInfo(streamInfo) {\n        debug(`streamInfo: type=${streamInfo.type ? TrackTypeValueToKeyMap[streamInfo.type] : '?'}, codec=${streamInfo.codecName}`);\n        this.format.trackInfo.push(streamInfo);\n    }\n    setFormat(key, value) {\n        debug(`format: ${key} = ${value}`);\n        this.format[key] = value; // as any to override readonly\n        if (this.opts?.observer) {\n            this.opts.observer({ metadata: this, tag: { type: 'format', id: key, value } });\n        }\n    }\n    setAudioOnly() {\n        this.setFormat('hasAudio', true);\n        this.setFormat('hasVideo', false);\n    }\n    async addTag(tagType, tagId, value) {\n        debug(`tag ${tagType}.${tagId} = ${value}`);\n        if (!this.native[tagType]) {\n            this.format.tagTypes.push(tagType);\n            this.native[tagType] = [];\n        }\n        this.native[tagType].push({ id: tagId, value });\n        await this.toCommon(tagType, tagId, value);\n    }\n    addWarning(warning) {\n        this.quality.warnings.push({ message: warning });\n    }\n    async postMap(tagType, tag) {\n        // Common tag (alias) found\n        // check if we need to do something special with common tag\n        // if the event has been aliased then we need to clean it before\n        // it is emitted to the user. e.g. genre (20) -> Electronic\n        switch (tag.id) {\n            case 'artist':\n                if (this.commonOrigin.artist === this.originPriority[tagType]) {\n                    // Assume the artist field is used as artists\n                    return this.postMap('artificial', { id: 'artists', value: tag.value });\n                }\n                if (!this.common.artists) {\n                    // Fill artists using artist source\n                    this.setGenericTag('artificial', { id: 'artists', value: tag.value });\n                }\n                break;\n            case 'artists':\n                if (!this.common.artist || this.commonOrigin.artist === this.originPriority.artificial) {\n                    if (!this.common.artists || this.common.artists.indexOf(tag.value) === -1) {\n                        // Fill artist using artists source\n                        const artists = (this.common.artists || []).concat([tag.value]);\n                        const value = joinArtists(artists);\n                        const artistTag = { id: 'artist', value };\n                        this.setGenericTag('artificial', artistTag);\n                    }\n                }\n                break;\n            case 'picture':\n                return this.postFixPicture(tag.value).then(picture => {\n                    if (picture !== null) {\n                        tag.value = picture;\n                        this.setGenericTag(tagType, tag);\n                    }\n                });\n            case 'totaltracks':\n                this.common.track.of = CommonTagMapper.toIntOrNull(tag.value);\n                return;\n            case 'totaldiscs':\n                this.common.disk.of = CommonTagMapper.toIntOrNull(tag.value);\n                return;\n            case 'movementTotal':\n                this.common.movementIndex.of = CommonTagMapper.toIntOrNull(tag.value);\n                return;\n            case 'track':\n            case 'disk':\n            case 'movementIndex': {\n                const of = this.common[tag.id].of; // store of value, maybe maybe overwritten\n                this.common[tag.id] = CommonTagMapper.normalizeTrack(tag.value);\n                this.common[tag.id].of = of != null ? of : this.common[tag.id].of;\n                return;\n            }\n            case 'bpm':\n            case 'year':\n            case 'originalyear':\n                tag.value = Number.parseInt(tag.value, 10);\n                break;\n            case 'date': {\n                // ToDo: be more strict on 'YYYY...'\n                const year = Number.parseInt(tag.value.substr(0, 4), 10);\n                if (!Number.isNaN(year)) {\n                    this.common.year = year;\n                }\n                break;\n            }\n            case 'discogs_label_id':\n            case 'discogs_release_id':\n            case 'discogs_master_release_id':\n            case 'discogs_artist_id':\n            case 'discogs_votes':\n                tag.value = typeof tag.value === 'string' ? Number.parseInt(tag.value, 10) : tag.value;\n                break;\n            case 'replaygain_track_gain':\n            case 'replaygain_track_peak':\n            case 'replaygain_album_gain':\n            case 'replaygain_album_peak':\n                tag.value = toRatio(tag.value);\n                break;\n            case 'replaygain_track_minmax':\n                tag.value = tag.value.split(',').map(v => Number.parseInt(v, 10));\n                break;\n            case 'replaygain_undo': {\n                const minMix = tag.value.split(',').map(v => Number.parseInt(v, 10));\n                tag.value = {\n                    leftChannel: minMix[0],\n                    rightChannel: minMix[1]\n                };\n                break;\n            }\n            case 'gapless': // iTunes gap-less flag\n            case 'compilation':\n            case 'podcast':\n            case 'showMovement':\n                tag.value = tag.value === '1' || tag.value === 1; // boolean\n                break;\n            case 'isrc': { // Only keep unique values\n                const commonTag = this.common[tag.id];\n                if (commonTag && commonTag.indexOf(tag.value) !== -1)\n                    return;\n                break;\n            }\n            case 'comment':\n                if (typeof tag.value === 'string') {\n                    tag.value = { text: tag.value };\n                }\n                if (tag.value.descriptor === 'iTunPGAP') {\n                    this.setGenericTag(tagType, { id: 'gapless', value: tag.value.text === '1' });\n                }\n                break;\n            case 'lyrics':\n                if (typeof tag.value === 'string') {\n                    tag.value = parseLyrics(tag.value);\n                }\n                break;\n            default:\n            // nothing to do\n        }\n        if (tag.value !== null) {\n            this.setGenericTag(tagType, tag);\n        }\n    }\n    /**\n     * Convert native tags to common tags\n     * @returns {IAudioMetadata} Native + common tags\n     */\n    toCommonMetadata() {\n        return {\n            format: this.format,\n            native: this.native,\n            quality: this.quality,\n            common: this.common\n        };\n    }\n    /**\n     * Fix some common issues with picture object\n     * @param picture Picture\n     */\n    async postFixPicture(picture) {\n        if (picture.data && picture.data.length > 0) {\n            if (!picture.format) {\n                const fileType = await fileTypeFromBuffer(Uint8Array.from(picture.data)); // ToDO: remove Buffer\n                if (fileType) {\n                    picture.format = fileType.mime;\n                }\n                else {\n                    return null;\n                }\n            }\n            picture.format = picture.format.toLocaleLowerCase();\n            switch (picture.format) {\n                case 'image/jpg':\n                    picture.format = 'image/jpeg'; // ToDo: register warning\n            }\n            return picture;\n        }\n        this.addWarning(\"Empty picture tag found\");\n        return null;\n    }\n    /**\n     * Convert native tag to common tags\n     */\n    async toCommon(tagType, tagId, value) {\n        const tag = { id: tagId, value };\n        const genericTag = this.tagMapper.mapTag(tagType, tag, this);\n        if (genericTag) {\n            await this.postMap(tagType, genericTag);\n        }\n    }\n    /**\n     * Set generic tag\n     */\n    setGenericTag(tagType, tag) {\n        debug(`common.${tag.id} = ${tag.value}`);\n        const prio0 = this.commonOrigin[tag.id] || 1000;\n        const prio1 = this.originPriority[tagType];\n        if (isSingleton(tag.id)) {\n            if (prio1 <= prio0) {\n                this.common[tag.id] = tag.value;\n                this.commonOrigin[tag.id] = prio1;\n            }\n            else {\n                return debug(`Ignore native tag (singleton): ${tagType}.${tag.id} = ${tag.value}`);\n            }\n        }\n        else {\n            if (prio1 === prio0) {\n                if (!isUnique(tag.id) || this.common[tag.id].indexOf(tag.value) === -1) {\n                    this.common[tag.id].push(tag.value);\n                }\n                else {\n                    debug(`Ignore duplicate value: ${tagType}.${tag.id} = ${tag.value}`);\n                }\n                // no effect? this.commonOrigin[tag.id] = prio1;\n            }\n            else if (prio1 < prio0) {\n                this.common[tag.id] = [tag.value];\n                this.commonOrigin[tag.id] = prio1;\n            }\n            else {\n                return debug(`Ignore native tag (list): ${tagType}.${tag.id} = ${tag.value}`);\n            }\n        }\n        if (this.opts?.observer) {\n            this.opts.observer({ metadata: this, tag: { type: 'common', id: tag.id, value: tag.value } });\n        }\n        // ToDo: trigger metadata event\n    }\n}\nexport function joinArtists(artists) {\n    if (artists.length > 2) {\n        return `${artists.slice(0, artists.length - 1).join(', ')} & ${artists[artists.length - 1]}`;\n    }\n    return artists.join(' & ');\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}